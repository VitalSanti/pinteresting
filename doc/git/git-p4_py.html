<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>git-p4.py - RDoc Documentation</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../Gemfile.html">Gemfile</a>
  
    <li><a href="../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../README_md.html">README</a>
  
    <li><a href="../Rakefile.html">Rakefile</a>
  
    <li><a href="../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../app/assets/javascripts/pages_js_coffee.html">pages.js.coffee</a>
  
    <li><a href="../app/assets/javascripts/pins_js_coffee.html">pins.js.coffee</a>
  
    <li><a href="../app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="../app/assets/stylesheets/bootstrap_and_customization_css_scss.html">bootstrap_and_customization.css.scss</a>
  
    <li><a href="../app/assets/stylesheets/pages_css_scss.html">pages.css.scss</a>
  
    <li><a href="../app/assets/stylesheets/pins_css_scss.html">pins.css.scss</a>
  
    <li><a href="../config_ru.html">config.ru</a>
  
    <li><a href="../git/COPYING.html">COPYING</a>
  
    <li><a href="../git/Documentation/CodingGuidelines.html">CodingGuidelines</a>
  
    <li><a href="../git/Documentation/Makefile.html">Makefile</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_1_txt.html">1.5.0.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_2_txt.html">1.5.0.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_3_txt.html">1.5.0.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_4_txt.html">1.5.0.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_5_txt.html">1.5.0.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_6_txt.html">1.5.0.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_7_txt.html">1.5.0.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_txt.html">1.5.0</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_1_txt.html">1.5.1.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_2_txt.html">1.5.1.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_3_txt.html">1.5.1.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_4_txt.html">1.5.1.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_5_txt.html">1.5.1.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_6_txt.html">1.5.1.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_txt.html">1.5.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_1_txt.html">1.5.2.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_2_txt.html">1.5.2.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_3_txt.html">1.5.2.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_4_txt.html">1.5.2.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_5_txt.html">1.5.2.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_txt.html">1.5.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_1_txt.html">1.5.3.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_2_txt.html">1.5.3.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_3_txt.html">1.5.3.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_4_txt.html">1.5.3.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_5_txt.html">1.5.3.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_6_txt.html">1.5.3.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_7_txt.html">1.5.3.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_8_txt.html">1.5.3.8</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_txt.html">1.5.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_1_txt.html">1.5.4.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_2_txt.html">1.5.4.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_3_txt.html">1.5.4.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_4_txt.html">1.5.4.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_5_txt.html">1.5.4.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_6_txt.html">1.5.4.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_7_txt.html">1.5.4.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_txt.html">1.5.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_1_txt.html">1.5.5.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_2_txt.html">1.5.5.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_3_txt.html">1.5.5.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_4_txt.html">1.5.5.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_5_txt.html">1.5.5.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_6_txt.html">1.5.5.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_txt.html">1.5.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_1_txt.html">1.5.6.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_2_txt.html">1.5.6.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_3_txt.html">1.5.6.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_4_txt.html">1.5.6.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_5_txt.html">1.5.6.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_6_txt.html">1.5.6.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_txt.html">1.5.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_1_txt.html">1.6.0.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_2_txt.html">1.6.0.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_3_txt.html">1.6.0.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_4_txt.html">1.6.0.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_5_txt.html">1.6.0.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_6_txt.html">1.6.0.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_txt.html">1.6.0</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_1_txt.html">1.6.1.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_2_txt.html">1.6.1.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_3_txt.html">1.6.1.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_4_txt.html">1.6.1.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_txt.html">1.6.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_1_txt.html">1.6.2.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_2_txt.html">1.6.2.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_3_txt.html">1.6.2.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_4_txt.html">1.6.2.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_5_txt.html">1.6.2.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_txt.html">1.6.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_1_txt.html">1.6.3.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_2_txt.html">1.6.3.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_3_txt.html">1.6.3.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_4_txt.html">1.6.3.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_txt.html">1.6.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_1_txt.html">1.6.4.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_2_txt.html">1.6.4.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_3_txt.html">1.6.4.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_4_txt.html">1.6.4.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_5_txt.html">1.6.4.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_txt.html">1.6.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_1_txt.html">1.6.5.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_2_txt.html">1.6.5.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_3_txt.html">1.6.5.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_4_txt.html">1.6.5.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_5_txt.html">1.6.5.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_6_txt.html">1.6.5.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_7_txt.html">1.6.5.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_8_txt.html">1.6.5.8</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_9_txt.html">1.6.5.9</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_txt.html">1.6.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_6_1_txt.html">1.6.6.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_6_2_txt.html">1.6.6.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_6_3_txt.html">1.6.6.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_6_txt.html">1.6.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_1_txt.html">1.7.0.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_2_txt.html">1.7.0.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_3_txt.html">1.7.0.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_4_txt.html">1.7.0.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_5_txt.html">1.7.0.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_6_txt.html">1.7.0.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_7_txt.html">1.7.0.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_8_txt.html">1.7.0.8</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_9_txt.html">1.7.0.9</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_txt.html">1.7.0</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_1_txt.html">1.7.1.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_2_txt.html">1.7.1.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_3_txt.html">1.7.1.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_4_txt.html">1.7.1.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_txt.html">1.7.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_1_txt.html">1.7.10.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_2_txt.html">1.7.10.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_3_txt.html">1.7.10.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_4_txt.html">1.7.10.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_5_txt.html">1.7.10.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_txt.html">1.7.10</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_1_txt.html">1.7.11.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_2_txt.html">1.7.11.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_3_txt.html">1.7.11.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_4_txt.html">1.7.11.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_5_txt.html">1.7.11.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_6_txt.html">1.7.11.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_7_txt.html">1.7.11.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_txt.html">1.7.11</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_1_txt.html">1.7.12.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_2_txt.html">1.7.12.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_3_txt.html">1.7.12.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_4_txt.html">1.7.12.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_txt.html">1.7.12</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_1_txt.html">1.7.2.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_2_txt.html">1.7.2.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_3_txt.html">1.7.2.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_4_txt.html">1.7.2.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_5_txt.html">1.7.2.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_txt.html">1.7.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_1_txt.html">1.7.3.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_2_txt.html">1.7.3.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_3_txt.html">1.7.3.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_4_txt.html">1.7.3.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_5_txt.html">1.7.3.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_txt.html">1.7.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_1_txt.html">1.7.4.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_2_txt.html">1.7.4.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_3_txt.html">1.7.4.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_4_txt.html">1.7.4.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_5_txt.html">1.7.4.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_txt.html">1.7.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_1_txt.html">1.7.5.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_2_txt.html">1.7.5.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_3_txt.html">1.7.5.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_4_txt.html">1.7.5.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_txt.html">1.7.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_1_txt.html">1.7.6.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_2_txt.html">1.7.6.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_3_txt.html">1.7.6.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_4_txt.html">1.7.6.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_5_txt.html">1.7.6.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_6_txt.html">1.7.6.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_txt.html">1.7.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_1_txt.html">1.7.7.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_2_txt.html">1.7.7.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_3_txt.html">1.7.7.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_4_txt.html">1.7.7.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_5_txt.html">1.7.7.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_6_txt.html">1.7.7.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_7_txt.html">1.7.7.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_txt.html">1.7.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_1_txt.html">1.7.8.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_2_txt.html">1.7.8.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_3_txt.html">1.7.8.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_4_txt.html">1.7.8.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_5_txt.html">1.7.8.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_6_txt.html">1.7.8.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_txt.html">1.7.8</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_1_txt.html">1.7.9.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_2_txt.html">1.7.9.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_3_txt.html">1.7.9.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_4_txt.html">1.7.9.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_5_txt.html">1.7.9.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_6_txt.html">1.7.9.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_7_txt.html">1.7.9.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_txt.html">1.7.9</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_0_1_txt.html">1.8.0.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_0_2_txt.html">1.8.0.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_0_3_txt.html">1.8.0.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_0_txt.html">1.8.0</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_1_txt.html">1.8.1.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_2_txt.html">1.8.1.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_3_txt.html">1.8.1.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_4_txt.html">1.8.1.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_5_txt.html">1.8.1.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_6_txt.html">1.8.1.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_txt.html">1.8.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_2_1_txt.html">1.8.2.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_2_2_txt.html">1.8.2.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_2_3_txt.html">1.8.2.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_2_txt.html">1.8.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_1_txt.html">1.8.3.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_2_txt.html">1.8.3.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_3_txt.html">1.8.3.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_4_txt.html">1.8.3.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_txt.html">1.8.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_4_1_txt.html">1.8.4.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_4_txt.html">1.8.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_5_txt.html">1.8.5</a>
  
    <li><a href="../git/Documentation/SubmittingPatches.html">SubmittingPatches</a>
  
    <li><a href="../git/Documentation/asciidoc_conf.html">asciidoc.conf</a>
  
    <li><a href="../git/Documentation/blame-options_txt.html">blame-options</a>
  
    <li><a href="../git/Documentation/build-docdep_perl.html">build-docdep.perl</a>
  
    <li><a href="../git/Documentation/cat-texi_perl.html">cat-texi.perl</a>
  
    <li><a href="../git/Documentation/cmd-list_perl.html">cmd-list.perl</a>
  
    <li><a href="../git/Documentation/config_txt.html">config</a>
  
    <li><a href="../git/Documentation/date-formats_txt.html">date-formats</a>
  
    <li><a href="../git/Documentation/diff-config_txt.html">diff-config</a>
  
    <li><a href="../git/Documentation/diff-format_txt.html">diff-format</a>
  
    <li><a href="../git/Documentation/diff-generate-patch_txt.html">diff-generate-patch</a>
  
    <li><a href="../git/Documentation/diff-options_txt.html">diff-options</a>
  
    <li><a href="../git/Documentation/docbook-xsl_css.html">docbook-xsl.css</a>
  
    <li><a href="../git/Documentation/docbook_xsl.html">docbook.xsl</a>
  
    <li><a href="../git/Documentation/everyday_txt.html">everyday</a>
  
    <li><a href="../git/Documentation/fetch-options_txt.html">fetch-options</a>
  
    <li><a href="../git/Documentation/fix-texi_perl.html">fix-texi.perl</a>
  
    <li><a href="../git/Documentation/git-add_txt.html">git-add</a>
  
    <li><a href="../git/Documentation/git-am_txt.html">git-am</a>
  
    <li><a href="../git/Documentation/git-annotate_txt.html">git-annotate</a>
  
    <li><a href="../git/Documentation/git-apply_txt.html">git-apply</a>
  
    <li><a href="../git/Documentation/git-archimport_txt.html">git-archimport</a>
  
    <li><a href="../git/Documentation/git-archive_txt.html">git-archive</a>
  
    <li><a href="../git/Documentation/git-bisect-lk2009_txt.html">git-bisect-lk2009</a>
  
    <li><a href="../git/Documentation/git-bisect_txt.html">git-bisect</a>
  
    <li><a href="../git/Documentation/git-blame_txt.html">git-blame</a>
  
    <li><a href="../git/Documentation/git-branch_txt.html">git-branch</a>
  
    <li><a href="../git/Documentation/git-bundle_txt.html">git-bundle</a>
  
    <li><a href="../git/Documentation/git-cat-file_txt.html">git-cat-file</a>
  
    <li><a href="../git/Documentation/git-check-attr_txt.html">git-check-attr</a>
  
    <li><a href="../git/Documentation/git-check-ignore_txt.html">git-check-ignore</a>
  
    <li><a href="../git/Documentation/git-check-mailmap_txt.html">git-check-mailmap</a>
  
    <li><a href="../git/Documentation/git-check-ref-format_txt.html">git-check-ref-format</a>
  
    <li><a href="../git/Documentation/git-checkout-index_txt.html">git-checkout-index</a>
  
    <li><a href="../git/Documentation/git-checkout_txt.html">git-checkout</a>
  
    <li><a href="../git/Documentation/git-cherry-pick_txt.html">git-cherry-pick</a>
  
    <li><a href="../git/Documentation/git-cherry_txt.html">git-cherry</a>
  
    <li><a href="../git/Documentation/git-citool_txt.html">git-citool</a>
  
    <li><a href="../git/Documentation/git-clean_txt.html">git-clean</a>
  
    <li><a href="../git/Documentation/git-clone_txt.html">git-clone</a>
  
    <li><a href="../git/Documentation/git-column_txt.html">git-column</a>
  
    <li><a href="../git/Documentation/git-commit-tree_txt.html">git-commit-tree</a>
  
    <li><a href="../git/Documentation/git-commit_txt.html">git-commit</a>
  
    <li><a href="../git/Documentation/git-config_txt.html">git-config</a>
  
    <li><a href="../git/Documentation/git-count-objects_txt.html">git-count-objects</a>
  
    <li><a href="../git/Documentation/git-credential-cache--daemon_txt.html">git-credential-cache--daemon</a>
  
    <li><a href="../git/Documentation/git-credential-cache_txt.html">git-credential-cache</a>
  
    <li><a href="../git/Documentation/git-credential-store_txt.html">git-credential-store</a>
  
    <li><a href="../git/Documentation/git-credential_txt.html">git-credential</a>
  
    <li><a href="../git/Documentation/git-cvsexportcommit_txt.html">git-cvsexportcommit</a>
  
    <li><a href="../git/Documentation/git-cvsimport_txt.html">git-cvsimport</a>
  
    <li><a href="../git/Documentation/git-cvsserver_txt.html">git-cvsserver</a>
  
    <li><a href="../git/Documentation/git-daemon_txt.html">git-daemon</a>
  
    <li><a href="../git/Documentation/git-describe_txt.html">git-describe</a>
  
    <li><a href="../git/Documentation/git-diff-files_txt.html">git-diff-files</a>
  
    <li><a href="../git/Documentation/git-diff-index_txt.html">git-diff-index</a>
  
    <li><a href="../git/Documentation/git-diff-tree_txt.html">git-diff-tree</a>
  
    <li><a href="../git/Documentation/git-diff_txt.html">git-diff</a>
  
    <li><a href="../git/Documentation/git-difftool_txt.html">git-difftool</a>
  
    <li><a href="../git/Documentation/git-fast-export_txt.html">git-fast-export</a>
  
    <li><a href="../git/Documentation/git-fast-import_txt.html">git-fast-import</a>
  
    <li><a href="../git/Documentation/git-fetch-pack_txt.html">git-fetch-pack</a>
  
    <li><a href="../git/Documentation/git-fetch_txt.html">git-fetch</a>
  
    <li><a href="../git/Documentation/git-filter-branch_txt.html">git-filter-branch</a>
  
    <li><a href="../git/Documentation/git-fmt-merge-msg_txt.html">git-fmt-merge-msg</a>
  
    <li><a href="../git/Documentation/git-for-each-ref_txt.html">git-for-each-ref</a>
  
    <li><a href="../git/Documentation/git-format-patch_txt.html">git-format-patch</a>
  
    <li><a href="../git/Documentation/git-fsck-objects_txt.html">git-fsck-objects</a>
  
    <li><a href="../git/Documentation/git-fsck_txt.html">git-fsck</a>
  
    <li><a href="../git/Documentation/git-gc_txt.html">git-gc</a>
  
    <li><a href="../git/Documentation/git-get-tar-commit-id_txt.html">git-get-tar-commit-id</a>
  
    <li><a href="../git/Documentation/git-grep_txt.html">git-grep</a>
  
    <li><a href="../git/Documentation/git-gui_txt.html">git-gui</a>
  
    <li><a href="../git/Documentation/git-hash-object_txt.html">git-hash-object</a>
  
    <li><a href="../git/Documentation/git-help_txt.html">git-help</a>
  
    <li><a href="../git/Documentation/git-http-backend_txt.html">git-http-backend</a>
  
    <li><a href="../git/Documentation/git-http-fetch_txt.html">git-http-fetch</a>
  
    <li><a href="../git/Documentation/git-http-push_txt.html">git-http-push</a>
  
    <li><a href="../git/Documentation/git-imap-send_txt.html">git-imap-send</a>
  
    <li><a href="../git/Documentation/git-index-pack_txt.html">git-index-pack</a>
  
    <li><a href="../git/Documentation/git-init-db_txt.html">git-init-db</a>
  
    <li><a href="../git/Documentation/git-init_txt.html">git-init</a>
  
    <li><a href="../git/Documentation/git-instaweb_txt.html">git-instaweb</a>
  
    <li><a href="../git/Documentation/git-log_txt.html">git-log</a>
  
    <li><a href="../git/Documentation/git-lost-found_txt.html">git-lost-found</a>
  
    <li><a href="../git/Documentation/git-ls-files_txt.html">git-ls-files</a>
  
    <li><a href="../git/Documentation/git-ls-remote_txt.html">git-ls-remote</a>
  
    <li><a href="../git/Documentation/git-ls-tree_txt.html">git-ls-tree</a>
  
    <li><a href="../git/Documentation/git-mailinfo_txt.html">git-mailinfo</a>
  
    <li><a href="../git/Documentation/git-mailsplit_txt.html">git-mailsplit</a>
  
    <li><a href="../git/Documentation/git-merge-base_txt.html">git-merge-base</a>
  
    <li><a href="../git/Documentation/git-merge-file_txt.html">git-merge-file</a>
  
    <li><a href="../git/Documentation/git-merge-index_txt.html">git-merge-index</a>
  
    <li><a href="../git/Documentation/git-merge-one-file_txt.html">git-merge-one-file</a>
  
    <li><a href="../git/Documentation/git-merge-tree_txt.html">git-merge-tree</a>
  
    <li><a href="../git/Documentation/git-merge_txt.html">git-merge</a>
  
    <li><a href="../git/Documentation/git-mergetool--lib_txt.html">git-mergetool--lib</a>
  
    <li><a href="../git/Documentation/git-mergetool_txt.html">git-mergetool</a>
  
    <li><a href="../git/Documentation/git-mktag_txt.html">git-mktag</a>
  
    <li><a href="../git/Documentation/git-mktree_txt.html">git-mktree</a>
  
    <li><a href="../git/Documentation/git-mv_txt.html">git-mv</a>
  
    <li><a href="../git/Documentation/git-name-rev_txt.html">git-name-rev</a>
  
    <li><a href="../git/Documentation/git-notes_txt.html">git-notes</a>
  
    <li><a href="../git/Documentation/git-p4_txt.html">git-p4</a>
  
    <li><a href="../git/Documentation/git-pack-objects_txt.html">git-pack-objects</a>
  
    <li><a href="../git/Documentation/git-pack-redundant_txt.html">git-pack-redundant</a>
  
    <li><a href="../git/Documentation/git-pack-refs_txt.html">git-pack-refs</a>
  
    <li><a href="../git/Documentation/git-parse-remote_txt.html">git-parse-remote</a>
  
    <li><a href="../git/Documentation/git-patch-id_txt.html">git-patch-id</a>
  
    <li><a href="../git/Documentation/git-peek-remote_txt.html">git-peek-remote</a>
  
    <li><a href="../git/Documentation/git-prune-packed_txt.html">git-prune-packed</a>
  
    <li><a href="../git/Documentation/git-prune_txt.html">git-prune</a>
  
    <li><a href="../git/Documentation/git-pull_txt.html">git-pull</a>
  
    <li><a href="../git/Documentation/git-push_txt.html">git-push</a>
  
    <li><a href="../git/Documentation/git-quiltimport_txt.html">git-quiltimport</a>
  
    <li><a href="../git/Documentation/git-read-tree_txt.html">git-read-tree</a>
  
    <li><a href="../git/Documentation/git-rebase_txt.html">git-rebase</a>
  
    <li><a href="../git/Documentation/git-receive-pack_txt.html">git-receive-pack</a>
  
    <li><a href="../git/Documentation/git-reflog_txt.html">git-reflog</a>
  
    <li><a href="../git/Documentation/git-relink_txt.html">git-relink</a>
  
    <li><a href="../git/Documentation/git-remote-ext_txt.html">git-remote-ext</a>
  
    <li><a href="../git/Documentation/git-remote-fd_txt.html">git-remote-fd</a>
  
    <li><a href="../git/Documentation/git-remote-helpers_txto.html">git-remote-helpers.txto</a>
  
    <li><a href="../git/Documentation/git-remote-testgit_txt.html">git-remote-testgit</a>
  
    <li><a href="../git/Documentation/git-remote_txt.html">git-remote</a>
  
    <li><a href="../git/Documentation/git-repack_txt.html">git-repack</a>
  
    <li><a href="../git/Documentation/git-replace_txt.html">git-replace</a>
  
    <li><a href="../git/Documentation/git-repo-config_txt.html">git-repo-config</a>
  
    <li><a href="../git/Documentation/git-request-pull_txt.html">git-request-pull</a>
  
    <li><a href="../git/Documentation/git-rerere_txt.html">git-rerere</a>
  
    <li><a href="../git/Documentation/git-reset_txt.html">git-reset</a>
  
    <li><a href="../git/Documentation/git-rev-list_txt.html">git-rev-list</a>
  
    <li><a href="../git/Documentation/git-rev-parse_txt.html">git-rev-parse</a>
  
    <li><a href="../git/Documentation/git-revert_txt.html">git-revert</a>
  
    <li><a href="../git/Documentation/git-rm_txt.html">git-rm</a>
  
    <li><a href="../git/Documentation/git-send-email_txt.html">git-send-email</a>
  
    <li><a href="../git/Documentation/git-send-pack_txt.html">git-send-pack</a>
  
    <li><a href="../git/Documentation/git-sh-i18n--envsubst_txt.html">git-sh-i18n--envsubst</a>
  
    <li><a href="../git/Documentation/git-sh-i18n_txt.html">git-sh-i18n</a>
  
    <li><a href="../git/Documentation/git-sh-setup_txt.html">git-sh-setup</a>
  
    <li><a href="../git/Documentation/git-shell_txt.html">git-shell</a>
  
    <li><a href="../git/Documentation/git-shortlog_txt.html">git-shortlog</a>
  
    <li><a href="../git/Documentation/git-show-branch_txt.html">git-show-branch</a>
  
    <li><a href="../git/Documentation/git-show-index_txt.html">git-show-index</a>
  
    <li><a href="../git/Documentation/git-show-ref_txt.html">git-show-ref</a>
  
    <li><a href="../git/Documentation/git-show_txt.html">git-show</a>
  
    <li><a href="../git/Documentation/git-stage_txt.html">git-stage</a>
  
    <li><a href="../git/Documentation/git-stash_txt.html">git-stash</a>
  
    <li><a href="../git/Documentation/git-status_txt.html">git-status</a>
  
    <li><a href="../git/Documentation/git-stripspace_txt.html">git-stripspace</a>
  
    <li><a href="../git/Documentation/git-submodule_txt.html">git-submodule</a>
  
    <li><a href="../git/Documentation/git-svn_txt.html">git-svn</a>
  
    <li><a href="../git/Documentation/git-symbolic-ref_txt.html">git-symbolic-ref</a>
  
    <li><a href="../git/Documentation/git-tag_txt.html">git-tag</a>
  
    <li><a href="../git/Documentation/git-tar-tree_txt.html">git-tar-tree</a>
  
    <li><a href="../git/Documentation/git-tools_txt.html">git-tools</a>
  
    <li><a href="../git/Documentation/git-unpack-file_txt.html">git-unpack-file</a>
  
    <li><a href="../git/Documentation/git-unpack-objects_txt.html">git-unpack-objects</a>
  
    <li><a href="../git/Documentation/git-update-index_txt.html">git-update-index</a>
  
    <li><a href="../git/Documentation/git-update-ref_txt.html">git-update-ref</a>
  
    <li><a href="../git/Documentation/git-update-server-info_txt.html">git-update-server-info</a>
  
    <li><a href="../git/Documentation/git-upload-archive_txt.html">git-upload-archive</a>
  
    <li><a href="../git/Documentation/git-upload-pack_txt.html">git-upload-pack</a>
  
    <li><a href="../git/Documentation/git-var_txt.html">git-var</a>
  
    <li><a href="../git/Documentation/git-verify-pack_txt.html">git-verify-pack</a>
  
    <li><a href="../git/Documentation/git-verify-tag_txt.html">git-verify-tag</a>
  
    <li><a href="../git/Documentation/git-web--browse_txt.html">git-web--browse</a>
  
    <li><a href="../git/Documentation/git-whatchanged_txt.html">git-whatchanged</a>
  
    <li><a href="../git/Documentation/git-write-tree_txt.html">git-write-tree</a>
  
    <li><a href="../git/Documentation/git_txt.html">git</a>
  
    <li><a href="../git/Documentation/gitattributes_txt.html">gitattributes</a>
  
    <li><a href="../git/Documentation/gitcli_txt.html">gitcli</a>
  
    <li><a href="../git/Documentation/gitcore-tutorial_txt.html">gitcore-tutorial</a>
  
    <li><a href="../git/Documentation/gitcredentials_txt.html">gitcredentials</a>
  
    <li><a href="../git/Documentation/gitcvs-migration_txt.html">gitcvs-migration</a>
  
    <li><a href="../git/Documentation/gitdiffcore_txt.html">gitdiffcore</a>
  
    <li><a href="../git/Documentation/gitglossary_txt.html">gitglossary</a>
  
    <li><a href="../git/Documentation/githooks_txt.html">githooks</a>
  
    <li><a href="../git/Documentation/gitignore_txt.html">gitignore</a>
  
    <li><a href="../git/Documentation/gitk_txt.html">gitk</a>
  
    <li><a href="../git/Documentation/gitmodules_txt.html">gitmodules</a>
  
    <li><a href="../git/Documentation/gitnamespaces_txt.html">gitnamespaces</a>
  
    <li><a href="../git/Documentation/gitremote-helpers_txt.html">gitremote-helpers</a>
  
    <li><a href="../git/Documentation/gitrepository-layout_txt.html">gitrepository-layout</a>
  
    <li><a href="../git/Documentation/gitrevisions_txt.html">gitrevisions</a>
  
    <li><a href="../git/Documentation/gittutorial-2_txt.html">gittutorial-2</a>
  
    <li><a href="../git/Documentation/gittutorial_txt.html">gittutorial</a>
  
    <li><a href="../git/Documentation/gitweb_conf_txt.html">gitweb.conf</a>
  
    <li><a href="../git/Documentation/gitweb_txt.html">gitweb</a>
  
    <li><a href="../git/Documentation/gitworkflows_txt.html">gitworkflows</a>
  
    <li><a href="../git/Documentation/glossary-content_txt.html">glossary-content</a>
  
    <li><a href="../git/Documentation/howto-index_sh.html">howto-index.sh</a>
  
    <li><a href="../git/Documentation/howto/maintain-git_txt.html">maintain-git</a>
  
    <li><a href="../git/Documentation/howto/new-command_txt.html">new-command</a>
  
    <li><a href="../git/Documentation/howto/rebase-from-internal-branch_txt.html">rebase-from-internal-branch</a>
  
    <li><a href="../git/Documentation/howto/rebuild-from-update-hook_txt.html">rebuild-from-update-hook</a>
  
    <li><a href="../git/Documentation/howto/recover-corrupted-blob-object_txt.html">recover-corrupted-blob-object</a>
  
    <li><a href="../git/Documentation/howto/revert-a-faulty-merge_txt.html">revert-a-faulty-merge</a>
  
    <li><a href="../git/Documentation/howto/revert-branch-rebase_txt.html">revert-branch-rebase</a>
  
    <li><a href="../git/Documentation/howto/separating-topic-branches_txt.html">separating-topic-branches</a>
  
    <li><a href="../git/Documentation/howto/setup-git-server-over-http_txt.html">setup-git-server-over-http</a>
  
    <li><a href="../git/Documentation/howto/update-hook-example_txt.html">update-hook-example</a>
  
    <li><a href="../git/Documentation/howto/use-git-daemon_txt.html">use-git-daemon</a>
  
    <li><a href="../git/Documentation/howto/using-merge-subtree_txt.html">using-merge-subtree</a>
  
    <li><a href="../git/Documentation/howto/using-signed-tag-in-pull-request_txt.html">using-signed-tag-in-pull-request</a>
  
    <li><a href="../git/Documentation/i18n_txt.html">i18n</a>
  
    <li><a href="../git/Documentation/install-doc-quick_sh.html">install-doc-quick.sh</a>
  
    <li><a href="../git/Documentation/install-webdoc_sh.html">install-webdoc.sh</a>
  
    <li><a href="../git/Documentation/line-range-format_txt.html">line-range-format</a>
  
    <li><a href="../git/Documentation/mailmap_txt.html">mailmap</a>
  
    <li><a href="../git/Documentation/manpage-1_72_xsl.html">manpage-1.72.xsl</a>
  
    <li><a href="../git/Documentation/manpage-base-url_xsl_in.html">manpage-base-url.xsl.in</a>
  
    <li><a href="../git/Documentation/manpage-base_xsl.html">manpage-base.xsl</a>
  
    <li><a href="../git/Documentation/manpage-bold-literal_xsl.html">manpage-bold-literal.xsl</a>
  
    <li><a href="../git/Documentation/manpage-normal_xsl.html">manpage-normal.xsl</a>
  
    <li><a href="../git/Documentation/manpage-quote-apos_xsl.html">manpage-quote-apos.xsl</a>
  
    <li><a href="../git/Documentation/manpage-suppress-sp_xsl.html">manpage-suppress-sp.xsl</a>
  
    <li><a href="../git/Documentation/merge-config_txt.html">merge-config</a>
  
    <li><a href="../git/Documentation/merge-options_txt.html">merge-options</a>
  
    <li><a href="../git/Documentation/merge-strategies_txt.html">merge-strategies</a>
  
    <li><a href="../git/Documentation/pretty-formats_txt.html">pretty-formats</a>
  
    <li><a href="../git/Documentation/pretty-options_txt.html">pretty-options</a>
  
    <li><a href="../git/Documentation/pull-fetch-param_txt.html">pull-fetch-param</a>
  
    <li><a href="../git/Documentation/rev-list-options_txt.html">rev-list-options</a>
  
    <li><a href="../git/Documentation/revisions_txt.html">revisions</a>
  
    <li><a href="../git/Documentation/sequencer_txt.html">sequencer</a>
  
    <li><a href="../git/Documentation/technical/api-allocation-growing_txt.html">api-allocation-growing</a>
  
    <li><a href="../git/Documentation/technical/api-argv-array_txt.html">api-argv-array</a>
  
    <li><a href="../git/Documentation/technical/api-builtin_txt.html">api-builtin</a>
  
    <li><a href="../git/Documentation/technical/api-config_txt.html">api-config</a>
  
    <li><a href="../git/Documentation/technical/api-credentials_txt.html">api-credentials</a>
  
    <li><a href="../git/Documentation/technical/api-decorate_txt.html">api-decorate</a>
  
    <li><a href="../git/Documentation/technical/api-diff_txt.html">api-diff</a>
  
    <li><a href="../git/Documentation/technical/api-directory-listing_txt.html">api-directory-listing</a>
  
    <li><a href="../git/Documentation/technical/api-gitattributes_txt.html">api-gitattributes</a>
  
    <li><a href="../git/Documentation/technical/api-grep_txt.html">api-grep</a>
  
    <li><a href="../git/Documentation/technical/api-hash_txt.html">api-hash</a>
  
    <li><a href="../git/Documentation/technical/api-history-graph_txt.html">api-history-graph</a>
  
    <li><a href="../git/Documentation/technical/api-in-core-index_txt.html">api-in-core-index</a>
  
    <li><a href="../git/Documentation/technical/api-index-skel_txt.html">api-index-skel</a>
  
    <li><a href="../git/Documentation/technical/api-index_sh.html">api-index.sh</a>
  
    <li><a href="../git/Documentation/technical/api-lockfile_txt.html">api-lockfile</a>
  
    <li><a href="../git/Documentation/technical/api-merge_txt.html">api-merge</a>
  
    <li><a href="../git/Documentation/technical/api-object-access_txt.html">api-object-access</a>
  
    <li><a href="../git/Documentation/technical/api-parse-options_txt.html">api-parse-options</a>
  
    <li><a href="../git/Documentation/technical/api-quote_txt.html">api-quote</a>
  
    <li><a href="../git/Documentation/technical/api-ref-iteration_txt.html">api-ref-iteration</a>
  
    <li><a href="../git/Documentation/technical/api-remote_txt.html">api-remote</a>
  
    <li><a href="../git/Documentation/technical/api-revision-walking_txt.html">api-revision-walking</a>
  
    <li><a href="../git/Documentation/technical/api-run-command_txt.html">api-run-command</a>
  
    <li><a href="../git/Documentation/technical/api-setup_txt.html">api-setup</a>
  
    <li><a href="../git/Documentation/technical/api-sha1-array_txt.html">api-sha1-array</a>
  
    <li><a href="../git/Documentation/technical/api-sigchain_txt.html">api-sigchain</a>
  
    <li><a href="../git/Documentation/technical/api-strbuf_txt.html">api-strbuf</a>
  
    <li><a href="../git/Documentation/technical/api-string-list_txt.html">api-string-list</a>
  
    <li><a href="../git/Documentation/technical/api-tree-walking_txt.html">api-tree-walking</a>
  
    <li><a href="../git/Documentation/technical/api-xdiff-interface_txt.html">api-xdiff-interface</a>
  
    <li><a href="../git/Documentation/technical/http-protocol_txt.html">http-protocol</a>
  
    <li><a href="../git/Documentation/technical/index-format_txt.html">index-format</a>
  
    <li><a href="../git/Documentation/technical/pack-format_txt.html">pack-format</a>
  
    <li><a href="../git/Documentation/technical/pack-heuristics_txt.html">pack-heuristics</a>
  
    <li><a href="../git/Documentation/technical/pack-protocol_txt.html">pack-protocol</a>
  
    <li><a href="../git/Documentation/technical/protocol-capabilities_txt.html">protocol-capabilities</a>
  
    <li><a href="../git/Documentation/technical/protocol-common_txt.html">protocol-common</a>
  
    <li><a href="../git/Documentation/technical/racy-git_txt.html">racy-git</a>
  
    <li><a href="../git/Documentation/technical/send-pack-pipeline_txt.html">send-pack-pipeline</a>
  
    <li><a href="../git/Documentation/technical/shallow_txt.html">shallow</a>
  
    <li><a href="../git/Documentation/technical/trivial-merge_txt.html">trivial-merge</a>
  
    <li><a href="../git/Documentation/urls-remotes_txt.html">urls-remotes</a>
  
    <li><a href="../git/Documentation/urls_txt.html">urls</a>
  
    <li><a href="../git/Documentation/user-manual_conf.html">user-manual.conf</a>
  
    <li><a href="../git/Documentation/user-manual_txt.html">user-manual</a>
  
    <li><a href="../git/GIT-CFLAGS.html">GIT-CFLAGS</a>
  
    <li><a href="../git/GIT-VERSION-FILE.html">GIT-VERSION-FILE</a>
  
    <li><a href="../git/GIT-VERSION-GEN.html">GIT-VERSION-GEN</a>
  
    <li><a href="../git/INSTALL.html">INSTALL</a>
  
    <li><a href="../git/LGPL-2_1.html">LGPL-2.1</a>
  
    <li><a href="../git/Makefile.html">Makefile</a>
  
    <li><a href="../git/README.html">README</a>
  
    <li><a href="../git/RelNotes.html">RelNotes</a>
  
    <li><a href="../git/aclocal_m4.html">aclocal.m4</a>
  
    <li><a href="../git/check-builtins_sh.html">check-builtins.sh</a>
  
    <li><a href="../git/check_bindir.html">check_bindir</a>
  
    <li><a href="../git/command-list_txt.html">command-list</a>
  
    <li><a href="../git/compat/nedmalloc/License_txt.html">License</a>
  
    <li><a href="../git/compat/nedmalloc/Readme_txt.html">Readme</a>
  
    <li><a href="../git/compat/vcbuild/README.html">README</a>
  
    <li><a href="../git/compat/vcbuild/scripts/clink_pl.html">clink.pl</a>
  
    <li><a href="../git/compat/vcbuild/scripts/lib_pl.html">lib.pl</a>
  
    <li><a href="../git/config_mak_in.html">config.mak.in</a>
  
    <li><a href="../git/config_mak_uname.html">config.mak.uname</a>
  
    <li><a href="../git/contrib/README.html">README</a>
  
    <li><a href="../git/contrib/buildsystems/Generators_pm.html">Generators.pm</a>
  
    <li><a href="../git/contrib/buildsystems/Generators/QMake_pm.html">QMake.pm</a>
  
    <li><a href="../git/contrib/buildsystems/Generators/Vcproj_pm.html">Vcproj.pm</a>
  
    <li><a href="../git/contrib/buildsystems/engine_pl.html">engine.pl</a>
  
    <li><a href="../git/contrib/buildsystems/generate.html">generate</a>
  
    <li><a href="../git/contrib/buildsystems/parse_pl.html">parse.pl</a>
  
    <li><a href="../git/contrib/ciabot/INSTALL.html">INSTALL</a>
  
    <li><a href="../git/contrib/ciabot/README.html">README</a>
  
    <li><a href="../git/contrib/ciabot/ciabot_py.html">ciabot.py</a>
  
    <li><a href="../git/contrib/ciabot/ciabot_sh.html">ciabot.sh</a>
  
    <li><a href="../git/contrib/completion/git-completion_bash.html">git-completion.bash</a>
  
    <li><a href="../git/contrib/completion/git-completion_tcsh.html">git-completion.tcsh</a>
  
    <li><a href="../git/contrib/completion/git-completion_zsh.html">git-completion.zsh</a>
  
    <li><a href="../git/contrib/completion/git-prompt_sh.html">git-prompt.sh</a>
  
    <li><a href="../git/contrib/contacts/git-contacts.html">git-contacts</a>
  
    <li><a href="../git/contrib/contacts/git-contacts_txt.html">git-contacts</a>
  
    <li><a href="../git/contrib/convert-objects/git-convert-objects_txt.html">git-convert-objects</a>
  
    <li><a href="../git/contrib/credential/gnome-keyring/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/credential/netrc/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/credential/netrc/git-credential-netrc.html">git-credential-netrc</a>
  
    <li><a href="../git/contrib/credential/netrc/test_netrc.html">test.netrc</a>
  
    <li><a href="../git/contrib/credential/netrc/test_pl.html">test.pl</a>
  
    <li><a href="../git/contrib/credential/osxkeychain/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/credential/wincred/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/diff-highlight/README.html">README</a>
  
    <li><a href="../git/contrib/diff-highlight/diff-highlight.html">diff-highlight</a>
  
    <li><a href="../git/contrib/diffall/README.html">README</a>
  
    <li><a href="../git/contrib/diffall/git-diffall.html">git-diffall</a>
  
    <li><a href="../git/contrib/emacs/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/emacs/README.html">README</a>
  
    <li><a href="../git/contrib/emacs/git-blame_el.html">git-blame.el</a>
  
    <li><a href="../git/contrib/emacs/git_el.html">git.el</a>
  
    <li><a href="../git/contrib/examples/README.html">README</a>
  
    <li><a href="../git/contrib/examples/git-checkout_sh.html">git-checkout.sh</a>
  
    <li><a href="../git/contrib/examples/git-clean_sh.html">git-clean.sh</a>
  
    <li><a href="../git/contrib/examples/git-clone_sh.html">git-clone.sh</a>
  
    <li><a href="../git/contrib/examples/git-commit_sh.html">git-commit.sh</a>
  
    <li><a href="../git/contrib/examples/git-fetch_sh.html">git-fetch.sh</a>
  
    <li><a href="../git/contrib/examples/git-gc_sh.html">git-gc.sh</a>
  
    <li><a href="../git/contrib/examples/git-log_sh.html">git-log.sh</a>
  
    <li><a href="../git/contrib/examples/git-ls-remote_sh.html">git-ls-remote.sh</a>
  
    <li><a href="../git/contrib/examples/git-merge-ours_sh.html">git-merge-ours.sh</a>
  
    <li><a href="../git/contrib/examples/git-merge_sh.html">git-merge.sh</a>
  
    <li><a href="../git/contrib/examples/git-notes_sh.html">git-notes.sh</a>
  
    <li><a href="../git/contrib/examples/git-remote_perl.html">git-remote.perl</a>
  
    <li><a href="../git/contrib/examples/git-rerere_perl.html">git-rerere.perl</a>
  
    <li><a href="../git/contrib/examples/git-reset_sh.html">git-reset.sh</a>
  
    <li><a href="../git/contrib/examples/git-resolve_sh.html">git-resolve.sh</a>
  
    <li><a href="../git/contrib/examples/git-revert_sh.html">git-revert.sh</a>
  
    <li><a href="../git/contrib/examples/git-svnimport_perl.html">git-svnimport.perl</a>
  
    <li><a href="../git/contrib/examples/git-svnimport_txt.html">git-svnimport</a>
  
    <li><a href="../git/contrib/examples/git-tag_sh.html">git-tag.sh</a>
  
    <li><a href="../git/contrib/examples/git-verify-tag_sh.html">git-verify-tag.sh</a>
  
    <li><a href="../git/contrib/examples/git-whatchanged_sh.html">git-whatchanged.sh</a>
  
    <li><a href="../git/contrib/fast-import/git-import_perl.html">git-import.perl</a>
  
    <li><a href="../git/contrib/fast-import/git-import_sh.html">git-import.sh</a>
  
    <li><a href="../git/contrib/fast-import/git-p4_README.html">git-p4.README</a>
  
    <li><a href="../git/contrib/fast-import/import-directories_perl.html">import-directories.perl</a>
  
    <li><a href="../git/contrib/fast-import/import-tars_perl.html">import-tars.perl</a>
  
    <li><a href="../git/contrib/fast-import/import-zips_py.html">import-zips.py</a>
  
    <li><a href="../git/contrib/git-jump/README.html">README</a>
  
    <li><a href="../git/contrib/git-jump/git-jump.html">git-jump</a>
  
    <li><a href="../git/contrib/git-resurrect_sh.html">git-resurrect.sh</a>
  
    <li><a href="../git/contrib/git-shell-commands/README.html">README</a>
  
    <li><a href="../git/contrib/git-shell-commands/help.html">help</a>
  
    <li><a href="../git/contrib/git-shell-commands/list.html">list</a>
  
    <li><a href="../git/contrib/gitview/gitview.html">gitview</a>
  
    <li><a href="../git/contrib/gitview/gitview_txt.html">gitview</a>
  
    <li><a href="../git/contrib/hg-to-git/hg-to-git_py.html">hg-to-git.py</a>
  
    <li><a href="../git/contrib/hg-to-git/hg-to-git_txt.html">hg-to-git</a>
  
    <li><a href="../git/contrib/hooks/multimail/README.html">README</a>
  
    <li><a href="../git/contrib/hooks/multimail/README_Git.html">README.Git</a>
  
    <li><a href="../git/contrib/hooks/multimail/README_migrate-from-post-receive-email.html">README.migrate-from-post-receive-email</a>
  
    <li><a href="../git/contrib/hooks/multimail/git_multimail_py.html">git_multimail.py</a>
  
    <li><a href="../git/contrib/hooks/multimail/migrate-mailhook-config.html">migrate-mailhook-config</a>
  
    <li><a href="../git/contrib/hooks/multimail/post-receive.html">post-receive</a>
  
    <li><a href="../git/contrib/hooks/post-receive-email.html">post-receive-email</a>
  
    <li><a href="../git/contrib/hooks/pre-auto-gc-battery.html">pre-auto-gc-battery</a>
  
    <li><a href="../git/contrib/hooks/setgitperms_perl.html">setgitperms.perl</a>
  
    <li><a href="../git/contrib/hooks/update-paranoid.html">update-paranoid</a>
  
    <li><a href="../git/contrib/mw-to-git/Git/Mediawiki_pm.html">Mediawiki.pm</a>
  
    <li><a href="../git/contrib/mw-to-git/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/mw-to-git/bin-wrapper/git.html">git</a>
  
    <li><a href="../git/contrib/mw-to-git/git-mw_perl.html">git-mw.perl</a>
  
    <li><a href="../git/contrib/mw-to-git/git-remote-mediawiki_perl.html">git-remote-mediawiki.perl</a>
  
    <li><a href="../git/contrib/mw-to-git/git-remote-mediawiki_txt.html">git-remote-mediawiki</a>
  
    <li><a href="../git/contrib/mw-to-git/t/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/mw-to-git/t/README.html">README</a>
  
    <li><a href="../git/contrib/mw-to-git/t/install-wiki_sh.html">install-wiki.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/install-wiki/LocalSettings_php.html">LocalSettings.php</a>
  
    <li><a href="../git/contrib/mw-to-git/t/install-wiki/db_install_php.html">db_install.php</a>
  
    <li><a href="../git/contrib/mw-to-git/t/push-pull-tests_sh.html">push-pull-tests.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9360-mw-to-git-clone_sh.html">t9360-mw-to-git-clone.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9361-mw-to-git-push-pull_sh.html">t9361-mw-to-git-push-pull.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9362-mw-to-git-utf8_sh.html">t9362-mw-to-git-utf8.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9363-mw-to-git-export-import_sh.html">t9363-mw-to-git-export-import.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9364-pull-by-rev_sh.html">t9364-pull-by-rev.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/test-gitmw-lib_sh.html">test-gitmw-lib.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/test-gitmw_pl.html">test-gitmw.pl</a>
  
    <li><a href="../git/contrib/mw-to-git/t/test_config.html">test.config</a>
  
    <li><a href="../git/contrib/p4import/README.html">README</a>
  
    <li><a href="../git/contrib/p4import/git-p4import_py.html">git-p4import.py</a>
  
    <li><a href="../git/contrib/p4import/git-p4import_txt.html">git-p4import</a>
  
    <li><a href="../git/contrib/persistent-https/LICENSE.html">LICENSE</a>
  
    <li><a href="../git/contrib/persistent-https/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/persistent-https/README.html">README</a>
  
    <li><a href="../git/contrib/persistent-https/client_go.html">client.go</a>
  
    <li><a href="../git/contrib/persistent-https/main_go.html">main.go</a>
  
    <li><a href="../git/contrib/persistent-https/proxy_go.html">proxy.go</a>
  
    <li><a href="../git/contrib/persistent-https/socket_go.html">socket.go</a>
  
    <li><a href="../git/contrib/remote-helpers/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/remote-helpers/git-remote-bzr.html">git-remote-bzr</a>
  
    <li><a href="../git/contrib/remote-helpers/git-remote-hg.html">git-remote-hg</a>
  
    <li><a href="../git/contrib/remote-helpers/test-bzr_sh.html">test-bzr.sh</a>
  
    <li><a href="../git/contrib/remote-helpers/test-hg-bidi_sh.html">test-hg-bidi.sh</a>
  
    <li><a href="../git/contrib/remote-helpers/test-hg-hg-git_sh.html">test-hg-hg-git.sh</a>
  
    <li><a href="../git/contrib/remote-helpers/test-hg_sh.html">test-hg.sh</a>
  
    <li><a href="../git/contrib/remotes2config_sh.html">remotes2config.sh</a>
  
    <li><a href="../git/contrib/rerere-train_sh.html">rerere-train.sh</a>
  
    <li><a href="../git/contrib/stats/git-common-hash.html">git-common-hash</a>
  
    <li><a href="../git/contrib/stats/mailmap_pl.html">mailmap.pl</a>
  
    <li><a href="../git/contrib/stats/packinfo_pl.html">packinfo.pl</a>
  
    <li><a href="../git/contrib/subtree/COPYING.html">COPYING</a>
  
    <li><a href="../git/contrib/subtree/INSTALL.html">INSTALL</a>
  
    <li><a href="../git/contrib/subtree/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/subtree/README.html">README</a>
  
    <li><a href="../git/contrib/subtree/git-subtree_sh.html">git-subtree.sh</a>
  
    <li><a href="../git/contrib/subtree/git-subtree_txt.html">git-subtree</a>
  
    <li><a href="../git/contrib/subtree/t/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/subtree/t/t7900-subtree_sh.html">t7900-subtree.sh</a>
  
    <li><a href="../git/contrib/subtree/todo.html">todo</a>
  
    <li><a href="../git/contrib/svn-fe/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/svn-fe/svn-fe_txt.html">svn-fe</a>
  
    <li><a href="../git/contrib/svn-fe/svnrdump_sim_py.html">svnrdump_sim.py</a>
  
    <li><a href="../git/contrib/thunderbird-patch-inline/README.html">README</a>
  
    <li><a href="../git/contrib/thunderbird-patch-inline/appp_sh.html">appp.sh</a>
  
    <li><a href="../git/contrib/vim/README.html">README</a>
  
    <li><a href="../git/contrib/workdir/git-new-workdir.html">git-new-workdir</a>
  
    <li><a href="../git/generate-cmdlist_sh.html">generate-cmdlist.sh</a>
  
    <li><a href="../git/git-add--interactive_perl.html">git-add--interactive.perl</a>
  
    <li><a href="../git/git-am_sh.html">git-am.sh</a>
  
    <li><a href="../git/git-archimport_perl.html">git-archimport.perl</a>
  
    <li><a href="../git/git-bisect_sh.html">git-bisect.sh</a>
  
    <li><a href="../git/git-cvsexportcommit_perl.html">git-cvsexportcommit.perl</a>
  
    <li><a href="../git/git-cvsimport_perl.html">git-cvsimport.perl</a>
  
    <li><a href="../git/git-cvsserver_perl.html">git-cvsserver.perl</a>
  
    <li><a href="../git/git-difftool--helper_sh.html">git-difftool--helper.sh</a>
  
    <li><a href="../git/git-difftool_perl.html">git-difftool.perl</a>
  
    <li><a href="../git/git-filter-branch_sh.html">git-filter-branch.sh</a>
  
    <li><a href="../git/git-gui/GIT-VERSION-GEN.html">GIT-VERSION-GEN</a>
  
    <li><a href="../git/git-gui/Makefile.html">Makefile</a>
  
    <li><a href="../git/git-gui/git-gui--askpass.html">git-gui--askpass</a>
  
    <li><a href="../git/git-gui/git-gui_sh.html">git-gui.sh</a>
  
    <li><a href="../git/git-gui/lib/about_tcl.html">about.tcl</a>
  
    <li><a href="../git/git-gui/lib/blame_tcl.html">blame.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_tcl.html">branch.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_checkout_tcl.html">branch_checkout.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_create_tcl.html">branch_create.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_delete_tcl.html">branch_delete.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_rename_tcl.html">branch_rename.tcl</a>
  
    <li><a href="../git/git-gui/lib/browser_tcl.html">browser.tcl</a>
  
    <li><a href="../git/git-gui/lib/checkout_op_tcl.html">checkout_op.tcl</a>
  
    <li><a href="../git/git-gui/lib/choose_font_tcl.html">choose_font.tcl</a>
  
    <li><a href="../git/git-gui/lib/choose_repository_tcl.html">choose_repository.tcl</a>
  
    <li><a href="../git/git-gui/lib/choose_rev_tcl.html">choose_rev.tcl</a>
  
    <li><a href="../git/git-gui/lib/class_tcl.html">class.tcl</a>
  
    <li><a href="../git/git-gui/lib/commit_tcl.html">commit.tcl</a>
  
    <li><a href="../git/git-gui/lib/console_tcl.html">console.tcl</a>
  
    <li><a href="../git/git-gui/lib/database_tcl.html">database.tcl</a>
  
    <li><a href="../git/git-gui/lib/date_tcl.html">date.tcl</a>
  
    <li><a href="../git/git-gui/lib/diff_tcl.html">diff.tcl</a>
  
    <li><a href="../git/git-gui/lib/encoding_tcl.html">encoding.tcl</a>
  
    <li><a href="../git/git-gui/lib/error_tcl.html">error.tcl</a>
  
    <li><a href="../git/git-gui/lib/index_tcl.html">index.tcl</a>
  
    <li><a href="../git/git-gui/lib/line_tcl.html">line.tcl</a>
  
    <li><a href="../git/git-gui/lib/logo_tcl.html">logo.tcl</a>
  
    <li><a href="../git/git-gui/lib/merge_tcl.html">merge.tcl</a>
  
    <li><a href="../git/git-gui/lib/mergetool_tcl.html">mergetool.tcl</a>
  
    <li><a href="../git/git-gui/lib/option_tcl.html">option.tcl</a>
  
    <li><a href="../git/git-gui/lib/remote_tcl.html">remote.tcl</a>
  
    <li><a href="../git/git-gui/lib/remote_add_tcl.html">remote_add.tcl</a>
  
    <li><a href="../git/git-gui/lib/remote_branch_delete_tcl.html">remote_branch_delete.tcl</a>
  
    <li><a href="../git/git-gui/lib/search_tcl.html">search.tcl</a>
  
    <li><a href="../git/git-gui/lib/shortcut_tcl.html">shortcut.tcl</a>
  
    <li><a href="../git/git-gui/lib/spellcheck_tcl.html">spellcheck.tcl</a>
  
    <li><a href="../git/git-gui/lib/sshkey_tcl.html">sshkey.tcl</a>
  
    <li><a href="../git/git-gui/lib/status_bar_tcl.html">status_bar.tcl</a>
  
    <li><a href="../git/git-gui/lib/themed_tcl.html">themed.tcl</a>
  
    <li><a href="../git/git-gui/lib/tools_tcl.html">tools.tcl</a>
  
    <li><a href="../git/git-gui/lib/tools_dlg_tcl.html">tools_dlg.tcl</a>
  
    <li><a href="../git/git-gui/lib/transport_tcl.html">transport.tcl</a>
  
    <li><a href="../git/git-gui/lib/win32_tcl.html">win32.tcl</a>
  
    <li><a href="../git/git-gui/lib/win32_shortcut_js.html">win32_shortcut.js</a>
  
    <li><a href="../git/git-gui/macosx/AppMain_tcl.html">AppMain.tcl</a>
  
    <li><a href="../git/git-gui/macosx/Info_plist.html">Info.plist</a>
  
    <li><a href="../git/git-gui/po/README.html">README</a>
  
    <li><a href="../git/git-gui/po/de_po.html">de.po</a>
  
    <li><a href="../git/git-gui/po/el_po.html">el.po</a>
  
    <li><a href="../git/git-gui/po/fr_po.html">fr.po</a>
  
    <li><a href="../git/git-gui/po/git-gui_pot.html">git-gui.pot</a>
  
    <li><a href="../git/git-gui/po/glossary/Makefile.html">Makefile</a>
  
    <li><a href="../git/git-gui/po/glossary/de_po.html">de.po</a>
  
    <li><a href="../git/git-gui/po/glossary/el_po.html">el.po</a>
  
    <li><a href="../git/git-gui/po/glossary/fr_po.html">fr.po</a>
  
    <li><a href="../git/git-gui/po/glossary/git-gui-glossary_pot.html">git-gui-glossary.pot</a>
  
    <li><a href="../git/git-gui/po/glossary/git-gui-glossary_txt.html">git-gui-glossary</a>
  
    <li><a href="../git/git-gui/po/glossary/it_po.html">it.po</a>
  
    <li><a href="../git/git-gui/po/glossary/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../git/git-gui/po/glossary/txt-to-pot_sh.html">txt-to-pot.sh</a>
  
    <li><a href="../git/git-gui/po/glossary/zh_cn_po.html">zh_cn.po</a>
  
    <li><a href="../git/git-gui/po/hu_po.html">hu.po</a>
  
    <li><a href="../git/git-gui/po/it_po.html">it.po</a>
  
    <li><a href="../git/git-gui/po/ja_po.html">ja.po</a>
  
    <li><a href="../git/git-gui/po/nb_po.html">nb.po</a>
  
    <li><a href="../git/git-gui/po/po2msg_sh.html">po2msg.sh</a>
  
    <li><a href="../git/git-gui/po/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../git/git-gui/po/ru_po.html">ru.po</a>
  
    <li><a href="../git/git-gui/po/sv_po.html">sv.po</a>
  
    <li><a href="../git/git-gui/po/zh_cn_po.html">zh_cn.po</a>
  
    <li><a href="../git/git-gui/windows/git-gui_sh.html">git-gui.sh</a>
  
    <li><a href="../git/git-instaweb_sh.html">git-instaweb.sh</a>
  
    <li><a href="../git/git-lost-found_sh.html">git-lost-found.sh</a>
  
    <li><a href="../git/git-merge-octopus_sh.html">git-merge-octopus.sh</a>
  
    <li><a href="../git/git-merge-one-file_sh.html">git-merge-one-file.sh</a>
  
    <li><a href="../git/git-merge-resolve_sh.html">git-merge-resolve.sh</a>
  
    <li><a href="../git/git-mergetool--lib_sh.html">git-mergetool--lib.sh</a>
  
    <li><a href="../git/git-mergetool_sh.html">git-mergetool.sh</a>
  
    <li><a href="../git/git-p4_py.html">git-p4.py</a>
  
    <li><a href="../git/git-parse-remote_sh.html">git-parse-remote.sh</a>
  
    <li><a href="../git/git-pull_sh.html">git-pull.sh</a>
  
    <li><a href="../git/git-quiltimport_sh.html">git-quiltimport.sh</a>
  
    <li><a href="../git/git-rebase--am_sh.html">git-rebase--am.sh</a>
  
    <li><a href="../git/git-rebase--interactive_sh.html">git-rebase--interactive.sh</a>
  
    <li><a href="../git/git-rebase--merge_sh.html">git-rebase--merge.sh</a>
  
    <li><a href="../git/git-rebase_sh.html">git-rebase.sh</a>
  
    <li><a href="../git/git-relink_perl.html">git-relink.perl</a>
  
    <li><a href="../git/git-remote-testgit_sh.html">git-remote-testgit.sh</a>
  
    <li><a href="../git/git-repack_sh.html">git-repack.sh</a>
  
    <li><a href="../git/git-request-pull_sh.html">git-request-pull.sh</a>
  
    <li><a href="../git/git-send-email_perl.html">git-send-email.perl</a>
  
    <li><a href="../git/git-sh-i18n_sh.html">git-sh-i18n.sh</a>
  
    <li><a href="../git/git-sh-setup_sh.html">git-sh-setup.sh</a>
  
    <li><a href="../git/git-stash_sh.html">git-stash.sh</a>
  
    <li><a href="../git/git-submodule_sh.html">git-submodule.sh</a>
  
    <li><a href="../git/git-svn_perl.html">git-svn.perl</a>
  
    <li><a href="../git/git-web--browse_sh.html">git-web--browse.sh</a>
  
    <li><a href="../git/git_rc.html">git.rc</a>
  
    <li><a href="../git/git_spec_in.html">git.spec.in</a>
  
    <li><a href="../git/gitk-git/Makefile.html">Makefile</a>
  
    <li><a href="../git/gitk-git/gitk.html">gitk</a>
  
    <li><a href="../git/gitk-git/po/de_po.html">de.po</a>
  
    <li><a href="../git/gitk-git/po/es_po.html">es.po</a>
  
    <li><a href="../git/gitk-git/po/fr_po.html">fr.po</a>
  
    <li><a href="../git/gitk-git/po/hu_po.html">hu.po</a>
  
    <li><a href="../git/gitk-git/po/it_po.html">it.po</a>
  
    <li><a href="../git/gitk-git/po/ja_po.html">ja.po</a>
  
    <li><a href="../git/gitk-git/po/po2msg_sh.html">po2msg.sh</a>
  
    <li><a href="../git/gitk-git/po/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../git/gitk-git/po/ru_po.html">ru.po</a>
  
    <li><a href="../git/gitk-git/po/sv_po.html">sv.po</a>
  
    <li><a href="../git/gitweb/INSTALL.html">INSTALL</a>
  
    <li><a href="../git/gitweb/Makefile.html">Makefile</a>
  
    <li><a href="../git/gitweb/README.html">README</a>
  
    <li><a href="../git/gitweb/gitweb_perl.html">gitweb.perl</a>
  
    <li><a href="../git/gitweb/static/gitweb_css.html">gitweb.css</a>
  
    <li><a href="../git/gitweb/static/js/README.html">README</a>
  
    <li><a href="../git/gitweb/static/js/adjust-timezone_js.html">adjust-timezone.js</a>
  
    <li><a href="../git/gitweb/static/js/blame_incremental_js.html">blame_incremental.js</a>
  
    <li><a href="../git/gitweb/static/js/javascript-detection_js.html">javascript-detection.js</a>
  
    <li><a href="../git/gitweb/static/js/lib/common-lib_js.html">common-lib.js</a>
  
    <li><a href="../git/gitweb/static/js/lib/cookies_js.html">cookies.js</a>
  
    <li><a href="../git/gitweb/static/js/lib/datetime_js.html">datetime.js</a>
  
    <li><a href="../git/mergetools/araxis.html">araxis</a>
  
    <li><a href="../git/mergetools/bc3.html">bc3</a>
  
    <li><a href="../git/mergetools/codecompare.html">codecompare</a>
  
    <li><a href="../git/mergetools/deltawalker.html">deltawalker</a>
  
    <li><a href="../git/mergetools/diffuse.html">diffuse</a>
  
    <li><a href="../git/mergetools/ecmerge.html">ecmerge</a>
  
    <li><a href="../git/mergetools/emerge.html">emerge</a>
  
    <li><a href="../git/mergetools/gvimdiff.html">gvimdiff</a>
  
    <li><a href="../git/mergetools/gvimdiff2.html">gvimdiff2</a>
  
    <li><a href="../git/mergetools/kdiff3.html">kdiff3</a>
  
    <li><a href="../git/mergetools/kompare.html">kompare</a>
  
    <li><a href="../git/mergetools/meld.html">meld</a>
  
    <li><a href="../git/mergetools/opendiff.html">opendiff</a>
  
    <li><a href="../git/mergetools/p4merge.html">p4merge</a>
  
    <li><a href="../git/mergetools/tkdiff.html">tkdiff</a>
  
    <li><a href="../git/mergetools/tortoisemerge.html">tortoisemerge</a>
  
    <li><a href="../git/mergetools/vimdiff.html">vimdiff</a>
  
    <li><a href="../git/mergetools/vimdiff2.html">vimdiff2</a>
  
    <li><a href="../git/mergetools/xxdiff.html">xxdiff</a>
  
    <li><a href="../git/perl/Git_pm.html">Git.pm</a>
  
    <li><a href="../git/perl/Git/I18N_pm.html">I18N.pm</a>
  
    <li><a href="../git/perl/Git/IndexInfo_pm.html">IndexInfo.pm</a>
  
    <li><a href="../git/perl/Git/SVN_pm.html">SVN.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Editor_pm.html">Editor.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Fetcher_pm.html">Fetcher.pm</a>
  
    <li><a href="../git/perl/Git/SVN/GlobSpec_pm.html">GlobSpec.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Log_pm.html">Log.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Memoize/YAML_pm.html">YAML.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Migration_pm.html">Migration.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Prompt_pm.html">Prompt.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Ra_pm.html">Ra.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Utils_pm.html">Utils.pm</a>
  
    <li><a href="../git/perl/Makefile.html">Makefile</a>
  
    <li><a href="../git/perl/Makefile_PL.html">Makefile.PL</a>
  
    <li><a href="../git/perl/private-Error_pm.html">private-Error.pm</a>
  
    <li><a href="../git/po/README.html">README</a>
  
    <li><a href="../git/po/TEAMS.html">TEAMS</a>
  
    <li><a href="../git/po/da_po.html">da.po</a>
  
    <li><a href="../git/po/de_po.html">de.po</a>
  
    <li><a href="../git/po/fr_po.html">fr.po</a>
  
    <li><a href="../git/po/git_pot.html">git.pot</a>
  
    <li><a href="../git/po/is_po.html">is.po</a>
  
    <li><a href="../git/po/it_po.html">it.po</a>
  
    <li><a href="../git/po/nl_po.html">nl.po</a>
  
    <li><a href="../git/po/pt_PT_po.html">pt_PT.po</a>
  
    <li><a href="../git/po/sv_po.html">sv.po</a>
  
    <li><a href="../git/po/vi_po.html">vi.po</a>
  
    <li><a href="../git/po/zh_CN_po.html">zh_CN.po</a>
  
    <li><a href="../git/ppc/sha1ppc_S.html">sha1ppc.S</a>
  
    <li><a href="../git/t/Git-SVN/00compile_t.html">00compile.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/add_path_to_url_t.html">add_path_to_url.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/can_compress_t.html">can_compress.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/canonicalize_url_t.html">canonicalize_url.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/collapse_dotdot_t.html">collapse_dotdot.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/fatal_t.html">fatal.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/join_paths_t.html">join_paths.t</a>
  
    <li><a href="../git/t/Makefile.html">Makefile</a>
  
    <li><a href="../git/t/README.html">README</a>
  
    <li><a href="../git/t/aggregate-results_sh.html">aggregate-results.sh</a>
  
    <li><a href="../git/t/annotate-tests_sh.html">annotate-tests.sh</a>
  
    <li><a href="../git/t/check-non-portable-shell_pl.html">check-non-portable-shell.pl</a>
  
    <li><a href="../git/t/diff-lib_sh.html">diff-lib.sh</a>
  
    <li><a href="../git/t/gitweb-lib_sh.html">gitweb-lib.sh</a>
  
    <li><a href="../git/t/lib-bash_sh.html">lib-bash.sh</a>
  
    <li><a href="../git/t/lib-credential_sh.html">lib-credential.sh</a>
  
    <li><a href="../git/t/lib-cvs_sh.html">lib-cvs.sh</a>
  
    <li><a href="../git/t/lib-diff-alternative_sh.html">lib-diff-alternative.sh</a>
  
    <li><a href="../git/t/lib-gettext_sh.html">lib-gettext.sh</a>
  
    <li><a href="../git/t/lib-git-daemon_sh.html">lib-git-daemon.sh</a>
  
    <li><a href="../git/t/lib-git-p4_sh.html">lib-git-p4.sh</a>
  
    <li><a href="../git/t/lib-git-svn_sh.html">lib-git-svn.sh</a>
  
    <li><a href="../git/t/lib-gpg_sh.html">lib-gpg.sh</a>
  
    <li><a href="../git/t/lib-httpd_sh.html">lib-httpd.sh</a>
  
    <li><a href="../git/t/lib-httpd/apache_conf.html">apache.conf</a>
  
    <li><a href="../git/t/lib-httpd/broken-smart-http_sh.html">broken-smart-http.sh</a>
  
    <li><a href="../git/t/lib-httpd/passwd.html">passwd</a>
  
    <li><a href="../git/t/lib-httpd/ssl_cnf.html">ssl.cnf</a>
  
    <li><a href="../git/t/lib-pack_sh.html">lib-pack.sh</a>
  
    <li><a href="../git/t/lib-pager_sh.html">lib-pager.sh</a>
  
    <li><a href="../git/t/lib-patch-mode_sh.html">lib-patch-mode.sh</a>
  
    <li><a href="../git/t/lib-prereq-FILEMODE_sh.html">lib-prereq-FILEMODE.sh</a>
  
    <li><a href="../git/t/lib-read-tree-m-3way_sh.html">lib-read-tree-m-3way.sh</a>
  
    <li><a href="../git/t/lib-read-tree_sh.html">lib-read-tree.sh</a>
  
    <li><a href="../git/t/lib-rebase_sh.html">lib-rebase.sh</a>
  
    <li><a href="../git/t/lib-t6000_sh.html">lib-t6000.sh</a>
  
    <li><a href="../git/t/lib-terminal_sh.html">lib-terminal.sh</a>
  
    <li><a href="../git/t/perf/Makefile.html">Makefile</a>
  
    <li><a href="../git/t/perf/README.html">README</a>
  
    <li><a href="../git/t/perf/aggregate_perl.html">aggregate.perl</a>
  
    <li><a href="../git/t/perf/min_time_perl.html">min_time.perl</a>
  
    <li><a href="../git/t/perf/p0000-perf-lib-sanity_sh.html">p0000-perf-lib-sanity.sh</a>
  
    <li><a href="../git/t/perf/p0001-rev-list_sh.html">p0001-rev-list.sh</a>
  
    <li><a href="../git/t/perf/p0002-read-cache_sh.html">p0002-read-cache.sh</a>
  
    <li><a href="../git/t/perf/p4000-diff-algorithms_sh.html">p4000-diff-algorithms.sh</a>
  
    <li><a href="../git/t/perf/p4211-line-log_sh.html">p4211-line-log.sh</a>
  
    <li><a href="../git/t/perf/p5302-pack-index_sh.html">p5302-pack-index.sh</a>
  
    <li><a href="../git/t/perf/p7810-grep_sh.html">p7810-grep.sh</a>
  
    <li><a href="../git/t/perf/perf-lib_sh.html">perf-lib.sh</a>
  
    <li><a href="../git/t/perf/run.html">run</a>
  
    <li><a href="../git/t/t0000-basic_sh.html">t0000-basic.sh</a>
  
    <li><a href="../git/t/t0001-init_sh.html">t0001-init.sh</a>
  
    <li><a href="../git/t/t0002-gitfile_sh.html">t0002-gitfile.sh</a>
  
    <li><a href="../git/t/t0003-attributes_sh.html">t0003-attributes.sh</a>
  
    <li><a href="../git/t/t0004-unwritable_sh.html">t0004-unwritable.sh</a>
  
    <li><a href="../git/t/t0005-signals_sh.html">t0005-signals.sh</a>
  
    <li><a href="../git/t/t0006-date_sh.html">t0006-date.sh</a>
  
    <li><a href="../git/t/t0007-git-var_sh.html">t0007-git-var.sh</a>
  
    <li><a href="../git/t/t0008-ignores_sh.html">t0008-ignores.sh</a>
  
    <li><a href="../git/t/t0009-prio-queue_sh.html">t0009-prio-queue.sh</a>
  
    <li><a href="../git/t/t0010-racy-git_sh.html">t0010-racy-git.sh</a>
  
    <li><a href="../git/t/t0020-crlf_sh.html">t0020-crlf.sh</a>
  
    <li><a href="../git/t/t0021-conversion_sh.html">t0021-conversion.sh</a>
  
    <li><a href="../git/t/t0022-crlf-rename_sh.html">t0022-crlf-rename.sh</a>
  
    <li><a href="../git/t/t0023-crlf-am_sh.html">t0023-crlf-am.sh</a>
  
    <li><a href="../git/t/t0024-crlf-archive_sh.html">t0024-crlf-archive.sh</a>
  
    <li><a href="../git/t/t0025-crlf-auto_sh.html">t0025-crlf-auto.sh</a>
  
    <li><a href="../git/t/t0026-eol-config_sh.html">t0026-eol-config.sh</a>
  
    <li><a href="../git/t/t0030-stripspace_sh.html">t0030-stripspace.sh</a>
  
    <li><a href="../git/t/t0040-parse-options_sh.html">t0040-parse-options.sh</a>
  
    <li><a href="../git/t/t0050-filesystem_sh.html">t0050-filesystem.sh</a>
  
    <li><a href="../git/t/t0055-beyond-symlinks_sh.html">t0055-beyond-symlinks.sh</a>
  
    <li><a href="../git/t/t0056-git-C_sh.html">t0056-git-C.sh</a>
  
    <li><a href="../git/t/t0060-path-utils_sh.html">t0060-path-utils.sh</a>
  
    <li><a href="../git/t/t0061-run-command_sh.html">t0061-run-command.sh</a>
  
    <li><a href="../git/t/t0062-revision-walking_sh.html">t0062-revision-walking.sh</a>
  
    <li><a href="../git/t/t0063-string-list_sh.html">t0063-string-list.sh</a>
  
    <li><a href="../git/t/t0070-fundamental_sh.html">t0070-fundamental.sh</a>
  
    <li><a href="../git/t/t0081-line-buffer_sh.html">t0081-line-buffer.sh</a>
  
    <li><a href="../git/t/t0090-cache-tree_sh.html">t0090-cache-tree.sh</a>
  
    <li><a href="../git/t/t0100-previous_sh.html">t0100-previous.sh</a>
  
    <li><a href="../git/t/t0101-at-syntax_sh.html">t0101-at-syntax.sh</a>
  
    <li><a href="../git/t/t0110-urlmatch-normalization_sh.html">t0110-urlmatch-normalization.sh</a>
  
    <li><a href="../git/t/t0110/README.html">README</a>
  
    <li><a href="../git/t/t0110/url-1.html">url-1</a>
  
    <li><a href="../git/t/t0110/url-11.html">url-11</a>
  
    <li><a href="../git/t/t0110/url-2.html">url-2</a>
  
    <li><a href="../git/t/t0200-gettext-basic_sh.html">t0200-gettext-basic.sh</a>
  
    <li><a href="../git/t/t0200/test_perl.html">test.perl</a>
  
    <li><a href="../git/t/t0200/test_sh.html">test.sh</a>
  
    <li><a href="../git/t/t0201-gettext-fallbacks_sh.html">t0201-gettext-fallbacks.sh</a>
  
    <li><a href="../git/t/t0202-gettext-perl_sh.html">t0202-gettext-perl.sh</a>
  
    <li><a href="../git/t/t0202/test_pl.html">test.pl</a>
  
    <li><a href="../git/t/t0203-gettext-setlocale-sanity_sh.html">t0203-gettext-setlocale-sanity.sh</a>
  
    <li><a href="../git/t/t0204-gettext-reencode-sanity_sh.html">t0204-gettext-reencode-sanity.sh</a>
  
    <li><a href="../git/t/t0205-gettext-poison_sh.html">t0205-gettext-poison.sh</a>
  
    <li><a href="../git/t/t0300-credentials_sh.html">t0300-credentials.sh</a>
  
    <li><a href="../git/t/t0301-credential-cache_sh.html">t0301-credential-cache.sh</a>
  
    <li><a href="../git/t/t0302-credential-store_sh.html">t0302-credential-store.sh</a>
  
    <li><a href="../git/t/t0303-credential-external_sh.html">t0303-credential-external.sh</a>
  
    <li><a href="../git/t/t1000-read-tree-m-3way_sh.html">t1000-read-tree-m-3way.sh</a>
  
    <li><a href="../git/t/t1001-read-tree-m-2way_sh.html">t1001-read-tree-m-2way.sh</a>
  
    <li><a href="../git/t/t1002-read-tree-m-u-2way_sh.html">t1002-read-tree-m-u-2way.sh</a>
  
    <li><a href="../git/t/t1003-read-tree-prefix_sh.html">t1003-read-tree-prefix.sh</a>
  
    <li><a href="../git/t/t1004-read-tree-m-u-wf_sh.html">t1004-read-tree-m-u-wf.sh</a>
  
    <li><a href="../git/t/t1005-read-tree-reset_sh.html">t1005-read-tree-reset.sh</a>
  
    <li><a href="../git/t/t1006-cat-file_sh.html">t1006-cat-file.sh</a>
  
    <li><a href="../git/t/t1007-hash-object_sh.html">t1007-hash-object.sh</a>
  
    <li><a href="../git/t/t1008-read-tree-overlay_sh.html">t1008-read-tree-overlay.sh</a>
  
    <li><a href="../git/t/t1009-read-tree-new-index_sh.html">t1009-read-tree-new-index.sh</a>
  
    <li><a href="../git/t/t1010-mktree_sh.html">t1010-mktree.sh</a>
  
    <li><a href="../git/t/t1011-read-tree-sparse-checkout_sh.html">t1011-read-tree-sparse-checkout.sh</a>
  
    <li><a href="../git/t/t1012-read-tree-df_sh.html">t1012-read-tree-df.sh</a>
  
    <li><a href="../git/t/t1013-loose-object-format_sh.html">t1013-loose-object-format.sh</a>
  
    <li><a href="../git/t/t1020-subdirectory_sh.html">t1020-subdirectory.sh</a>
  
    <li><a href="../git/t/t1021-rerere-in-workdir_sh.html">t1021-rerere-in-workdir.sh</a>
  
    <li><a href="../git/t/t1050-large_sh.html">t1050-large.sh</a>
  
    <li><a href="../git/t/t1051-large-conversion_sh.html">t1051-large-conversion.sh</a>
  
    <li><a href="../git/t/t1060-object-corruption_sh.html">t1060-object-corruption.sh</a>
  
    <li><a href="../git/t/t1100-commit-tree-options_sh.html">t1100-commit-tree-options.sh</a>
  
    <li><a href="../git/t/t1200-tutorial_sh.html">t1200-tutorial.sh</a>
  
    <li><a href="../git/t/t1300-repo-config_sh.html">t1300-repo-config.sh</a>
  
    <li><a href="../git/t/t1301-shared-repo_sh.html">t1301-shared-repo.sh</a>
  
    <li><a href="../git/t/t1302-repo-version_sh.html">t1302-repo-version.sh</a>
  
    <li><a href="../git/t/t1303-wacky-config_sh.html">t1303-wacky-config.sh</a>
  
    <li><a href="../git/t/t1304-default-acl_sh.html">t1304-default-acl.sh</a>
  
    <li><a href="../git/t/t1305-config-include_sh.html">t1305-config-include.sh</a>
  
    <li><a href="../git/t/t1306-xdg-files_sh.html">t1306-xdg-files.sh</a>
  
    <li><a href="../git/t/t1307-config-blob_sh.html">t1307-config-blob.sh</a>
  
    <li><a href="../git/t/t1400-update-ref_sh.html">t1400-update-ref.sh</a>
  
    <li><a href="../git/t/t1401-symbolic-ref_sh.html">t1401-symbolic-ref.sh</a>
  
    <li><a href="../git/t/t1402-check-ref-format_sh.html">t1402-check-ref-format.sh</a>
  
    <li><a href="../git/t/t1403-show-ref_sh.html">t1403-show-ref.sh</a>
  
    <li><a href="../git/t/t1410-reflog_sh.html">t1410-reflog.sh</a>
  
    <li><a href="../git/t/t1411-reflog-show_sh.html">t1411-reflog-show.sh</a>
  
    <li><a href="../git/t/t1412-reflog-loop_sh.html">t1412-reflog-loop.sh</a>
  
    <li><a href="../git/t/t1420-lost-found_sh.html">t1420-lost-found.sh</a>
  
    <li><a href="../git/t/t1450-fsck_sh.html">t1450-fsck.sh</a>
  
    <li><a href="../git/t/t1500-rev-parse_sh.html">t1500-rev-parse.sh</a>
  
    <li><a href="../git/t/t1501-worktree_sh.html">t1501-worktree.sh</a>
  
    <li><a href="../git/t/t1502-rev-parse-parseopt_sh.html">t1502-rev-parse-parseopt.sh</a>
  
    <li><a href="../git/t/t1503-rev-parse-verify_sh.html">t1503-rev-parse-verify.sh</a>
  
    <li><a href="../git/t/t1504-ceiling-dirs_sh.html">t1504-ceiling-dirs.sh</a>
  
    <li><a href="../git/t/t1505-rev-parse-last_sh.html">t1505-rev-parse-last.sh</a>
  
    <li><a href="../git/t/t1506-rev-parse-diagnosis_sh.html">t1506-rev-parse-diagnosis.sh</a>
  
    <li><a href="../git/t/t1507-rev-parse-upstream_sh.html">t1507-rev-parse-upstream.sh</a>
  
    <li><a href="../git/t/t1508-at-combinations_sh.html">t1508-at-combinations.sh</a>
  
    <li><a href="../git/t/t1509-root-worktree_sh.html">t1509-root-worktree.sh</a>
  
    <li><a href="../git/t/t1509/excludes.html">excludes</a>
  
    <li><a href="../git/t/t1509/prepare-chroot_sh.html">prepare-chroot.sh</a>
  
    <li><a href="../git/t/t1510-repo-setup_sh.html">t1510-repo-setup.sh</a>
  
    <li><a href="../git/t/t1511-rev-parse-caret_sh.html">t1511-rev-parse-caret.sh</a>
  
    <li><a href="../git/t/t1512-rev-parse-disambiguation_sh.html">t1512-rev-parse-disambiguation.sh</a>
  
    <li><a href="../git/t/t1513-rev-parse-prefix_sh.html">t1513-rev-parse-prefix.sh</a>
  
    <li><a href="../git/t/t2000-checkout-cache-clash_sh.html">t2000-checkout-cache-clash.sh</a>
  
    <li><a href="../git/t/t2001-checkout-cache-clash_sh.html">t2001-checkout-cache-clash.sh</a>
  
    <li><a href="../git/t/t2002-checkout-cache-u_sh.html">t2002-checkout-cache-u.sh</a>
  
    <li><a href="../git/t/t2003-checkout-cache-mkdir_sh.html">t2003-checkout-cache-mkdir.sh</a>
  
    <li><a href="../git/t/t2004-checkout-cache-temp_sh.html">t2004-checkout-cache-temp.sh</a>
  
    <li><a href="../git/t/t2005-checkout-index-symlinks_sh.html">t2005-checkout-index-symlinks.sh</a>
  
    <li><a href="../git/t/t2006-checkout-index-basic_sh.html">t2006-checkout-index-basic.sh</a>
  
    <li><a href="../git/t/t2007-checkout-symlink_sh.html">t2007-checkout-symlink.sh</a>
  
    <li><a href="../git/t/t2008-checkout-subdir_sh.html">t2008-checkout-subdir.sh</a>
  
    <li><a href="../git/t/t2009-checkout-statinfo_sh.html">t2009-checkout-statinfo.sh</a>
  
    <li><a href="../git/t/t2010-checkout-ambiguous_sh.html">t2010-checkout-ambiguous.sh</a>
  
    <li><a href="../git/t/t2011-checkout-invalid-head_sh.html">t2011-checkout-invalid-head.sh</a>
  
    <li><a href="../git/t/t2012-checkout-last_sh.html">t2012-checkout-last.sh</a>
  
    <li><a href="../git/t/t2013-checkout-submodule_sh.html">t2013-checkout-submodule.sh</a>
  
    <li><a href="../git/t/t2014-switch_sh.html">t2014-switch.sh</a>
  
    <li><a href="../git/t/t2015-checkout-unborn_sh.html">t2015-checkout-unborn.sh</a>
  
    <li><a href="../git/t/t2016-checkout-patch_sh.html">t2016-checkout-patch.sh</a>
  
    <li><a href="../git/t/t2017-checkout-orphan_sh.html">t2017-checkout-orphan.sh</a>
  
    <li><a href="../git/t/t2018-checkout-branch_sh.html">t2018-checkout-branch.sh</a>
  
    <li><a href="../git/t/t2019-checkout-ambiguous-ref_sh.html">t2019-checkout-ambiguous-ref.sh</a>
  
    <li><a href="../git/t/t2020-checkout-detach_sh.html">t2020-checkout-detach.sh</a>
  
    <li><a href="../git/t/t2021-checkout-overwrite_sh.html">t2021-checkout-overwrite.sh</a>
  
    <li><a href="../git/t/t2022-checkout-paths_sh.html">t2022-checkout-paths.sh</a>
  
    <li><a href="../git/t/t2023-checkout-m_sh.html">t2023-checkout-m.sh</a>
  
    <li><a href="../git/t/t2024-checkout-dwim_sh.html">t2024-checkout-dwim.sh</a>
  
    <li><a href="../git/t/t2030-unresolve-info_sh.html">t2030-unresolve-info.sh</a>
  
    <li><a href="../git/t/t2050-git-dir-relative_sh.html">t2050-git-dir-relative.sh</a>
  
    <li><a href="../git/t/t2100-update-cache-badpath_sh.html">t2100-update-cache-badpath.sh</a>
  
    <li><a href="../git/t/t2101-update-index-reupdate_sh.html">t2101-update-index-reupdate.sh</a>
  
    <li><a href="../git/t/t2102-update-index-symlinks_sh.html">t2102-update-index-symlinks.sh</a>
  
    <li><a href="../git/t/t2103-update-index-ignore-missing_sh.html">t2103-update-index-ignore-missing.sh</a>
  
    <li><a href="../git/t/t2104-update-index-skip-worktree_sh.html">t2104-update-index-skip-worktree.sh</a>
  
    <li><a href="../git/t/t2105-update-index-gitfile_sh.html">t2105-update-index-gitfile.sh</a>
  
    <li><a href="../git/t/t2106-update-index-assume-unchanged_sh.html">t2106-update-index-assume-unchanged.sh</a>
  
    <li><a href="../git/t/t2107-update-index-basic_sh.html">t2107-update-index-basic.sh</a>
  
    <li><a href="../git/t/t2200-add-update_sh.html">t2200-add-update.sh</a>
  
    <li><a href="../git/t/t2201-add-update-typechange_sh.html">t2201-add-update-typechange.sh</a>
  
    <li><a href="../git/t/t2202-add-addremove_sh.html">t2202-add-addremove.sh</a>
  
    <li><a href="../git/t/t2203-add-intent_sh.html">t2203-add-intent.sh</a>
  
    <li><a href="../git/t/t2204-add-ignored_sh.html">t2204-add-ignored.sh</a>
  
    <li><a href="../git/t/t2300-cd-to-toplevel_sh.html">t2300-cd-to-toplevel.sh</a>
  
    <li><a href="../git/t/t3000-ls-files-others_sh.html">t3000-ls-files-others.sh</a>
  
    <li><a href="../git/t/t3001-ls-files-others-exclude_sh.html">t3001-ls-files-others-exclude.sh</a>
  
    <li><a href="../git/t/t3002-ls-files-dashpath_sh.html">t3002-ls-files-dashpath.sh</a>
  
    <li><a href="../git/t/t3003-ls-files-exclude_sh.html">t3003-ls-files-exclude.sh</a>
  
    <li><a href="../git/t/t3004-ls-files-basic_sh.html">t3004-ls-files-basic.sh</a>
  
    <li><a href="../git/t/t3005-ls-files-relative_sh.html">t3005-ls-files-relative.sh</a>
  
    <li><a href="../git/t/t3006-ls-files-long_sh.html">t3006-ls-files-long.sh</a>
  
    <li><a href="../git/t/t3010-ls-files-killed-modified_sh.html">t3010-ls-files-killed-modified.sh</a>
  
    <li><a href="../git/t/t3020-ls-files-error-unmatch_sh.html">t3020-ls-files-error-unmatch.sh</a>
  
    <li><a href="../git/t/t3030-merge-recursive_sh.html">t3030-merge-recursive.sh</a>
  
    <li><a href="../git/t/t3031-merge-criscross_sh.html">t3031-merge-criscross.sh</a>
  
    <li><a href="../git/t/t3032-merge-recursive-options_sh.html">t3032-merge-recursive-options.sh</a>
  
    <li><a href="../git/t/t3040-subprojects-basic_sh.html">t3040-subprojects-basic.sh</a>
  
    <li><a href="../git/t/t3050-subprojects-fetch_sh.html">t3050-subprojects-fetch.sh</a>
  
    <li><a href="../git/t/t3060-ls-files-with-tree_sh.html">t3060-ls-files-with-tree.sh</a>
  
    <li><a href="../git/t/t3070-wildmatch_sh.html">t3070-wildmatch.sh</a>
  
    <li><a href="../git/t/t3100-ls-tree-restrict_sh.html">t3100-ls-tree-restrict.sh</a>
  
    <li><a href="../git/t/t3101-ls-tree-dirname_sh.html">t3101-ls-tree-dirname.sh</a>
  
    <li><a href="../git/t/t3102-ls-tree-wildcards_sh.html">t3102-ls-tree-wildcards.sh</a>
  
    <li><a href="../git/t/t3103-ls-tree-misc_sh.html">t3103-ls-tree-misc.sh</a>
  
    <li><a href="../git/t/t3200-branch_sh.html">t3200-branch.sh</a>
  
    <li><a href="../git/t/t3201-branch-contains_sh.html">t3201-branch-contains.sh</a>
  
    <li><a href="../git/t/t3202-show-branch-octopus_sh.html">t3202-show-branch-octopus.sh</a>
  
    <li><a href="../git/t/t3203-branch-output_sh.html">t3203-branch-output.sh</a>
  
    <li><a href="../git/t/t3210-pack-refs_sh.html">t3210-pack-refs.sh</a>
  
    <li><a href="../git/t/t3211-peel-ref_sh.html">t3211-peel-ref.sh</a>
  
    <li><a href="../git/t/t3300-funny-names_sh.html">t3300-funny-names.sh</a>
  
    <li><a href="../git/t/t3301-notes_sh.html">t3301-notes.sh</a>
  
    <li><a href="../git/t/t3302-notes-index-expensive_sh.html">t3302-notes-index-expensive.sh</a>
  
    <li><a href="../git/t/t3303-notes-subtrees_sh.html">t3303-notes-subtrees.sh</a>
  
    <li><a href="../git/t/t3304-notes-mixed_sh.html">t3304-notes-mixed.sh</a>
  
    <li><a href="../git/t/t3305-notes-fanout_sh.html">t3305-notes-fanout.sh</a>
  
    <li><a href="../git/t/t3306-notes-prune_sh.html">t3306-notes-prune.sh</a>
  
    <li><a href="../git/t/t3307-notes-man_sh.html">t3307-notes-man.sh</a>
  
    <li><a href="../git/t/t3308-notes-merge_sh.html">t3308-notes-merge.sh</a>
  
    <li><a href="../git/t/t3309-notes-merge-auto-resolve_sh.html">t3309-notes-merge-auto-resolve.sh</a>
  
    <li><a href="../git/t/t3310-notes-merge-manual-resolve_sh.html">t3310-notes-merge-manual-resolve.sh</a>
  
    <li><a href="../git/t/t3311-notes-merge-fanout_sh.html">t3311-notes-merge-fanout.sh</a>
  
    <li><a href="../git/t/t3400-rebase_sh.html">t3400-rebase.sh</a>
  
    <li><a href="../git/t/t3402-rebase-merge_sh.html">t3402-rebase-merge.sh</a>
  
    <li><a href="../git/t/t3403-rebase-skip_sh.html">t3403-rebase-skip.sh</a>
  
    <li><a href="../git/t/t3404-rebase-interactive_sh.html">t3404-rebase-interactive.sh</a>
  
    <li><a href="../git/t/t3405-rebase-malformed_sh.html">t3405-rebase-malformed.sh</a>
  
    <li><a href="../git/t/t3406-rebase-message_sh.html">t3406-rebase-message.sh</a>
  
    <li><a href="../git/t/t3407-rebase-abort_sh.html">t3407-rebase-abort.sh</a>
  
    <li><a href="../git/t/t3408-rebase-multi-line_sh.html">t3408-rebase-multi-line.sh</a>
  
    <li><a href="../git/t/t3409-rebase-preserve-merges_sh.html">t3409-rebase-preserve-merges.sh</a>
  
    <li><a href="../git/t/t3410-rebase-preserve-dropped-merges_sh.html">t3410-rebase-preserve-dropped-merges.sh</a>
  
    <li><a href="../git/t/t3411-rebase-preserve-around-merges_sh.html">t3411-rebase-preserve-around-merges.sh</a>
  
    <li><a href="../git/t/t3412-rebase-root_sh.html">t3412-rebase-root.sh</a>
  
    <li><a href="../git/t/t3413-rebase-hook_sh.html">t3413-rebase-hook.sh</a>
  
    <li><a href="../git/t/t3414-rebase-preserve-onto_sh.html">t3414-rebase-preserve-onto.sh</a>
  
    <li><a href="../git/t/t3415-rebase-autosquash_sh.html">t3415-rebase-autosquash.sh</a>
  
    <li><a href="../git/t/t3416-rebase-onto-threedots_sh.html">t3416-rebase-onto-threedots.sh</a>
  
    <li><a href="../git/t/t3417-rebase-whitespace-fix_sh.html">t3417-rebase-whitespace-fix.sh</a>
  
    <li><a href="../git/t/t3418-rebase-continue_sh.html">t3418-rebase-continue.sh</a>
  
    <li><a href="../git/t/t3419-rebase-patch-id_sh.html">t3419-rebase-patch-id.sh</a>
  
    <li><a href="../git/t/t3420-rebase-autostash_sh.html">t3420-rebase-autostash.sh</a>
  
    <li><a href="../git/t/t3421-rebase-topology-linear_sh.html">t3421-rebase-topology-linear.sh</a>
  
    <li><a href="../git/t/t3425-rebase-topology-merges_sh.html">t3425-rebase-topology-merges.sh</a>
  
    <li><a href="../git/t/t3500-cherry_sh.html">t3500-cherry.sh</a>
  
    <li><a href="../git/t/t3501-revert-cherry-pick_sh.html">t3501-revert-cherry-pick.sh</a>
  
    <li><a href="../git/t/t3502-cherry-pick-merge_sh.html">t3502-cherry-pick-merge.sh</a>
  
    <li><a href="../git/t/t3503-cherry-pick-root_sh.html">t3503-cherry-pick-root.sh</a>
  
    <li><a href="../git/t/t3504-cherry-pick-rerere_sh.html">t3504-cherry-pick-rerere.sh</a>
  
    <li><a href="../git/t/t3505-cherry-pick-empty_sh.html">t3505-cherry-pick-empty.sh</a>
  
    <li><a href="../git/t/t3506-cherry-pick-ff_sh.html">t3506-cherry-pick-ff.sh</a>
  
    <li><a href="../git/t/t3507-cherry-pick-conflict_sh.html">t3507-cherry-pick-conflict.sh</a>
  
    <li><a href="../git/t/t3508-cherry-pick-many-commits_sh.html">t3508-cherry-pick-many-commits.sh</a>
  
    <li><a href="../git/t/t3509-cherry-pick-merge-df_sh.html">t3509-cherry-pick-merge-df.sh</a>
  
    <li><a href="../git/t/t3510-cherry-pick-sequence_sh.html">t3510-cherry-pick-sequence.sh</a>
  
    <li><a href="../git/t/t3511-cherry-pick-x_sh.html">t3511-cherry-pick-x.sh</a>
  
    <li><a href="../git/t/t3600-rm_sh.html">t3600-rm.sh</a>
  
    <li><a href="../git/t/t3700-add_sh.html">t3700-add.sh</a>
  
    <li><a href="../git/t/t3701-add-interactive_sh.html">t3701-add-interactive.sh</a>
  
    <li><a href="../git/t/t3702-add-edit_sh.html">t3702-add-edit.sh</a>
  
    <li><a href="../git/t/t3703-add-magic-pathspec_sh.html">t3703-add-magic-pathspec.sh</a>
  
    <li><a href="../git/t/t3800-mktag_sh.html">t3800-mktag.sh</a>
  
    <li><a href="../git/t/t3900-i18n-commit_sh.html">t3900-i18n-commit.sh</a>
  
    <li><a href="../git/t/t3900/1-UTF-8_txt.html">1-UTF-8</a>
  
    <li><a href="../git/t/t3900/2-UTF-8_txt.html">2-UTF-8</a>
  
    <li><a href="../git/t/t3900/ISO-2022-JP_txt.html">ISO-2022-JP</a>
  
    <li><a href="../git/t/t3901-i18n-patch_sh.html">t3901-i18n-patch.sh</a>
  
    <li><a href="../git/t/t3901-utf8_txt.html">t3901-utf8</a>
  
    <li><a href="../git/t/t3902-quoted_sh.html">t3902-quoted.sh</a>
  
    <li><a href="../git/t/t3903-stash_sh.html">t3903-stash.sh</a>
  
    <li><a href="../git/t/t3904-stash-patch_sh.html">t3904-stash-patch.sh</a>
  
    <li><a href="../git/t/t3905-stash-include-untracked_sh.html">t3905-stash-include-untracked.sh</a>
  
    <li><a href="../git/t/t3910-mac-os-precompose_sh.html">t3910-mac-os-precompose.sh</a>
  
    <li><a href="../git/t/t4000-diff-format_sh.html">t4000-diff-format.sh</a>
  
    <li><a href="../git/t/t4001-diff-rename_sh.html">t4001-diff-rename.sh</a>
  
    <li><a href="../git/t/t4002-diff-basic_sh.html">t4002-diff-basic.sh</a>
  
    <li><a href="../git/t/t4003-diff-rename-1_sh.html">t4003-diff-rename-1.sh</a>
  
    <li><a href="../git/t/t4004-diff-rename-symlink_sh.html">t4004-diff-rename-symlink.sh</a>
  
    <li><a href="../git/t/t4005-diff-rename-2_sh.html">t4005-diff-rename-2.sh</a>
  
    <li><a href="../git/t/t4006-diff-mode_sh.html">t4006-diff-mode.sh</a>
  
    <li><a href="../git/t/t4007-rename-3_sh.html">t4007-rename-3.sh</a>
  
    <li><a href="../git/t/t4008-diff-break-rewrite_sh.html">t4008-diff-break-rewrite.sh</a>
  
    <li><a href="../git/t/t4009-diff-rename-4_sh.html">t4009-diff-rename-4.sh</a>
  
    <li><a href="../git/t/t4010-diff-pathspec_sh.html">t4010-diff-pathspec.sh</a>
  
    <li><a href="../git/t/t4011-diff-symlink_sh.html">t4011-diff-symlink.sh</a>
  
    <li><a href="../git/t/t4012-diff-binary_sh.html">t4012-diff-binary.sh</a>
  
    <li><a href="../git/t/t4013-diff-various_sh.html">t4013-diff-various.sh</a>
  
    <li><a href="../git/t/t4013/diff_config_format_subjectprefix_DIFFERENT_PREFIX.html">diff.config_format.subjectprefix_DIFFERENT_PREFIX</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_--summary_master.html">diff.diff-tree_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_--summary_side.html">diff.diff-tree_--cc_--patch-with-stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_master.html">diff.diff-tree_--cc_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--stat_--summary_master.html">diff.diff-tree_--cc_--stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--stat_--summary_side.html">diff.diff-tree_--cc_--stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--stat_master.html">diff.diff-tree_--cc_--stat_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_master.html">diff.diff-tree_--cc_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--patch-with-raw_initial.html">diff.diff-tree_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--patch-with-stat_initial.html">diff.diff-tree_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--patch-with-raw_initial.html">diff.diff-tree_--pretty=oneline_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--patch-with-stat_initial.html">diff.diff-tree_--pretty=oneline_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_--patch-with-raw_initial.html">diff.diff-tree_--pretty=oneline_--root_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_--patch-with-stat_initial.html">diff.diff-tree_--pretty=oneline_--root_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_-p_initial.html">diff.diff-tree_--pretty=oneline_--root_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_initial.html">diff.diff-tree_--pretty=oneline_--root_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_-p_initial.html">diff.diff-tree_--pretty=oneline_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_initial.html">diff.diff-tree_--pretty=oneline_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--patch-with-raw_initial.html">diff.diff-tree_--pretty_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--patch-with-stat_initial.html">diff.diff-tree_--pretty_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--patch-with-stat_side.html">diff.diff-tree_--pretty_--patch-with-stat_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--patch-with-raw_initial.html">diff.diff-tree_--pretty_--root_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--patch-with-stat_initial.html">diff.diff-tree_--pretty_--root_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--stat_--summary_initial.html">diff.diff-tree_--pretty_--root_--stat_--summary_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--stat_initial.html">diff.diff-tree_--pretty_--root_--stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--summary_-r_initial.html">diff.diff-tree_--pretty_--root_--summary_-r_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--summary_initial.html">diff.diff-tree_--pretty_--root_--summary_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_-p_initial.html">diff.diff-tree_--pretty_--root_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_initial.html">diff.diff-tree_--pretty_--root_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--stat_--summary_initial.html">diff.diff-tree_--pretty_--stat_--summary_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--stat_initial.html">diff.diff-tree_--pretty_--stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--summary_initial.html">diff.diff-tree_--pretty_--summary_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_-p_initial.html">diff.diff-tree_--pretty_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_-p_side.html">diff.diff-tree_--pretty_-p_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_initial.html">diff.diff-tree_--pretty_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_side.html">diff.diff-tree_--pretty_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_--abbrev_initial.html">diff.diff-tree_--root_--abbrev_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_--patch-with-raw_initial.html">diff.diff-tree_--root_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_--patch-with-stat_initial.html">diff.diff-tree_--root_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_-p_initial.html">diff.diff-tree_--root_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_-r_--abbrev=4_initial.html">diff.diff-tree_--root_-r_--abbrev=4_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_-r_--abbrev_initial.html">diff.diff-tree_--root_-r_--abbrev_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_-r_initial.html">diff.diff-tree_--root_-r_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_initial.html">diff.diff-tree_--root_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_--abbrev_master.html">diff.diff-tree_-c_--abbrev_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_--stat_--summary_master.html">diff.diff-tree_-c_--stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_--stat_--summary_side.html">diff.diff-tree_-c_--stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_--stat_master.html">diff.diff-tree_-c_--stat_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_master.html">diff.diff-tree_-c_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-p_-m_master.html">diff.diff-tree_-p_-m_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-p_initial.html">diff.diff-tree_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-p_master.html">diff.diff-tree_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-r_--abbrev=4_initial.html">diff.diff-tree_-r_--abbrev=4_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-r_--abbrev_initial.html">diff.diff-tree_-r_--abbrev_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-r_initial.html">diff.diff-tree_-r_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_initial.html">diff.diff-tree_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_master.html">diff.diff-tree_master</a>
  
    <li><a href="../git/t/t4013/diff_diff_--abbrev_initial__side.html">diff.diff_--abbrev_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--cached.html">diff.diff_--cached</a>
  
    <li><a href="../git/t/t4013/diff_diff_--cached_--_file0.html">diff.diff_--cached_--_file0</a>
  
    <li><a href="../git/t/t4013/diff_diff_--dirstat-by-file_initial_rearrange.html">diff.diff_--dirstat-by-file_initial_rearrange</a>
  
    <li><a href="../git/t/t4013/diff_diff_--dirstat_initial_rearrange.html">diff.diff_--dirstat_initial_rearrange</a>
  
    <li><a href="../git/t/t4013/diff_diff_--dirstat_master~1_master~2.html">diff.diff_--dirstat_master~1_master~2</a>
  
    <li><a href="../git/t/t4013/diff_diff_--name-status_dir2_dir.html">diff.diff_--name-status_dir2_dir</a>
  
    <li><a href="../git/t/t4013/diff_diff_--no-index_--name-status_--_dir2_dir.html">diff.diff_--no-index_--name-status_--_dir2_dir</a>
  
    <li><a href="../git/t/t4013/diff_diff_--no-index_--name-status_dir2_dir.html">diff.diff_--no-index_--name-status_dir2_dir</a>
  
    <li><a href="../git/t/t4013/diff_diff_--no-index_dir_dir3.html">diff.diff_--no-index_dir_dir3</a>
  
    <li><a href="../git/t/t4013/diff_diff_--patch-with-raw_-r_initial__side.html">diff.diff_--patch-with-raw_-r_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--patch-with-raw_initial__side.html">diff.diff_--patch-with-raw_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--patch-with-stat_-r_initial__side.html">diff.diff_--patch-with-stat_-r_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--patch-with-stat_initial__side.html">diff.diff_--patch-with-stat_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--stat_initial__side.html">diff.diff_--stat_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_-r_--stat_initial__side.html">diff.diff_-r_--stat_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_-r_initial__side.html">diff.diff_-r_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_initial__side.html">diff.diff_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_master_master^_side.html">diff.diff_master_master^_side</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--attach_--stdout_--suffix=_diff_initial__side.html">diff.format-patch_--attach_--stdout_--suffix=.diff_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--attach_--stdout_initial__master.html">diff.format-patch_--attach_--stdout_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--attach_--stdout_initial__master^.html">diff.format-patch_--attach_--stdout_initial..master^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--attach_--stdout_initial__side.html">diff.format-patch_--attach_--stdout_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_--numbered-files_initial__master.html">diff.format-patch_--inline_--stdout_--numbered-files_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_--subject-prefix=TESTCASE_initial__master.html">diff.format-patch_--inline_--stdout_--subject-prefix=TESTCASE_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master.html">diff.format-patch_--inline_--stdout_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master^.html">diff.format-patch_--inline_--stdout_initial..master^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master^^.html">diff.format-patch_--inline_--stdout_initial..master^^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_initial__side.html">diff.format-patch_--inline_--stdout_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_--cover-letter_-n_initial__master^.html">diff.format-patch_--stdout_--cover-letter_-n_initial..master^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_--no-numbered_initial__master.html">diff.format-patch_--stdout_--no-numbered_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_--numbered_initial__master.html">diff.format-patch_--stdout_--numbered_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_initial__master.html">diff.format-patch_--stdout_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_initial__master^.html">diff.format-patch_--stdout_initial..master^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_initial__side.html">diff.format-patch_--stdout_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_log_--decorate=full_--all.html">diff.log_--decorate=full_--all</a>
  
    <li><a href="../git/t/t4013/diff_log_--decorate_--all.html">diff.log_--decorate_--all</a>
  
    <li><a href="../git/t/t4013/diff_log_--patch-with-stat_--summary_master_--_dir_.html">diff.log_--patch-with-stat_--summary_master_--_dir_</a>
  
    <li><a href="../git/t/t4013/diff_log_--patch-with-stat_master.html">diff.log_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--patch-with-stat_master_--_dir_.html">diff.log_--patch-with-stat_master_--_dir_</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_--cc_--patch-with-stat_--summary_master.html">diff.log_--root_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_--patch-with-stat_--summary_master.html">diff.log_--root_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_--patch-with-stat_master.html">diff.log_--root_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_-c_--patch-with-stat_--summary_master.html">diff.log_--root_-c_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_-p_master.html">diff.log_--root_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_master.html">diff.log_--root_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-GF_-p_--pickaxe-all_master.html">diff.log_-GF_-p_--pickaxe-all_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-GF_-p_master.html">diff.log_-GF_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-GF_master.html">diff.log_-GF_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_-p_master.html">diff.log_-SF_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_master.html">diff.log_-SF_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_master_--max-count=0.html">diff.log_-SF_master_--max-count=0</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_master_--max-count=1.html">diff.log_-SF_master_--max-count=1</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_master_--max-count=2.html">diff.log_-SF_master_--max-count=2</a>
  
    <li><a href="../git/t/t4013/diff_log_-S_F_master.html">diff.log_-S_F_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-m_-p_--first-parent_master.html">diff.log_-m_-p_--first-parent_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-m_-p_master.html">diff.log_-m_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-p_--first-parent_master.html">diff.log_-p_--first-parent_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-p_master.html">diff.log_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_master.html">diff.log_master</a>
  
    <li><a href="../git/t/t4013/diff_rev-list_--children_HEAD.html">diff.rev-list_--children_HEAD</a>
  
    <li><a href="../git/t/t4013/diff_rev-list_--parents_HEAD.html">diff.rev-list_--parents_HEAD</a>
  
    <li><a href="../git/t/t4013/diff_show_--first-parent_master.html">diff.show_--first-parent_master</a>
  
    <li><a href="../git/t/t4013/diff_show_--patch-with-raw_side.html">diff.show_--patch-with-raw_side</a>
  
    <li><a href="../git/t/t4013/diff_show_--patch-with-stat_--summary_side.html">diff.show_--patch-with-stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_show_--patch-with-stat_side.html">diff.show_--patch-with-stat_side</a>
  
    <li><a href="../git/t/t4013/diff_show_--root_initial.html">diff.show_--root_initial</a>
  
    <li><a href="../git/t/t4013/diff_show_--stat_--summary_side.html">diff.show_--stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_show_--stat_side.html">diff.show_--stat_side</a>
  
    <li><a href="../git/t/t4013/diff_show_-c_master.html">diff.show_-c_master</a>
  
    <li><a href="../git/t/t4013/diff_show_-m_master.html">diff.show_-m_master</a>
  
    <li><a href="../git/t/t4013/diff_show_initial.html">diff.show_initial</a>
  
    <li><a href="../git/t/t4013/diff_show_master.html">diff.show_master</a>
  
    <li><a href="../git/t/t4013/diff_show_side.html">diff.show_side</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--patch-with-stat_--summary_master_--_dir_.html">diff.whatchanged_--patch-with-stat_--summary_master_--_dir_</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--patch-with-stat_master.html">diff.whatchanged_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--patch-with-stat_master_--_dir_.html">diff.whatchanged_--patch-with-stat_master_--_dir_</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_--cc_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_--patch-with-stat_master.html">diff.whatchanged_--root_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_-c_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_-c_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_-p_master.html">diff.whatchanged_--root_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_master.html">diff.whatchanged_--root_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_-SF_-p_master.html">diff.whatchanged_-SF_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_-SF_master.html">diff.whatchanged_-SF_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_-p_master.html">diff.whatchanged_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_master.html">diff.whatchanged_master</a>
  
    <li><a href="../git/t/t4014-format-patch_sh.html">t4014-format-patch.sh</a>
  
    <li><a href="../git/t/t4015-diff-whitespace_sh.html">t4015-diff-whitespace.sh</a>
  
    <li><a href="../git/t/t4016-diff-quote_sh.html">t4016-diff-quote.sh</a>
  
    <li><a href="../git/t/t4017-diff-retval_sh.html">t4017-diff-retval.sh</a>
  
    <li><a href="../git/t/t4018-diff-funcname_sh.html">t4018-diff-funcname.sh</a>
  
    <li><a href="../git/t/t4019-diff-wserror_sh.html">t4019-diff-wserror.sh</a>
  
    <li><a href="../git/t/t4020-diff-external_sh.html">t4020-diff-external.sh</a>
  
    <li><a href="../git/t/t4021-format-patch-numbered_sh.html">t4021-format-patch-numbered.sh</a>
  
    <li><a href="../git/t/t4022-diff-rewrite_sh.html">t4022-diff-rewrite.sh</a>
  
    <li><a href="../git/t/t4023-diff-rename-typechange_sh.html">t4023-diff-rename-typechange.sh</a>
  
    <li><a href="../git/t/t4024-diff-optimize-common_sh.html">t4024-diff-optimize-common.sh</a>
  
    <li><a href="../git/t/t4025-hunk-header_sh.html">t4025-hunk-header.sh</a>
  
    <li><a href="../git/t/t4026-color_sh.html">t4026-color.sh</a>
  
    <li><a href="../git/t/t4027-diff-submodule_sh.html">t4027-diff-submodule.sh</a>
  
    <li><a href="../git/t/t4028-format-patch-mime-headers_sh.html">t4028-format-patch-mime-headers.sh</a>
  
    <li><a href="../git/t/t4029-diff-trailing-space_sh.html">t4029-diff-trailing-space.sh</a>
  
    <li><a href="../git/t/t4030-diff-textconv_sh.html">t4030-diff-textconv.sh</a>
  
    <li><a href="../git/t/t4031-diff-rewrite-binary_sh.html">t4031-diff-rewrite-binary.sh</a>
  
    <li><a href="../git/t/t4032-diff-inter-hunk-context_sh.html">t4032-diff-inter-hunk-context.sh</a>
  
    <li><a href="../git/t/t4033-diff-patience_sh.html">t4033-diff-patience.sh</a>
  
    <li><a href="../git/t/t4034-diff-words_sh.html">t4034-diff-words.sh</a>
  
    <li><a href="../git/t/t4034/ada/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/ada/post.html">post</a>
  
    <li><a href="../git/t/t4034/ada/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/bibtex/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/bibtex/post.html">post</a>
  
    <li><a href="../git/t/t4034/bibtex/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/cpp/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/cpp/post.html">post</a>
  
    <li><a href="../git/t/t4034/cpp/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/csharp/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/csharp/post.html">post</a>
  
    <li><a href="../git/t/t4034/csharp/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/fortran/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/fortran/post.html">post</a>
  
    <li><a href="../git/t/t4034/fortran/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/html/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/html/post.html">post</a>
  
    <li><a href="../git/t/t4034/html/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/java/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/java/post.html">post</a>
  
    <li><a href="../git/t/t4034/java/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/matlab/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/matlab/post.html">post</a>
  
    <li><a href="../git/t/t4034/matlab/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/objc/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/objc/post.html">post</a>
  
    <li><a href="../git/t/t4034/objc/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/pascal/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/pascal/post.html">post</a>
  
    <li><a href="../git/t/t4034/pascal/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/perl/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/perl/post.html">post</a>
  
    <li><a href="../git/t/t4034/perl/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/php/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/php/post.html">post</a>
  
    <li><a href="../git/t/t4034/php/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/python/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/python/post.html">post</a>
  
    <li><a href="../git/t/t4034/python/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/ruby/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/ruby/post.html">post</a>
  
    <li><a href="../git/t/t4034/ruby/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/tex/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/tex/post.html">post</a>
  
    <li><a href="../git/t/t4034/tex/pre.html">pre</a>
  
    <li><a href="../git/t/t4035-diff-quiet_sh.html">t4035-diff-quiet.sh</a>
  
    <li><a href="../git/t/t4036-format-patch-signer-mime_sh.html">t4036-format-patch-signer-mime.sh</a>
  
    <li><a href="../git/t/t4037-diff-r-t-dirs_sh.html">t4037-diff-r-t-dirs.sh</a>
  
    <li><a href="../git/t/t4038-diff-combined_sh.html">t4038-diff-combined.sh</a>
  
    <li><a href="../git/t/t4039-diff-assume-unchanged_sh.html">t4039-diff-assume-unchanged.sh</a>
  
    <li><a href="../git/t/t4040-whitespace-status_sh.html">t4040-whitespace-status.sh</a>
  
    <li><a href="../git/t/t4041-diff-submodule-option_sh.html">t4041-diff-submodule-option.sh</a>
  
    <li><a href="../git/t/t4042-diff-textconv-caching_sh.html">t4042-diff-textconv-caching.sh</a>
  
    <li><a href="../git/t/t4043-diff-rename-binary_sh.html">t4043-diff-rename-binary.sh</a>
  
    <li><a href="../git/t/t4044-diff-index-unique-abbrev_sh.html">t4044-diff-index-unique-abbrev.sh</a>
  
    <li><a href="../git/t/t4045-diff-relative_sh.html">t4045-diff-relative.sh</a>
  
    <li><a href="../git/t/t4046-diff-unmerged_sh.html">t4046-diff-unmerged.sh</a>
  
    <li><a href="../git/t/t4047-diff-dirstat_sh.html">t4047-diff-dirstat.sh</a>
  
    <li><a href="../git/t/t4048-diff-combined-binary_sh.html">t4048-diff-combined-binary.sh</a>
  
    <li><a href="../git/t/t4049-diff-stat-count_sh.html">t4049-diff-stat-count.sh</a>
  
    <li><a href="../git/t/t4050-diff-histogram_sh.html">t4050-diff-histogram.sh</a>
  
    <li><a href="../git/t/t4051-diff-function-context_sh.html">t4051-diff-function-context.sh</a>
  
    <li><a href="../git/t/t4052-stat-output_sh.html">t4052-stat-output.sh</a>
  
    <li><a href="../git/t/t4053-diff-no-index_sh.html">t4053-diff-no-index.sh</a>
  
    <li><a href="../git/t/t4054-diff-bogus-tree_sh.html">t4054-diff-bogus-tree.sh</a>
  
    <li><a href="../git/t/t4055-diff-context_sh.html">t4055-diff-context.sh</a>
  
    <li><a href="../git/t/t4100-apply-stat_sh.html">t4100-apply-stat.sh</a>
  
    <li><a href="../git/t/t4100/t-apply-1_expect.html">t-apply-1.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-1_patch.html">t-apply-1.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-2_expect.html">t-apply-2.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-2_patch.html">t-apply-2.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-3_expect.html">t-apply-3.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-3_patch.html">t-apply-3.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-4_expect.html">t-apply-4.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-4_patch.html">t-apply-4.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-5_expect.html">t-apply-5.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-5_patch.html">t-apply-5.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-6_expect.html">t-apply-6.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-6_patch.html">t-apply-6.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-7_expect.html">t-apply-7.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-7_patch.html">t-apply-7.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-8_expect.html">t-apply-8.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-8_patch.html">t-apply-8.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-9_expect.html">t-apply-9.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-9_patch.html">t-apply-9.patch</a>
  
    <li><a href="../git/t/t4101-apply-nonl_sh.html">t4101-apply-nonl.sh</a>
  
    <li><a href="../git/t/t4101/diff_0-1.html">diff.0-1</a>
  
    <li><a href="../git/t/t4101/diff_0-2.html">diff.0-2</a>
  
    <li><a href="../git/t/t4101/diff_0-3.html">diff.0-3</a>
  
    <li><a href="../git/t/t4101/diff_1-0.html">diff.1-0</a>
  
    <li><a href="../git/t/t4101/diff_1-2.html">diff.1-2</a>
  
    <li><a href="../git/t/t4101/diff_1-3.html">diff.1-3</a>
  
    <li><a href="../git/t/t4101/diff_2-0.html">diff.2-0</a>
  
    <li><a href="../git/t/t4101/diff_2-1.html">diff.2-1</a>
  
    <li><a href="../git/t/t4101/diff_2-3.html">diff.2-3</a>
  
    <li><a href="../git/t/t4101/diff_3-0.html">diff.3-0</a>
  
    <li><a href="../git/t/t4101/diff_3-1.html">diff.3-1</a>
  
    <li><a href="../git/t/t4101/diff_3-2.html">diff.3-2</a>
  
    <li><a href="../git/t/t4102-apply-rename_sh.html">t4102-apply-rename.sh</a>
  
    <li><a href="../git/t/t4103-apply-binary_sh.html">t4103-apply-binary.sh</a>
  
    <li><a href="../git/t/t4104-apply-boundary_sh.html">t4104-apply-boundary.sh</a>
  
    <li><a href="../git/t/t4105-apply-fuzz_sh.html">t4105-apply-fuzz.sh</a>
  
    <li><a href="../git/t/t4106-apply-stdin_sh.html">t4106-apply-stdin.sh</a>
  
    <li><a href="../git/t/t4107-apply-ignore-whitespace_sh.html">t4107-apply-ignore-whitespace.sh</a>
  
    <li><a href="../git/t/t4108-apply-threeway_sh.html">t4108-apply-threeway.sh</a>
  
    <li><a href="../git/t/t4109-apply-multifrag_sh.html">t4109-apply-multifrag.sh</a>
  
    <li><a href="../git/t/t4109/expect-1.html">expect-1</a>
  
    <li><a href="../git/t/t4109/expect-2.html">expect-2</a>
  
    <li><a href="../git/t/t4109/expect-3.html">expect-3</a>
  
    <li><a href="../git/t/t4109/patch1_patch.html">patch1.patch</a>
  
    <li><a href="../git/t/t4109/patch2_patch.html">patch2.patch</a>
  
    <li><a href="../git/t/t4109/patch3_patch.html">patch3.patch</a>
  
    <li><a href="../git/t/t4109/patch4_patch.html">patch4.patch</a>
  
    <li><a href="../git/t/t4110-apply-scan_sh.html">t4110-apply-scan.sh</a>
  
    <li><a href="../git/t/t4110/expect.html">expect</a>
  
    <li><a href="../git/t/t4110/patch1_patch.html">patch1.patch</a>
  
    <li><a href="../git/t/t4110/patch2_patch.html">patch2.patch</a>
  
    <li><a href="../git/t/t4110/patch3_patch.html">patch3.patch</a>
  
    <li><a href="../git/t/t4110/patch4_patch.html">patch4.patch</a>
  
    <li><a href="../git/t/t4110/patch5_patch.html">patch5.patch</a>
  
    <li><a href="../git/t/t4111-apply-subdir_sh.html">t4111-apply-subdir.sh</a>
  
    <li><a href="../git/t/t4112-apply-renames_sh.html">t4112-apply-renames.sh</a>
  
    <li><a href="../git/t/t4113-apply-ending_sh.html">t4113-apply-ending.sh</a>
  
    <li><a href="../git/t/t4114-apply-typechange_sh.html">t4114-apply-typechange.sh</a>
  
    <li><a href="../git/t/t4115-apply-symlink_sh.html">t4115-apply-symlink.sh</a>
  
    <li><a href="../git/t/t4116-apply-reverse_sh.html">t4116-apply-reverse.sh</a>
  
    <li><a href="../git/t/t4117-apply-reject_sh.html">t4117-apply-reject.sh</a>
  
    <li><a href="../git/t/t4118-apply-empty-context_sh.html">t4118-apply-empty-context.sh</a>
  
    <li><a href="../git/t/t4119-apply-config_sh.html">t4119-apply-config.sh</a>
  
    <li><a href="../git/t/t4120-apply-popt_sh.html">t4120-apply-popt.sh</a>
  
    <li><a href="../git/t/t4121-apply-diffs_sh.html">t4121-apply-diffs.sh</a>
  
    <li><a href="../git/t/t4122-apply-symlink-inside_sh.html">t4122-apply-symlink-inside.sh</a>
  
    <li><a href="../git/t/t4123-apply-shrink_sh.html">t4123-apply-shrink.sh</a>
  
    <li><a href="../git/t/t4124-apply-ws-rule_sh.html">t4124-apply-ws-rule.sh</a>
  
    <li><a href="../git/t/t4125-apply-ws-fuzz_sh.html">t4125-apply-ws-fuzz.sh</a>
  
    <li><a href="../git/t/t4126-apply-empty_sh.html">t4126-apply-empty.sh</a>
  
    <li><a href="../git/t/t4127-apply-same-fn_sh.html">t4127-apply-same-fn.sh</a>
  
    <li><a href="../git/t/t4128-apply-root_sh.html">t4128-apply-root.sh</a>
  
    <li><a href="../git/t/t4129-apply-samemode_sh.html">t4129-apply-samemode.sh</a>
  
    <li><a href="../git/t/t4130-apply-criss-cross-rename_sh.html">t4130-apply-criss-cross-rename.sh</a>
  
    <li><a href="../git/t/t4131-apply-fake-ancestor_sh.html">t4131-apply-fake-ancestor.sh</a>
  
    <li><a href="../git/t/t4132-apply-removal_sh.html">t4132-apply-removal.sh</a>
  
    <li><a href="../git/t/t4133-apply-filenames_sh.html">t4133-apply-filenames.sh</a>
  
    <li><a href="../git/t/t4134-apply-submodule_sh.html">t4134-apply-submodule.sh</a>
  
    <li><a href="../git/t/t4135-apply-weird-filenames_sh.html">t4135-apply-weird-filenames.sh</a>
  
    <li><a href="../git/t/t4135/add-plain_diff.html">add-plain.diff</a>
  
    <li><a href="../git/t/t4135/add-with backslash_diff.html">add-with backslash.diff</a>
  
    <li><a href="../git/t/t4135/add-with quote_diff.html">add-with quote.diff</a>
  
    <li><a href="../git/t/t4135/add-with spaces_diff.html">add-with spaces.diff</a>
  
    <li><a href="../git/t/t4135/add-with tab_diff.html">add-with tab.diff</a>
  
    <li><a href="../git/t/t4135/damaged-tz_diff.html">damaged-tz.diff</a>
  
    <li><a href="../git/t/t4135/damaged_diff.html">damaged.diff</a>
  
    <li><a href="../git/t/t4135/diff-plain_diff.html">diff-plain.diff</a>
  
    <li><a href="../git/t/t4135/diff-with backslash_diff.html">diff-with backslash.diff</a>
  
    <li><a href="../git/t/t4135/diff-with quote_diff.html">diff-with quote.diff</a>
  
    <li><a href="../git/t/t4135/diff-with spaces_diff.html">diff-with spaces.diff</a>
  
    <li><a href="../git/t/t4135/diff-with tab_diff.html">diff-with tab.diff</a>
  
    <li><a href="../git/t/t4135/funny-tz_diff.html">funny-tz.diff</a>
  
    <li><a href="../git/t/t4135/git-plain_diff.html">git-plain.diff</a>
  
    <li><a href="../git/t/t4135/git-with backslash_diff.html">git-with backslash.diff</a>
  
    <li><a href="../git/t/t4135/git-with quote_diff.html">git-with quote.diff</a>
  
    <li><a href="../git/t/t4135/git-with spaces_diff.html">git-with spaces.diff</a>
  
    <li><a href="../git/t/t4135/git-with tab_diff.html">git-with tab.diff</a>
  
    <li><a href="../git/t/t4135/make-patches.html">make-patches</a>
  
    <li><a href="../git/t/t4136-apply-check_sh.html">t4136-apply-check.sh</a>
  
    <li><a href="../git/t/t4150-am_sh.html">t4150-am.sh</a>
  
    <li><a href="../git/t/t4151-am-abort_sh.html">t4151-am-abort.sh</a>
  
    <li><a href="../git/t/t4152-am-subjects_sh.html">t4152-am-subjects.sh</a>
  
    <li><a href="../git/t/t4200-rerere_sh.html">t4200-rerere.sh</a>
  
    <li><a href="../git/t/t4202-log_sh.html">t4202-log.sh</a>
  
    <li><a href="../git/t/t4203-mailmap_sh.html">t4203-mailmap.sh</a>
  
    <li><a href="../git/t/t4204-patch-id_sh.html">t4204-patch-id.sh</a>
  
    <li><a href="../git/t/t4205-log-pretty-formats_sh.html">t4205-log-pretty-formats.sh</a>
  
    <li><a href="../git/t/t4206-log-follow-harder-copies_sh.html">t4206-log-follow-harder-copies.sh</a>
  
    <li><a href="../git/t/t4207-log-decoration-colors_sh.html">t4207-log-decoration-colors.sh</a>
  
    <li><a href="../git/t/t4208-log-magic-pathspec_sh.html">t4208-log-magic-pathspec.sh</a>
  
    <li><a href="../git/t/t4209-log-pickaxe_sh.html">t4209-log-pickaxe.sh</a>
  
    <li><a href="../git/t/t4210-log-i18n_sh.html">t4210-log-i18n.sh</a>
  
    <li><a href="../git/t/t4211-line-log_sh.html">t4211-line-log.sh</a>
  
    <li><a href="../git/t/t4211/expect_beginning-of-file.html">expect.beginning-of-file</a>
  
    <li><a href="../git/t/t4211/expect_end-of-file.html">expect.end-of-file</a>
  
    <li><a href="../git/t/t4211/expect_move-support-f.html">expect.move-support-f</a>
  
    <li><a href="../git/t/t4211/expect_multiple.html">expect.multiple</a>
  
    <li><a href="../git/t/t4211/expect_multiple-overlapping.html">expect.multiple-overlapping</a>
  
    <li><a href="../git/t/t4211/expect_multiple-superset.html">expect.multiple-superset</a>
  
    <li><a href="../git/t/t4211/expect_parallel-change-f-to-main.html">expect.parallel-change-f-to-main</a>
  
    <li><a href="../git/t/t4211/expect_simple-f.html">expect.simple-f</a>
  
    <li><a href="../git/t/t4211/expect_simple-f-to-main.html">expect.simple-f-to-main</a>
  
    <li><a href="../git/t/t4211/expect_simple-main.html">expect.simple-main</a>
  
    <li><a href="../git/t/t4211/expect_simple-main-to-end.html">expect.simple-main-to-end</a>
  
    <li><a href="../git/t/t4211/expect_two-ranges.html">expect.two-ranges</a>
  
    <li><a href="../git/t/t4211/expect_vanishes-early.html">expect.vanishes-early</a>
  
    <li><a href="../git/t/t4211/history_export.html">history.export</a>
  
    <li><a href="../git/t/t4212-log-corrupt_sh.html">t4212-log-corrupt.sh</a>
  
    <li><a href="../git/t/t4252-am-options_sh.html">t4252-am-options.sh</a>
  
    <li><a href="../git/t/t4252/am-test-1-1.html">am-test-1-1</a>
  
    <li><a href="../git/t/t4252/am-test-1-2.html">am-test-1-2</a>
  
    <li><a href="../git/t/t4252/am-test-2-1.html">am-test-2-1</a>
  
    <li><a href="../git/t/t4252/am-test-2-2.html">am-test-2-2</a>
  
    <li><a href="../git/t/t4252/am-test-3-1.html">am-test-3-1</a>
  
    <li><a href="../git/t/t4252/am-test-3-2.html">am-test-3-2</a>
  
    <li><a href="../git/t/t4252/am-test-4-1.html">am-test-4-1</a>
  
    <li><a href="../git/t/t4252/am-test-4-2.html">am-test-4-2</a>
  
    <li><a href="../git/t/t4252/am-test-5-1.html">am-test-5-1</a>
  
    <li><a href="../git/t/t4252/am-test-5-2.html">am-test-5-2</a>
  
    <li><a href="../git/t/t4252/am-test-6-1.html">am-test-6-1</a>
  
    <li><a href="../git/t/t4252/file-1-0.html">file-1-0</a>
  
    <li><a href="../git/t/t4252/file-2-0.html">file-2-0</a>
  
    <li><a href="../git/t/t4253-am-keep-cr-dos_sh.html">t4253-am-keep-cr-dos.sh</a>
  
    <li><a href="../git/t/t4254-am-corrupt_sh.html">t4254-am-corrupt.sh</a>
  
    <li><a href="../git/t/t4300-merge-tree_sh.html">t4300-merge-tree.sh</a>
  
    <li><a href="../git/t/t5000-tar-tree_sh.html">t5000-tar-tree.sh</a>
  
    <li><a href="../git/t/t5001-archive-attr_sh.html">t5001-archive-attr.sh</a>
  
    <li><a href="../git/t/t5002-archive-attr-pattern_sh.html">t5002-archive-attr-pattern.sh</a>
  
    <li><a href="../git/t/t5003-archive-zip_sh.html">t5003-archive-zip.sh</a>
  
    <li><a href="../git/t/t5004-archive-corner-cases_sh.html">t5004-archive-corner-cases.sh</a>
  
    <li><a href="../git/t/t5100-mailinfo_sh.html">t5100-mailinfo.sh</a>
  
    <li><a href="../git/t/t5100/empty.html">empty</a>
  
    <li><a href="../git/t/t5100/info-from_expect.html">info-from.expect</a>
  
    <li><a href="../git/t/t5100/info-from_in.html">info-from.in</a>
  
    <li><a href="../git/t/t5100/info0001.html">info0001</a>
  
    <li><a href="../git/t/t5100/info0002.html">info0002</a>
  
    <li><a href="../git/t/t5100/info0003.html">info0003</a>
  
    <li><a href="../git/t/t5100/info0004.html">info0004</a>
  
    <li><a href="../git/t/t5100/info0005.html">info0005</a>
  
    <li><a href="../git/t/t5100/info0006.html">info0006</a>
  
    <li><a href="../git/t/t5100/info0007.html">info0007</a>
  
    <li><a href="../git/t/t5100/info0008.html">info0008</a>
  
    <li><a href="../git/t/t5100/info0009.html">info0009</a>
  
    <li><a href="../git/t/t5100/info0010.html">info0010</a>
  
    <li><a href="../git/t/t5100/info0011.html">info0011</a>
  
    <li><a href="../git/t/t5100/info0012.html">info0012</a>
  
    <li><a href="../git/t/t5100/info0013.html">info0013</a>
  
    <li><a href="../git/t/t5100/info0014.html">info0014</a>
  
    <li><a href="../git/t/t5100/info0014--scissors.html">info0014--scissors</a>
  
    <li><a href="../git/t/t5100/info0015.html">info0015</a>
  
    <li><a href="../git/t/t5100/info0015--no-inbody-headers.html">info0015--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/info0016.html">info0016</a>
  
    <li><a href="../git/t/t5100/info0016--no-inbody-headers.html">info0016--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/info0017.html">info0017</a>
  
    <li><a href="../git/t/t5100/msg0001.html">msg0001</a>
  
    <li><a href="../git/t/t5100/msg0002.html">msg0002</a>
  
    <li><a href="../git/t/t5100/msg0003.html">msg0003</a>
  
    <li><a href="../git/t/t5100/msg0004.html">msg0004</a>
  
    <li><a href="../git/t/t5100/msg0005.html">msg0005</a>
  
    <li><a href="../git/t/t5100/msg0006.html">msg0006</a>
  
    <li><a href="../git/t/t5100/msg0007.html">msg0007</a>
  
    <li><a href="../git/t/t5100/msg0008.html">msg0008</a>
  
    <li><a href="../git/t/t5100/msg0009.html">msg0009</a>
  
    <li><a href="../git/t/t5100/msg0010.html">msg0010</a>
  
    <li><a href="../git/t/t5100/msg0011.html">msg0011</a>
  
    <li><a href="../git/t/t5100/msg0012.html">msg0012</a>
  
    <li><a href="../git/t/t5100/msg0013.html">msg0013</a>
  
    <li><a href="../git/t/t5100/msg0014.html">msg0014</a>
  
    <li><a href="../git/t/t5100/msg0014--scissors.html">msg0014--scissors</a>
  
    <li><a href="../git/t/t5100/msg0015.html">msg0015</a>
  
    <li><a href="../git/t/t5100/msg0015--no-inbody-headers.html">msg0015--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/msg0016.html">msg0016</a>
  
    <li><a href="../git/t/t5100/msg0016--no-inbody-headers.html">msg0016--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/msg0017.html">msg0017</a>
  
    <li><a href="../git/t/t5100/nul-b64_in.html">nul-b64.in</a>
  
    <li><a href="../git/t/t5100/patch0001.html">patch0001</a>
  
    <li><a href="../git/t/t5100/patch0002.html">patch0002</a>
  
    <li><a href="../git/t/t5100/patch0003.html">patch0003</a>
  
    <li><a href="../git/t/t5100/patch0004.html">patch0004</a>
  
    <li><a href="../git/t/t5100/patch0006.html">patch0006</a>
  
    <li><a href="../git/t/t5100/patch0007.html">patch0007</a>
  
    <li><a href="../git/t/t5100/patch0008.html">patch0008</a>
  
    <li><a href="../git/t/t5100/patch0009.html">patch0009</a>
  
    <li><a href="../git/t/t5100/patch0010.html">patch0010</a>
  
    <li><a href="../git/t/t5100/patch0011.html">patch0011</a>
  
    <li><a href="../git/t/t5100/patch0012.html">patch0012</a>
  
    <li><a href="../git/t/t5100/patch0013.html">patch0013</a>
  
    <li><a href="../git/t/t5100/patch0014.html">patch0014</a>
  
    <li><a href="../git/t/t5100/patch0014--scissors.html">patch0014--scissors</a>
  
    <li><a href="../git/t/t5100/patch0015.html">patch0015</a>
  
    <li><a href="../git/t/t5100/patch0015--no-inbody-headers.html">patch0015--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/patch0016.html">patch0016</a>
  
    <li><a href="../git/t/t5100/patch0016--no-inbody-headers.html">patch0016--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/patch0017.html">patch0017</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0001.html">rfc2047-info-0001</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0002.html">rfc2047-info-0002</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0003.html">rfc2047-info-0003</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0004.html">rfc2047-info-0004</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0005.html">rfc2047-info-0005</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0006.html">rfc2047-info-0006</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0007.html">rfc2047-info-0007</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0008.html">rfc2047-info-0008</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0009.html">rfc2047-info-0009</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0010.html">rfc2047-info-0010</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0011.html">rfc2047-info-0011</a>
  
    <li><a href="../git/t/t5100/rfc2047-samples_mbox.html">rfc2047-samples.mbox</a>
  
    <li><a href="../git/t/t5100/sample_mbox.html">sample.mbox</a>
  
    <li><a href="../git/t/t5150-request-pull_sh.html">t5150-request-pull.sh</a>
  
    <li><a href="../git/t/t5300-pack-object_sh.html">t5300-pack-object.sh</a>
  
    <li><a href="../git/t/t5301-sliding-window_sh.html">t5301-sliding-window.sh</a>
  
    <li><a href="../git/t/t5302-pack-index_sh.html">t5302-pack-index.sh</a>
  
    <li><a href="../git/t/t5303-pack-corruption-resilience_sh.html">t5303-pack-corruption-resilience.sh</a>
  
    <li><a href="../git/t/t5304-prune_sh.html">t5304-prune.sh</a>
  
    <li><a href="../git/t/t5305-include-tag_sh.html">t5305-include-tag.sh</a>
  
    <li><a href="../git/t/t5306-pack-nobase_sh.html">t5306-pack-nobase.sh</a>
  
    <li><a href="../git/t/t5307-pack-missing-commit_sh.html">t5307-pack-missing-commit.sh</a>
  
    <li><a href="../git/t/t5308-pack-detect-duplicates_sh.html">t5308-pack-detect-duplicates.sh</a>
  
    <li><a href="../git/t/t5309-pack-delta-cycles_sh.html">t5309-pack-delta-cycles.sh</a>
  
    <li><a href="../git/t/t5400-send-pack_sh.html">t5400-send-pack.sh</a>
  
    <li><a href="../git/t/t5401-update-hooks_sh.html">t5401-update-hooks.sh</a>
  
    <li><a href="../git/t/t5402-post-merge-hook_sh.html">t5402-post-merge-hook.sh</a>
  
    <li><a href="../git/t/t5403-post-checkout-hook_sh.html">t5403-post-checkout-hook.sh</a>
  
    <li><a href="../git/t/t5404-tracking-branches_sh.html">t5404-tracking-branches.sh</a>
  
    <li><a href="../git/t/t5405-send-pack-rewind_sh.html">t5405-send-pack-rewind.sh</a>
  
    <li><a href="../git/t/t5406-remote-rejects_sh.html">t5406-remote-rejects.sh</a>
  
    <li><a href="../git/t/t5407-post-rewrite-hook_sh.html">t5407-post-rewrite-hook.sh</a>
  
    <li><a href="../git/t/t5500-fetch-pack_sh.html">t5500-fetch-pack.sh</a>
  
    <li><a href="../git/t/t5501-fetch-push-alternates_sh.html">t5501-fetch-push-alternates.sh</a>
  
    <li><a href="../git/t/t5502-quickfetch_sh.html">t5502-quickfetch.sh</a>
  
    <li><a href="../git/t/t5503-tagfollow_sh.html">t5503-tagfollow.sh</a>
  
    <li><a href="../git/t/t5504-fetch-receive-strict_sh.html">t5504-fetch-receive-strict.sh</a>
  
    <li><a href="../git/t/t5505-remote_sh.html">t5505-remote.sh</a>
  
    <li><a href="../git/t/t5506-remote-groups_sh.html">t5506-remote-groups.sh</a>
  
    <li><a href="../git/t/t5509-fetch-push-namespaces_sh.html">t5509-fetch-push-namespaces.sh</a>
  
    <li><a href="../git/t/t5510-fetch_sh.html">t5510-fetch.sh</a>
  
    <li><a href="../git/t/t5511-refspec_sh.html">t5511-refspec.sh</a>
  
    <li><a href="../git/t/t5512-ls-remote_sh.html">t5512-ls-remote.sh</a>
  
    <li><a href="../git/t/t5513-fetch-track_sh.html">t5513-fetch-track.sh</a>
  
    <li><a href="../git/t/t5514-fetch-multiple_sh.html">t5514-fetch-multiple.sh</a>
  
    <li><a href="../git/t/t5515-fetch-merge-logic_sh.html">t5515-fetch-merge-logic.sh</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default.html">fetch.br-branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default-merge.html">fetch.br-branches-default-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default-merge_branches-default.html">fetch.br-branches-default-merge_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default-octopus.html">fetch.br-branches-default-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default-octopus_branches-default.html">fetch.br-branches-default-octopus_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default_branches-default.html">fetch.br-branches-default_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one.html">fetch.br-branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one-merge.html">fetch.br-branches-one-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one-merge_branches-one.html">fetch.br-branches-one-merge_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one-octopus.html">fetch.br-branches-one-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one-octopus_branches-one.html">fetch.br-branches-one-octopus_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one_branches-one.html">fetch.br-branches-one_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit.html">fetch.br-config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit-merge.html">fetch.br-config-explicit-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit-merge_config-explicit.html">fetch.br-config-explicit-merge_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit-octopus.html">fetch.br-config-explicit-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit-octopus_config-explicit.html">fetch.br-config-explicit-octopus_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit_config-explicit.html">fetch.br-config-explicit_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob.html">fetch.br-config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob-merge.html">fetch.br-config-glob-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob-merge_config-glob.html">fetch.br-config-glob-merge_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob-octopus.html">fetch.br-config-glob-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob-octopus_config-glob.html">fetch.br-config-glob-octopus_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob_config-glob.html">fetch.br-config-glob_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit.html">fetch.br-remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit-merge.html">fetch.br-remote-explicit-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit-merge_remote-explicit.html">fetch.br-remote-explicit-merge_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit-octopus.html">fetch.br-remote-explicit-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit-octopus_remote-explicit.html">fetch.br-remote-explicit-octopus_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit_remote-explicit.html">fetch.br-remote-explicit_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob.html">fetch.br-remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob-merge.html">fetch.br-remote-glob-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob-merge_remote-glob.html">fetch.br-remote-glob-merge_remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob-octopus.html">fetch.br-remote-glob-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob-octopus_remote-glob.html">fetch.br-remote-glob-octopus_remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob_remote-glob.html">fetch.br-remote-glob_remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig.html">fetch.br-unconfig</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_--tags_____git.html">fetch.br-unconfig_--tags_.._.git</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git.html">fetch.br-unconfig_.._.git</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_one.html">fetch.br-unconfig_.._.git_one</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_one_tag_tag-one_tag_tag-three-file.html">fetch.br-unconfig_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_one_two.html">fetch.br-unconfig_.._.git_one_two</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_tag_tag-one-tree_tag_tag-three-file.html">fetch.br-unconfig_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_tag_tag-one_tag_tag-three.html">fetch.br-unconfig_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_branches-default.html">fetch.br-unconfig_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_branches-one.html">fetch.br-unconfig_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_config-explicit.html">fetch.br-unconfig_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_config-glob.html">fetch.br-unconfig_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_remote-explicit.html">fetch.br-unconfig_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_remote-glob.html">fetch.br-unconfig_remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_master.html">fetch.master</a>
  
    <li><a href="../git/t/t5515/fetch_master_--tags_____git.html">fetch.master_--tags_.._.git</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git.html">fetch.master_.._.git</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_one.html">fetch.master_.._.git_one</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_one_tag_tag-one_tag_tag-three-file.html">fetch.master_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_one_two.html">fetch.master_.._.git_one_two</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_tag_tag-one-tree_tag_tag-three-file.html">fetch.master_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_tag_tag-one_tag_tag-three.html">fetch.master_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../git/t/t5515/fetch_master_branches-default.html">fetch.master_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_master_branches-one.html">fetch.master_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_master_config-explicit.html">fetch.master_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_master_config-glob.html">fetch.master_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_master_remote-explicit.html">fetch.master_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_master_remote-glob.html">fetch.master_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default.html">refs.br-branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default-merge.html">refs.br-branches-default-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default-merge_branches-default.html">refs.br-branches-default-merge_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default-octopus.html">refs.br-branches-default-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default-octopus_branches-default.html">refs.br-branches-default-octopus_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default_branches-default.html">refs.br-branches-default_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one.html">refs.br-branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one-merge.html">refs.br-branches-one-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one-merge_branches-one.html">refs.br-branches-one-merge_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one-octopus.html">refs.br-branches-one-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one-octopus_branches-one.html">refs.br-branches-one-octopus_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one_branches-one.html">refs.br-branches-one_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit.html">refs.br-config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit-merge.html">refs.br-config-explicit-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit-merge_config-explicit.html">refs.br-config-explicit-merge_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit-octopus.html">refs.br-config-explicit-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit-octopus_config-explicit.html">refs.br-config-explicit-octopus_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit_config-explicit.html">refs.br-config-explicit_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob.html">refs.br-config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob-merge.html">refs.br-config-glob-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob-merge_config-glob.html">refs.br-config-glob-merge_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob-octopus.html">refs.br-config-glob-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob-octopus_config-glob.html">refs.br-config-glob-octopus_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob_config-glob.html">refs.br-config-glob_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit.html">refs.br-remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit-merge.html">refs.br-remote-explicit-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit-merge_remote-explicit.html">refs.br-remote-explicit-merge_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit-octopus.html">refs.br-remote-explicit-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit-octopus_remote-explicit.html">refs.br-remote-explicit-octopus_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit_remote-explicit.html">refs.br-remote-explicit_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob.html">refs.br-remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob-merge.html">refs.br-remote-glob-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob-merge_remote-glob.html">refs.br-remote-glob-merge_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob-octopus.html">refs.br-remote-glob-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob-octopus_remote-glob.html">refs.br-remote-glob-octopus_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob_remote-glob.html">refs.br-remote-glob_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig.html">refs.br-unconfig</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_--tags_____git.html">refs.br-unconfig_--tags_.._.git</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git.html">refs.br-unconfig_.._.git</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_one.html">refs.br-unconfig_.._.git_one</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_one_tag_tag-one_tag_tag-three-file.html">refs.br-unconfig_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_one_two.html">refs.br-unconfig_.._.git_one_two</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_tag_tag-one-tree_tag_tag-three-file.html">refs.br-unconfig_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_tag_tag-one_tag_tag-three.html">refs.br-unconfig_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_branches-default.html">refs.br-unconfig_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_branches-one.html">refs.br-unconfig_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_config-explicit.html">refs.br-unconfig_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_config-glob.html">refs.br-unconfig_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_remote-explicit.html">refs.br-unconfig_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_remote-glob.html">refs.br-unconfig_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_master.html">refs.master</a>
  
    <li><a href="../git/t/t5515/refs_master_--tags_____git.html">refs.master_--tags_.._.git</a>
  
    <li><a href="../git/t/t5515/refs_master_____git.html">refs.master_.._.git</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_one.html">refs.master_.._.git_one</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_one_tag_tag-one_tag_tag-three-file.html">refs.master_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_one_two.html">refs.master_.._.git_one_two</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_tag_tag-one-tree_tag_tag-three-file.html">refs.master_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_tag_tag-one_tag_tag-three.html">refs.master_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../git/t/t5515/refs_master_branches-default.html">refs.master_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_master_branches-one.html">refs.master_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_master_config-explicit.html">refs.master_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_master_config-glob.html">refs.master_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_master_remote-explicit.html">refs.master_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_master_remote-glob.html">refs.master_remote-glob</a>
  
    <li><a href="../git/t/t5516-fetch-push_sh.html">t5516-fetch-push.sh</a>
  
    <li><a href="../git/t/t5517-push-mirror_sh.html">t5517-push-mirror.sh</a>
  
    <li><a href="../git/t/t5518-fetch-exit-status_sh.html">t5518-fetch-exit-status.sh</a>
  
    <li><a href="../git/t/t5519-push-alternates_sh.html">t5519-push-alternates.sh</a>
  
    <li><a href="../git/t/t5520-pull_sh.html">t5520-pull.sh</a>
  
    <li><a href="../git/t/t5521-pull-options_sh.html">t5521-pull-options.sh</a>
  
    <li><a href="../git/t/t5522-pull-symlink_sh.html">t5522-pull-symlink.sh</a>
  
    <li><a href="../git/t/t5523-push-upstream_sh.html">t5523-push-upstream.sh</a>
  
    <li><a href="../git/t/t5524-pull-msg_sh.html">t5524-pull-msg.sh</a>
  
    <li><a href="../git/t/t5525-fetch-tagopt_sh.html">t5525-fetch-tagopt.sh</a>
  
    <li><a href="../git/t/t5526-fetch-submodules_sh.html">t5526-fetch-submodules.sh</a>
  
    <li><a href="../git/t/t5527-fetch-odd-refs_sh.html">t5527-fetch-odd-refs.sh</a>
  
    <li><a href="../git/t/t5528-push-default_sh.html">t5528-push-default.sh</a>
  
    <li><a href="../git/t/t5530-upload-pack-error_sh.html">t5530-upload-pack-error.sh</a>
  
    <li><a href="../git/t/t5531-deep-submodule-push_sh.html">t5531-deep-submodule-push.sh</a>
  
    <li><a href="../git/t/t5532-fetch-proxy_sh.html">t5532-fetch-proxy.sh</a>
  
    <li><a href="../git/t/t5533-push-cas_sh.html">t5533-push-cas.sh</a>
  
    <li><a href="../git/t/t5535-fetch-push-symref_sh.html">t5535-fetch-push-symref.sh</a>
  
    <li><a href="../git/t/t5540-http-push_sh.html">t5540-http-push.sh</a>
  
    <li><a href="../git/t/t5541-http-push_sh.html">t5541-http-push.sh</a>
  
    <li><a href="../git/t/t5550-http-fetch_sh.html">t5550-http-fetch.sh</a>
  
    <li><a href="../git/t/t5551-http-fetch_sh.html">t5551-http-fetch.sh</a>
  
    <li><a href="../git/t/t5560-http-backend-noserver_sh.html">t5560-http-backend-noserver.sh</a>
  
    <li><a href="../git/t/t5561-http-backend_sh.html">t5561-http-backend.sh</a>
  
    <li><a href="../git/t/t556x_common.html">t556x_common</a>
  
    <li><a href="../git/t/t5570-git-daemon_sh.html">t5570-git-daemon.sh</a>
  
    <li><a href="../git/t/t5571-pre-push-hook_sh.html">t5571-pre-push-hook.sh</a>
  
    <li><a href="../git/t/t5600-clone-fail-cleanup_sh.html">t5600-clone-fail-cleanup.sh</a>
  
    <li><a href="../git/t/t5601-clone_sh.html">t5601-clone.sh</a>
  
    <li><a href="../git/t/t5602-clone-remote-exec_sh.html">t5602-clone-remote-exec.sh</a>
  
    <li><a href="../git/t/t5700-clone-reference_sh.html">t5700-clone-reference.sh</a>
  
    <li><a href="../git/t/t5701-clone-local_sh.html">t5701-clone-local.sh</a>
  
    <li><a href="../git/t/t5702-clone-options_sh.html">t5702-clone-options.sh</a>
  
    <li><a href="../git/t/t5704-bundle_sh.html">t5704-bundle.sh</a>
  
    <li><a href="../git/t/t5705-clone-2gb_sh.html">t5705-clone-2gb.sh</a>
  
    <li><a href="../git/t/t5706-clone-branch_sh.html">t5706-clone-branch.sh</a>
  
    <li><a href="../git/t/t5707-clone-detached_sh.html">t5707-clone-detached.sh</a>
  
    <li><a href="../git/t/t5708-clone-config_sh.html">t5708-clone-config.sh</a>
  
    <li><a href="../git/t/t5709-clone-refspec_sh.html">t5709-clone-refspec.sh</a>
  
    <li><a href="../git/t/t5710-info-alternate_sh.html">t5710-info-alternate.sh</a>
  
    <li><a href="../git/t/t5801-remote-helpers_sh.html">t5801-remote-helpers.sh</a>
  
    <li><a href="../git/t/t5802-connect-helper_sh.html">t5802-connect-helper.sh</a>
  
    <li><a href="../git/t/t5900-repo-selection_sh.html">t5900-repo-selection.sh</a>
  
    <li><a href="../git/t/t6000-rev-list-misc_sh.html">t6000-rev-list-misc.sh</a>
  
    <li><a href="../git/t/t6001-rev-list-graft_sh.html">t6001-rev-list-graft.sh</a>
  
    <li><a href="../git/t/t6002-rev-list-bisect_sh.html">t6002-rev-list-bisect.sh</a>
  
    <li><a href="../git/t/t6003-rev-list-topo-order_sh.html">t6003-rev-list-topo-order.sh</a>
  
    <li><a href="../git/t/t6004-rev-list-path-optim_sh.html">t6004-rev-list-path-optim.sh</a>
  
    <li><a href="../git/t/t6005-rev-list-count_sh.html">t6005-rev-list-count.sh</a>
  
    <li><a href="../git/t/t6006-rev-list-format_sh.html">t6006-rev-list-format.sh</a>
  
    <li><a href="../git/t/t6007-rev-list-cherry-pick-file_sh.html">t6007-rev-list-cherry-pick-file.sh</a>
  
    <li><a href="../git/t/t6008-rev-list-submodule_sh.html">t6008-rev-list-submodule.sh</a>
  
    <li><a href="../git/t/t6009-rev-list-parent_sh.html">t6009-rev-list-parent.sh</a>
  
    <li><a href="../git/t/t6010-merge-base_sh.html">t6010-merge-base.sh</a>
  
    <li><a href="../git/t/t6011-rev-list-with-bad-commit_sh.html">t6011-rev-list-with-bad-commit.sh</a>
  
    <li><a href="../git/t/t6012-rev-list-simplify_sh.html">t6012-rev-list-simplify.sh</a>
  
    <li><a href="../git/t/t6013-rev-list-reverse-parents_sh.html">t6013-rev-list-reverse-parents.sh</a>
  
    <li><a href="../git/t/t6014-rev-list-all_sh.html">t6014-rev-list-all.sh</a>
  
    <li><a href="../git/t/t6015-rev-list-show-all-parents_sh.html">t6015-rev-list-show-all-parents.sh</a>
  
    <li><a href="../git/t/t6016-rev-list-graph-simplify-history_sh.html">t6016-rev-list-graph-simplify-history.sh</a>
  
    <li><a href="../git/t/t6017-rev-list-stdin_sh.html">t6017-rev-list-stdin.sh</a>
  
    <li><a href="../git/t/t6018-rev-list-glob_sh.html">t6018-rev-list-glob.sh</a>
  
    <li><a href="../git/t/t6019-rev-list-ancestry-path_sh.html">t6019-rev-list-ancestry-path.sh</a>
  
    <li><a href="../git/t/t6020-merge-df_sh.html">t6020-merge-df.sh</a>
  
    <li><a href="../git/t/t6021-merge-criss-cross_sh.html">t6021-merge-criss-cross.sh</a>
  
    <li><a href="../git/t/t6022-merge-rename_sh.html">t6022-merge-rename.sh</a>
  
    <li><a href="../git/t/t6023-merge-file_sh.html">t6023-merge-file.sh</a>
  
    <li><a href="../git/t/t6024-recursive-merge_sh.html">t6024-recursive-merge.sh</a>
  
    <li><a href="../git/t/t6025-merge-symlinks_sh.html">t6025-merge-symlinks.sh</a>
  
    <li><a href="../git/t/t6026-merge-attr_sh.html">t6026-merge-attr.sh</a>
  
    <li><a href="../git/t/t6027-merge-binary_sh.html">t6027-merge-binary.sh</a>
  
    <li><a href="../git/t/t6028-merge-up-to-date_sh.html">t6028-merge-up-to-date.sh</a>
  
    <li><a href="../git/t/t6029-merge-subtree_sh.html">t6029-merge-subtree.sh</a>
  
    <li><a href="../git/t/t6030-bisect-porcelain_sh.html">t6030-bisect-porcelain.sh</a>
  
    <li><a href="../git/t/t6031-merge-recursive_sh.html">t6031-merge-recursive.sh</a>
  
    <li><a href="../git/t/t6032-merge-large-rename_sh.html">t6032-merge-large-rename.sh</a>
  
    <li><a href="../git/t/t6033-merge-crlf_sh.html">t6033-merge-crlf.sh</a>
  
    <li><a href="../git/t/t6034-merge-rename-nocruft_sh.html">t6034-merge-rename-nocruft.sh</a>
  
    <li><a href="../git/t/t6035-merge-dir-to-symlink_sh.html">t6035-merge-dir-to-symlink.sh</a>
  
    <li><a href="../git/t/t6036-recursive-corner-cases_sh.html">t6036-recursive-corner-cases.sh</a>
  
    <li><a href="../git/t/t6037-merge-ours-theirs_sh.html">t6037-merge-ours-theirs.sh</a>
  
    <li><a href="../git/t/t6038-merge-text-auto_sh.html">t6038-merge-text-auto.sh</a>
  
    <li><a href="../git/t/t6040-tracking-info_sh.html">t6040-tracking-info.sh</a>
  
    <li><a href="../git/t/t6042-merge-rename-corner-cases_sh.html">t6042-merge-rename-corner-cases.sh</a>
  
    <li><a href="../git/t/t6050-replace_sh.html">t6050-replace.sh</a>
  
    <li><a href="../git/t/t6060-merge-index_sh.html">t6060-merge-index.sh</a>
  
    <li><a href="../git/t/t6101-rev-parse-parents_sh.html">t6101-rev-parse-parents.sh</a>
  
    <li><a href="../git/t/t6110-rev-list-sparse_sh.html">t6110-rev-list-sparse.sh</a>
  
    <li><a href="../git/t/t6111-rev-list-treesame_sh.html">t6111-rev-list-treesame.sh</a>
  
    <li><a href="../git/t/t6120-describe_sh.html">t6120-describe.sh</a>
  
    <li><a href="../git/t/t6130-pathspec-noglob_sh.html">t6130-pathspec-noglob.sh</a>
  
    <li><a href="../git/t/t6131-pathspec-icase_sh.html">t6131-pathspec-icase.sh</a>
  
    <li><a href="../git/t/t6200-fmt-merge-msg_sh.html">t6200-fmt-merge-msg.sh</a>
  
    <li><a href="../git/t/t6300-for-each-ref_sh.html">t6300-for-each-ref.sh</a>
  
    <li><a href="../git/t/t6500-gc_sh.html">t6500-gc.sh</a>
  
    <li><a href="../git/t/t7001-mv_sh.html">t7001-mv.sh</a>
  
    <li><a href="../git/t/t7003-filter-branch_sh.html">t7003-filter-branch.sh</a>
  
    <li><a href="../git/t/t7004-tag_sh.html">t7004-tag.sh</a>
  
    <li><a href="../git/t/t7005-editor_sh.html">t7005-editor.sh</a>
  
    <li><a href="../git/t/t7006-pager_sh.html">t7006-pager.sh</a>
  
    <li><a href="../git/t/t7007-show_sh.html">t7007-show.sh</a>
  
    <li><a href="../git/t/t7008-grep-binary_sh.html">t7008-grep-binary.sh</a>
  
    <li><a href="../git/t/t7009-filter-branch-null-sha1_sh.html">t7009-filter-branch-null-sha1.sh</a>
  
    <li><a href="../git/t/t7010-setup_sh.html">t7010-setup.sh</a>
  
    <li><a href="../git/t/t7011-skip-worktree-reading_sh.html">t7011-skip-worktree-reading.sh</a>
  
    <li><a href="../git/t/t7012-skip-worktree-writing_sh.html">t7012-skip-worktree-writing.sh</a>
  
    <li><a href="../git/t/t7060-wtstatus_sh.html">t7060-wtstatus.sh</a>
  
    <li><a href="../git/t/t7061-wtstatus-ignore_sh.html">t7061-wtstatus-ignore.sh</a>
  
    <li><a href="../git/t/t7062-wtstatus-ignorecase_sh.html">t7062-wtstatus-ignorecase.sh</a>
  
    <li><a href="../git/t/t7101-reset_sh.html">t7101-reset.sh</a>
  
    <li><a href="../git/t/t7102-reset_sh.html">t7102-reset.sh</a>
  
    <li><a href="../git/t/t7103-reset-bare_sh.html">t7103-reset-bare.sh</a>
  
    <li><a href="../git/t/t7104-reset_sh.html">t7104-reset.sh</a>
  
    <li><a href="../git/t/t7105-reset-patch_sh.html">t7105-reset-patch.sh</a>
  
    <li><a href="../git/t/t7106-reset-unborn-branch_sh.html">t7106-reset-unborn-branch.sh</a>
  
    <li><a href="../git/t/t7110-reset-merge_sh.html">t7110-reset-merge.sh</a>
  
    <li><a href="../git/t/t7111-reset-table_sh.html">t7111-reset-table.sh</a>
  
    <li><a href="../git/t/t7201-co_sh.html">t7201-co.sh</a>
  
    <li><a href="../git/t/t7300-clean_sh.html">t7300-clean.sh</a>
  
    <li><a href="../git/t/t7301-clean-interactive_sh.html">t7301-clean-interactive.sh</a>
  
    <li><a href="../git/t/t7400-submodule-basic_sh.html">t7400-submodule-basic.sh</a>
  
    <li><a href="../git/t/t7401-submodule-summary_sh.html">t7401-submodule-summary.sh</a>
  
    <li><a href="../git/t/t7402-submodule-rebase_sh.html">t7402-submodule-rebase.sh</a>
  
    <li><a href="../git/t/t7403-submodule-sync_sh.html">t7403-submodule-sync.sh</a>
  
    <li><a href="../git/t/t7405-submodule-merge_sh.html">t7405-submodule-merge.sh</a>
  
    <li><a href="../git/t/t7406-submodule-update_sh.html">t7406-submodule-update.sh</a>
  
    <li><a href="../git/t/t7407-submodule-foreach_sh.html">t7407-submodule-foreach.sh</a>
  
    <li><a href="../git/t/t7408-submodule-reference_sh.html">t7408-submodule-reference.sh</a>
  
    <li><a href="../git/t/t7409-submodule-detached-worktree_sh.html">t7409-submodule-detached-worktree.sh</a>
  
    <li><a href="../git/t/t7500-commit_sh.html">t7500-commit.sh</a>
  
    <li><a href="../git/t/t7500/add-comments.html">add-comments</a>
  
    <li><a href="../git/t/t7500/add-content.html">add-content</a>
  
    <li><a href="../git/t/t7500/add-content-and-comment.html">add-content-and-comment</a>
  
    <li><a href="../git/t/t7500/add-signed-off.html">add-signed-off</a>
  
    <li><a href="../git/t/t7500/add-whitespaced-content.html">add-whitespaced-content</a>
  
    <li><a href="../git/t/t7500/edit-content.html">edit-content</a>
  
    <li><a href="../git/t/t7501-commit_sh.html">t7501-commit.sh</a>
  
    <li><a href="../git/t/t7502-commit_sh.html">t7502-commit.sh</a>
  
    <li><a href="../git/t/t7503-pre-commit-hook_sh.html">t7503-pre-commit-hook.sh</a>
  
    <li><a href="../git/t/t7504-commit-msg-hook_sh.html">t7504-commit-msg-hook.sh</a>
  
    <li><a href="../git/t/t7505-prepare-commit-msg-hook_sh.html">t7505-prepare-commit-msg-hook.sh</a>
  
    <li><a href="../git/t/t7506-status-submodule_sh.html">t7506-status-submodule.sh</a>
  
    <li><a href="../git/t/t7507-commit-verbose_sh.html">t7507-commit-verbose.sh</a>
  
    <li><a href="../git/t/t7508-status_sh.html">t7508-status.sh</a>
  
    <li><a href="../git/t/t7509-commit_sh.html">t7509-commit.sh</a>
  
    <li><a href="../git/t/t7510-signed-commit_sh.html">t7510-signed-commit.sh</a>
  
    <li><a href="../git/t/t7511-status-index_sh.html">t7511-status-index.sh</a>
  
    <li><a href="../git/t/t7512-status-help_sh.html">t7512-status-help.sh</a>
  
    <li><a href="../git/t/t7600-merge_sh.html">t7600-merge.sh</a>
  
    <li><a href="../git/t/t7601-merge-pull-config_sh.html">t7601-merge-pull-config.sh</a>
  
    <li><a href="../git/t/t7602-merge-octopus-many_sh.html">t7602-merge-octopus-many.sh</a>
  
    <li><a href="../git/t/t7603-merge-reduce-heads_sh.html">t7603-merge-reduce-heads.sh</a>
  
    <li><a href="../git/t/t7604-merge-custom-message_sh.html">t7604-merge-custom-message.sh</a>
  
    <li><a href="../git/t/t7605-merge-resolve_sh.html">t7605-merge-resolve.sh</a>
  
    <li><a href="../git/t/t7606-merge-custom_sh.html">t7606-merge-custom.sh</a>
  
    <li><a href="../git/t/t7607-merge-overwrite_sh.html">t7607-merge-overwrite.sh</a>
  
    <li><a href="../git/t/t7608-merge-messages_sh.html">t7608-merge-messages.sh</a>
  
    <li><a href="../git/t/t7609-merge-co-error-msgs_sh.html">t7609-merge-co-error-msgs.sh</a>
  
    <li><a href="../git/t/t7610-mergetool_sh.html">t7610-mergetool.sh</a>
  
    <li><a href="../git/t/t7611-merge-abort_sh.html">t7611-merge-abort.sh</a>
  
    <li><a href="../git/t/t7612-merge-verify-signatures_sh.html">t7612-merge-verify-signatures.sh</a>
  
    <li><a href="../git/t/t7700-repack_sh.html">t7700-repack.sh</a>
  
    <li><a href="../git/t/t7701-repack-unpack-unreachable_sh.html">t7701-repack-unpack-unreachable.sh</a>
  
    <li><a href="../git/t/t7800-difftool_sh.html">t7800-difftool.sh</a>
  
    <li><a href="../git/t/t7810-grep_sh.html">t7810-grep.sh</a>
  
    <li><a href="../git/t/t7811-grep-open_sh.html">t7811-grep-open.sh</a>
  
    <li><a href="../git/t/t8001-annotate_sh.html">t8001-annotate.sh</a>
  
    <li><a href="../git/t/t8002-blame_sh.html">t8002-blame.sh</a>
  
    <li><a href="../git/t/t8003-blame-corner-cases_sh.html">t8003-blame-corner-cases.sh</a>
  
    <li><a href="../git/t/t8004-blame-with-conflicts_sh.html">t8004-blame-with-conflicts.sh</a>
  
    <li><a href="../git/t/t8005-blame-i18n_sh.html">t8005-blame-i18n.sh</a>
  
    <li><a href="../git/t/t8005/utf8_txt.html">utf8</a>
  
    <li><a href="../git/t/t8006-blame-textconv_sh.html">t8006-blame-textconv.sh</a>
  
    <li><a href="../git/t/t8007-cat-file-textconv_sh.html">t8007-cat-file-textconv.sh</a>
  
    <li><a href="../git/t/t8008-blame-formats_sh.html">t8008-blame-formats.sh</a>
  
    <li><a href="../git/t/t9001-send-email_sh.html">t9001-send-email.sh</a>
  
    <li><a href="../git/t/t9002-column_sh.html">t9002-column.sh</a>
  
    <li><a href="../git/t/t9010-svn-fe_sh.html">t9010-svn-fe.sh</a>
  
    <li><a href="../git/t/t9011-svn-da_sh.html">t9011-svn-da.sh</a>
  
    <li><a href="../git/t/t9020-remote-svn_sh.html">t9020-remote-svn.sh</a>
  
    <li><a href="../git/t/t9100-git-svn-basic_sh.html">t9100-git-svn-basic.sh</a>
  
    <li><a href="../git/t/t9101-git-svn-props_sh.html">t9101-git-svn-props.sh</a>
  
    <li><a href="../git/t/t9102-git-svn-deep-rmdir_sh.html">t9102-git-svn-deep-rmdir.sh</a>
  
    <li><a href="../git/t/t9103-git-svn-tracked-directory-removed_sh.html">t9103-git-svn-tracked-directory-removed.sh</a>
  
    <li><a href="../git/t/t9104-git-svn-follow-parent_sh.html">t9104-git-svn-follow-parent.sh</a>
  
    <li><a href="../git/t/t9105-git-svn-commit-diff_sh.html">t9105-git-svn-commit-diff.sh</a>
  
    <li><a href="../git/t/t9106-git-svn-commit-diff-clobber_sh.html">t9106-git-svn-commit-diff-clobber.sh</a>
  
    <li><a href="../git/t/t9107-git-svn-migrate_sh.html">t9107-git-svn-migrate.sh</a>
  
    <li><a href="../git/t/t9108-git-svn-glob_sh.html">t9108-git-svn-glob.sh</a>
  
    <li><a href="../git/t/t9109-git-svn-multi-glob_sh.html">t9109-git-svn-multi-glob.sh</a>
  
    <li><a href="../git/t/t9110-git-svn-use-svm-props_sh.html">t9110-git-svn-use-svm-props.sh</a>
  
    <li><a href="../git/t/t9110/svm_dump.html">svm.dump</a>
  
    <li><a href="../git/t/t9111-git-svn-use-svnsync-props_sh.html">t9111-git-svn-use-svnsync-props.sh</a>
  
    <li><a href="../git/t/t9111/svnsync_dump.html">svnsync.dump</a>
  
    <li><a href="../git/t/t9112-git-svn-md5less-file_sh.html">t9112-git-svn-md5less-file.sh</a>
  
    <li><a href="../git/t/t9113-git-svn-dcommit-new-file_sh.html">t9113-git-svn-dcommit-new-file.sh</a>
  
    <li><a href="../git/t/t9114-git-svn-dcommit-merge_sh.html">t9114-git-svn-dcommit-merge.sh</a>
  
    <li><a href="../git/t/t9115-git-svn-dcommit-funky-renames_sh.html">t9115-git-svn-dcommit-funky-renames.sh</a>
  
    <li><a href="../git/t/t9115/funky-names_dump.html">funky-names.dump</a>
  
    <li><a href="../git/t/t9116-git-svn-log_sh.html">t9116-git-svn-log.sh</a>
  
    <li><a href="../git/t/t9117-git-svn-init-clone_sh.html">t9117-git-svn-init-clone.sh</a>
  
    <li><a href="../git/t/t9118-git-svn-funky-branch-names_sh.html">t9118-git-svn-funky-branch-names.sh</a>
  
    <li><a href="../git/t/t9119-git-svn-info_sh.html">t9119-git-svn-info.sh</a>
  
    <li><a href="../git/t/t9120-git-svn-clone-with-percent-escapes_sh.html">t9120-git-svn-clone-with-percent-escapes.sh</a>
  
    <li><a href="../git/t/t9121-git-svn-fetch-renamed-dir_sh.html">t9121-git-svn-fetch-renamed-dir.sh</a>
  
    <li><a href="../git/t/t9121/renamed-dir_dump.html">renamed-dir.dump</a>
  
    <li><a href="../git/t/t9122-git-svn-author_sh.html">t9122-git-svn-author.sh</a>
  
    <li><a href="../git/t/t9123-git-svn-rebuild-with-rewriteroot_sh.html">t9123-git-svn-rebuild-with-rewriteroot.sh</a>
  
    <li><a href="../git/t/t9124-git-svn-dcommit-auto-props_sh.html">t9124-git-svn-dcommit-auto-props.sh</a>
  
    <li><a href="../git/t/t9125-git-svn-multi-glob-branch-names_sh.html">t9125-git-svn-multi-glob-branch-names.sh</a>
  
    <li><a href="../git/t/t9126-git-svn-follow-deleted-readded-directory_sh.html">t9126-git-svn-follow-deleted-readded-directory.sh</a>
  
    <li><a href="../git/t/t9126/follow-deleted-readded_dump.html">follow-deleted-readded.dump</a>
  
    <li><a href="../git/t/t9127-git-svn-partial-rebuild_sh.html">t9127-git-svn-partial-rebuild.sh</a>
  
    <li><a href="../git/t/t9128-git-svn-cmd-branch_sh.html">t9128-git-svn-cmd-branch.sh</a>
  
    <li><a href="../git/t/t9129-git-svn-i18n-commitencoding_sh.html">t9129-git-svn-i18n-commitencoding.sh</a>
  
    <li><a href="../git/t/t9130-git-svn-authors-file_sh.html">t9130-git-svn-authors-file.sh</a>
  
    <li><a href="../git/t/t9131-git-svn-empty-symlink_sh.html">t9131-git-svn-empty-symlink.sh</a>
  
    <li><a href="../git/t/t9132-git-svn-broken-symlink_sh.html">t9132-git-svn-broken-symlink.sh</a>
  
    <li><a href="../git/t/t9133-git-svn-nested-git-repo_sh.html">t9133-git-svn-nested-git-repo.sh</a>
  
    <li><a href="../git/t/t9134-git-svn-ignore-paths_sh.html">t9134-git-svn-ignore-paths.sh</a>
  
    <li><a href="../git/t/t9135-git-svn-moved-branch-empty-file_sh.html">t9135-git-svn-moved-branch-empty-file.sh</a>
  
    <li><a href="../git/t/t9135/svn_dump.html">svn.dump</a>
  
    <li><a href="../git/t/t9136-git-svn-recreated-branch-empty-file_sh.html">t9136-git-svn-recreated-branch-empty-file.sh</a>
  
    <li><a href="../git/t/t9136/svn_dump.html">svn.dump</a>
  
    <li><a href="../git/t/t9137-git-svn-dcommit-clobber-series_sh.html">t9137-git-svn-dcommit-clobber-series.sh</a>
  
    <li><a href="../git/t/t9138-git-svn-authors-prog_sh.html">t9138-git-svn-authors-prog.sh</a>
  
    <li><a href="../git/t/t9139-git-svn-non-utf8-commitencoding_sh.html">t9139-git-svn-non-utf8-commitencoding.sh</a>
  
    <li><a href="../git/t/t9140-git-svn-reset_sh.html">t9140-git-svn-reset.sh</a>
  
    <li><a href="../git/t/t9141-git-svn-multiple-branches_sh.html">t9141-git-svn-multiple-branches.sh</a>
  
    <li><a href="../git/t/t9142-git-svn-shallow-clone_sh.html">t9142-git-svn-shallow-clone.sh</a>
  
    <li><a href="../git/t/t9143-git-svn-gc_sh.html">t9143-git-svn-gc.sh</a>
  
    <li><a href="../git/t/t9144-git-svn-old-rev_map_sh.html">t9144-git-svn-old-rev_map.sh</a>
  
    <li><a href="../git/t/t9145-git-svn-master-branch_sh.html">t9145-git-svn-master-branch.sh</a>
  
    <li><a href="../git/t/t9146-git-svn-empty-dirs_sh.html">t9146-git-svn-empty-dirs.sh</a>
  
    <li><a href="../git/t/t9147-git-svn-include-paths_sh.html">t9147-git-svn-include-paths.sh</a>
  
    <li><a href="../git/t/t9150-svk-mergetickets_sh.html">t9150-svk-mergetickets.sh</a>
  
    <li><a href="../git/t/t9150/make-svk-dump.html">make-svk-dump</a>
  
    <li><a href="../git/t/t9150/svk-merge_dump.html">svk-merge.dump</a>
  
    <li><a href="../git/t/t9151-svn-mergeinfo_sh.html">t9151-svn-mergeinfo.sh</a>
  
    <li><a href="../git/t/t9151/make-svnmerge-dump.html">make-svnmerge-dump</a>
  
    <li><a href="../git/t/t9151/svn-mergeinfo_dump.html">svn-mergeinfo.dump</a>
  
    <li><a href="../git/t/t9152-svn-empty-dirs-after-gc_sh.html">t9152-svn-empty-dirs-after-gc.sh</a>
  
    <li><a href="../git/t/t9153-git-svn-rewrite-uuid_sh.html">t9153-git-svn-rewrite-uuid.sh</a>
  
    <li><a href="../git/t/t9153/svn_dump.html">svn.dump</a>
  
    <li><a href="../git/t/t9154-git-svn-fancy-glob_sh.html">t9154-git-svn-fancy-glob.sh</a>
  
    <li><a href="../git/t/t9154/svn_dump.html">svn.dump</a>
  
    <li><a href="../git/t/t9155-git-svn-fetch-deleted-tag_sh.html">t9155-git-svn-fetch-deleted-tag.sh</a>
  
    <li><a href="../git/t/t9156-git-svn-fetch-deleted-tag-2_sh.html">t9156-git-svn-fetch-deleted-tag-2.sh</a>
  
    <li><a href="../git/t/t9157-git-svn-fetch-merge_sh.html">t9157-git-svn-fetch-merge.sh</a>
  
    <li><a href="../git/t/t9158-git-svn-mergeinfo_sh.html">t9158-git-svn-mergeinfo.sh</a>
  
    <li><a href="../git/t/t9159-git-svn-no-parent-mergeinfo_sh.html">t9159-git-svn-no-parent-mergeinfo.sh</a>
  
    <li><a href="../git/t/t9160-git-svn-preserve-empty-dirs_sh.html">t9160-git-svn-preserve-empty-dirs.sh</a>
  
    <li><a href="../git/t/t9161-git-svn-mergeinfo-push_sh.html">t9161-git-svn-mergeinfo-push.sh</a>
  
    <li><a href="../git/t/t9161/branches_dump.html">branches.dump</a>
  
    <li><a href="../git/t/t9162-git-svn-dcommit-interactive_sh.html">t9162-git-svn-dcommit-interactive.sh</a>
  
    <li><a href="../git/t/t9163-git-svn-reset-clears-caches_sh.html">t9163-git-svn-reset-clears-caches.sh</a>
  
    <li><a href="../git/t/t9164-git-svn-dcommit-concurrent_sh.html">t9164-git-svn-dcommit-concurrent.sh</a>
  
    <li><a href="../git/t/t9165-git-svn-fetch-merge-branch-of-branch_sh.html">t9165-git-svn-fetch-merge-branch-of-branch.sh</a>
  
    <li><a href="../git/t/t9166-git-svn-fetch-merge-branch-of-branch2_sh.html">t9166-git-svn-fetch-merge-branch-of-branch2.sh</a>
  
    <li><a href="../git/t/t9167-git-svn-cmd-branch-subproject_sh.html">t9167-git-svn-cmd-branch-subproject.sh</a>
  
    <li><a href="../git/t/t9200-git-cvsexportcommit_sh.html">t9200-git-cvsexportcommit.sh</a>
  
    <li><a href="../git/t/t9300-fast-import_sh.html">t9300-fast-import.sh</a>
  
    <li><a href="../git/t/t9301-fast-import-notes_sh.html">t9301-fast-import-notes.sh</a>
  
    <li><a href="../git/t/t9350-fast-export_sh.html">t9350-fast-export.sh</a>
  
    <li><a href="../git/t/t9400-git-cvsserver-server_sh.html">t9400-git-cvsserver-server.sh</a>
  
    <li><a href="../git/t/t9401-git-cvsserver-crlf_sh.html">t9401-git-cvsserver-crlf.sh</a>
  
    <li><a href="../git/t/t9402-git-cvsserver-refs_sh.html">t9402-git-cvsserver-refs.sh</a>
  
    <li><a href="../git/t/t9500-gitweb-standalone-no-errors_sh.html">t9500-gitweb-standalone-no-errors.sh</a>
  
    <li><a href="../git/t/t9501-gitweb-standalone-http-status_sh.html">t9501-gitweb-standalone-http-status.sh</a>
  
    <li><a href="../git/t/t9502-gitweb-standalone-parse-output_sh.html">t9502-gitweb-standalone-parse-output.sh</a>
  
    <li><a href="../git/t/t9600-cvsimport_sh.html">t9600-cvsimport.sh</a>
  
    <li><a href="../git/t/t9601-cvsimport-vendor-branch_sh.html">t9601-cvsimport-vendor-branch.sh</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/added-imported_txt,v.html">added-imported.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-anonymously_txt,v.html">imported-anonymously.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-modified-imported_txt,v.html">imported-modified-imported.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-modified_txt,v.html">imported-modified.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-once_txt,v.html">imported-once.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-twice_txt,v.html">imported-twice.txt,v</a>
  
    <li><a href="../git/t/t9602-cvsimport-branches-tags_sh.html">t9602-cvsimport-branches-tags.sh</a>
  
    <li><a href="../git/t/t9602/README.html">README</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub1/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub1/subsubA/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub1/subsubB/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub2/Attic/branch_B_MIXED_only,v.html">branch_B_MIXED_only,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub2/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub2/subsubA/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub3/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9603-cvsimport-patchsets_sh.html">t9603-cvsimport-patchsets.sh</a>
  
    <li><a href="../git/t/t9603/cvsroot/module/a,v.html">a,v</a>
  
    <li><a href="../git/t/t9603/cvsroot/module/b,v.html">b,v</a>
  
    <li><a href="../git/t/t9604-cvsimport-timestamps_sh.html">t9604-cvsimport-timestamps.sh</a>
  
    <li><a href="../git/t/t9604/cvsroot/module/a,v.html">a,v</a>
  
    <li><a href="../git/t/t9700-perl-git_sh.html">t9700-perl-git.sh</a>
  
    <li><a href="../git/t/t9700/test_pl.html">test.pl</a>
  
    <li><a href="../git/t/t9800-git-p4-basic_sh.html">t9800-git-p4-basic.sh</a>
  
    <li><a href="../git/t/t9801-git-p4-branch_sh.html">t9801-git-p4-branch.sh</a>
  
    <li><a href="../git/t/t9802-git-p4-filetype_sh.html">t9802-git-p4-filetype.sh</a>
  
    <li><a href="../git/t/t9803-git-p4-shell-metachars_sh.html">t9803-git-p4-shell-metachars.sh</a>
  
    <li><a href="../git/t/t9804-git-p4-label_sh.html">t9804-git-p4-label.sh</a>
  
    <li><a href="../git/t/t9805-git-p4-skip-submit-edit_sh.html">t9805-git-p4-skip-submit-edit.sh</a>
  
    <li><a href="../git/t/t9806-git-p4-options_sh.html">t9806-git-p4-options.sh</a>
  
    <li><a href="../git/t/t9807-git-p4-submit_sh.html">t9807-git-p4-submit.sh</a>
  
    <li><a href="../git/t/t9808-git-p4-chdir_sh.html">t9808-git-p4-chdir.sh</a>
  
    <li><a href="../git/t/t9809-git-p4-client-view_sh.html">t9809-git-p4-client-view.sh</a>
  
    <li><a href="../git/t/t9810-git-p4-rcs_sh.html">t9810-git-p4-rcs.sh</a>
  
    <li><a href="../git/t/t9811-git-p4-label-import_sh.html">t9811-git-p4-label-import.sh</a>
  
    <li><a href="../git/t/t9812-git-p4-wildcards_sh.html">t9812-git-p4-wildcards.sh</a>
  
    <li><a href="../git/t/t9813-git-p4-preserve-users_sh.html">t9813-git-p4-preserve-users.sh</a>
  
    <li><a href="../git/t/t9814-git-p4-rename_sh.html">t9814-git-p4-rename.sh</a>
  
    <li><a href="../git/t/t9815-git-p4-submit-fail_sh.html">t9815-git-p4-submit-fail.sh</a>
  
    <li><a href="../git/t/t9901-git-web--browse_sh.html">t9901-git-web--browse.sh</a>
  
    <li><a href="../git/t/t9902-completion_sh.html">t9902-completion.sh</a>
  
    <li><a href="../git/t/t9903-bash-prompt_sh.html">t9903-bash-prompt.sh</a>
  
    <li><a href="../git/t/test-lib-functions_sh.html">test-lib-functions.sh</a>
  
    <li><a href="../git/t/test-lib_sh.html">test-lib.sh</a>
  
    <li><a href="../git/t/test-terminal_perl.html">test-terminal.perl</a>
  
    <li><a href="../git/t/valgrind/analyze_sh.html">analyze.sh</a>
  
    <li><a href="../git/t/valgrind/default_supp.html">default.supp</a>
  
    <li><a href="../git/t/valgrind/valgrind_sh.html">valgrind.sh</a>
  
    <li><a href="../git/templates/Makefile.html">Makefile</a>
  
    <li><a href="../git/templates/branches--.html">branches--</a>
  
    <li><a href="../git/templates/hooks--applypatch-msg_sample.html">hooks--applypatch-msg.sample</a>
  
    <li><a href="../git/templates/hooks--commit-msg_sample.html">hooks--commit-msg.sample</a>
  
    <li><a href="../git/templates/hooks--post-update_sample.html">hooks--post-update.sample</a>
  
    <li><a href="../git/templates/hooks--pre-applypatch_sample.html">hooks--pre-applypatch.sample</a>
  
    <li><a href="../git/templates/hooks--pre-commit_sample.html">hooks--pre-commit.sample</a>
  
    <li><a href="../git/templates/hooks--pre-push_sample.html">hooks--pre-push.sample</a>
  
    <li><a href="../git/templates/hooks--pre-rebase_sample.html">hooks--pre-rebase.sample</a>
  
    <li><a href="../git/templates/hooks--prepare-commit-msg_sample.html">hooks--prepare-commit-msg.sample</a>
  
    <li><a href="../git/templates/hooks--update_sample.html">hooks--update.sample</a>
  
    <li><a href="../git/templates/info--exclude.html">info--exclude</a>
  
    <li><a href="../git/templates/this--description.html">this--description</a>
  
    <li><a href="../git/test-sha1_sh.html">test-sha1.sh</a>
  
    <li><a href="../git/unimplemented_sh.html">unimplemented.sh</a>
  
    <li><a href="../git/vcs-svn/LICENSE.html">LICENSE</a>
  
    <li><a href="../git/vcs-svn/line_buffer_txt.html">line_buffer</a>
  
    <li><a href="../git/wrap-for-bin_sh.html">wrap-for-bin.sh</a>
  
    <li><a href="../log/development_log.html">development.log</a>
  
    <li><a href="../public/404_html.html">404.html</a>
  
    <li><a href="../public/422_html.html">422.html</a>
  
    <li><a href="../public/500_html.html">500.html</a>
  
    <li><a href="../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../public/robots_txt.html">robots</a>
  
    <li><a href="../tmp/pids/server_pid.html">server.pid</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page git/git-p4.py">

<p>#!/usr/bin/env python # # git-p4.py  A tool for bidirectional operation
between a Perforce depot and git. # # Author: Simon Hausmann
&lt;simon@lst.de&gt; # Copyright: 2007 Simon Hausmann &lt;simon@lst.de&gt;
#            2007 Trolltech ASA # License: MIT &lt;<a
href="http://www.opensource.org/licenses/mit-license.php">www.opensource.org/licenses/mit-license.php</a>&gt;
# import sys if sys.hexversion &lt; 0x02040000:</p>

<pre># The limiter is the subprocess module
sys.stderr.write(&quot;git-p4: requires Python 2.4 or later.\n&quot;)
sys.exit(1)</pre>

<p>import os import optparse import marshal import subprocess import tempfile
import time import platform import re import shutil import stat</p>

<p>try:</p>

<pre>from subprocess import CalledProcessError</pre>

<p>except ImportError:</p>

<pre class="ruby"><span class="ruby-comment"># from python2.7:subprocess.py</span>
<span class="ruby-comment"># Exception classes used by this module.</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">CalledProcessError</span>(<span class="ruby-constant">Exception</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;This exception is raised when a process run by check_call() returns
    a non-zero exit status.  The exit status will be stored in the
    returncode attribute.&quot;</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">returncode</span>, <span class="ruby-identifier">cmd</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">returncode</span> = <span class="ruby-identifier">returncode</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cmd</span> = <span class="ruby-identifier">cmd</span>
    <span class="ruby-keyword">def</span> <span class="ruby-identifier">__str__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Command &#39;%s&#39; returned non-zero exit status %d&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">cmd</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">returncode</span>)
</pre>

<p>verbose = False</p>

<p># Only labels/tags matching this will be imported/exported
defaultLabelRegexp = <a href="a-zA-Z0-9_\-.">r</a>+$&#39;</p>

<p>def p4_build_cmd(cmd):</p>

<pre>&quot;&quot;&quot;Build a suitable p4 command line.

This consolidates building and returning a p4 command line into one
location. It means that hooking into the environment, or other configuration
can be done more easily.
&quot;&quot;&quot;
real_cmd = [&quot;p4&quot;]

user = gitConfig(&quot;git-p4.user&quot;)
if len(user) &gt; 0:
    real_cmd += [&quot;-u&quot;,user]

password = gitConfig(&quot;git-p4.password&quot;)
if len(password) &gt; 0:
    real_cmd += [&quot;-P&quot;, password]

port = gitConfig(&quot;git-p4.port&quot;)
if len(port) &gt; 0:
    real_cmd += [&quot;-p&quot;, port]

host = gitConfig(&quot;git-p4.host&quot;)
if len(host) &gt; 0:
    real_cmd += [&quot;-H&quot;, host]

client = gitConfig(&quot;git-p4.client&quot;)
if len(client) &gt; 0:
    real_cmd += [&quot;-c&quot;, client]

if isinstance(cmd,basestring):
    real_cmd = &#39; &#39;.join(real_cmd) + &#39; &#39; + cmd
else:
    real_cmd += cmd
return real_cmd</pre>

<p>def chdir(path, is_client_path=False):</p>

<pre>&quot;&quot;&quot;Do chdir to the given path, and set the PWD environment
   variable for use by P4.  It does not look at getcwd() output.
   Since we&#39;re not using the shell, it is necessary to set the
   PWD environment variable explicitly.

   Normally, expand the path to force it to be absolute.  This
   addresses the use of relative path names inside P4 settings,
   e.g. P4CONFIG=.p4config.  P4 does not simply open the filename
   as given; it looks for .p4config using PWD.

   If is_client_path, the path was handed to us directly by p4,
   and may be a symbolic link.  Do not call os.getcwd() in this
   case, because it will cause p4 to think that PWD is not inside
   the client path.
   &quot;&quot;&quot;

os.chdir(path)
if not is_client_path:
    path = os.getcwd()
os.environ[&#39;PWD&#39;] = path</pre>

<p>def die(msg):</p>

<pre>if verbose:
    raise Exception(msg)
else:
    sys.stderr.write(msg + &quot;\n&quot;)
    sys.exit(1)</pre>

<p>def write_pipe(c, stdin):</p>

<pre>if verbose:
    sys.stderr.write(&#39;Writing pipe: %s\n&#39; % str(c))

expand = isinstance(c,basestring)
p = subprocess.Popen(c, stdin=subprocess.PIPE, shell=expand)
pipe = p.stdin
val = pipe.write(stdin)
pipe.close()
if p.wait():
    die(&#39;Command failed: %s&#39; % str(c))

return val</pre>

<p>def p4_write_pipe(c, stdin):</p>

<pre>real_cmd = p4_build_cmd(c)
return write_pipe(real_cmd, stdin)</pre>

<p>def read_pipe(c, ignore_error=False):</p>

<pre>if verbose:
    sys.stderr.write(&#39;Reading pipe: %s\n&#39; % str(c))

expand = isinstance(c,basestring)
p = subprocess.Popen(c, stdout=subprocess.PIPE, shell=expand)
pipe = p.stdout
val = pipe.read()
if p.wait() and not ignore_error:
    die(&#39;Command failed: %s&#39; % str(c))

return val</pre>

<p>def p4_read_pipe(c, ignore_error=False):</p>

<pre>real_cmd = p4_build_cmd(c)
return read_pipe(real_cmd, ignore_error)</pre>

<p>def read_pipe_lines:</p>

<pre>if verbose:
    sys.stderr.write(&#39;Reading pipe: %s\n&#39; % str(c))

expand = isinstance(c, basestring)
p = subprocess.Popen(c, stdout=subprocess.PIPE, shell=expand)
pipe = p.stdout
val = pipe.readlines()
if pipe.close() or p.wait():
    die(&#39;Command failed: %s&#39; % str(c))

return val</pre>

<p>def p4_read_pipe_lines:</p>

<pre>&quot;&quot;&quot;Specifically invoke p4 on the command supplied. &quot;&quot;&quot;
real_cmd = p4_build_cmd(c)
return read_pipe_lines(real_cmd)</pre>

<p>def p4_has_command(cmd):</p>

<pre>&quot;&quot;&quot;Ask p4 for help on this command.  If it returns an error, the
   command does not exist in this version of p4.&quot;&quot;&quot;
real_cmd = p4_build_cmd([&quot;help&quot;, cmd])
p = subprocess.Popen(real_cmd, stdout=subprocess.PIPE,
                               stderr=subprocess.PIPE)
p.communicate()
return p.returncode == 0</pre>

<p>def p4_has_move_command():</p>

<pre>&quot;&quot;&quot;See if the move command exists, that it supports -k, and that
   it has not been administratively disabled.  The arguments
   must be correct, but the filenames do not have to exist.  Use
   ones with wildcards so even if they exist, it will fail.&quot;&quot;&quot;

if not p4_has_command(&quot;move&quot;):
    return False
cmd = p4_build_cmd([&quot;move&quot;, &quot;-k&quot;, &quot;@from&quot;, &quot;@to&quot;])
p = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
(out, err) = p.communicate()
# return code will be 1 in either case
if err.find(&quot;Invalid option&quot;) &gt;= 0:
    return False
if err.find(&quot;disabled&quot;) &gt;= 0:
    return False
# assume it failed because @... was invalid changelist
return True</pre>

<p>def system(cmd):</p>

<pre>expand = isinstance(cmd,basestring)
if verbose:
    sys.stderr.write(&quot;executing %s\n&quot; % str(cmd))
retcode = subprocess.call(cmd, shell=expand)
if retcode:
    raise CalledProcessError(retcode, cmd)</pre>

<p>def p4_system(cmd):</p>

<pre>&quot;&quot;&quot;Specifically invoke p4 as the system command. &quot;&quot;&quot;
real_cmd = p4_build_cmd(cmd)
expand = isinstance(real_cmd, basestring)
retcode = subprocess.call(real_cmd, shell=expand)
if retcode:
    raise CalledProcessError(retcode, real_cmd)</pre>

<p>_p4_version_string = None def p4_version_string():</p>

<pre>&quot;&quot;&quot;Read the version string, showing just the last line, which
   hopefully is the interesting version bit.

   $ p4 -V
   Perforce - The Fast Software Configuration Management System.
   Copyright 1995-2011 Perforce Software.  All rights reserved.
   Rev. P4/NTX86/2011.1/393975 (2011/12/16).
&quot;&quot;&quot;
global _p4_version_string
if not _p4_version_string:
    a = p4_read_pipe_lines([&quot;-V&quot;])
    _p4_version_string = a[-1].rstrip()
return _p4_version_string</pre>

<p>def p4_integrate(src, dest):</p>

<pre>p4_system([&quot;integrate&quot;, &quot;-Dt&quot;, wildcard_encode(src), wildcard_encode(dest)])</pre>

<p>def p4_sync(f, *options):</p>

<pre>p4_system([&quot;sync&quot;] + list(options) + [wildcard_encode(f)])</pre>

<p>def p4_add(f):</p>

<pre># forcibly add file names with wildcards
if wildcard_present(f):
    p4_system([&quot;add&quot;, &quot;-f&quot;, f])
else:
    p4_system([&quot;add&quot;, f])</pre>

<p>def p4_delete(f):</p>

<pre>p4_system([&quot;delete&quot;, wildcard_encode(f)])</pre>

<p>def p4_edit(f):</p>

<pre>p4_system([&quot;edit&quot;, wildcard_encode(f)])</pre>

<p>def p4_revert(f):</p>

<pre>p4_system([&quot;revert&quot;, wildcard_encode(f)])</pre>

<p>def p4_reopen(type, f):</p>

<pre>p4_system([&quot;reopen&quot;, &quot;-t&quot;, type, wildcard_encode(f)])</pre>

<p>def p4_move(src, dest):</p>

<pre>p4_system([&quot;move&quot;, &quot;-k&quot;, wildcard_encode(src), wildcard_encode(dest)])</pre>

<p>def p4_describe(change):</p>

<pre>&quot;&quot;&quot;Make sure it returns a valid result by checking for
   the presence of field &quot;time&quot;.  Return a dict of the
   results.&quot;&quot;&quot;

ds = p4CmdList([&quot;describe&quot;, &quot;-s&quot;, str(change)])
if len(ds) != 1:
    die(&quot;p4 describe -s %d did not return 1 result: %s&quot; % (change, str(ds)))

d = ds[0]

if &quot;p4ExitCode&quot; in d:
    die(&quot;p4 describe -s %d exited with %d: %s&quot; % (change, d[&quot;p4ExitCode&quot;],
                                                  str(d)))
if &quot;code&quot; in d:
    if d[&quot;code&quot;] == &quot;error&quot;:
        die(&quot;p4 describe -s %d returned error code: %s&quot; % (change, str(d)))

if &quot;time&quot; not in d:
    die(&quot;p4 describe -s %d returned no \&quot;time\&quot;: %s&quot; % (change, str(d)))

return d</pre>

<p># # Canonicalize the p4 type and return a tuple of the # base type, plus
any modifiers.  See p4 help filetypes # for a list and explanation. # def
split_p4_type(p4type):</p>

<pre>p4_filetypes_historical = {
    &quot;ctempobj&quot;: &quot;binary+Sw&quot;,
    &quot;ctext&quot;: &quot;text+C&quot;,
    &quot;cxtext&quot;: &quot;text+Cx&quot;,
    &quot;ktext&quot;: &quot;text+k&quot;,
    &quot;kxtext&quot;: &quot;text+kx&quot;,
    &quot;ltext&quot;: &quot;text+F&quot;,
    &quot;tempobj&quot;: &quot;binary+FSw&quot;,
    &quot;ubinary&quot;: &quot;binary+F&quot;,
    &quot;uresource&quot;: &quot;resource+F&quot;,
    &quot;uxbinary&quot;: &quot;binary+Fx&quot;,
    &quot;xbinary&quot;: &quot;binary+x&quot;,
    &quot;xltext&quot;: &quot;text+Fx&quot;,
    &quot;xtempobj&quot;: &quot;binary+Swx&quot;,
    &quot;xtext&quot;: &quot;text+x&quot;,
    &quot;xunicode&quot;: &quot;unicode+x&quot;,
    &quot;xutf16&quot;: &quot;utf16+x&quot;,
}
if p4type in p4_filetypes_historical:
    p4type = p4_filetypes_historical[p4type]
mods = &quot;&quot;
s = p4type.split(&quot;+&quot;)
base = s[0]
mods = &quot;&quot;
if len(s) &gt; 1:
    mods = s[1]
return (base, mods)</pre>

<p># # return the raw p4 type of a file (text, text+ko, etc) # def
p4_type(file):</p>

<pre>results = p4CmdList([&quot;fstat&quot;, &quot;-T&quot;, &quot;headType&quot;, file])
return results[0][&#39;headType&#39;]</pre>

<p># # Given a type base and modifier, return a regexp matching # the keywords
that can be expanded in the file # def p4_keywords_regexp_for_type(base,
type_mods):</p>

<pre>if base in (&quot;text&quot;, &quot;unicode&quot;, &quot;binary&quot;):
    kwords = None
    if &quot;ko&quot; in type_mods:
        kwords = &#39;Id|Header&#39;
    elif &quot;k&quot; in type_mods:
        kwords = &#39;Id|Header|Author|Date|DateTime|Change|File|Revision&#39;
    else:
        return None
    pattern = r&quot;&quot;&quot;
        \$              # Starts with a dollar, followed by...
        (%s)            # one of the keywords, followed by...
        (:[^$\n]+)?     # possibly an old expansion, followed by...
        \$              # another dollar
        &quot;&quot;&quot; % kwords
    return pattern
else:
    return None</pre>

<p># # Given a file, return a regexp matching the possible # RCS keywords that
will be expanded, or None for files # with kw expansion turned off. # def
p4_keywords_regexp_for_file(file):</p>

<pre>if not os.path.exists(file):
    return None
else:
    (type_base, type_mods) = split_p4_type(p4_type(file))
    return p4_keywords_regexp_for_type(type_base, type_mods)</pre>

<p>def setP4ExecBit(file, mode):</p>

<pre># Reopens an already open file and changes the execute bit to match
# the execute bit setting in the passed in mode.

p4Type = &quot;+x&quot;

if not isModeExec(mode):
    p4Type = getP4OpenedType(file)
    p4Type = re.sub(&#39;^([cku]?)x(.*)&#39;, &#39;\\1\\2&#39;, p4Type)
    p4Type = re.sub(&#39;(.*?\+.*?)x(.*?)&#39;, &#39;\\1\\2&#39;, p4Type)
    if p4Type[-1] == &quot;+&quot;:
        p4Type = p4Type[0:-1]

p4_reopen(p4Type, file)</pre>

<p>def getP4OpenedType(file):</p>

<pre># Returns the perforce file type for the given file.

result = p4_read_pipe([&quot;opened&quot;, wildcard_encode(file)])
match = re.match(&quot;.*\((.+)\)\r?$&quot;, result)
if match:
    return match.group(1)
else:
    die(&quot;Could not determine file type for %s (result: &#39;%s&#39;)&quot; % (file, result))</pre>

<p># Return the set of all p4 labels def getP4Labels(depotPaths):</p>

<pre>labels = set()
if isinstance(depotPaths,basestring):
    depotPaths = [depotPaths]

for l in p4CmdList([&quot;labels&quot;] + [&quot;%s...&quot; % p for p in depotPaths]):
    label = l[&#39;label&#39;]
    labels.add(label)

return labels</pre>

<p># Return the set of all git tags def getGitTags():</p>

<pre>gitTags = set()
for line in read_pipe_lines([&quot;git&quot;, &quot;tag&quot;]):
    tag = line.strip()
    gitTags.add(tag)
return gitTags</pre>

<p>def diffTreePattern():</p>

<pre class="ruby"><span class="ruby-comment"># This is a simple generator for the diff tree regex pattern. This could be</span>
<span class="ruby-comment"># a class variable if this and parseDiffTreeEntry were a part of a class.</span>
<span class="ruby-identifier">pattern</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">compile</span>(<span class="ruby-string">&#39;:(\d+) (\d+) (\w+) (\w+) ([A-Z])(\d+)?\t(.*?)((\t(.*))|$)&#39;</span>)
<span class="ruby-keyword">while</span> <span class="ruby-constant">True</span><span class="ruby-operator">:</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">pattern</span>
</pre>

<p>def parseDiffTreeEntry(entry):</p>

<pre>&quot;&quot;&quot;Parses a single diff tree entry into its component elements.

See git-diff-tree(1) manpage for details about the format of the diff
output. This method returns a dictionary with the following elements:

src_mode - The mode of the source file
dst_mode - The mode of the destination file
src_sha1 - The sha1 for the source file
dst_sha1 - The sha1 fr the destination file
status - The one letter status of the diff (i.e. &#39;A&#39;, &#39;M&#39;, &#39;D&#39;, etc)
status_score - The score for the status (applicable for &#39;C&#39; and &#39;R&#39;
               statuses). This is None if there is no score.
src - The path for the source file.
dst - The path for the destination file. This is only present for
      copy or renames. If it is not present, this is None.

If the pattern is not matched, None is returned.&quot;&quot;&quot;

match = diffTreePattern().next().match(entry)
if match:
    return {
        &#39;src_mode&#39;: match.group(1),
        &#39;dst_mode&#39;: match.group(2),
        &#39;src_sha1&#39;: match.group(3),
        &#39;dst_sha1&#39;: match.group(4),
        &#39;status&#39;: match.group(5),
        &#39;status_score&#39;: match.group(6),
        &#39;src&#39;: match.group(7),
        &#39;dst&#39;: match.group(10)
    }
return None</pre>

<p>def isModeExec(mode):</p>

<pre># Returns True if the given git mode represents an executable file,
# otherwise False.
return mode[-3:] == &quot;755&quot;</pre>

<p>def isModeExecChanged(src_mode, dst_mode):</p>

<pre>return isModeExec(src_mode) != isModeExec(dst_mode)</pre>

<p>def p4CmdList(cmd, stdin=None, stdin_mode=&#39;w+b&#39;, cb=None):</p>

<pre>if isinstance(cmd,basestring):
    cmd = &quot;-G &quot; + cmd
    expand = True
else:
    cmd = [&quot;-G&quot;] + cmd
    expand = False

cmd = p4_build_cmd(cmd)
if verbose:
    sys.stderr.write(&quot;Opening pipe: %s\n&quot; % str(cmd))

# Use a temporary file to avoid deadlocks without
# subprocess.communicate(), which would put another copy
# of stdout into memory.
stdin_file = None
if stdin is not None:
    stdin_file = tempfile.TemporaryFile(prefix=&#39;p4-stdin&#39;, mode=stdin_mode)
    if isinstance(stdin,basestring):
        stdin_file.write(stdin)
    else:
        for i in stdin:
            stdin_file.write(i + &#39;\n&#39;)
    stdin_file.flush()
    stdin_file.seek(0)

p4 = subprocess.Popen(cmd,
                      shell=expand,
                      stdin=stdin_file,
                      stdout=subprocess.PIPE)

result = []
try:
    while True:
        entry = marshal.load(p4.stdout)
        if cb is not None:
            cb(entry)
        else:
            result.append(entry)
except EOFError:
    pass
exitCode = p4.wait()
if exitCode != 0:
    entry = {}
    entry[&quot;p4ExitCode&quot;] = exitCode
    result.append(entry)

return result</pre>

<p>def p4Cmd(cmd):</p>

<pre>list = p4CmdList(cmd)
result = {}
for entry in list:
    result.update(entry)
return result;</pre>

<p>def p4Where(depotPath):</p>

<pre>if not depotPath.endswith(&quot;/&quot;):
    depotPath += &quot;/&quot;
depotPath = depotPath + &quot;...&quot;
outputList = p4CmdList([&quot;where&quot;, depotPath])
output = None
for entry in outputList:
    if &quot;depotFile&quot; in entry:
        if entry[&quot;depotFile&quot;] == depotPath:
            output = entry
            break
    elif &quot;data&quot; in entry:
        data = entry.get(&quot;data&quot;)
        space = data.find(&quot; &quot;)
        if data[:space] == depotPath:
            output = entry
            break
if output == None:
    return &quot;&quot;
if output[&quot;code&quot;] == &quot;error&quot;:
    return &quot;&quot;
clientPath = &quot;&quot;
if &quot;path&quot; in output:
    clientPath = output.get(&quot;path&quot;)
elif &quot;data&quot; in output:
    data = output.get(&quot;data&quot;)
    lastSpace = data.rfind(&quot; &quot;)
    clientPath = data[lastSpace + 1:]

if clientPath.endswith(&quot;...&quot;):
    clientPath = clientPath[:-3]
return clientPath</pre>

<p>def currentGitBranch():</p>

<pre>return read_pipe(&quot;git name-rev HEAD&quot;).split(&quot; &quot;)[1].strip()</pre>

<p>def isValidGitDir(path):</p>

<pre>if (os.path.exists(path + &quot;/HEAD&quot;)
    and os.path.exists(path + &quot;/refs&quot;) and os.path.exists(path + &quot;/objects&quot;)):
    return True;
return False</pre>

<p>def parseRevision(ref):</p>

<pre>return read_pipe(&quot;git rev-parse %s&quot; % ref).strip()</pre>

<p>def branchExists(ref):</p>

<pre>rev = read_pipe([&quot;git&quot;, &quot;rev-parse&quot;, &quot;-q&quot;, &quot;--verify&quot;, ref],
                 ignore_error=True)
return len(rev) &gt; 0</pre>

<p>def extractLogMessageFromGitCommit(commit):</p>

<pre>logMessage = &quot;&quot;

## fixme: title is first line of commit, not 1st paragraph.
foundTitle = False
for log in read_pipe_lines(&quot;git cat-file commit %s&quot; % commit):
   if not foundTitle:
       if len(log) == 1:
           foundTitle = True
       continue

   logMessage += log
return logMessage</pre>

<p>def extractSettingsGitLog(log):</p>

<pre>values = {}
for line in log.split(&quot;\n&quot;):
    line = line.strip()
    m = re.search (r&quot;^ *\[git-p4: (.*)\]$&quot;, line)
    if not m:
        continue

    assignments = m.group(1).split (&#39;:&#39;)
    for a in assignments:
        vals = a.split (&#39;=&#39;)
        key = vals[0].strip()
        val = (&#39;=&#39;.join (vals[1:])).strip()
        if val.endswith (&#39;\&quot;&#39;) and val.startswith(&#39;&quot;&#39;):
            val = val[1:-1]

        values[key] = val

paths = values.get(&quot;depot-paths&quot;)
if not paths:
    paths = values.get(&quot;depot-path&quot;)
if paths:
    values[&#39;depot-paths&#39;] = paths.split(&#39;,&#39;)
return values</pre>

<p>def gitBranchExists(branch):</p>

<pre>proc = subprocess.Popen([&quot;git&quot;, &quot;rev-parse&quot;, branch],
                        stderr=subprocess.PIPE, stdout=subprocess.PIPE);
return proc.wait() == 0;</pre>

<p>_gitConfig = {}</p>

<p>def gitConfig(key):</p>

<pre>if not _gitConfig.has_key(key):
    cmd = [ &quot;git&quot;, &quot;config&quot;, key ]
    s = read_pipe(cmd, ignore_error=True)
    _gitConfig[key] = s.strip()
return _gitConfig[key]</pre>

<p>def gitConfigBool(key):</p>

<pre>&quot;&quot;&quot;Return a bool, using git config --bool.  It is True only if the
   variable is set to true, and False if set to false or not present
   in the config.&quot;&quot;&quot;

if not _gitConfig.has_key(key):
    cmd = [ &quot;git&quot;, &quot;config&quot;, &quot;--bool&quot;, key ]
    s = read_pipe(cmd, ignore_error=True)
    v = s.strip()
    _gitConfig[key] = v == &quot;true&quot;
return _gitConfig[key]</pre>

<p>def gitConfigList(key):</p>

<pre>if not _gitConfig.has_key(key):
    s = read_pipe([&quot;git&quot;, &quot;config&quot;, &quot;--get-all&quot;, key], ignore_error=True)
    _gitConfig[key] = s.strip().split(os.linesep)
return _gitConfig[key]</pre>

<p>def p4BranchesInGit(branchesAreInRemotes=True):</p>

<pre>&quot;&quot;&quot;Find all the branches whose names start with &quot;p4/&quot;, looking
   in remotes or heads as specified by the argument.  Return
   a dictionary of { branch: revision } for each one found.
   The branch names are the short names, without any
   &quot;p4/&quot; prefix.&quot;&quot;&quot;

branches = {}

cmdline = &quot;git rev-parse --symbolic &quot;
if branchesAreInRemotes:
    cmdline += &quot;--remotes&quot;
else:
    cmdline += &quot;--branches&quot;

for line in read_pipe_lines(cmdline):
    line = line.strip()

    # only import to p4/
    if not line.startswith(&#39;p4/&#39;):
        continue
    # special symbolic ref to p4/master
    if line == &quot;p4/HEAD&quot;:
        continue

    # strip off p4/ prefix
    branch = line[len(&quot;p4/&quot;):]

    branches[branch] = parseRevision(line)

return branches</pre>

<p>def branch_exists(branch):</p>

<pre>&quot;&quot;&quot;Make sure that the given ref name really exists.&quot;&quot;&quot;

cmd = [ &quot;git&quot;, &quot;rev-parse&quot;, &quot;--symbolic&quot;, &quot;--verify&quot;, branch ]
p = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
out, _ = p.communicate()
if p.returncode:
    return False
# expect exactly one line of output: the branch name
return out.rstrip() == branch</pre>

<p>def findUpstreamBranchPoint(head = HEAD):</p>

<pre>branches = p4BranchesInGit()
# map from depot-path to branch name
branchByDepotPath = {}
for branch in branches.keys():
    tip = branches[branch]
    log = extractLogMessageFromGitCommit(tip)
    settings = extractSettingsGitLog(log)
    if settings.has_key(&quot;depot-paths&quot;):
        paths = &quot;,&quot;.join(settings[&quot;depot-paths&quot;])
        branchByDepotPath[paths] = &quot;remotes/p4/&quot; + branch

settings = None
parent = 0
while parent &lt; 65535:
    commit = head + &quot;~%s&quot; % parent
    log = extractLogMessageFromGitCommit(commit)
    settings = extractSettingsGitLog(log)
    if settings.has_key(&quot;depot-paths&quot;):
        paths = &quot;,&quot;.join(settings[&quot;depot-paths&quot;])
        if branchByDepotPath.has_key(paths):
            return [branchByDepotPath[paths], settings]

    parent = parent + 1

return [&quot;&quot;, settings]</pre>

<p>def createOrUpdateBranchesFromOrigin(localRefPrefix = refs/remotes/p4/,
silent=True):</p>

<pre>if not silent:
    print (&quot;Creating/updating branch(es) in %s based on origin branch(es)&quot;
           % localRefPrefix)

originPrefix = &quot;origin/p4/&quot;

for line in read_pipe_lines(&quot;git rev-parse --symbolic --remotes&quot;):
    line = line.strip()
    if (not line.startswith(originPrefix)) or line.endswith(&quot;HEAD&quot;):
        continue

    headName = line[len(originPrefix):]
    remoteHead = localRefPrefix + headName
    originHead = line

    original = extractSettingsGitLog(extractLogMessageFromGitCommit(originHead))
    if (not original.has_key(&#39;depot-paths&#39;)
        or not original.has_key(&#39;change&#39;)):
        continue

    update = False
    if not gitBranchExists(remoteHead):
        if verbose:
            print &quot;creating %s&quot; % remoteHead
        update = True
    else:
        settings = extractSettingsGitLog(extractLogMessageFromGitCommit(remoteHead))
        if settings.has_key(&#39;change&#39;) &gt; 0:
            if settings[&#39;depot-paths&#39;] == original[&#39;depot-paths&#39;]:
                originP4Change = int(original[&#39;change&#39;])
                p4Change = int(settings[&#39;change&#39;])
                if originP4Change &gt; p4Change:
                    print (&quot;%s (%s) is newer than %s (%s). &quot;
                           &quot;Updating p4 branch from origin.&quot;
                           % (originHead, originP4Change,
                              remoteHead, p4Change))
                    update = True
            else:
                print (&quot;Ignoring: %s was imported from %s while &quot;
                       &quot;%s was imported from %s&quot;
                       % (originHead, &#39;,&#39;.join(original[&#39;depot-paths&#39;]),
                          remoteHead, &#39;,&#39;.join(settings[&#39;depot-paths&#39;])))

    if update:
        system(&quot;git update-ref %s %s&quot; % (remoteHead, originHead))</pre>

<p>def originP4BranchesExist():</p>

<pre>return gitBranchExists(&quot;origin&quot;) or gitBranchExists(&quot;origin/p4&quot;) or gitBranchExists(&quot;origin/p4/master&quot;)</pre>

<p>def p4ChangesForPaths(depotPaths, changeRange):</p>

<pre>assert depotPaths
cmd = [&#39;changes&#39;]
for p in depotPaths:
    cmd += [&quot;%s...%s&quot; % (p, changeRange)]
output = p4_read_pipe_lines(cmd)

changes = {}
for line in output:
    changeNum = int(line.split(&quot; &quot;)[1])
    changes[changeNum] = True

changelist = changes.keys()
changelist.sort()
return changelist</pre>

<p>def p4PathStartsWith(path, prefix):</p>

<pre># This method tries to remedy a potential mixed-case issue:
#
# If UserA adds  //depot/DirA/file1
# and UserB adds //depot/dira/file2
#
# we may or may not have a problem. If you have core.ignorecase=true,
# we treat DirA and dira as the same directory
if gitConfigBool(&quot;core.ignorecase&quot;):
    return path.lower().startswith(prefix.lower())
return path.startswith(prefix)</pre>

<p>def getClientSpec():</p>

<pre>&quot;&quot;&quot;Look at the p4 client spec, create a View() object that contains
   all the mappings, and return it.&quot;&quot;&quot;

specList = p4CmdList(&quot;client -o&quot;)
if len(specList) != 1:
    die(&#39;Output from &quot;client -o&quot; is %d lines, expecting 1&#39; %
        len(specList))

# dictionary of all client parameters
entry = specList[0]

# the //client/ name
client_name = entry[&quot;Client&quot;]

# just the keys that start with &quot;View&quot;
view_keys = [ k for k in entry.keys() if k.startswith(&quot;View&quot;) ]

# hold this new View
view = View(client_name)

# append the lines, in order, to the view
for view_num in range(len(view_keys)):
    k = &quot;View%d&quot; % view_num
    if k not in view_keys:
        die(&quot;Expected view key %s missing&quot; % k)
    view.append(entry[k])

return view</pre>

<p>def getClientRoot():</p>

<pre>&quot;&quot;&quot;Grab the client directory.&quot;&quot;&quot;

output = p4CmdList(&quot;client -o&quot;)
if len(output) != 1:
    die(&#39;Output from &quot;client -o&quot; is %d lines, expecting 1&#39; % len(output))

entry = output[0]
if &quot;Root&quot; not in entry:
    die(&#39;Client has no &quot;Root&quot;&#39;)

return entry[&quot;Root&quot;]</pre>

<p># # P4 wildcards are not allowed in filenames.  P4 complains # if you
simply add them, but you can force it with -f, in # which case it
translates them into %xx encoding internally. # def wildcard_decode(path):</p>

<pre># Search for and fix just these four characters.  Do % last so
# that fixing it does not inadvertently create new %-escapes.
# Cannot have * in a filename in windows; untested as to
# what p4 would do in such a case.
if not platform.system() == &quot;Windows&quot;:
    path = path.replace(&quot;%2A&quot;, &quot;*&quot;)
path = path.replace(&quot;%23&quot;, &quot;#&quot;) \
           .replace(&quot;%40&quot;, &quot;@&quot;) \
           .replace(&quot;%25&quot;, &quot;%&quot;)
return path</pre>

<p>def wildcard_encode(path):</p>

<pre># do % first to avoid double-encoding the %s introduced here
path = path.replace(&quot;%&quot;, &quot;%25&quot;) \
           .replace(&quot;*&quot;, &quot;%2A&quot;) \
           .replace(&quot;#&quot;, &quot;%23&quot;) \
           .replace(&quot;@&quot;, &quot;%40&quot;)
return path</pre>

<p>def wildcard_present(path):</p>

<pre>m = re.search(&quot;[*#@%]&quot;, path)
return m is not None</pre>

<p>class Command:</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">usage</span> = <span class="ruby-string">&quot;usage: %prog [options]&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">needsGit</span> = <span class="ruby-constant">True</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-constant">False</span>
</pre>

<p>class P4UserMap:</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">userMapFromPerforceServer</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">myP4UserId</span> = <span class="ruby-constant">None</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">p4UserId</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">myP4UserId</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">myP4UserId</span>

    <span class="ruby-identifier">results</span> = <span class="ruby-identifier">p4CmdList</span>(<span class="ruby-string">&quot;user -o&quot;</span>)
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">results</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;User&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">myP4UserId</span> = <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;User&#39;</span>]
            <span class="ruby-keyword">return</span> <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;User&#39;</span>]
    <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Could not find your p4 user id&quot;</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">p4UserIsMe</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">p4User</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># return True if the given p4 user is actually me</span>
    <span class="ruby-identifier">me</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4UserId</span>()
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">p4User</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">p4User</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">me</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">getUserCacheFilename</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">home</span> = <span class="ruby-identifier">os</span>.<span class="ruby-identifier">environ</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&quot;HOME&quot;</span>, <span class="ruby-identifier">os</span>.<span class="ruby-identifier">environ</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&quot;USERPROFILE&quot;</span>))
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">home</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/.gitp4-usercache.txt&quot;</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">getUserMapFromPerforceServer</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">userMapFromPerforceServer</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span> = {}
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">emails</span> = {}

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">output</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">p4CmdList</span>(<span class="ruby-string">&quot;users&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">output</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&quot;User&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">continue</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span>[<span class="ruby-identifier">output</span>[<span class="ruby-string">&quot;User&quot;</span>]] = <span class="ruby-identifier">output</span>[<span class="ruby-string">&quot;FullName&quot;</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &lt;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">output</span>[<span class="ruby-string">&quot;Email&quot;</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&gt;&quot;</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">emails</span>[<span class="ruby-identifier">output</span>[<span class="ruby-string">&quot;Email&quot;</span>]] = <span class="ruby-identifier">output</span>[<span class="ruby-string">&quot;User&quot;</span>]

    <span class="ruby-identifier">s</span> = <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">for</span> (<span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span>) <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">items</span>()<span class="ruby-operator">:</span>
        <span class="ruby-identifier">s</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;%s\t%s\n&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">key</span>.<span class="ruby-identifier">expandtabs</span>(<span class="ruby-value">1</span>), <span class="ruby-identifier">val</span>.<span class="ruby-identifier">expandtabs</span>(<span class="ruby-value">1</span>))

    <span class="ruby-identifier">open</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">getUserCacheFilename</span>(), <span class="ruby-string">&quot;wb&quot;</span>).<span class="ruby-identifier">write</span>(<span class="ruby-identifier">s</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">userMapFromPerforceServer</span> = <span class="ruby-constant">True</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">loadUserMapFromCache</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span> = {}
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">userMapFromPerforceServer</span> = <span class="ruby-constant">False</span>
    <span class="ruby-identifier">try</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">cache</span> = <span class="ruby-identifier">open</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">getUserCacheFilename</span>(), <span class="ruby-string">&quot;rb&quot;</span>)
        <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">readlines</span>()
        <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">close</span>()
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">lines</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip</span>().<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\t&quot;</span>)
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span>[<span class="ruby-identifier">entry</span>[<span class="ruby-value">0</span>]] = <span class="ruby-identifier">entry</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">except</span> <span class="ruby-constant">IOError</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">getUserMapFromPerforceServer</span>()
</pre>

<p>class P4Debug(Command):</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-constant">Command</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> = []
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;A tool to debug the output of p4 -G.&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">needsGit</span> = <span class="ruby-constant">False</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">j</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">output</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">p4CmdList</span>(<span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&#39;Element: %d&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">j</span>
        <span class="ruby-identifier">j</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">output</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>
</pre>

<p>class P4RollBack(Command):</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-constant">Command</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> = [
        <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--local&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;rollbackLocalBranches&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>)
    ]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;A tool to debug the multi-branch import. Don&#39;t use :)&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rollbackLocalBranches</span> = <span class="ruby-constant">False</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">args</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">1</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>
    <span class="ruby-identifier">maxChange</span> = <span class="ruby-identifier">int</span>(<span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])

    <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;p4ExitCode&quot;</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">p4Cmd</span>(<span class="ruby-string">&quot;changes -m 1&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Problems executing p4&quot;</span>);

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rollbackLocalBranches</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">refPrefix</span> = <span class="ruby-string">&quot;refs/heads/&quot;</span>
        <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">read_pipe_lines</span>(<span class="ruby-string">&quot;git rev-parse --symbolic --branches&quot;</span>)
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">refPrefix</span> = <span class="ruby-string">&quot;refs/remotes/&quot;</span>
        <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">read_pipe_lines</span>(<span class="ruby-string">&quot;git rev-parse --symbolic --remotes&quot;</span>)

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">lines</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rollbackLocalBranches</span> <span class="ruby-keyword">or</span> (<span class="ruby-identifier">line</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;p4/&quot;</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;p4/HEAD\n&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">line</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip</span>()
            <span class="ruby-identifier">ref</span> = <span class="ruby-identifier">refPrefix</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">line</span>
            <span class="ruby-identifier">log</span> = <span class="ruby-identifier">extractLogMessageFromGitCommit</span>(<span class="ruby-identifier">ref</span>)
            <span class="ruby-identifier">settings</span> = <span class="ruby-identifier">extractSettingsGitLog</span>(<span class="ruby-identifier">log</span>)

            <span class="ruby-identifier">depotPaths</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-string">&#39;depot-paths&#39;</span>]
            <span class="ruby-identifier">change</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-string">&#39;change&#39;</span>]

            <span class="ruby-identifier">changed</span> = <span class="ruby-constant">False</span>

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">p4Cmd</span>(<span class="ruby-string">&quot;changes -m 1 &quot;</span>  <span class="ruby-operator">+</span> <span class="ruby-string">&#39; &#39;</span>.<span class="ruby-identifier">join</span> ([<span class="ruby-string">&#39;%s...@%s&#39;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">p</span>, <span class="ruby-identifier">maxChange</span>)
                                                       <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">depotPaths</span>]))) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Branch %s did not exist at change %s, deleting.&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">maxChange</span>)
                <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git update-ref -d %s `git rev-parse %s`&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">ref</span>))
                <span class="ruby-identifier">continue</span>

            <span class="ruby-keyword">while</span> <span class="ruby-identifier">change</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">int</span>(<span class="ruby-identifier">change</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">maxChange</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">changed</span> = <span class="ruby-constant">True</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;%s is at %s ; rewinding towards %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">change</span>, <span class="ruby-identifier">maxChange</span>)
                <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git update-ref %s \&quot;%s^\&quot;&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">ref</span>))
                <span class="ruby-identifier">log</span> = <span class="ruby-identifier">extractLogMessageFromGitCommit</span>(<span class="ruby-identifier">ref</span>)
                <span class="ruby-identifier">settings</span> =  <span class="ruby-identifier">extractSettingsGitLog</span>(<span class="ruby-identifier">log</span>)

                <span class="ruby-identifier">depotPaths</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-string">&#39;depot-paths&#39;</span>]
                <span class="ruby-identifier">change</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-string">&#39;change&#39;</span>]

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">changed</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;%s rewound to %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">ref</span>, <span class="ruby-identifier">change</span>)

    <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>
</pre>

<p>class P4Submit(Command, P4UserMap):</p>

<pre class="ruby"><span class="ruby-identifier">conflict_behavior_choices</span> = (<span class="ruby-string">&quot;ask&quot;</span>, <span class="ruby-string">&quot;skip&quot;</span>, <span class="ruby-string">&quot;quit&quot;</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-constant">Command</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-constant">P4UserMap</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> = [
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--origin&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;origin&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;-M&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;detectRenames&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-comment"># preserve the user, requires relevant p4 permissions</span>
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--preserve-user&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;preserveUser&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--export-labels&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;exportLabels&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--dry-run&quot;</span>, <span class="ruby-string">&quot;-n&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;dry_run&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--prepare-p4-only&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;prepare_p4_only&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--conflict&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;conflict_behavior&quot;</span>,
                                 <span class="ruby-identifier">choices</span>=<span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior_choices</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--branch&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;branch&quot;</span>),
    ]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;Submit changes from git to the perforce depot.&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">usage</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot; [name of git branch to submit into perforce depot]&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">origin</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectRenames</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preserveUser</span> = <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.preserveUser&quot;</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dry_run</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prepare_p4_only</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior</span> = <span class="ruby-constant">None</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">isWindows</span> = (<span class="ruby-identifier">platform</span>.<span class="ruby-identifier">system</span>() <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Windows&quot;</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exportLabels</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4HasMoveCommand</span> = <span class="ruby-identifier">p4_has_move_command</span>()
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span> = <span class="ruby-constant">None</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">check</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">p4CmdList</span>(<span class="ruby-string">&quot;opened ...&quot;</span>)) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;You have files opened with perforce! Close them before starting the sync.&quot;</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">separate_jobs_from_description</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">message</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Extract and return a possible Jobs field in the commit
       message.  It goes into a separate section in the p4 change
       specification.

       A jobs line starts with &quot;</span><span class="ruby-constant">Jobs</span><span class="ruby-operator">:</span><span class="ruby-string">&quot; and looks like a new field
       in a form.  Values are white-space separated on the same
       line or on following lines that start with a tab.

       This does not parse and extract the full git commit message
       like a p4 form.  It just sees the Jobs: line as a marker
       to pass everything from then on directly into the p4 form,
       but outside the description section.

       Return a tuple (stripped log message, jobs string).&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-identifier">m</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">r</span><span class="ruby-string">&#39;^Jobs:&#39;</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">re</span>.<span class="ruby-constant">MULTILINE</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> <span class="ruby-identifier">is</span> <span class="ruby-constant">None</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> (<span class="ruby-identifier">message</span>, <span class="ruby-constant">None</span>)

    <span class="ruby-identifier">jobtext</span> = <span class="ruby-identifier">message</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">start</span>()<span class="ruby-operator">:</span>]
    <span class="ruby-identifier">stripped_message</span> = <span class="ruby-identifier">message</span>[:<span class="ruby-identifier">m</span>.<span class="ruby-identifier">start</span>()].<span class="ruby-identifier">rstrip</span>()
    <span class="ruby-keyword">return</span> (<span class="ruby-identifier">stripped_message</span>, <span class="ruby-identifier">jobtext</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">prepareLogMessage</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">template</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">jobs</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Edits the template returned from &quot;</span><span class="ruby-identifier">p4</span> <span class="ruby-identifier">change</span> <span class="ruby-operator">-</span><span class="ruby-identifier">o</span><span class="ruby-string">&quot; to insert
       the message in the Description field, and the jobs text in
       the Jobs field.&quot;</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-identifier">inDescriptionSection</span> = <span class="ruby-constant">False</span>

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-node">&quot;#&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">result</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>
            <span class="ruby-identifier">continue</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">inDescriptionSection</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;Files:&quot;</span>) <span class="ruby-keyword">or</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;Jobs:&quot;</span>)<span class="ruby-operator">:</span>
                <span class="ruby-identifier">inDescriptionSection</span> = <span class="ruby-constant">False</span>
                <span class="ruby-comment"># insert Jobs section</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">jobs</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">result</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">jobs</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>
            <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">continue</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;Description:&quot;</span>)<span class="ruby-operator">:</span>
                <span class="ruby-identifier">inDescriptionSection</span> = <span class="ruby-constant">True</span>
                <span class="ruby-identifier">line</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;\n&quot;</span>
                <span class="ruby-keyword">for</span> <span class="ruby-identifier">messageLine</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)<span class="ruby-operator">:</span>
                    <span class="ruby-identifier">line</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;\t&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">messageLine</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>

        <span class="ruby-identifier">result</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">patchRCSKeywords</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">pattern</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># Attempt to zap the RCS keywords in a p4 controlled file matching the given pattern</span>
    (<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">outFileName</span>) = <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">mkstemp</span>(<span class="ruby-identifier">dir</span>=<span class="ruby-string">&#39;.&#39;</span>)
    <span class="ruby-identifier">try</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">outFile</span> = <span class="ruby-identifier">os</span>.<span class="ruby-identifier">fdopen</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-string">&quot;w+&quot;</span>)
        <span class="ruby-identifier">inFile</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-string">&quot;r&quot;</span>)
        <span class="ruby-identifier">regexp</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">compile</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">re</span>.<span class="ruby-constant">VERBOSE</span>)
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">inFile</span>.<span class="ruby-identifier">readlines</span>()<span class="ruby-operator">:</span>
            <span class="ruby-identifier">line</span> = <span class="ruby-identifier">regexp</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">r</span><span class="ruby-string">&#39;$\1$&#39;</span>, <span class="ruby-identifier">line</span>)
            <span class="ruby-identifier">outFile</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">line</span>)
        <span class="ruby-identifier">inFile</span>.<span class="ruby-identifier">close</span>()
        <span class="ruby-identifier">outFile</span>.<span class="ruby-identifier">close</span>()
        <span class="ruby-comment"># Forcibly overwrite the original file</span>
        <span class="ruby-identifier">os</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">file</span>)
        <span class="ruby-identifier">shutil</span>.<span class="ruby-identifier">move</span>(<span class="ruby-identifier">outFileName</span>, <span class="ruby-identifier">file</span>)
    <span class="ruby-identifier">except</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># cleanup our temporary file</span>
        <span class="ruby-identifier">os</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">outFileName</span>)
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Failed to strip RCS keywords in %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">file</span>
        <span class="ruby-identifier">raise</span>

    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Patched up RCS keywords in %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">file</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">p4UserForCommit</span>(<span class="ruby-keyword">self</span>,<span class="ruby-identifier">id</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># Return the tuple (perforce user,git email) for a given git commit id</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">getUserMapFromPerforceServer</span>()
    <span class="ruby-identifier">gitEmail</span> = <span class="ruby-identifier">read_pipe</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;log&quot;</span>, <span class="ruby-string">&quot;--max-count=1&quot;</span>,
                          <span class="ruby-string">&quot;--format=%ae&quot;</span>, <span class="ruby-identifier">id</span>])
    <span class="ruby-identifier">gitEmail</span> = <span class="ruby-identifier">gitEmail</span>.<span class="ruby-identifier">strip</span>()
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">emails</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-identifier">gitEmail</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> (<span class="ruby-constant">None</span>,<span class="ruby-identifier">gitEmail</span>)
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">emails</span>[<span class="ruby-identifier">gitEmail</span>],<span class="ruby-identifier">gitEmail</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">checkValidP4Users</span>(<span class="ruby-keyword">self</span>,<span class="ruby-identifier">commits</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># check if any git authors cannot be mapped to p4 users</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">id</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">commits</span><span class="ruby-operator">:</span>
        (<span class="ruby-identifier">user</span>,<span class="ruby-identifier">email</span>) = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4UserForCommit</span>(<span class="ruby-identifier">id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">user</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">msg</span> = <span class="ruby-string">&quot;Cannot find p4 user for email %s in commit %s.&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">email</span>, <span class="ruby-identifier">id</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.allowMissingP4Users&quot;</span>)<span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">msg</span>
            <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Error: %s\nSet git-p4.allowMissingP4Users to true to allow this.&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">msg</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">lastP4Changelist</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># Get back the last changelist number submitted in this client spec. This</span>
    <span class="ruby-comment"># then gets used to patch up the username in the change. If the same</span>
    <span class="ruby-comment"># client spec is being used by multiple processes then this might go</span>
    <span class="ruby-comment"># wrong.</span>
    <span class="ruby-identifier">results</span> = <span class="ruby-identifier">p4CmdList</span>(<span class="ruby-string">&quot;client -o&quot;</span>)        <span class="ruby-comment"># find the current client</span>
    <span class="ruby-identifier">client</span> = <span class="ruby-constant">None</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">results</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;Client&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">client</span> = <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;Client&#39;</span>]
            <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">client</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;could not get client spec&quot;</span>)
    <span class="ruby-identifier">results</span> = <span class="ruby-identifier">p4CmdList</span>([<span class="ruby-string">&quot;changes&quot;</span>, <span class="ruby-string">&quot;-c&quot;</span>, <span class="ruby-identifier">client</span>, <span class="ruby-string">&quot;-m&quot;</span>, <span class="ruby-string">&quot;1&quot;</span>])
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">results</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;change&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">return</span> <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;change&#39;</span>]
    <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Could not get changelist number for last submit - cannot patch up user details&quot;</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">modifyChangelistUser</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">changelist</span>, <span class="ruby-identifier">newUser</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># fixup the user field of a changelist after it has been submitted.</span>
    <span class="ruby-identifier">changes</span> = <span class="ruby-identifier">p4CmdList</span>(<span class="ruby-string">&quot;change -o %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">changelist</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">changes</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">1</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Bad output from p4 change modifying %s to user %s&quot;</span> <span class="ruby-operator">%</span>
            (<span class="ruby-identifier">changelist</span>, <span class="ruby-identifier">newUser</span>))

    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">changes</span>[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>[<span class="ruby-string">&#39;User&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">newUser</span><span class="ruby-operator">:</span> <span class="ruby-keyword">return</span>   <span class="ruby-comment"># nothing to do</span>
    <span class="ruby-identifier">c</span>[<span class="ruby-string">&#39;User&#39;</span>] = <span class="ruby-identifier">newUser</span>
    <span class="ruby-identifier">input</span> = <span class="ruby-identifier">marshal</span>.<span class="ruby-identifier">dumps</span>(<span class="ruby-identifier">c</span>)

    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">p4CmdList</span>(<span class="ruby-string">&quot;change -f -i&quot;</span>, <span class="ruby-identifier">stdin</span>=<span class="ruby-identifier">input</span>)
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">result</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;code&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;code&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;error&#39;</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Could not modify user field of changelist %s to %s:%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">changelist</span>, <span class="ruby-identifier">newUser</span>, <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;data&#39;</span>]))
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;data&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span>(<span class="ruby-string">&quot;Updated user field for changelist %s to %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">changelist</span>, <span class="ruby-identifier">newUser</span>))
            <span class="ruby-keyword">return</span>
    <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Could not modify user field of changelist %s to %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">changelist</span>, <span class="ruby-identifier">newUser</span>))

<span class="ruby-keyword">def</span> <span class="ruby-identifier">canChangeChangelists</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># check to see if we have p4 admin or super-user permissions, either of</span>
    <span class="ruby-comment"># which are required to modify changelists.</span>
    <span class="ruby-identifier">results</span> = <span class="ruby-identifier">p4CmdList</span>([<span class="ruby-string">&quot;protects&quot;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPath</span>])
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">results</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;perm&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;perm&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;admin&#39;</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">return</span> <span class="ruby-value">1</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;perm&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;super&#39;</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">return</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">0</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">prepareSubmitTemplate</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Run &quot;</span><span class="ruby-identifier">p4</span> <span class="ruby-identifier">change</span> <span class="ruby-operator">-</span><span class="ruby-identifier">o</span><span class="ruby-string">&quot; to grab a change specification template.
       This does not use &quot;</span><span class="ruby-identifier">p4</span> <span class="ruby-operator">-</span><span class="ruby-constant">G</span><span class="ruby-string">&quot;, as it is nice to keep the submission
       template in original order, since a human might edit it.

       Remove lines in the Files section that show changes to files
       outside the depot path we&#39;re committing into.&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-identifier">template</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">inFilesSection</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">p4_read_pipe_lines</span>([<span class="ruby-string">&#39;change&#39;</span>, <span class="ruby-string">&#39;-o&#39;</span>])<span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">endswith</span>(<span class="ruby-string">&quot;\r\n&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">line</span> = <span class="ruby-identifier">line</span>[:<span class="ruby-value">-2</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">inFilesSection</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;\t&quot;</span>)<span class="ruby-operator">:</span>
                <span class="ruby-comment"># path starts and ends with a tab</span>
                <span class="ruby-identifier">path</span> = <span class="ruby-identifier">line</span>[<span class="ruby-value">1</span><span class="ruby-operator">:</span>]
                <span class="ruby-identifier">lastTab</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">rfind</span>(<span class="ruby-string">&quot;\t&quot;</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">lastTab</span> <span class="ruby-operator">!=</span> <span class="ruby-value">-1</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>[:<span class="ruby-identifier">lastTab</span>]
                    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">path</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPath</span>)<span class="ruby-operator">:</span>
                        <span class="ruby-identifier">continue</span>
            <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">inFilesSection</span> = <span class="ruby-constant">False</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;Files:&quot;</span>)<span class="ruby-operator">:</span>
                <span class="ruby-identifier">inFilesSection</span> = <span class="ruby-constant">True</span>

        <span class="ruby-identifier">template</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">line</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">template</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_template</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">template_file</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Invoke the editor to let the user change the submission
       message.  Return true if okay to continue with the submit.&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-comment"># if configured to skip the editing part, just submit</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.skipSubmitEdit&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>

    <span class="ruby-comment"># look at the modification time, to check later if the user saved</span>
    <span class="ruby-comment"># the file</span>
    <span class="ruby-identifier">mtime</span> = <span class="ruby-identifier">os</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">template_file</span>).<span class="ruby-identifier">st_mtime</span>

    <span class="ruby-comment"># invoke the editor</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">environ</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&quot;P4EDITOR&quot;</span>) <span class="ruby-keyword">and</span> (<span class="ruby-identifier">os</span>.<span class="ruby-identifier">environ</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&quot;P4EDITOR&quot;</span>) <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">editor</span> = <span class="ruby-identifier">os</span>.<span class="ruby-identifier">environ</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&quot;P4EDITOR&quot;</span>)
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">editor</span> = <span class="ruby-identifier">read_pipe</span>(<span class="ruby-string">&quot;git var GIT_EDITOR&quot;</span>).<span class="ruby-identifier">strip</span>()
    <span class="ruby-identifier">system</span>(<span class="ruby-identifier">editor</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">template_file</span>)

    <span class="ruby-comment"># If the file was not saved, prompt to see if this patch should</span>
    <span class="ruby-comment"># be skipped.  But skip this verification step if configured so.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.skipSubmitEditCheck&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>

    <span class="ruby-comment"># modification time updated means user saved the file</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">template_file</span>).<span class="ruby-identifier">st_mtime</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mtime</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>

    <span class="ruby-keyword">while</span> <span class="ruby-constant">True</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">response</span> = <span class="ruby-identifier">raw_input</span>(<span class="ruby-string">&quot;Submit template unchanged. Submit anyway? [y]es, [n]o (skip this patch) &quot;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;y&#39;</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;n&#39;</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">applyCommit</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">id</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Apply one commit, return True if it succeeded.&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Applying&quot;</span>, <span class="ruby-identifier">read_pipe</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;show&quot;</span>, <span class="ruby-string">&quot;-s&quot;</span>,
                                 <span class="ruby-string">&quot;--format=format:%h %s&quot;</span>, <span class="ruby-identifier">id</span>])

    (<span class="ruby-identifier">p4User</span>, <span class="ruby-identifier">gitEmail</span>) = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4UserForCommit</span>(<span class="ruby-identifier">id</span>)

    <span class="ruby-identifier">diff</span> = <span class="ruby-identifier">read_pipe_lines</span>(<span class="ruby-string">&quot;git diff-tree -r %s \&quot;%s^\&quot; \&quot;%s\&quot;&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">diffOpts</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">id</span>))
    <span class="ruby-identifier">filesToAdd</span> = <span class="ruby-identifier">set</span>()
    <span class="ruby-identifier">filesToDelete</span> = <span class="ruby-identifier">set</span>()
    <span class="ruby-identifier">editedFiles</span> = <span class="ruby-identifier">set</span>()
    <span class="ruby-identifier">pureRenameCopy</span> = <span class="ruby-identifier">set</span>()
    <span class="ruby-identifier">filesToChangeExecBit</span> = {}

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">diff</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">diff</span> = <span class="ruby-identifier">parseDiffTreeEntry</span>(<span class="ruby-identifier">line</span>)
        <span class="ruby-identifier">modifier</span> = <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;status&#39;</span>]
        <span class="ruby-identifier">path</span> = <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;src&#39;</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">modifier</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;M&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">p4_edit</span>(<span class="ruby-identifier">path</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">isModeExecChanged</span>(<span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;src_mode&#39;</span>], <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_mode&#39;</span>])<span class="ruby-operator">:</span>
                <span class="ruby-identifier">filesToChangeExecBit</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_mode&#39;</span>]
            <span class="ruby-identifier">editedFiles</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">path</span>)
        <span class="ruby-identifier">elif</span> <span class="ruby-identifier">modifier</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;A&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">filesToAdd</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">path</span>)
            <span class="ruby-identifier">filesToChangeExecBit</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_mode&#39;</span>]
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToDelete</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">filesToDelete</span>.<span class="ruby-identifier">remove</span>(<span class="ruby-identifier">path</span>)
        <span class="ruby-identifier">elif</span> <span class="ruby-identifier">modifier</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;D&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">filesToDelete</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">path</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToAdd</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">filesToAdd</span>.<span class="ruby-identifier">remove</span>(<span class="ruby-identifier">path</span>)
        <span class="ruby-identifier">elif</span> <span class="ruby-identifier">modifier</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;C&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">src</span>, <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;src&#39;</span>], <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst&#39;</span>]
            <span class="ruby-identifier">p4_integrate</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">dest</span>)
            <span class="ruby-identifier">pureRenameCopy</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">dest</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;src_sha1&#39;</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_sha1&#39;</span>]<span class="ruby-operator">:</span>
                <span class="ruby-identifier">p4_edit</span>(<span class="ruby-identifier">dest</span>)
                <span class="ruby-identifier">pureRenameCopy</span>.<span class="ruby-identifier">discard</span>(<span class="ruby-identifier">dest</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">isModeExecChanged</span>(<span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;src_mode&#39;</span>], <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_mode&#39;</span>])<span class="ruby-operator">:</span>
                <span class="ruby-identifier">p4_edit</span>(<span class="ruby-identifier">dest</span>)
                <span class="ruby-identifier">pureRenameCopy</span>.<span class="ruby-identifier">discard</span>(<span class="ruby-identifier">dest</span>)
                <span class="ruby-identifier">filesToChangeExecBit</span>[<span class="ruby-identifier">dest</span>] = <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_mode&#39;</span>]
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">isWindows</span><span class="ruby-operator">:</span>
                <span class="ruby-comment"># turn off read-only attribute</span>
                <span class="ruby-identifier">os</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">dest</span>, <span class="ruby-identifier">stat</span>.<span class="ruby-constant">S_IWRITE</span>)
            <span class="ruby-identifier">os</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">dest</span>)
            <span class="ruby-identifier">editedFiles</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">dest</span>)
        <span class="ruby-identifier">elif</span> <span class="ruby-identifier">modifier</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;R&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">src</span>, <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;src&#39;</span>], <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst&#39;</span>]
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4HasMoveCommand</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">p4_edit</span>(<span class="ruby-identifier">src</span>)        <span class="ruby-comment"># src must be open before move</span>
                <span class="ruby-identifier">p4_move</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">dest</span>)  <span class="ruby-comment"># opens for (move/delete, move/add)</span>
            <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">p4_integrate</span>(<span class="ruby-identifier">src</span>, <span class="ruby-identifier">dest</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;src_sha1&#39;</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_sha1&#39;</span>]<span class="ruby-operator">:</span>
                    <span class="ruby-identifier">p4_edit</span>(<span class="ruby-identifier">dest</span>)
                <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">pureRenameCopy</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">dest</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">isModeExecChanged</span>(<span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;src_mode&#39;</span>], <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_mode&#39;</span>])<span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4HasMoveCommand</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">p4_edit</span>(<span class="ruby-identifier">dest</span>)   <span class="ruby-comment"># with move: already open, writable</span>
                <span class="ruby-identifier">filesToChangeExecBit</span>[<span class="ruby-identifier">dest</span>] = <span class="ruby-identifier">diff</span>[<span class="ruby-string">&#39;dst_mode&#39;</span>]
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4HasMoveCommand</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">isWindows</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">os</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">dest</span>, <span class="ruby-identifier">stat</span>.<span class="ruby-constant">S_IWRITE</span>)
                <span class="ruby-identifier">os</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">dest</span>)
                <span class="ruby-identifier">filesToDelete</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">src</span>)
            <span class="ruby-identifier">editedFiles</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">dest</span>)
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;unknown modifier %s for %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">modifier</span>, <span class="ruby-identifier">path</span>))

    <span class="ruby-identifier">diffcmd</span> = <span class="ruby-string">&quot;git format-patch -k --stdout \&quot;%s^\&quot;..\&quot;%s\&quot;&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">id</span>, <span class="ruby-identifier">id</span>)
    <span class="ruby-identifier">patchcmd</span> = <span class="ruby-identifier">diffcmd</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; | git apply &quot;</span>
    <span class="ruby-identifier">tryPatchCmd</span> = <span class="ruby-identifier">patchcmd</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;--check -&quot;</span>
    <span class="ruby-identifier">applyPatchCmd</span> = <span class="ruby-identifier">patchcmd</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;--check --apply -&quot;</span>
    <span class="ruby-identifier">patch_succeeded</span> = <span class="ruby-constant">True</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">system</span>(<span class="ruby-identifier">tryPatchCmd</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">fixed_rcs_keywords</span> = <span class="ruby-constant">False</span>
        <span class="ruby-identifier">patch_succeeded</span> = <span class="ruby-constant">False</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Unfortunately applying the change failed!&quot;</span>

        <span class="ruby-comment"># Patch failed, maybe it&#39;s just RCS keyword woes. Look through</span>
        <span class="ruby-comment"># the patch to see if that&#39;s possible.</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.attemptRCSCleanup&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">file</span> = <span class="ruby-constant">None</span>
            <span class="ruby-identifier">pattern</span> = <span class="ruby-constant">None</span>
            <span class="ruby-identifier">kwfiles</span> = {}
            <span class="ruby-keyword">for</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">editedFiles</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">filesToDelete</span><span class="ruby-operator">:</span>
                <span class="ruby-comment"># did this file&#39;s delta contain RCS keywords?</span>
                <span class="ruby-identifier">pattern</span> = <span class="ruby-identifier">p4_keywords_regexp_for_file</span>(<span class="ruby-identifier">file</span>)

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">pattern</span><span class="ruby-operator">:</span>
                    <span class="ruby-comment"># this file is a possibility...look for RCS keywords.</span>
                    <span class="ruby-identifier">regexp</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">compile</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">re</span>.<span class="ruby-constant">VERBOSE</span>)
                    <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">read_pipe_lines</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;diff&quot;</span>, <span class="ruby-string">&quot;%s^..%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">id</span>, <span class="ruby-identifier">id</span>), <span class="ruby-identifier">file</span>])<span class="ruby-operator">:</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">regexp</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">line</span>)<span class="ruby-operator">:</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;got keyword match on %s in %s in %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">line</span>, <span class="ruby-identifier">file</span>)
                            <span class="ruby-identifier">kwfiles</span>[<span class="ruby-identifier">file</span>] = <span class="ruby-identifier">pattern</span>
                            <span class="ruby-keyword">break</span>

            <span class="ruby-keyword">for</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">kwfiles</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;zapping %s with %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">line</span>,<span class="ruby-identifier">pattern</span>)
                <span class="ruby-comment"># File is being deleted, so not open in p4.  Must</span>
                <span class="ruby-comment"># disable the read-only bit on windows.</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">isWindows</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">editedFiles</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">os</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">stat</span>.<span class="ruby-constant">S_IWRITE</span>)
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">patchRCSKeywords</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">kwfiles</span>[<span class="ruby-identifier">file</span>])
                <span class="ruby-identifier">fixed_rcs_keywords</span> = <span class="ruby-constant">True</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">fixed_rcs_keywords</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Retrying the patch with RCS keywords cleaned up&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">system</span>(<span class="ruby-identifier">tryPatchCmd</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">patch_succeeded</span> = <span class="ruby-constant">True</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">patch_succeeded</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">editedFiles</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">p4_revert</span>(<span class="ruby-identifier">f</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>

    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># Apply the patch for real, and do add/delete/+x handling.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">system</span>(<span class="ruby-identifier">applyPatchCmd</span>)

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToAdd</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">p4_add</span>(<span class="ruby-identifier">f</span>)
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToDelete</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">p4_revert</span>(<span class="ruby-identifier">f</span>)
        <span class="ruby-identifier">p4_delete</span>(<span class="ruby-identifier">f</span>)

    <span class="ruby-comment"># Set/clear executable bits</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToChangeExecBit</span>.<span class="ruby-identifier">keys</span>()<span class="ruby-operator">:</span>
        <span class="ruby-identifier">mode</span> = <span class="ruby-identifier">filesToChangeExecBit</span>[<span class="ruby-identifier">f</span>]
        <span class="ruby-identifier">setP4ExecBit</span>(<span class="ruby-identifier">f</span>, <span class="ruby-identifier">mode</span>)

    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># Build p4 change description, starting with the contents</span>
    <span class="ruby-comment"># of the git commit message.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">logMessage</span> = <span class="ruby-identifier">extractLogMessageFromGitCommit</span>(<span class="ruby-identifier">id</span>)
    <span class="ruby-identifier">logMessage</span> = <span class="ruby-identifier">logMessage</span>.<span class="ruby-identifier">strip</span>()
    (<span class="ruby-identifier">logMessage</span>, <span class="ruby-identifier">jobs</span>) = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">separate_jobs_from_description</span>(<span class="ruby-identifier">logMessage</span>)

    <span class="ruby-identifier">template</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prepareSubmitTemplate</span>()
    <span class="ruby-identifier">submitTemplate</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prepareLogMessage</span>(<span class="ruby-identifier">template</span>, <span class="ruby-identifier">logMessage</span>, <span class="ruby-identifier">jobs</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preserveUser</span><span class="ruby-operator">:</span>
       <span class="ruby-identifier">submitTemplate</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\n######## Actual user %s, modified after commit\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">p4User</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checkAuthorship</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4UserIsMe</span>(<span class="ruby-identifier">p4User</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">submitTemplate</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;######## git author %s does not match your p4 account.\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">gitEmail</span>
        <span class="ruby-identifier">submitTemplate</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;######## Use option --preserve-user to modify authorship.\n&quot;</span>
        <span class="ruby-identifier">submitTemplate</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;######## Variable git-p4.skipUserNameCheck hides this message.\n&quot;</span>

    <span class="ruby-identifier">separatorLine</span> = <span class="ruby-node">&quot;######## everything below this line is just the diff #######\n&quot;</span>

    <span class="ruby-comment"># diff</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">environ</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&quot;P4DIFF&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">del</span>(<span class="ruby-identifier">os</span>.<span class="ruby-identifier">environ</span>[<span class="ruby-string">&quot;P4DIFF&quot;</span>])
    <span class="ruby-identifier">diff</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">editedFile</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">editedFiles</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">diff</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">p4_read_pipe</span>([<span class="ruby-string">&#39;diff&#39;</span>, <span class="ruby-string">&#39;-du&#39;</span>,
                              <span class="ruby-identifier">wildcard_encode</span>(<span class="ruby-identifier">editedFile</span>)])

    <span class="ruby-comment"># new file diff</span>
    <span class="ruby-identifier">newdiff</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">newFile</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToAdd</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">newdiff</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;==== new file ====\n&quot;</span>
        <span class="ruby-identifier">newdiff</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;--- /dev/null\n&quot;</span>
        <span class="ruby-identifier">newdiff</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;+++ %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">newFile</span>
        <span class="ruby-identifier">f</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">newFile</span>, <span class="ruby-string">&quot;r&quot;</span>)
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">readlines</span>()<span class="ruby-operator">:</span>
            <span class="ruby-identifier">newdiff</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;+&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">line</span>
        <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>()

    <span class="ruby-comment"># change description file: submitTemplate, separatorLine, diff, newdiff</span>
    (<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">fileName</span>) = <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">mkstemp</span>()
    <span class="ruby-identifier">tmpFile</span> = <span class="ruby-identifier">os</span>.<span class="ruby-identifier">fdopen</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-string">&quot;w+&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">isWindows</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">submitTemplate</span> = <span class="ruby-identifier">submitTemplate</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-string">&quot;\n&quot;</span>, <span class="ruby-string">&quot;\r\n&quot;</span>)
        <span class="ruby-identifier">separatorLine</span> = <span class="ruby-identifier">separatorLine</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-string">&quot;\n&quot;</span>, <span class="ruby-string">&quot;\r\n&quot;</span>)
        <span class="ruby-identifier">newdiff</span> = <span class="ruby-identifier">newdiff</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-string">&quot;\n&quot;</span>, <span class="ruby-string">&quot;\r\n&quot;</span>)
    <span class="ruby-identifier">tmpFile</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">submitTemplate</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">separatorLine</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">diff</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">newdiff</span>)
    <span class="ruby-identifier">tmpFile</span>.<span class="ruby-identifier">close</span>()

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prepare_p4_only</span><span class="ruby-operator">:</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment"># Leave the p4 tree prepared, and the submit template around</span>
        <span class="ruby-comment"># and let the user decide what to do next</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-identifier">print</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;P4 workspace prepared for submission.&quot;</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;To submit or revert, go to client workspace&quot;</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;  &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span>
        <span class="ruby-identifier">print</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;To submit, use \&quot;p4 submit\&quot; to write a new description,&quot;</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;or \&quot;p4 submit -i %s\&quot; to use the one prepared by&quot;</span>                <span class="ruby-string">&quot; \&quot;git p4\&quot;.&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fileName</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;You can delete the file \&quot;%s\&quot; when finished.&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fileName</span>

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preserveUser</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">p4User</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4UserIsMe</span>(<span class="ruby-identifier">p4User</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;To preserve change ownership by user %s, you must\n&quot;</span>                    <span class="ruby-string">&quot;do \&quot;p4 change -f &lt;change&gt;\&quot; after submitting and\n&quot;</span>                    <span class="ruby-string">&quot;edit the User field.&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">pureRenameCopy</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;After submitting, renamed files must be re-synced.&quot;</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Invoke \&quot;p4 sync -f\&quot; on each of these files:&quot;</span>
            <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">pureRenameCopy</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;  &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span>

        <span class="ruby-identifier">print</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;To revert the changes, use \&quot;p4 revert ...\&quot;, and delete&quot;</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;the submit template file \&quot;%s\&quot;&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fileName</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">filesToAdd</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Since the commit adds new files, they must be deleted:&quot;</span>
            <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToAdd</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;  &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f</span>
        <span class="ruby-identifier">print</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>

    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># Let the user edit the change description, then submit it.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">edit_template</span>(<span class="ruby-identifier">fileName</span>)<span class="ruby-operator">:</span>
        <span class="ruby-comment"># read the edited message and submit</span>
        <span class="ruby-identifier">ret</span> = <span class="ruby-constant">True</span>
        <span class="ruby-identifier">tmpFile</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">fileName</span>, <span class="ruby-string">&quot;rb&quot;</span>)
        <span class="ruby-identifier">message</span> = <span class="ruby-identifier">tmpFile</span>.<span class="ruby-identifier">read</span>()
        <span class="ruby-identifier">tmpFile</span>.<span class="ruby-identifier">close</span>()
        <span class="ruby-identifier">submitTemplate</span> = <span class="ruby-identifier">message</span>[:<span class="ruby-identifier">message</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">separatorLine</span>)]
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">isWindows</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">submitTemplate</span> = <span class="ruby-identifier">submitTemplate</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-string">&quot;\r\n&quot;</span>, <span class="ruby-string">&quot;\n&quot;</span>)
        <span class="ruby-identifier">p4_write_pipe</span>([<span class="ruby-string">&#39;submit&#39;</span>, <span class="ruby-string">&#39;-i&#39;</span>], <span class="ruby-identifier">submitTemplate</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preserveUser</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4User</span><span class="ruby-operator">:</span>
                <span class="ruby-comment"># Get last changelist number. Cannot easily get it from</span>
                <span class="ruby-comment"># the submit command output as the output is</span>
                <span class="ruby-comment"># unmarshalled.</span>
                <span class="ruby-identifier">changelist</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lastP4Changelist</span>()
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">modifyChangelistUser</span>(<span class="ruby-identifier">changelist</span>, <span class="ruby-identifier">p4User</span>)

        <span class="ruby-comment"># The rename/copy happened by applying a patch that created a</span>
        <span class="ruby-comment"># new file.  This leaves it writable, which confuses p4.</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">pureRenameCopy</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">p4_sync</span>(<span class="ruby-identifier">f</span>, <span class="ruby-string">&quot;-f&quot;</span>)

    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># skip this patch</span>
        <span class="ruby-identifier">ret</span> = <span class="ruby-constant">False</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Submission cancelled, undoing p4 changes.&quot;</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">editedFiles</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">p4_revert</span>(<span class="ruby-identifier">f</span>)
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToAdd</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">p4_revert</span>(<span class="ruby-identifier">f</span>)
            <span class="ruby-identifier">os</span>.<span class="ruby-identifier">remove</span>(<span class="ruby-identifier">f</span>)
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToDelete</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">p4_revert</span>(<span class="ruby-identifier">f</span>)

    <span class="ruby-identifier">os</span>.<span class="ruby-identifier">remove</span>(<span class="ruby-identifier">fileName</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret</span>

<span class="ruby-comment"># Export git tags as p4 labels. Create a p4 label and then tag</span>
<span class="ruby-comment"># with that.</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">exportGitTags</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">gitTags</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">validLabelRegexp</span> = <span class="ruby-identifier">gitConfig</span>(<span class="ruby-string">&quot;git-p4.labelExportRegexp&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">validLabelRegexp</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">validLabelRegexp</span> = <span class="ruby-identifier">defaultLabelRegexp</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">compile</span>(<span class="ruby-identifier">validLabelRegexp</span>)

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">gitTags</span><span class="ruby-operator">:</span>

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">name</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;tag %s does not match regexp %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">name</span>, <span class="ruby-identifier">validLabelRegexp</span>)
            <span class="ruby-identifier">continue</span>

        <span class="ruby-comment"># Get the p4 commit this corresponds to</span>
        <span class="ruby-identifier">logMessage</span> = <span class="ruby-identifier">extractLogMessageFromGitCommit</span>(<span class="ruby-identifier">name</span>)
        <span class="ruby-identifier">values</span> = <span class="ruby-identifier">extractSettingsGitLog</span>(<span class="ruby-identifier">logMessage</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;change&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-comment"># a tag pointing to something not sent to p4; ignore</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;git tag %s does not give a p4 commit&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">name</span>
            <span class="ruby-identifier">continue</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">changelist</span> = <span class="ruby-identifier">values</span>[<span class="ruby-string">&#39;change&#39;</span>]

        <span class="ruby-comment"># Get the tag details.</span>
        <span class="ruby-identifier">inHeader</span> = <span class="ruby-constant">True</span>
        <span class="ruby-identifier">isAnnotated</span> = <span class="ruby-constant">False</span>
        <span class="ruby-identifier">body</span> = []
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">l</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">read_pipe_lines</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;cat-file&quot;</span>, <span class="ruby-string">&quot;-p&quot;</span>, <span class="ruby-identifier">name</span>])<span class="ruby-operator">:</span>
            <span class="ruby-identifier">l</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">strip</span>()
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">inHeader</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">re</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">r</span><span class="ruby-string">&#39;tag\s+&#39;</span>, <span class="ruby-identifier">l</span>)<span class="ruby-operator">:</span>
                    <span class="ruby-identifier">isAnnotated</span> = <span class="ruby-constant">True</span>
                <span class="ruby-identifier">elif</span> <span class="ruby-identifier">re</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">r</span><span class="ruby-string">&#39;\s*$&#39;</span>, <span class="ruby-identifier">l</span>)<span class="ruby-operator">:</span>
                    <span class="ruby-identifier">inHeader</span> = <span class="ruby-constant">False</span>
                    <span class="ruby-identifier">continue</span>
            <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">body</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">l</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">isAnnotated</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">body</span> = [<span class="ruby-string">&quot;lightweight tag imported by git p4\n&quot;</span>]

        <span class="ruby-comment"># Create the label - use the same view as the client spec we are using</span>
        <span class="ruby-identifier">clientSpec</span> = <span class="ruby-identifier">getClientSpec</span>()

        <span class="ruby-identifier">labelTemplate</span>  = <span class="ruby-string">&quot;Label: %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">name</span>
        <span class="ruby-identifier">labelTemplate</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;Description:\n&quot;</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">b</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">body</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">labelTemplate</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;\t&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>
        <span class="ruby-identifier">labelTemplate</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;View:\n&quot;</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">depot_side</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">clientSpec</span>.<span class="ruby-identifier">mappings</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">labelTemplate</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;\t%s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">depot_side</span>

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dry_run</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Would create p4 label %s for tag&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">name</span>
        <span class="ruby-identifier">elif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prepare_p4_only</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Not creating p4 label %s for tag due to option&quot;</span>                    <span class="ruby-string">&quot; --prepare-p4-only&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">name</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">p4_write_pipe</span>([<span class="ruby-string">&quot;label&quot;</span>, <span class="ruby-string">&quot;-i&quot;</span>], <span class="ruby-identifier">labelTemplate</span>)

            <span class="ruby-comment"># Use the label</span>
            <span class="ruby-identifier">p4_system</span>([<span class="ruby-string">&quot;tag&quot;</span>, <span class="ruby-string">&quot;-l&quot;</span>, <span class="ruby-identifier">name</span>] <span class="ruby-operator">+</span>
                      [<span class="ruby-string">&quot;%s@%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">depot_side</span>, <span class="ruby-identifier">changelist</span>) <span class="ruby-keyword">for</span> <span class="ruby-identifier">depot_side</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">clientSpec</span>.<span class="ruby-identifier">mappings</span>])

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;created p4 label for tag %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">name</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">args</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span> = <span class="ruby-identifier">currentGitBranch</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">gitBranchExists</span>(<span class="ruby-string">&quot;refs/heads/%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Detecting current git branch failed!&quot;</span>)
    <span class="ruby-identifier">elif</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">args</span>) <span class="ruby-operator">==</span> <span class="ruby-value">1</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">branchExists</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Branch %s does not exist&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span>)
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>

    <span class="ruby-identifier">allowSubmit</span> = <span class="ruby-identifier">gitConfig</span>(<span class="ruby-string">&quot;git-p4.allowSubmit&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">allowSubmit</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">allowSubmit</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;%s is not in git-p4.allowSubmit&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span>)

    [<span class="ruby-identifier">upstream</span>, <span class="ruby-identifier">settings</span>] = <span class="ruby-identifier">findUpstreamBranchPoint</span>()
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPath</span> = <span class="ruby-identifier">settings</span>[<span class="ruby-string">&#39;depot-paths&#39;</span>][<span class="ruby-value">0</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">origin</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">origin</span> = <span class="ruby-identifier">upstream</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preserveUser</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">canChangeChangelists</span>()<span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Cannot preserve user names without p4 super-user or admin permissions&quot;</span>)

    <span class="ruby-comment"># if not set from the command line, try the config file</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior</span> <span class="ruby-identifier">is</span> <span class="ruby-constant">None</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">val</span> = <span class="ruby-identifier">gitConfig</span>(<span class="ruby-string">&quot;git-p4.conflict&quot;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior_choices</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Invalid value &#39;%s&#39; for config git-p4.conflict&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">val</span>)
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">val</span> = <span class="ruby-string">&quot;ask&quot;</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior</span> = <span class="ruby-identifier">val</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Origin branch is &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">origin</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPath</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Internal error: cannot locate perforce depot path from existing branches&quot;</span>
        <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">exit</span>(<span class="ruby-value">128</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.useclientspec&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span> = <span class="ruby-constant">True</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span> = <span class="ruby-identifier">getClientSpec</span>()

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># all files are relative to the client spec</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span> = <span class="ruby-identifier">getClientRoot</span>()
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span> = <span class="ruby-identifier">p4Where</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPath</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Error: Cannot locate perforce checkout of %s in client view&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPath</span>)

    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Perforce checkout for depot path %s located at %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPath</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">oldWorkingDirectory</span> = <span class="ruby-identifier">os</span>.<span class="ruby-identifier">getcwd</span>()

    <span class="ruby-comment"># ensure the clientPath exists</span>
    <span class="ruby-identifier">new_client_dir</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">exists</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">new_client_dir</span> = <span class="ruby-constant">True</span>
        <span class="ruby-identifier">os</span>.<span class="ruby-identifier">makedirs</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span>)

    <span class="ruby-identifier">chdir</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span>, <span class="ruby-identifier">is_client_path</span>=<span class="ruby-constant">True</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dry_run</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Would synchronize p4 checkout in %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientPath</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Synchronizing p4 checkout...&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_client_dir</span><span class="ruby-operator">:</span>
            <span class="ruby-comment"># old one was destroyed, and maybe nobody told p4</span>
            <span class="ruby-identifier">p4_sync</span>(<span class="ruby-string">&quot;...&quot;</span>, <span class="ruby-string">&quot;-f&quot;</span>)
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">p4_sync</span>(<span class="ruby-string">&quot;...&quot;</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">check</span>()

    <span class="ruby-identifier">commits</span> = []
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">read_pipe_lines</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;rev-list&quot;</span>, <span class="ruby-string">&quot;--no-merges&quot;</span>, <span class="ruby-string">&quot;%s..%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">origin</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">master</span>)])<span class="ruby-operator">:</span>
        <span class="ruby-identifier">commits</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip</span>())
    <span class="ruby-identifier">commits</span>.<span class="ruby-identifier">reverse</span>()

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preserveUser</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.skipUserNameCheck&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checkAuthorship</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checkAuthorship</span> = <span class="ruby-constant">True</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">preserveUser</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checkValidP4Users</span>(<span class="ruby-identifier">commits</span>)

    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># Build up a set of options to be passed to diff when</span>
    <span class="ruby-comment"># submitting each commit to p4.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectRenames</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># command-line -M arg</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">diffOpts</span> = <span class="ruby-string">&quot;-M&quot;</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># If not explicitly set check the config variable</span>
        <span class="ruby-identifier">detectRenames</span> = <span class="ruby-identifier">gitConfig</span>(<span class="ruby-string">&quot;git-p4.detectRenames&quot;</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">detectRenames</span>.<span class="ruby-identifier">lower</span>() <span class="ruby-operator">==</span> <span class="ruby-string">&quot;false&quot;</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">detectRenames</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">diffOpts</span> = <span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">elif</span> <span class="ruby-identifier">detectRenames</span>.<span class="ruby-identifier">lower</span>() <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">diffOpts</span> = <span class="ruby-string">&quot;-M&quot;</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">diffOpts</span> = <span class="ruby-string">&quot;-M%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">detectRenames</span>

    <span class="ruby-comment"># no command-line arg for -C or --find-copies-harder, just</span>
    <span class="ruby-comment"># config variables</span>
    <span class="ruby-identifier">detectCopies</span> = <span class="ruby-identifier">gitConfig</span>(<span class="ruby-string">&quot;git-p4.detectCopies&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">detectCopies</span>.<span class="ruby-identifier">lower</span>() <span class="ruby-operator">==</span> <span class="ruby-string">&quot;false&quot;</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">detectCopies</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">pass</span>
    <span class="ruby-identifier">elif</span> <span class="ruby-identifier">detectCopies</span>.<span class="ruby-identifier">lower</span>() <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">diffOpts</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot; -C&quot;</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">diffOpts</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot; -C%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">detectCopies</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.detectCopiesHarder&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">diffOpts</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot; --find-copies-harder&quot;</span>

    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># Apply the commits, one at a time.  On failure, ask if should</span>
    <span class="ruby-comment"># continue to try the rest of the patches, or quit.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dry_run</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Would apply&quot;</span>
    <span class="ruby-identifier">applied</span> = []
    <span class="ruby-identifier">last</span> = <span class="ruby-identifier">len</span>(<span class="ruby-identifier">commits</span>) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">i</span>, <span class="ruby-identifier">commit</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">enumerate</span>(<span class="ruby-identifier">commits</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dry_run</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; &quot;</span>, <span class="ruby-identifier">read_pipe</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;show&quot;</span>, <span class="ruby-string">&quot;-s&quot;</span>,
                                  <span class="ruby-string">&quot;--format=format:%h %s&quot;</span>, <span class="ruby-identifier">commit</span>])
            <span class="ruby-identifier">ok</span> = <span class="ruby-constant">True</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">ok</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">applyCommit</span>(<span class="ruby-identifier">commit</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">ok</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">applied</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">commit</span>)
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prepare_p4_only</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">last</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Processing only the first commit due to option&quot;</span>                        <span class="ruby-string">&quot; --prepare-p4-only&quot;</span>
                <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">last</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">quit</span> = <span class="ruby-constant">False</span>
                <span class="ruby-keyword">while</span> <span class="ruby-constant">True</span><span class="ruby-operator">:</span>
                    <span class="ruby-comment"># prompt for what to do, or use the option/variable</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;ask&quot;</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;What do you want to do?&quot;</span>
                        <span class="ruby-identifier">response</span> = <span class="ruby-identifier">raw_input</span>(<span class="ruby-string">&quot;[s]kip this commit but apply&quot;</span>
                                             <span class="ruby-string">&quot; the rest, or [q]uit? &quot;</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">response</span><span class="ruby-operator">:</span>
                            <span class="ruby-identifier">continue</span>
                    <span class="ruby-identifier">elif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;skip&quot;</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">response</span> = <span class="ruby-string">&quot;s&quot;</span>
                    <span class="ruby-identifier">elif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;quit&quot;</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">response</span> = <span class="ruby-string">&quot;q&quot;</span>
                    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Unknown conflict_behavior &#39;%s&#39;&quot;</span> <span class="ruby-operator">%</span>
                            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">conflict_behavior</span>)

                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;s&quot;</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Skipping this commit, but applying the rest&quot;</span>
                        <span class="ruby-keyword">break</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;q&quot;</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Quitting&quot;</span>
                        <span class="ruby-identifier">quit</span> = <span class="ruby-constant">True</span>
                        <span class="ruby-keyword">break</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">quit</span><span class="ruby-operator">:</span>
                    <span class="ruby-keyword">break</span>

    <span class="ruby-identifier">chdir</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">oldWorkingDirectory</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dry_run</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">pass</span>
    <span class="ruby-identifier">elif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">prepare_p4_only</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">pass</span>
    <span class="ruby-identifier">elif</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">commits</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">applied</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;All commits applied!&quot;</span>

        <span class="ruby-identifier">sync</span> = <span class="ruby-constant">P4Sync</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">sync</span>.<span class="ruby-identifier">branch</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>
        <span class="ruby-identifier">sync</span>.<span class="ruby-identifier">run</span>([])

        <span class="ruby-identifier">rebase</span> = <span class="ruby-constant">P4Rebase</span>()
        <span class="ruby-identifier">rebase</span>.<span class="ruby-identifier">rebase</span>()

    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">applied</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;No commits applied.&quot;</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Applied only the commits marked with &#39;*&#39;:&quot;</span>
            <span class="ruby-keyword">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">commits</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">applied</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">star</span> = <span class="ruby-string">&quot;*&quot;</span>
                <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">star</span> = <span class="ruby-string">&quot; &quot;</span>
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">star</span>, <span class="ruby-identifier">read_pipe</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;show&quot;</span>, <span class="ruby-string">&quot;-s&quot;</span>,
                                       <span class="ruby-string">&quot;--format=format:%h %s&quot;</span>,  <span class="ruby-identifier">c</span>])
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;You will have to do &#39;git p4 sync&#39; and rebase.&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.exportLabels&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exportLabels</span> = <span class="ruby-constant">True</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exportLabels</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">p4Labels</span> = <span class="ruby-identifier">getP4Labels</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPath</span>)
        <span class="ruby-identifier">gitTags</span> = <span class="ruby-identifier">getGitTags</span>()

        <span class="ruby-identifier">missingGitTags</span> = <span class="ruby-identifier">gitTags</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">p4Labels</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">exportGitTags</span>(<span class="ruby-identifier">missingGitTags</span>)

    <span class="ruby-comment"># exit with error unless everything applied perfectly</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">commits</span>) <span class="ruby-operator">!=</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">applied</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)

    <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>
</pre>

<p>class View(object):</p>

<pre class="ruby"><span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Represent a p4 view (&quot;</span><span class="ruby-identifier">p4</span> <span class="ruby-identifier">help</span> <span class="ruby-identifier">views</span><span class="ruby-string">&quot;), and map files in a
   repo according to the view.&quot;</span><span class="ruby-string">&quot;&quot;</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">client_name</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">mappings</span> = []
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_prefix</span> = <span class="ruby-string">&quot;//%s/&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">client_name</span>
    <span class="ruby-comment"># cache results of &quot;p4 where&quot; to lookup client file locations</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_spec_path_cache</span> = {}

<span class="ruby-keyword">def</span> <span class="ruby-identifier">append</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">view_line</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Parse a view line, splitting it into depot and client
       sides.  Append to self.mappings, preserving order.  This
       is only needed for tag creation.&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-comment"># Split the view line into exactly two words.  P4 enforces</span>
    <span class="ruby-comment"># structure on these lines that simplifies this quite a bit.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># Either or both words may be double-quoted.</span>
    <span class="ruby-comment"># Single quotes do not matter.</span>
    <span class="ruby-comment"># Double-quote marks cannot occur inside the words.</span>
    <span class="ruby-comment"># A + or - prefix is also inside the quotes.</span>
    <span class="ruby-comment"># There are no quotes unless they contain a space.</span>
    <span class="ruby-comment"># The line is already white-space stripped.</span>
    <span class="ruby-comment"># The two words are separated by a single space.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">view_line</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&quot;&#39;</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># First word is double quoted.  Find its end.</span>
        <span class="ruby-identifier">close_quote_index</span> = <span class="ruby-identifier">view_line</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&#39;&quot;&#39;</span>, <span class="ruby-value">1</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">close_quote_index</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;No first-word closing quote found: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">view_line</span>)
        <span class="ruby-identifier">depot_side</span> = <span class="ruby-identifier">view_line</span>[<span class="ruby-value">1</span><span class="ruby-operator">:</span><span class="ruby-identifier">close_quote_index</span>]
        <span class="ruby-comment"># skip closing quote and space</span>
        <span class="ruby-identifier">rhs_index</span> = <span class="ruby-identifier">close_quote_index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">space_index</span> = <span class="ruby-identifier">view_line</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&quot; &quot;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">space_index</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;No word-splitting space found: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">view_line</span>)
        <span class="ruby-identifier">depot_side</span> = <span class="ruby-identifier">view_line</span>[<span class="ruby-value">0</span><span class="ruby-operator">:</span><span class="ruby-identifier">space_index</span>]
        <span class="ruby-identifier">rhs_index</span> = <span class="ruby-identifier">space_index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

    <span class="ruby-comment"># prefix + means overlay on previous mapping</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">depot_side</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;+&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">depot_side</span> = <span class="ruby-identifier">depot_side</span>[<span class="ruby-value">1</span><span class="ruby-operator">:</span>]

    <span class="ruby-comment"># prefix - means exclude this path, leave out of mappings</span>
    <span class="ruby-identifier">exclude</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">depot_side</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;-&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">exclude</span> = <span class="ruby-constant">True</span>
        <span class="ruby-identifier">depot_side</span> = <span class="ruby-identifier">depot_side</span>[<span class="ruby-value">1</span><span class="ruby-operator">:</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">exclude</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">mappings</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">depot_side</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">convert_client_path</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">clientFile</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># chop off //client/ part to make it relative</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">clientFile</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_prefix</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;No prefix &#39;%s&#39; on clientFile &#39;%s&#39;&quot;</span> <span class="ruby-operator">%</span>
            (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_prefix</span>, <span class="ruby-identifier">clientFile</span>))
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">clientFile</span>[<span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_prefix</span>)<span class="ruby-operator">:</span>]

<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_client_spec_path_cache</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">files</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot; Caching file paths by &quot;</span><span class="ruby-identifier">p4</span> <span class="ruby-identifier">where</span><span class="ruby-string">&quot; batch query &quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-comment"># List depot file paths exclude that already cached</span>
    <span class="ruby-identifier">fileArgs</span> = [<span class="ruby-identifier">f</span>[<span class="ruby-string">&#39;path&#39;</span>] <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">files</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">f</span>[<span class="ruby-string">&#39;path&#39;</span>] <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_spec_path_cache</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">fileArgs</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span>  <span class="ruby-comment"># All files in cache</span>

    <span class="ruby-identifier">where_result</span> = <span class="ruby-identifier">p4CmdList</span>([<span class="ruby-string">&quot;-x&quot;</span>, <span class="ruby-string">&quot;-&quot;</span>, <span class="ruby-string">&quot;where&quot;</span>], <span class="ruby-identifier">stdin</span>=<span class="ruby-identifier">fileArgs</span>)
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">where_result</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;code&quot;</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">res</span>[<span class="ruby-string">&quot;code&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;error&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-comment"># assume error is &quot;... file(s) not in client view&quot;</span>
            <span class="ruby-identifier">continue</span>
        <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;clientFile&quot;</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">res</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;No clientFile from &#39;p4 where %s&#39;&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">depot_path</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;unmap&quot;</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">res</span><span class="ruby-operator">:</span>
            <span class="ruby-comment"># it will list all of them, but only one not unmap-ped</span>
            <span class="ruby-identifier">continue</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_spec_path_cache</span>[<span class="ruby-identifier">res</span>[<span class="ruby-string">&#39;depotFile&#39;</span>]] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">convert_client_path</span>(<span class="ruby-identifier">res</span>[<span class="ruby-string">&quot;clientFile&quot;</span>])

    <span class="ruby-comment"># not found files or unmap files set to &quot;&quot;</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">depotFile</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">fileArgs</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">depotFile</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_spec_path_cache</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_spec_path_cache</span>[<span class="ruby-identifier">depotFile</span>] = <span class="ruby-string">&quot;&quot;</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">map_in_client</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">depot_path</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Return the relative location in the client where this
       depot file should live.  Returns &quot;</span><span class="ruby-string">&quot; if the file should
       not be mapped in the client.&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">depot_path</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_spec_path_cache</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_spec_path_cache</span>[<span class="ruby-identifier">depot_path</span>]

    <span class="ruby-identifier">die</span>( <span class="ruby-string">&quot;Error: %s is not found in client spec path&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">depot_path</span> )
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
</pre>

<p>class P4Sync(Command, P4UserMap):</p>

<pre class="ruby"><span class="ruby-identifier">delete_actions</span> = ( <span class="ruby-string">&quot;delete&quot;</span>, <span class="ruby-string">&quot;move/delete&quot;</span>, <span class="ruby-string">&quot;purge&quot;</span> )

<span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-constant">Command</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-constant">P4UserMap</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> = [
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--branch&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;branch&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--detect-branches&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;detectBranches&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--changesfile&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;changesFile&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--silent&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;silent&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--detect-labels&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;detectLabels&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--import-labels&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;importLabels&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--import-local&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;importIntoRemotes&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_false&quot;</span>,
                                 <span class="ruby-identifier">help</span>=<span class="ruby-string">&quot;Import into refs/heads/ , not refs/remotes&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--max-changes&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;maxChanges&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--keep-path&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;keepRepoPath&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&#39;store_true&#39;</span>,
                                 <span class="ruby-identifier">help</span>=<span class="ruby-string">&quot;Keep entire BRANCH/DIR/SUBDIR prefix during import&quot;</span>),
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--use-client-spec&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;useClientSpec&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&#39;store_true&#39;</span>,
                                 <span class="ruby-identifier">help</span>=<span class="ruby-string">&quot;Only sync files that are included in the Perforce Client Spec&quot;</span>)
    ]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Imports from Perforce into a git repository.\n
example:
//depot/my/project/ -- to import the current head
//depot/my/project/@all -- to import everything
//depot/my/project/@1,6 -- to import only from revision 1 to 6

(a ... is not needed in the path p4 specification, it&#39;s added implicitly)&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">usage</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot; //depot/path[@revRange]&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">createdBranches</span> = <span class="ruby-identifier">set</span>()
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">committedChanges</span> = <span class="ruby-identifier">set</span>()
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectLabels</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importLabels</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changesFile</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">syncWithOrigin</span> = <span class="ruby-constant">True</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importIntoRemotes</span> = <span class="ruby-constant">True</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">maxChanges</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">keepRepoPath</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span> = <span class="ruby-constant">None</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span> = []
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneExclude</span> = []
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec_from_options</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span> = <span class="ruby-constant">None</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tempBranches</span> = []
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tempBranchLocation</span> = <span class="ruby-string">&quot;git-p4-tmp&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfig</span>(<span class="ruby-string">&quot;git-p4.syncFromOrigin&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-string">&quot;false&quot;</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">syncWithOrigin</span> = <span class="ruby-constant">False</span>

<span class="ruby-comment"># Force a checkpoint in fast-import and wait for it to finish</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">checkpoint</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;checkpoint\n\n&quot;</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;progress checkpoint\n\n&quot;</span>)
    <span class="ruby-identifier">out</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitOutput</span>.<span class="ruby-identifier">readline</span>()
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;checkpoint finished: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">out</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">extractFilesFromCommit</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">commit</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneExclude</span> = [<span class="ruby-identifier">re</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">r</span><span class="ruby-string">&quot;\.\.\.$&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">path</span>)
                         <span class="ruby-keyword">for</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneExclude</span>]
    <span class="ruby-identifier">files</span> = []
    <span class="ruby-identifier">fnum</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">while</span> <span class="ruby-identifier">commit</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&quot;depotFile%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">path</span> =  <span class="ruby-identifier">commit</span>[<span class="ruby-string">&quot;depotFile%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>]

        <span class="ruby-keyword">if</span> [<span class="ruby-identifier">p</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneExclude</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">p</span>)]<span class="ruby-operator">:</span>
            <span class="ruby-identifier">found</span> = <span class="ruby-constant">False</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">found</span> = [<span class="ruby-identifier">p</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>
                     <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">p</span>)]
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">found</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">fnum</span> = <span class="ruby-identifier">fnum</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
            <span class="ruby-identifier">continue</span>

        <span class="ruby-identifier">file</span> = {}
        <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;path&quot;</span>] = <span class="ruby-identifier">path</span>
        <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;rev&quot;</span>] = <span class="ruby-identifier">commit</span>[<span class="ruby-string">&quot;rev%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>]
        <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;action&quot;</span>] = <span class="ruby-identifier">commit</span>[<span class="ruby-string">&quot;action%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>]
        <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;type&quot;</span>] = <span class="ruby-identifier">commit</span>[<span class="ruby-string">&quot;type%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>]
        <span class="ruby-identifier">files</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">file</span>)
        <span class="ruby-identifier">fnum</span> = <span class="ruby-identifier">fnum</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">files</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">stripRepoPath</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">prefixes</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;When streaming files, this is called to map a p4 depot path
       to where it should go in git.  The prefixes are either
       self.depotPaths, or self.branchPrefixes in the case of
       branch detection.&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># branch detection moves files up a level (the branch name)</span>
        <span class="ruby-comment"># from what client spec interpretation gives</span>
        <span class="ruby-identifier">path</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span>.<span class="ruby-identifier">map_in_client</span>(<span class="ruby-identifier">path</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">for</span> <span class="ruby-identifier">b</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-identifier">b</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span>)<span class="ruby-operator">:</span>
                    <span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>[<span class="ruby-identifier">len</span>(<span class="ruby-identifier">b</span>)<span class="ruby-operator">+</span><span class="ruby-value">1</span><span class="ruby-operator">:</span>]

    <span class="ruby-identifier">elif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">keepRepoPath</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># Preserve everything in relative path name except leading</span>
        <span class="ruby-comment"># //depot/; just look at first prefix as they all should</span>
        <span class="ruby-comment"># be in the same depot.</span>
        <span class="ruby-identifier">depot</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-string">&quot;^(//[^/]+/).*&quot;</span>, <span class="ruby-identifier">r</span><span class="ruby-string">&#39;\1&#39;</span>, <span class="ruby-identifier">prefixes</span>[<span class="ruby-value">0</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">depot</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>[<span class="ruby-identifier">len</span>(<span class="ruby-identifier">depot</span>)<span class="ruby-operator">:</span>]

    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">prefixes</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">p</span>)<span class="ruby-operator">:</span>
                <span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>[<span class="ruby-identifier">len</span>(<span class="ruby-identifier">p</span>)<span class="ruby-operator">:</span>]
                <span class="ruby-keyword">break</span>

    <span class="ruby-identifier">path</span> = <span class="ruby-identifier">wildcard_decode</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">path</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">splitFilesIntoBranches</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">commit</span>)<span class="ruby-operator">:</span>
    <span class="ruby-string">&quot;&quot;</span><span class="ruby-string">&quot;Look at each depotFile in the commit to figure out to what
       branch it belongs.&quot;</span><span class="ruby-string">&quot;&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">files</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extractFilesFromCommit</span>(<span class="ruby-identifier">commit</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span>.<span class="ruby-identifier">update_client_spec_path_cache</span>(<span class="ruby-identifier">files</span>)

    <span class="ruby-identifier">branches</span> = {}
    <span class="ruby-identifier">fnum</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">while</span> <span class="ruby-identifier">commit</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&quot;depotFile%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">path</span> =  <span class="ruby-identifier">commit</span>[<span class="ruby-string">&quot;depotFile%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>]
        <span class="ruby-identifier">found</span> = [<span class="ruby-identifier">p</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>
                 <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">p</span>)]
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">found</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">fnum</span> = <span class="ruby-identifier">fnum</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
            <span class="ruby-identifier">continue</span>

        <span class="ruby-identifier">file</span> = {}
        <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;path&quot;</span>] = <span class="ruby-identifier">path</span>
        <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;rev&quot;</span>] = <span class="ruby-identifier">commit</span>[<span class="ruby-string">&quot;rev%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>]
        <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;action&quot;</span>] = <span class="ruby-identifier">commit</span>[<span class="ruby-string">&quot;action%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>]
        <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;type&quot;</span>] = <span class="ruby-identifier">commit</span>[<span class="ruby-string">&quot;type%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fnum</span>]
        <span class="ruby-identifier">fnum</span> = <span class="ruby-identifier">fnum</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

        <span class="ruby-comment"># start with the full relative path where this file would</span>
        <span class="ruby-comment"># go in a p4 client</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">relPath</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span>.<span class="ruby-identifier">map_in_client</span>(<span class="ruby-identifier">path</span>)
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">relPath</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stripRepoPath</span>(<span class="ruby-identifier">path</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>)

        <span class="ruby-keyword">for</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span>.<span class="ruby-identifier">keys</span>()<span class="ruby-operator">:</span>
            <span class="ruby-comment"># add a trailing slash so that a commit into qt/4.2foo</span>
            <span class="ruby-comment"># doesn&#39;t end up in qt/4.2, e.g.</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">relPath</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-identifier">branch</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span>)<span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">branches</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">branches</span>[<span class="ruby-identifier">branch</span>] = []
                <span class="ruby-identifier">branches</span>[<span class="ruby-identifier">branch</span>].<span class="ruby-identifier">append</span>(<span class="ruby-identifier">file</span>)
                <span class="ruby-keyword">break</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">branches</span>

<span class="ruby-comment"># output one file from the P4 stream</span>
<span class="ruby-comment"># - helper for streamP4Files</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">streamOneP4File</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">contents</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">relPath</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stripRepoPath</span>(<span class="ruby-identifier">file</span>[<span class="ruby-string">&#39;depotFile&#39;</span>], <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branchPrefixes</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;%s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">relPath</span>)

    (<span class="ruby-identifier">type_base</span>, <span class="ruby-identifier">type_mods</span>) = <span class="ruby-identifier">split_p4_type</span>(<span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;type&quot;</span>])

    <span class="ruby-identifier">git_mode</span> = <span class="ruby-string">&quot;100644&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;x&quot;</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">type_mods</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">git_mode</span> = <span class="ruby-string">&quot;100755&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">type_base</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;symlink&quot;</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">git_mode</span> = <span class="ruby-string">&quot;120000&quot;</span>
        <span class="ruby-comment"># p4 print on a symlink sometimes contains &quot;target\n&quot;;</span>
        <span class="ruby-comment"># if it does, remove the newline</span>
        <span class="ruby-identifier">data</span> = <span class="ruby-string">&#39;&#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">contents</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;\n&#39;</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">contents</span> = [<span class="ruby-identifier">data</span>[:<span class="ruby-value">-1</span>]]
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">contents</span> = [<span class="ruby-identifier">data</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">type_base</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;utf16&quot;</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># p4 delivers different text in the python output to -G</span>
        <span class="ruby-comment"># than it does when using &quot;print -o&quot;, or normal p4 client</span>
        <span class="ruby-comment"># operations.  utf16 is converted to ascii or utf8, perhaps.</span>
        <span class="ruby-comment"># But ascii text saved as -t utf16 is completely mangled.</span>
        <span class="ruby-comment"># Invoke print -o to get the real contents.</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment"># On windows, the newlines will always be mangled by print, so put</span>
        <span class="ruby-comment"># them back too.  This is not needed to the cygwin windows version,</span>
        <span class="ruby-comment"># just the native &quot;NT&quot; type.</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-identifier">text</span> = <span class="ruby-identifier">p4_read_pipe</span>([<span class="ruby-string">&#39;print&#39;</span>, <span class="ruby-string">&#39;-q&#39;</span>, <span class="ruby-string">&#39;-o&#39;</span>, <span class="ruby-string">&#39;-&#39;</span>, <span class="ruby-identifier">file</span>[<span class="ruby-string">&#39;depotFile&#39;</span>]])
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4_version_string</span>().<span class="ruby-identifier">find</span>(<span class="ruby-string">&quot;/NT&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-string">&quot;\r\n&quot;</span>, <span class="ruby-string">&quot;\n&quot;</span>)
        <span class="ruby-identifier">contents</span> = [ <span class="ruby-identifier">text</span> ]

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">type_base</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;apple&quot;</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># Apple filetype files will be streamed as a concatenation of</span>
        <span class="ruby-comment"># its appledouble header and the contents.  This is useless</span>
        <span class="ruby-comment"># on both macs and non-macs.  If using &quot;print -q -o xx&quot;, it</span>
        <span class="ruby-comment"># will create &quot;xx&quot; with the data, and &quot;%xx&quot; with the header.</span>
        <span class="ruby-comment"># This is also not very useful.</span>
        <span class="ruby-comment">#</span>
        <span class="ruby-comment"># Ideally, someday, this script can learn how to generate</span>
        <span class="ruby-comment"># appledouble files directly and import those to git, but</span>
        <span class="ruby-comment"># non-mac machines can never find a use for apple filetype.</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;\nIgnoring apple filetype file %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">file</span>[<span class="ruby-string">&#39;depotFile&#39;</span>]
        <span class="ruby-keyword">return</span>

    <span class="ruby-comment"># Note that we do not try to de-mangle keywords on utf16 files,</span>
    <span class="ruby-comment"># even though in theory somebody may want that.</span>
    <span class="ruby-identifier">pattern</span> = <span class="ruby-identifier">p4_keywords_regexp_for_type</span>(<span class="ruby-identifier">type_base</span>, <span class="ruby-identifier">type_mods</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">pattern</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">regexp</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">compile</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">re</span>.<span class="ruby-constant">VERBOSE</span>)
        <span class="ruby-identifier">text</span> = <span class="ruby-string">&#39;&#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">contents</span>)
        <span class="ruby-identifier">text</span> = <span class="ruby-identifier">regexp</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">r</span><span class="ruby-string">&#39;$\1$&#39;</span>, <span class="ruby-identifier">text</span>)
        <span class="ruby-identifier">contents</span> = [ <span class="ruby-identifier">text</span> ]

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;M %s inline %s\n&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">git_mode</span>, <span class="ruby-identifier">relPath</span>))

    <span class="ruby-comment"># total length...</span>
    <span class="ruby-identifier">length</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">d</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">contents</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">length</span> = <span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">d</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;data %d\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">length</span>)
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">d</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">contents</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">d</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;\n&quot;</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">streamOneP4Deletion</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">file</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">relPath</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stripRepoPath</span>(<span class="ruby-identifier">file</span>[<span class="ruby-string">&#39;path&#39;</span>], <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branchPrefixes</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;delete %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">relPath</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;D %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">relPath</span>)

<span class="ruby-comment"># handle another chunk of streaming data</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">streamP4FilesCb</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">marshalled</span>)<span class="ruby-operator">:</span>

    <span class="ruby-comment"># catch p4 errors and complain</span>
    <span class="ruby-identifier">err</span> = <span class="ruby-constant">None</span>
    <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;code&quot;</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">marshalled</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">marshalled</span>[<span class="ruby-string">&quot;code&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;error&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;data&quot;</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">marshalled</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">err</span> = <span class="ruby-identifier">marshalled</span>[<span class="ruby-string">&quot;data&quot;</span>].<span class="ruby-identifier">rstrip</span>()
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">err</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">f</span> = <span class="ruby-constant">None</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_have_file_info</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-string">&quot;depotFile&quot;</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_file</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">f</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_file</span>[<span class="ruby-string">&quot;depotFile&quot;</span>]
        <span class="ruby-comment"># force a failure in fast-import, else an empty</span>
        <span class="ruby-comment"># commit will be made</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;\n&quot;</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;die-now\n&quot;</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">close</span>()
        <span class="ruby-comment"># ignore errors, but make sure it exits first</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importProcess</span>.<span class="ruby-identifier">wait</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">f</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Error from p4 print for %s: %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">f</span>, <span class="ruby-identifier">err</span>))
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Error from p4 print: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">err</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">marshalled</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;depotFile&#39;</span>) <span class="ruby-keyword">and</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_have_file_info</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># start of a new file - output the old one first</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">streamOneP4File</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_file</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_contents</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_file</span> = {}
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_contents</span> = []
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_have_file_info</span> = <span class="ruby-constant">False</span>

    <span class="ruby-comment"># pick up the new file information... for the</span>
    <span class="ruby-comment"># &#39;data&#39; field we need to append to our array</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">k</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">marshalled</span>.<span class="ruby-identifier">keys</span>()<span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;data&#39;</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_contents</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">marshalled</span>[<span class="ruby-string">&#39;data&#39;</span>])
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_file</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">marshalled</span>[<span class="ruby-identifier">k</span>]

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_have_file_info</span> = <span class="ruby-constant">True</span>

<span class="ruby-comment"># Stream directly from &quot;p4 files&quot; into &quot;git fast-import&quot;</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">streamP4Files</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">files</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">filesForCommit</span> = []
    <span class="ruby-identifier">filesToRead</span> = []
    <span class="ruby-identifier">filesToDelete</span> = []

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">files</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># if using a client spec, only add the files that have</span>
        <span class="ruby-comment"># a path in the client</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span>.<span class="ruby-identifier">map_in_client</span>(<span class="ruby-identifier">f</span>[<span class="ruby-string">&#39;path&#39;</span>]) <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">continue</span>

        <span class="ruby-identifier">filesForCommit</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">f</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">f</span>[<span class="ruby-string">&#39;action&#39;</span>] <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">delete_actions</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">filesToDelete</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">f</span>)
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">filesToRead</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">f</span>)

    <span class="ruby-comment"># deleted files...</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToDelete</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">streamOneP4Deletion</span>(<span class="ruby-identifier">f</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">filesToRead</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_file</span> = {}
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_contents</span> = []
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_have_file_info</span> = <span class="ruby-constant">False</span>

        <span class="ruby-comment"># curry self argument</span>
        <span class="ruby-keyword">def</span> <span class="ruby-identifier">streamP4FilesCbSelf</span>(<span class="ruby-identifier">entry</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">streamP4FilesCb</span>(<span class="ruby-identifier">entry</span>)

        <span class="ruby-identifier">fileArgs</span> = [<span class="ruby-string">&#39;%s#%s&#39;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">f</span>[<span class="ruby-string">&#39;path&#39;</span>], <span class="ruby-identifier">f</span>[<span class="ruby-string">&#39;rev&#39;</span>]) <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">filesToRead</span>]

        <span class="ruby-identifier">p4CmdList</span>([<span class="ruby-string">&quot;-x&quot;</span>, <span class="ruby-string">&quot;-&quot;</span>, <span class="ruby-string">&quot;print&quot;</span>],
                  <span class="ruby-identifier">stdin</span>=<span class="ruby-identifier">fileArgs</span>,
                  <span class="ruby-identifier">cb</span>=<span class="ruby-identifier">streamP4FilesCbSelf</span>)

        <span class="ruby-comment"># do the last chunk</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_file</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;depotFile&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">streamOneP4File</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_file</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stream_contents</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_email</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">userid</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">userid</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span>[<span class="ruby-identifier">userid</span>]
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;%s &lt;a@b&gt;&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">userid</span>

<span class="ruby-comment"># Stream a p4 tag</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">streamTag</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">gitStream</span>, <span class="ruby-identifier">labelName</span>, <span class="ruby-identifier">labelDetails</span>, <span class="ruby-identifier">commit</span>, <span class="ruby-identifier">epoch</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;writing tag %s for commit %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">labelName</span>, <span class="ruby-identifier">commit</span>)
    <span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;tag %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">labelName</span>)
    <span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;from %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">commit</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">labelDetails</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;Owner&#39;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">owner</span> = <span class="ruby-identifier">labelDetails</span>[<span class="ruby-string">&quot;Owner&quot;</span>]
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">owner</span> = <span class="ruby-constant">None</span>

    <span class="ruby-comment"># Try to use the owner of the p4 label, or failing that,</span>
    <span class="ruby-comment"># the current p4 user id.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">owner</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">email</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">make_email</span>(<span class="ruby-identifier">owner</span>)
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">email</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">make_email</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4UserId</span>())
    <span class="ruby-identifier">tagger</span> = <span class="ruby-string">&quot;%s %s %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">email</span>, <span class="ruby-identifier">epoch</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tz</span>)

    <span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;tagger %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">tagger</span>)

    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;labelDetails=&quot;</span>,<span class="ruby-identifier">labelDetails</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">labelDetails</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;Description&#39;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">description</span> = <span class="ruby-identifier">labelDetails</span>[<span class="ruby-string">&#39;Description&#39;</span>]
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">description</span> = <span class="ruby-string">&#39;Label from git p4&#39;</span>

    <span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;data %d\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">description</span>))
    <span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">description</span>)
    <span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;\n&quot;</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">commit</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">details</span>, <span class="ruby-identifier">files</span>, <span class="ruby-identifier">branch</span>, <span class="ruby-identifier">parent</span> = <span class="ruby-string">&quot;&quot;</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">epoch</span> = <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;time&quot;</span>]
    <span class="ruby-identifier">author</span> = <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;user&quot;</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;commit into %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">branch</span>

    <span class="ruby-comment"># start with reading files; if that fails, we should not</span>
    <span class="ruby-comment"># create a commit.</span>
    <span class="ruby-identifier">new_files</span> = []
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">files</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> [<span class="ruby-identifier">p</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branchPrefixes</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">f</span>[<span class="ruby-string">&#39;path&#39;</span>], <span class="ruby-identifier">p</span>)]<span class="ruby-operator">:</span>
            <span class="ruby-identifier">new_files</span>.<span class="ruby-identifier">append</span> (<span class="ruby-identifier">f</span>)
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;Ignoring file outside of prefix: %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">f</span>[<span class="ruby-string">&#39;path&#39;</span>])

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span>.<span class="ruby-identifier">update_client_spec_path_cache</span>(<span class="ruby-identifier">files</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;commit %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">branch</span>)
</pre>

<p>#        gitStream.write(mark :%sn % <a href=""change"">details</a>)</p>

<pre class="ruby">    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">committedChanges</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">int</span>(<span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;change&quot;</span>]))
    <span class="ruby-identifier">committer</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">author</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">getUserMapFromPerforceServer</span>()
    <span class="ruby-identifier">committer</span> = <span class="ruby-string">&quot;%s %s %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">make_email</span>(<span class="ruby-identifier">author</span>), <span class="ruby-identifier">epoch</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tz</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;committer %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">committer</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;data &lt;&lt;EOT\n&quot;</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;desc&quot;</span>])
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;\n[git-p4: depot-paths = \&quot;%s\&quot;: change = %s&quot;</span> <span class="ruby-operator">%</span>
                         (<span class="ruby-string">&#39;,&#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">branchPrefixes</span>), <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;change&quot;</span>]))
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">details</span>[<span class="ruby-string">&#39;options&#39;</span>]) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;: options = %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">details</span>[<span class="ruby-string">&#39;options&#39;</span>])
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;]\nEOT\n\n&quot;</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">parent</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;parent %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">parent</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;from %s\n&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">parent</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">streamP4Files</span>(<span class="ruby-identifier">new_files</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;\n&quot;</span>)

    <span class="ruby-identifier">change</span> = <span class="ruby-identifier">int</span>(<span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;change&quot;</span>])

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">labels</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-identifier">change</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">label</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">labels</span>[<span class="ruby-identifier">change</span>]
        <span class="ruby-identifier">labelDetails</span> = <span class="ruby-identifier">label</span>[<span class="ruby-value">0</span>]
        <span class="ruby-identifier">labelRevisions</span> = <span class="ruby-identifier">label</span>[<span class="ruby-value">1</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Change %s is labelled %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">change</span>, <span class="ruby-identifier">labelDetails</span>)

        <span class="ruby-identifier">files</span> = <span class="ruby-identifier">p4CmdList</span>([<span class="ruby-string">&quot;files&quot;</span>] <span class="ruby-operator">+</span> [<span class="ruby-string">&quot;%s...@%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">p</span>, <span class="ruby-identifier">change</span>)
                                            <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branchPrefixes</span>])

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">files</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">labelRevisions</span>)<span class="ruby-operator">:</span>

            <span class="ruby-identifier">cleanedFiles</span> = {}
            <span class="ruby-keyword">for</span> <span class="ruby-identifier">info</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">files</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">info</span>[<span class="ruby-string">&quot;action&quot;</span>] <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">delete_actions</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">continue</span>
                <span class="ruby-identifier">cleanedFiles</span>[<span class="ruby-identifier">info</span>[<span class="ruby-string">&quot;depotFile&quot;</span>]] = <span class="ruby-identifier">info</span>[<span class="ruby-string">&quot;rev&quot;</span>]

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">cleanedFiles</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">labelRevisions</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">streamTag</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>, <span class="ruby-string">&#39;tag_%s&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">labelDetails</span>[<span class="ruby-string">&#39;label&#39;</span>], <span class="ruby-identifier">labelDetails</span>, <span class="ruby-identifier">branch</span>, <span class="ruby-identifier">epoch</span>)

            <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">print</span> (<span class="ruby-string">&quot;Tag %s does not match with change %s: files do not match.&quot;</span>
                           <span class="ruby-string">%Q(labelDetails[&quot;label&quot;], </span><span class="ruby-identifier">change</span>))

        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> (<span class="ruby-string">&quot;Tag %s does not match with change %s: file count is different.&quot;</span>
                       <span class="ruby-string">%Q(labelDetails[&quot;label&quot;], </span><span class="ruby-identifier">change</span>))

<span class="ruby-comment"># Build a dictionary of changelists and labels, for &quot;detect-labels&quot; option.</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getLabels</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">labels</span> = {}

    <span class="ruby-identifier">l</span> = <span class="ruby-identifier">p4CmdList</span>([<span class="ruby-string">&quot;labels&quot;</span>] <span class="ruby-operator">+</span> [<span class="ruby-string">&quot;%s...&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">l</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Finding files belonging to labels in %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-value">%xself.depotPaths`</span>

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">output</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">l</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">label</span> = <span class="ruby-identifier">output</span>[<span class="ruby-string">&quot;label&quot;</span>]
        <span class="ruby-identifier">revisions</span> = {}
        <span class="ruby-identifier">newestChange</span> = <span class="ruby-value">0</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Querying files for label %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">label</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">p4CmdList</span>([<span class="ruby-string">&quot;files&quot;</span>] <span class="ruby-operator">+</span>
                                  [<span class="ruby-string">&quot;%s...@%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">p</span>, <span class="ruby-identifier">label</span>)
                                      <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>])<span class="ruby-operator">:</span>
            <span class="ruby-identifier">revisions</span>[<span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;depotFile&quot;</span>]] = <span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;rev&quot;</span>]
            <span class="ruby-identifier">change</span> = <span class="ruby-identifier">int</span>(<span class="ruby-identifier">file</span>[<span class="ruby-string">&quot;change&quot;</span>])
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">change</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">newestChange</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">newestChange</span> = <span class="ruby-identifier">change</span>

        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">labels</span>[<span class="ruby-identifier">newestChange</span>] = [<span class="ruby-identifier">output</span>, <span class="ruby-identifier">revisions</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Label changes: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">labels</span>.<span class="ruby-identifier">keys</span>()

<span class="ruby-comment"># Import p4 labels as git tags. A direct mapping does not</span>
<span class="ruby-comment"># exist, so assume that if all the files are at the same revision</span>
<span class="ruby-comment"># then we can use that, or it&#39;s something more complicated we should</span>
<span class="ruby-comment"># just ignore.</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">importP4Labels</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">stream</span>, <span class="ruby-identifier">p4Labels</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;import p4 labels: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; &#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">p4Labels</span>)

    <span class="ruby-identifier">ignoredP4Labels</span> = <span class="ruby-identifier">gitConfigList</span>(<span class="ruby-string">&quot;git-p4.ignoredP4Labels&quot;</span>)
    <span class="ruby-identifier">validLabelRegexp</span> = <span class="ruby-identifier">gitConfig</span>(<span class="ruby-string">&quot;git-p4.labelImportRegexp&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">validLabelRegexp</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">validLabelRegexp</span> = <span class="ruby-identifier">defaultLabelRegexp</span>
    <span class="ruby-identifier">m</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">compile</span>(<span class="ruby-identifier">validLabelRegexp</span>)

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">p4Labels</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">commitFound</span> = <span class="ruby-constant">False</span>

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">name</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;label %s does not match regexp %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">name</span>,<span class="ruby-identifier">validLabelRegexp</span>)
            <span class="ruby-identifier">continue</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">ignoredP4Labels</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">continue</span>

        <span class="ruby-identifier">labelDetails</span> = <span class="ruby-identifier">p4CmdList</span>([<span class="ruby-string">&#39;label&#39;</span>, <span class="ruby-string">&quot;-o&quot;</span>, <span class="ruby-identifier">name</span>])[<span class="ruby-value">0</span>]

        <span class="ruby-comment"># get the most recent changelist for each file in this label</span>
        <span class="ruby-identifier">change</span> = <span class="ruby-identifier">p4Cmd</span>([<span class="ruby-string">&quot;changes&quot;</span>, <span class="ruby-string">&quot;-m&quot;</span>, <span class="ruby-string">&quot;1&quot;</span>] <span class="ruby-operator">+</span> [<span class="ruby-string">&quot;%s...@%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">p</span>, <span class="ruby-identifier">name</span>)
                            <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>])

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">change</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;change&#39;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-comment"># find the corresponding git commit; take the oldest commit</span>
            <span class="ruby-identifier">changelist</span> = <span class="ruby-identifier">int</span>(<span class="ruby-identifier">change</span>[<span class="ruby-string">&#39;change&#39;</span>])
            <span class="ruby-identifier">gitCommit</span> = <span class="ruby-identifier">read_pipe</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;rev-list&quot;</span>, <span class="ruby-string">&quot;--max-count=1&quot;</span>,
                 <span class="ruby-string">&quot;--reverse&quot;</span>, <span class="ruby-string">&quot;:/\[git-p4:.*change = %d\]&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">changelist</span>])
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">gitCommit</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;could not find git commit for changelist %d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">changelist</span>
            <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">gitCommit</span> = <span class="ruby-identifier">gitCommit</span>.<span class="ruby-identifier">strip</span>()
                <span class="ruby-identifier">commitFound</span> = <span class="ruby-constant">True</span>
                <span class="ruby-comment"># Convert from p4 time format</span>
                <span class="ruby-identifier">try</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">tmwhen</span> = <span class="ruby-identifier">time</span>.<span class="ruby-identifier">strptime</span>(<span class="ruby-identifier">labelDetails</span>[<span class="ruby-string">&#39;Update&#39;</span>], <span class="ruby-string">&quot;%Y/%m/%d %H:%M:%S&quot;</span>)
                <span class="ruby-identifier">except</span> <span class="ruby-constant">ValueError</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Could not convert label time %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">labelDetails</span>[<span class="ruby-string">&#39;Update&#39;</span>]
                    <span class="ruby-identifier">tmwhen</span> = <span class="ruby-value">1</span>

                <span class="ruby-keyword">when</span> = <span class="ruby-identifier">int</span>(<span class="ruby-identifier">time</span>.<span class="ruby-identifier">mktime</span>(<span class="ruby-identifier">tmwhen</span>))
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">streamTag</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">labelDetails</span>, <span class="ruby-identifier">gitCommit</span>, <span class="ruby-keyword">when</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;p4 label %s mapped to git commit %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">name</span>, <span class="ruby-identifier">gitCommit</span>)
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Label %s has no changelists - possibly deleted?&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">name</span>

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">commitFound</span><span class="ruby-operator">:</span>
            <span class="ruby-comment"># We can&#39;t import this label; don&#39;t try again as it will get very</span>
            <span class="ruby-comment"># expensive repeatedly fetching all the files for labels that will</span>
            <span class="ruby-comment"># never be imported. If the label is moved in the future, the</span>
            <span class="ruby-comment"># ignore will need to be removed manually.</span>
            <span class="ruby-identifier">system</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;config&quot;</span>, <span class="ruby-string">&quot;--add&quot;</span>, <span class="ruby-string">&quot;git-p4.ignoredP4Labels&quot;</span>, <span class="ruby-identifier">name</span>])

<span class="ruby-keyword">def</span> <span class="ruby-identifier">guessProjectName</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">endswith</span>(<span class="ruby-string">&quot;/&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">p</span> = <span class="ruby-identifier">p</span>[:<span class="ruby-value">-1</span>]
        <span class="ruby-identifier">p</span> = <span class="ruby-identifier">p</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">strip</span>().<span class="ruby-identifier">rfind</span>(<span class="ruby-string">&quot;/&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-value">1</span><span class="ruby-operator">:</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">endswith</span>(<span class="ruby-string">&quot;/&quot;</span>)<span class="ruby-operator">:</span>
           <span class="ruby-identifier">p</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;/&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">p</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">getBranchMapping</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">lostAndFoundBranches</span> = <span class="ruby-identifier">set</span>()

    <span class="ruby-identifier">user</span> = <span class="ruby-identifier">gitConfig</span>(<span class="ruby-string">&quot;git-p4.branchUser&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">user</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">command</span> = <span class="ruby-string">&quot;branches -u %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">user</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">command</span> = <span class="ruby-string">&quot;branches&quot;</span>

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">info</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">p4CmdList</span>(<span class="ruby-identifier">command</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">details</span> = <span class="ruby-identifier">p4Cmd</span>([<span class="ruby-string">&quot;branch&quot;</span>, <span class="ruby-string">&quot;-o&quot;</span>, <span class="ruby-identifier">info</span>[<span class="ruby-string">&quot;branch&quot;</span>]])
        <span class="ruby-identifier">viewIdx</span> = <span class="ruby-value">0</span>
        <span class="ruby-keyword">while</span> <span class="ruby-identifier">details</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&quot;View%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">viewIdx</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">paths</span> = <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;View%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">viewIdx</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot; &quot;</span>)
            <span class="ruby-identifier">viewIdx</span> = <span class="ruby-identifier">viewIdx</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
            <span class="ruby-comment"># require standard //depot/foo/... //depot/bar/... mapping</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">paths</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">2</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">paths</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">endswith</span>(<span class="ruby-string">&quot;/...&quot;</span>) <span class="ruby-keyword">or</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">paths</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">endswith</span>(<span class="ruby-string">&quot;/...&quot;</span>)<span class="ruby-operator">:</span>
                <span class="ruby-identifier">continue</span>
            <span class="ruby-identifier">source</span> = <span class="ruby-identifier">paths</span>[<span class="ruby-value">0</span>]
            <span class="ruby-identifier">destination</span> = <span class="ruby-identifier">paths</span>[<span class="ruby-value">1</span>]
            <span class="ruby-comment">## HACK</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">source</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>[<span class="ruby-value">0</span>]) <span class="ruby-keyword">and</span> <span class="ruby-identifier">p4PathStartsWith</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>[<span class="ruby-value">0</span>])<span class="ruby-operator">:</span>
                <span class="ruby-identifier">source</span> = <span class="ruby-identifier">source</span>[<span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>[<span class="ruby-value">0</span>])<span class="ruby-operator">:</span><span class="ruby-value">-4</span>]
                <span class="ruby-identifier">destination</span> = <span class="ruby-identifier">destination</span>[<span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>[<span class="ruby-value">0</span>])<span class="ruby-operator">:</span><span class="ruby-value">-4</span>]

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">destination</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span><span class="ruby-operator">:</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;p4 branch %s defines a mapping from %s to %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">info</span>[<span class="ruby-string">&quot;branch&quot;</span>], <span class="ruby-identifier">source</span>, <span class="ruby-identifier">destination</span>)
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;but there exists another mapping from %s to %s already!&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span>[<span class="ruby-identifier">destination</span>], <span class="ruby-identifier">destination</span>)
                    <span class="ruby-identifier">continue</span>

                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span>[<span class="ruby-identifier">destination</span>] = <span class="ruby-identifier">source</span>

                <span class="ruby-identifier">lostAndFoundBranches</span>.<span class="ruby-identifier">discard</span>(<span class="ruby-identifier">destination</span>)

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">lostAndFoundBranches</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">source</span>)

    <span class="ruby-comment"># Perforce does not strictly require branches to be defined, so we also</span>
    <span class="ruby-comment"># check git config for a branch list.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># Example of branch definition in git config file:</span>
    <span class="ruby-comment"># [git-p4]</span>
    <span class="ruby-comment">#   branchList=main:branchA</span>
    <span class="ruby-comment">#   branchList=main:branchB</span>
    <span class="ruby-comment">#   branchList=branchA:branchC</span>
    <span class="ruby-identifier">configBranches</span> = <span class="ruby-identifier">gitConfigList</span>(<span class="ruby-string">&quot;git-p4.branchList&quot;</span>)
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">configBranches</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">branch</span><span class="ruby-operator">:</span>
            (<span class="ruby-identifier">source</span>, <span class="ruby-identifier">destination</span>) = <span class="ruby-identifier">branch</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;:&quot;</span>)
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span>[<span class="ruby-identifier">destination</span>] = <span class="ruby-identifier">source</span>

            <span class="ruby-identifier">lostAndFoundBranches</span>.<span class="ruby-identifier">discard</span>(<span class="ruby-identifier">destination</span>)

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">lostAndFoundBranches</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">source</span>)

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">lostAndFoundBranches</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span>[<span class="ruby-identifier">branch</span>] = <span class="ruby-identifier">branch</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">getBranchMappingFromGitBranches</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">branches</span> = <span class="ruby-identifier">p4BranchesInGit</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">importIntoRemotes</span>)
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">branches</span>.<span class="ruby-identifier">keys</span>()<span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">branch</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;master&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">branch</span> = <span class="ruby-string">&quot;main&quot;</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">branch</span> = <span class="ruby-identifier">branch</span>[<span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">projectName</span>)<span class="ruby-operator">:</span>]
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span>[<span class="ruby-identifier">branch</span>] = <span class="ruby-identifier">branch</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">updateOptionDict</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">d</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">option_keys</span> = {}
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">keepRepoPath</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">option_keys</span>[<span class="ruby-string">&#39;keepRepoPath&#39;</span>] = <span class="ruby-value">1</span>

    <span class="ruby-identifier">d</span>[<span class="ruby-string">&quot;options&quot;</span>] = <span class="ruby-string">&#39; &#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">sorted</span>(<span class="ruby-identifier">option_keys</span>.<span class="ruby-identifier">keys</span>()))

<span class="ruby-keyword">def</span> <span class="ruby-identifier">readOptions</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">d</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">keepRepoPath</span> = (<span class="ruby-identifier">d</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;options&#39;</span>)
                         <span class="ruby-keyword">and</span> (<span class="ruby-string">&#39;keepRepoPath&#39;</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">d</span>[<span class="ruby-string">&#39;options&#39;</span>]))

<span class="ruby-keyword">def</span> <span class="ruby-identifier">gitRefForBranch</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">branch</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">branch</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;main&quot;</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;master&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">branch</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">branch</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">projectName</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">branch</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">gitCommitByP4Change</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">ref</span>, <span class="ruby-identifier">change</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;looking in ref &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ref</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; for change %s using bisect...&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">change</span>

    <span class="ruby-identifier">earliestCommit</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">latestCommit</span> = <span class="ruby-identifier">parseRevision</span>(<span class="ruby-identifier">ref</span>)

    <span class="ruby-keyword">while</span> <span class="ruby-constant">True</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;trying: earliest %s latest %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">earliestCommit</span>, <span class="ruby-identifier">latestCommit</span>)
        <span class="ruby-keyword">next</span> = <span class="ruby-identifier">read_pipe</span>(<span class="ruby-string">&quot;git rev-list --bisect %s %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">latestCommit</span>, <span class="ruby-identifier">earliestCommit</span>)).<span class="ruby-identifier">strip</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">next</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;argh&quot;</span>
            <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">log</span> = <span class="ruby-identifier">extractLogMessageFromGitCommit</span>(<span class="ruby-keyword">next</span>)
        <span class="ruby-identifier">settings</span> = <span class="ruby-identifier">extractSettingsGitLog</span>(<span class="ruby-identifier">log</span>)
        <span class="ruby-identifier">currentChange</span> = <span class="ruby-identifier">int</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-string">&#39;change&#39;</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;current change %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">currentChange</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">currentChange</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">change</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;found %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">next</span>
            <span class="ruby-keyword">return</span> <span class="ruby-keyword">next</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">currentChange</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">change</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">earliestCommit</span> = <span class="ruby-string">&quot;^%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">latestCommit</span> = <span class="ruby-string">&quot;%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">next</span>

    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">importNewBranch</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">branch</span>, <span class="ruby-identifier">maxChange</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment"># make fast-import flush all changes to disk and update the refs using the checkpoint</span>
    <span class="ruby-comment"># command so that we can try to find the branch parent in the git history</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;checkpoint\n\n&quot;</span>);
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">flush</span>();
    <span class="ruby-identifier">branchPrefix</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">branch</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span>
    <span class="ruby-identifier">range</span> = <span class="ruby-string">&quot;@1,%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">maxChange</span>
    <span class="ruby-comment">#print &quot;prefix&quot; + branchPrefix</span>
    <span class="ruby-identifier">changes</span> = <span class="ruby-identifier">p4ChangesForPaths</span>([<span class="ruby-identifier">branchPrefix</span>], <span class="ruby-identifier">range</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">changes</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>
    <span class="ruby-identifier">firstChange</span> = <span class="ruby-identifier">changes</span>[<span class="ruby-value">0</span>]
    <span class="ruby-comment">#print &quot;first change in branch: %s&quot; % firstChange</span>
    <span class="ruby-identifier">sourceBranch</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span>[<span class="ruby-identifier">branch</span>]
    <span class="ruby-identifier">sourceDepotPath</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">sourceBranch</span>
    <span class="ruby-identifier">sourceRef</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitRefForBranch</span>(<span class="ruby-identifier">sourceBranch</span>)
    <span class="ruby-comment">#print &quot;source &quot; + sourceBranch</span>

    <span class="ruby-identifier">branchParentChange</span> = <span class="ruby-identifier">int</span>(<span class="ruby-identifier">p4Cmd</span>([<span class="ruby-string">&quot;changes&quot;</span>, <span class="ruby-string">&quot;-m&quot;</span>, <span class="ruby-string">&quot;1&quot;</span>, <span class="ruby-string">&quot;%s...@1,%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">sourceDepotPath</span>, <span class="ruby-identifier">firstChange</span>)])[<span class="ruby-string">&quot;change&quot;</span>])
    <span class="ruby-comment">#print &quot;branch parent: %s&quot; % branchParentChange</span>
    <span class="ruby-identifier">gitParent</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitCommitByP4Change</span>(<span class="ruby-identifier">sourceRef</span>, <span class="ruby-identifier">branchParentChange</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">gitParent</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParents</span>[<span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitRefForBranch</span>(<span class="ruby-identifier">branch</span>)] = <span class="ruby-identifier">gitParent</span>
        <span class="ruby-comment">#print &quot;parent git commit: %s&quot; % gitParent</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importChanges</span>(<span class="ruby-identifier">changes</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">searchParent</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">parent</span>, <span class="ruby-identifier">branch</span>, <span class="ruby-identifier">target</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">parentFound</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">blob</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">read_pipe_lines</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;rev-list&quot;</span>, <span class="ruby-string">&quot;--reverse&quot;</span>,
                                 <span class="ruby-string">&quot;--no-merges&quot;</span>, <span class="ruby-identifier">parent</span>])<span class="ruby-operator">:</span>
        <span class="ruby-identifier">blob</span> = <span class="ruby-identifier">blob</span>.<span class="ruby-identifier">strip</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">read_pipe</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;diff-tree&quot;</span>, <span class="ruby-identifier">blob</span>, <span class="ruby-identifier">target</span>])) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">parentFound</span> = <span class="ruby-constant">True</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Found parent of %s in commit %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">branch</span>, <span class="ruby-identifier">blob</span>)
            <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">parentFound</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">blob</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">None</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">importChanges</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">changes</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">cnt</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">change</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">changes</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">description</span> = <span class="ruby-identifier">p4_describe</span>(<span class="ruby-identifier">change</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updateOptionDict</span>(<span class="ruby-identifier">description</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;\rImporting revision %s (%s%%)&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">change</span>, <span class="ruby-identifier">cnt</span> <span class="ruby-operator">*</span> <span class="ruby-value">100</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">changes</span>)))
            <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">flush</span>()
        <span class="ruby-identifier">cnt</span> = <span class="ruby-identifier">cnt</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

        <span class="ruby-identifier">try</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">branches</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">splitFilesIntoBranches</span>(<span class="ruby-identifier">description</span>)
                <span class="ruby-keyword">for</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">branches</span>.<span class="ruby-identifier">keys</span>()<span class="ruby-operator">:</span>
                    <span class="ruby-comment">## HACK  --hwn</span>
                    <span class="ruby-identifier">branchPrefix</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">branch</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span>
                    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branchPrefixes</span> = [ <span class="ruby-identifier">branchPrefix</span> ]

                    <span class="ruby-identifier">parent</span> = <span class="ruby-string">&quot;&quot;</span>

                    <span class="ruby-identifier">filesForCommit</span> = <span class="ruby-identifier">branches</span>[<span class="ruby-identifier">branch</span>]

                    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;branch is %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">branch</span>

                    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updatedBranches</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">branch</span>)

                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">createdBranches</span><span class="ruby-operator">:</span>
                        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">createdBranches</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">branch</span>)
                        <span class="ruby-identifier">parent</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span>[<span class="ruby-identifier">branch</span>]
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">branch</span><span class="ruby-operator">:</span>
                            <span class="ruby-identifier">parent</span> = <span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                            <span class="ruby-identifier">fullBranch</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">projectName</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">branch</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-identifier">fullBranch</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span><span class="ruby-operator">:</span>
                                <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                                    <span class="ruby-identifier">print</span>(<span class="ruby-string">&quot;\n    Importing new branch %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fullBranch</span>);
                                <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importNewBranch</span>(<span class="ruby-identifier">branch</span>, <span class="ruby-identifier">change</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)<span class="ruby-operator">:</span>
                                    <span class="ruby-identifier">parent</span> = <span class="ruby-string">&quot;&quot;</span>
                                    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">fullBranch</span>)
                                <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                                    <span class="ruby-identifier">print</span>(<span class="ruby-string">&quot;\n    Resuming with change %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">change</span>);

                            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;parent determined through known branches: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">parent</span>

                    <span class="ruby-identifier">branch</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitRefForBranch</span>(<span class="ruby-identifier">branch</span>)
                    <span class="ruby-identifier">parent</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitRefForBranch</span>(<span class="ruby-identifier">parent</span>)

                    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;looking for initial parent for %s; current parent is %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">branch</span>, <span class="ruby-identifier">parent</span>)

                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">parent</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParents</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">parent</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParents</span>[<span class="ruby-identifier">branch</span>]
                        <span class="ruby-identifier">del</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParents</span>[<span class="ruby-identifier">branch</span>]

                    <span class="ruby-identifier">blob</span> = <span class="ruby-constant">None</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">parent</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">tempBranch</span> = <span class="ruby-string">&quot;%s/%d&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">tempBranchLocation</span>, <span class="ruby-identifier">change</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Creating temporary branch: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tempBranch</span>
                        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">commit</span>(<span class="ruby-identifier">description</span>, <span class="ruby-identifier">filesForCommit</span>, <span class="ruby-identifier">tempBranch</span>)
                        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tempBranches</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">tempBranch</span>)
                        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">checkpoint</span>()
                        <span class="ruby-identifier">blob</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">searchParent</span>(<span class="ruby-identifier">parent</span>, <span class="ruby-identifier">branch</span>, <span class="ruby-identifier">tempBranch</span>)
                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">blob</span><span class="ruby-operator">:</span>
                        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">commit</span>(<span class="ruby-identifier">description</span>, <span class="ruby-identifier">filesForCommit</span>, <span class="ruby-identifier">branch</span>, <span class="ruby-identifier">blob</span>)
                    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Parent of %s not found. Committing into head of %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">branch</span>, <span class="ruby-identifier">parent</span>)
                        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">commit</span>(<span class="ruby-identifier">description</span>, <span class="ruby-identifier">filesForCommit</span>, <span class="ruby-identifier">branch</span>, <span class="ruby-identifier">parent</span>)
            <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">files</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extractFilesFromCommit</span>(<span class="ruby-identifier">description</span>)
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">commit</span>(<span class="ruby-identifier">description</span>, <span class="ruby-identifier">files</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>,
                            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParent</span>)
                <span class="ruby-comment"># only needed once, to connect to the previous commit</span>
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParent</span> = <span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">except</span> <span class="ruby-constant">IOError</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitError</span>.<span class="ruby-identifier">read</span>()
            <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">importHeadRevision</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">revision</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Doing initial import of %s from revision %s into %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-string">&#39; &#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>), <span class="ruby-identifier">revision</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)

    <span class="ruby-identifier">details</span> = {}
    <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;user&quot;</span>] = <span class="ruby-string">&quot;git perforce import user&quot;</span>
    <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;desc&quot;</span>] = (<span class="ruby-string">&quot;Initial import of %s from the state at revision %s\n&quot;</span>
                       <span class="ruby-string">%Q(&#39; </span><span class="ruby-string">&#39;.join(self.depotPaths), revision))
    details[&quot;change&quot;] = revision
    newestRevision = 0

    fileCnt = 0
    fileArgs = [&quot;%s...%s&quot; % (p,revision) for p in self.depotPaths]

    for info in p4CmdList([&quot;files&quot;] + fileArgs):

        if &#39;</span><span class="ruby-identifier">code</span><span class="ruby-string">&#39; in info and info[&#39;</span><span class="ruby-identifier">code</span><span class="ruby-string">&#39;] == &#39;</span><span class="ruby-identifier">error</span><span class="ruby-string">&#39;:
            sys.stderr.write(&quot;p4 returned an error: %s\n&quot;
                             % info[&#39;</span><span class="ruby-identifier">data</span><span class="ruby-string">&#39;])
            if info[&#39;</span><span class="ruby-identifier">data</span><span class="ruby-string">&#39;].find(&quot;must refer to client&quot;) &gt;= 0:
                sys.stderr.write(&quot;This particular p4 error is misleading.\n&quot;)
                sys.stderr.write(&quot;Perhaps the depot path was misspelled.\n&quot;);
                sys.stderr.write(&quot;Depot path:  %s\n&quot; % &quot; &quot;.join(self.depotPaths))
            sys.exit(1)
        if &#39;</span><span class="ruby-identifier">p4ExitCode</span><span class="ruby-string">&#39; in info:
            sys.stderr.write(&quot;p4 exitcode: %s\n&quot; % info[&#39;</span><span class="ruby-identifier">p4ExitCode</span><span class="ruby-string">&#39;])
            sys.exit(1)

        change = int(info[&quot;change&quot;])
        if change &gt; newestRevision:
            newestRevision = change

        if info[&quot;action&quot;] in self.delete_actions:
            # don&#39;</span><span class="ruby-identifier">t</span> <span class="ruby-identifier">increase</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">file</span> <span class="ruby-identifier">cnt</span>, <span class="ruby-identifier">otherwise</span> <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;depotFile123&quot;</span>] <span class="ruby-identifier">will</span> <span class="ruby-identifier">have</span> <span class="ruby-identifier">gaps!</span>
            <span class="ruby-comment">#fileCnt = fileCnt + 1</span>
            <span class="ruby-identifier">continue</span>

        <span class="ruby-keyword">for</span> <span class="ruby-identifier">prop</span> <span class="ruby-keyword">in</span> [<span class="ruby-string">&quot;depotFile&quot;</span>, <span class="ruby-string">&quot;rev&quot;</span>, <span class="ruby-string">&quot;action&quot;</span>, <span class="ruby-string">&quot;type&quot;</span> ]<span class="ruby-operator">:</span>
            <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;%s%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">prop</span>, <span class="ruby-identifier">fileCnt</span>)] = <span class="ruby-identifier">info</span>[<span class="ruby-identifier">prop</span>]

        <span class="ruby-identifier">fileCnt</span> = <span class="ruby-identifier">fileCnt</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

    <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;change&quot;</span>] = <span class="ruby-identifier">newestRevision</span>

    <span class="ruby-comment"># Use time from top-most change so that all git p4 clones of</span>
    <span class="ruby-comment"># the same p4 repo have the same commit SHA1s.</span>
    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">p4_describe</span>(<span class="ruby-identifier">newestRevision</span>)
    <span class="ruby-identifier">details</span>[<span class="ruby-string">&quot;time&quot;</span>] = <span class="ruby-identifier">res</span>[<span class="ruby-string">&quot;time&quot;</span>]

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updateOptionDict</span>(<span class="ruby-identifier">details</span>)
    <span class="ruby-identifier">try</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">commit</span>(<span class="ruby-identifier">details</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extractFilesFromCommit</span>(<span class="ruby-identifier">details</span>), <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)
    <span class="ruby-identifier">except</span> <span class="ruby-constant">IOError</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;IO error with git fast-import. Is your git version recent enough?&quot;</span>
        <span class="ruby-identifier">print</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitError</span>.<span class="ruby-identifier">read</span>()

<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span> = []
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">previousDepotPaths</span> = []
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">hasOrigin</span> = <span class="ruby-constant">False</span>

    <span class="ruby-comment"># map from branch depot path to parent branch</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">knownBranches</span> = {}
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParents</span> = {}

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importIntoRemotes</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span> = <span class="ruby-string">&quot;refs/remotes/p4/&quot;</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span> = <span class="ruby-string">&quot;refs/heads/p4/&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">syncWithOrigin</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">hasOrigin</span> = <span class="ruby-identifier">originP4BranchesExist</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">hasOrigin</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&#39;Syncing with origin first, using &quot;git fetch origin&quot;&#39;</span>
            <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git fetch origin&quot;</span>)

    <span class="ruby-identifier">branch_arg_given</span> = <span class="ruby-identifier">bool</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;master&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitBranchExists</span>(<span class="ruby-string">&quot;refs/heads/p4&quot;</span>) <span class="ruby-keyword">and</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importIntoRemotes</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git update-ref %s refs/heads/p4&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)
            <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git branch -D p4&quot;</span>)

    <span class="ruby-comment"># accept either the command-line option, or the configuration variable</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span><span class="ruby-operator">:</span>
        <span class="ruby-comment"># will use this after clone to set the variable</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec_from_options</span> = <span class="ruby-constant">True</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.useclientspec&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span> = <span class="ruby-constant">True</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clientSpecDirs</span> = <span class="ruby-identifier">getClientSpec</span>()

    <span class="ruby-comment"># TODO: should always look at previous commits,</span>
    <span class="ruby-comment"># merge with previous imports, if possible.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span> <span class="ruby-operator">==</span> []<span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">hasOrigin</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">createOrUpdateBranchesFromOrigin</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span>)

        <span class="ruby-comment"># branches holds mapping from branch name to sha1</span>
        <span class="ruby-identifier">branches</span> = <span class="ruby-identifier">p4BranchesInGit</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">importIntoRemotes</span>)

        <span class="ruby-comment"># restrict to just this one, disabling detect-branches</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">branch_arg_given</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">short</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;/&quot;</span>)[<span class="ruby-value">-1</span>]
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">short</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">branches</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span> = [ <span class="ruby-identifier">short</span> ]
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span> = <span class="ruby-identifier">branches</span>.<span class="ruby-identifier">keys</span>()

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Importing from/into multiple branches&quot;</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span> = <span class="ruby-constant">True</span>
            <span class="ruby-keyword">for</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">branches</span>.<span class="ruby-identifier">keys</span>()<span class="ruby-operator">:</span>
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParents</span>[<span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">branch</span>] =                      <span class="ruby-identifier">branches</span>[<span class="ruby-identifier">branch</span>]

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;branches: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span>

        <span class="ruby-identifier">p4Change</span> = <span class="ruby-value">0</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">logMsg</span> =  <span class="ruby-identifier">extractLogMessageFromGitCommit</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">branch</span>)

            <span class="ruby-identifier">settings</span> = <span class="ruby-identifier">extractSettingsGitLog</span>(<span class="ruby-identifier">logMsg</span>)

            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">readOptions</span>(<span class="ruby-identifier">settings</span>)
            <span class="ruby-keyword">if</span> (<span class="ruby-identifier">settings</span>.<span class="ruby-identifier">has_key</span>(<span class="ruby-string">&#39;depot-paths&#39;</span>)
                <span class="ruby-keyword">and</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">has_key</span> (<span class="ruby-string">&#39;change&#39;</span>))<span class="ruby-operator">:</span>
                <span class="ruby-identifier">change</span> = <span class="ruby-identifier">int</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-string">&#39;change&#39;</span>]) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
                <span class="ruby-identifier">p4Change</span> = <span class="ruby-identifier">max</span>(<span class="ruby-identifier">p4Change</span>, <span class="ruby-identifier">change</span>)

                <span class="ruby-identifier">depotPaths</span> = <span class="ruby-identifier">sorted</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-string">&#39;depot-paths&#39;</span>])
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">previousDepotPaths</span> <span class="ruby-operator">==</span> []<span class="ruby-operator">:</span>
                    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">previousDepotPaths</span> = <span class="ruby-identifier">depotPaths</span>
                <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">paths</span> = []
                    <span class="ruby-keyword">for</span> (<span class="ruby-identifier">prev</span>, <span class="ruby-identifier">cur</span>) <span class="ruby-keyword">in</span> <span class="ruby-identifier">zip</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">previousDepotPaths</span>, <span class="ruby-identifier">depotPaths</span>)<span class="ruby-operator">:</span>
                        <span class="ruby-identifier">prev_list</span> = <span class="ruby-identifier">prev</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;/&quot;</span>)
                        <span class="ruby-identifier">cur_list</span> = <span class="ruby-identifier">cur</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;/&quot;</span>)
                        <span class="ruby-keyword">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">range</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">min</span>(<span class="ruby-identifier">len</span>(<span class="ruby-identifier">cur_list</span>), <span class="ruby-identifier">len</span>(<span class="ruby-identifier">prev_list</span>)))<span class="ruby-operator">:</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-identifier">cur_list</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">&lt;</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">prev_list</span>[<span class="ruby-identifier">i</span>]<span class="ruby-operator">:</span>
                                <span class="ruby-identifier">i</span> = <span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
                                <span class="ruby-keyword">break</span>

                        <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">append</span> (<span class="ruby-string">&quot;/&quot;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">cur_list</span>[:<span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>]))

                    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">previousDepotPaths</span> = <span class="ruby-identifier">paths</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">p4Change</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span> = <span class="ruby-identifier">sorted</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">previousDepotPaths</span>)
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span> = <span class="ruby-node">&quot;@%s,#head&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">p4Change</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Performing incremental import into %s git branch&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>

    <span class="ruby-comment"># accept multiple ref name abbreviations:</span>
    <span class="ruby-comment">#    refs/foo/bar/branch -&gt; use it exactly</span>
    <span class="ruby-comment">#    p4/branch -&gt; prepend refs/remotes/ or refs/heads/</span>
    <span class="ruby-comment">#    branch -&gt; prepend refs/remotes/p4/ or refs/heads/p4/</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;refs/&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importIntoRemotes</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">prepend</span> = <span class="ruby-string">&quot;refs/remotes/&quot;</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">prepend</span> = <span class="ruby-string">&quot;refs/heads/&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;p4/&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">prepend</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;p4/&quot;</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span> = <span class="ruby-identifier">prepend</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">args</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Depot paths: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-string">&#39; &#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>)
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">args</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> (<span class="ruby-string">&quot;previous import used depot path %s and now %s was specified. &quot;</span>
                   <span class="ruby-string">&quot;This doesn&#39;t work!&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-string">&#39; &#39;</span>.<span class="ruby-identifier">join</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>),
                                           <span class="ruby-string">&#39; &#39;</span>.<span class="ruby-identifier">join</span> (<span class="ruby-identifier">args</span>)))
            <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)

        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span> = <span class="ruby-identifier">sorted</span>(<span class="ruby-identifier">args</span>)

    <span class="ruby-identifier">revision</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">users</span> = {}

    <span class="ruby-comment"># Make sure no revision specifiers are used when --changesfile</span>
    <span class="ruby-comment"># is specified.</span>
    <span class="ruby-identifier">bad_changesfile</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">changesFile</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&quot;@&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">find</span>(<span class="ruby-node">&quot;#&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">bad_changesfile</span> = <span class="ruby-constant">True</span>
                <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">bad_changesfile</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Option --changesfile is incompatible with revision specifiers&quot;</span>)

    <span class="ruby-identifier">newPaths</span> = []
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">find</span>(<span class="ruby-string">&quot;@&quot;</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">-1</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">atIdx</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">index</span>(<span class="ruby-string">&quot;@&quot;</span>)
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span> = <span class="ruby-identifier">p</span>[<span class="ruby-identifier">atIdx</span>:]
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;@all&quot;</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">elif</span> <span class="ruby-string">&#39;,&#39;</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">revision</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span>
                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">p</span> = <span class="ruby-identifier">p</span>[:<span class="ruby-identifier">atIdx</span>]
        <span class="ruby-identifier">elif</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">find</span>(<span class="ruby-node">&quot;#&quot;</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">-1</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">hashIdx</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">index</span>(<span class="ruby-node">&quot;#&quot;</span>)
            <span class="ruby-identifier">revision</span> = <span class="ruby-identifier">p</span>[<span class="ruby-identifier">hashIdx</span>:]
            <span class="ruby-identifier">p</span> = <span class="ruby-identifier">p</span>[:<span class="ruby-identifier">hashIdx</span>]
        <span class="ruby-identifier">elif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">previousDepotPaths</span> <span class="ruby-operator">==</span> []<span class="ruby-operator">:</span>
            <span class="ruby-comment"># pay attention to changesfile, if given, else import</span>
            <span class="ruby-comment"># the entire p4 tree at the head revision</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">changesFile</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">revision</span> = <span class="ruby-node">&quot;#head&quot;</span>

        <span class="ruby-identifier">p</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">sub</span> (<span class="ruby-string">&quot;\.\.\.$&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">p</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">endswith</span>(<span class="ruby-string">&quot;/&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">p</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;/&quot;</span>

        <span class="ruby-identifier">newPaths</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">p</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span> = <span class="ruby-identifier">newPaths</span>

    <span class="ruby-comment"># --detect-branches may change this for each branch</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branchPrefixes</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">loadUserMapFromCache</span>()
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">labels</span> = {}
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectLabels</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">getLabels</span>();

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span><span class="ruby-operator">:</span>
        <span class="ruby-comment">## FIXME - what&#39;s a P4 projectName ?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">projectName</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">guessProjectName</span>()

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">hasOrigin</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">getBranchMappingFromGitBranches</span>()
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">getBranchMapping</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;p4-git branches: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;initial parents: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParents</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">b</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;master&quot;</span><span class="ruby-operator">:</span>

                <span class="ruby-comment">## FIXME</span>
                <span class="ruby-identifier">b</span> = <span class="ruby-identifier">b</span>[<span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">projectName</span>)<span class="ruby-operator">:</span>]
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">createdBranches</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">b</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tz</span> = <span class="ruby-string">&quot;%+03d%02d&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">timezone</span> <span class="ruby-operator">/</span> <span class="ruby-value">3600</span>, ((<span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">timezone</span> <span class="ruby-operator">%</span> <span class="ruby-value">3600</span>) <span class="ruby-operator">/</span> <span class="ruby-value">60</span>))

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importProcess</span> = <span class="ruby-identifier">subprocess</span>.<span class="ruby-constant">Popen</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;fast-import&quot;</span>],
                                          <span class="ruby-identifier">stdin</span>=<span class="ruby-identifier">subprocess</span>.<span class="ruby-constant">PIPE</span>,
                                          <span class="ruby-identifier">stdout</span>=<span class="ruby-identifier">subprocess</span>.<span class="ruby-constant">PIPE</span>,
                                          <span class="ruby-identifier">stderr</span>=<span class="ruby-identifier">subprocess</span>.<span class="ruby-constant">PIPE</span>);
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitOutput</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importProcess</span>.<span class="ruby-identifier">stdout</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importProcess</span>.<span class="ruby-identifier">stdin</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitError</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importProcess</span>.<span class="ruby-identifier">stderr</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">revision</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importHeadRevision</span>(<span class="ruby-identifier">revision</span>)
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">changes</span> = []

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">changesFile</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">output</span> = <span class="ruby-identifier">open</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">changesFile</span>).<span class="ruby-identifier">readlines</span>()
            <span class="ruby-identifier">changeSet</span> = <span class="ruby-identifier">set</span>()
            <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">output</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">changeSet</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">int</span>(<span class="ruby-identifier">line</span>))

            <span class="ruby-keyword">for</span> <span class="ruby-identifier">change</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">changeSet</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">changes</span>.<span class="ruby-identifier">append</span>(<span class="ruby-identifier">change</span>)

            <span class="ruby-identifier">changes</span>.<span class="ruby-identifier">sort</span>()
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-comment"># catch &quot;git p4 sync&quot; with no new branches, in a repo that</span>
            <span class="ruby-comment"># does not have any existing p4 branches</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">args</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">p4BranchesInGit</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;No remote p4 branches.  Perhaps you never did \&quot;git p4 clone\&quot; in here.&quot;</span>)

                <span class="ruby-comment"># The default branch is master, unless --branch is used to</span>
                <span class="ruby-comment"># specify something else.  Make sure it exists, or complain</span>
                <span class="ruby-comment"># nicely about how to use --branch.</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span><span class="ruby-operator">:</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">branch_exists</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)<span class="ruby-operator">:</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">branch_arg_given</span><span class="ruby-operator">:</span>
                            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Error: branch %s does not exist.&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)
                        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                            <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Error: no branch %s; perhaps specify one with --branch.&quot;</span> <span class="ruby-operator">%</span>
                                <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)

            <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Getting p4 changes for %s...%s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-string">&#39;, &#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>),
                                                          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span>)
            <span class="ruby-identifier">changes</span> = <span class="ruby-identifier">p4ChangesForPaths</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">changeRange</span>)

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">maxChanges</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">changes</span> = <span class="ruby-identifier">changes</span>[:<span class="ruby-identifier">min</span>(<span class="ruby-identifier">int</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">maxChanges</span>), <span class="ruby-identifier">len</span>(<span class="ruby-identifier">changes</span>))]

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">changes</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;No changes to import!&quot;</span>
        <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Import destination: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>

            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updatedBranches</span> = <span class="ruby-identifier">set</span>()

            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">detectBranches</span><span class="ruby-operator">:</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span><span class="ruby-operator">:</span>
                    <span class="ruby-comment"># start a new branch</span>
                    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParent</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
                    <span class="ruby-comment"># build on a previous revision</span>
                    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialParent</span> = <span class="ruby-identifier">parseRevision</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)

            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importChanges</span>(<span class="ruby-identifier">changes</span>)

            <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">silent</span><span class="ruby-operator">:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">updatedBranches</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
                    <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;Updated branches: &quot;</span>)
                    <span class="ruby-keyword">for</span> <span class="ruby-identifier">b</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">updatedBranches</span><span class="ruby-operator">:</span>
                        <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;%s &quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">b</span>)
                    <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;\n&quot;</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitConfigBool</span>(<span class="ruby-string">&quot;git-p4.importLabels&quot;</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importLabels</span> = <span class="ruby-constant">True</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importLabels</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">p4Labels</span> = <span class="ruby-identifier">getP4Labels</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">depotPaths</span>)
        <span class="ruby-identifier">gitTags</span> = <span class="ruby-identifier">getGitTags</span>()

        <span class="ruby-identifier">missingP4Labels</span> = <span class="ruby-identifier">p4Labels</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">gitTags</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importP4Labels</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>, <span class="ruby-identifier">missingP4Labels</span>)

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitStream</span>.<span class="ruby-identifier">close</span>()
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importProcess</span>.<span class="ruby-identifier">wait</span>() <span class="ruby-operator">!=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;fast-import failed: %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitError</span>.<span class="ruby-identifier">read</span>())
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitOutput</span>.<span class="ruby-identifier">close</span>()
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">gitError</span>.<span class="ruby-identifier">close</span>()

    <span class="ruby-comment"># Cleanup temporary branches created during import</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tempBranches</span> <span class="ruby-operator">!=</span> []<span class="ruby-operator">:</span>
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">branch</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tempBranches</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">read_pipe</span>(<span class="ruby-string">&quot;git update-ref -d %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">branch</span>)
        <span class="ruby-identifier">os</span>.<span class="ruby-identifier">rmdir</span>(<span class="ruby-identifier">os</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">os</span>.<span class="ruby-identifier">environ</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&quot;GIT_DIR&quot;</span>, <span class="ruby-string">&quot;.git&quot;</span>), <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tempBranchLocation</span>))

    <span class="ruby-comment"># Create a symbolic ref p4/HEAD pointing to p4/&lt;branch&gt; to allow</span>
    <span class="ruby-comment"># a convenient shortcut refname &quot;p4&quot;.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importIntoRemotes</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">head_ref</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">refPrefix</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;HEAD&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">gitBranchExists</span>(<span class="ruby-identifier">head_ref</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">gitBranchExists</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">system</span>([<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;symbolic-ref&quot;</span>, <span class="ruby-identifier">head_ref</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>])

    <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>
</pre>

<p>class P4Rebase(Command):</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-constant">Command</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> = [
            <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--import-labels&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;importLabels&quot;</span>, <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>),
    ]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importLabels</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span> = (<span class="ruby-string">&quot;Fetches the latest revision from perforce and &quot;</span>
                        <span class="ruby-operator">+</span> <span class="ruby-string">&quot;rebases the current work (branch) against it&quot;</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">sync</span> = <span class="ruby-constant">P4Sync</span>()
    <span class="ruby-identifier">sync</span>.<span class="ruby-identifier">importLabels</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">importLabels</span>
    <span class="ruby-identifier">sync</span>.<span class="ruby-identifier">run</span>([])

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rebase</span>()

<span class="ruby-keyword">def</span> <span class="ruby-identifier">rebase</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git update-index --refresh&quot;</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Some files in your working directory are modified and different than what is in your index. You can use git update-index &lt;filename&gt; to bring the index up-to-date or stash away all your changes with git stash.&quot;</span>);
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">read_pipe</span>(<span class="ruby-string">&quot;git diff-index HEAD --&quot;</span>)) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;You have uncommitted changes. Please commit them before rebasing or stash them away with git stash.&quot;</span>);

    [<span class="ruby-identifier">upstream</span>, <span class="ruby-identifier">settings</span>] = <span class="ruby-identifier">findUpstreamBranchPoint</span>()
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">upstream</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Cannot find upstream branchpoint for rebase&quot;</span>)

    <span class="ruby-comment"># the branchpoint may be p4/foo~3, so strip off the parent</span>
    <span class="ruby-identifier">upstream</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-string">&quot;~[0-9]+$&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">upstream</span>)

    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Rebasing the current branch onto %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">upstream</span>
    <span class="ruby-identifier">oldHead</span> = <span class="ruby-identifier">read_pipe</span>(<span class="ruby-string">&quot;git rev-parse HEAD&quot;</span>).<span class="ruby-identifier">strip</span>()
    <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git rebase %s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">upstream</span>)
    <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git diff-tree --stat --summary -M %s HEAD&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">oldHead</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>
</pre>

<p>class P4Clone(P4Sync):</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-constant">P4Sync</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;Creates a new git repository and imports from Perforce into it&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">usage</span> = <span class="ruby-string">&quot;usage: %prog [options] //depot/path[@revRange]&quot;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> <span class="ruby-operator">+=</span> [
        <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--destination&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;cloneDestination&quot;</span>,
                             <span class="ruby-identifier">action</span>=<span class="ruby-string">&#39;store&#39;</span>, <span class="ruby-identifier">default</span>=<span class="ruby-constant">None</span>,
                             <span class="ruby-identifier">help</span>=<span class="ruby-string">&quot;where to leave result of the clone&quot;</span>),
        <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;-/&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;cloneExclude&quot;</span>,
                             <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;append&quot;</span>, <span class="ruby-identifier">type</span>=<span class="ruby-string">&quot;string&quot;</span>,
                             <span class="ruby-identifier">help</span>=<span class="ruby-string">&quot;exclude depot path&quot;</span>),
        <span class="ruby-identifier">optparse</span>.<span class="ruby-identifier">make_option</span>(<span class="ruby-string">&quot;--bare&quot;</span>, <span class="ruby-identifier">dest</span>=<span class="ruby-string">&quot;cloneBare&quot;</span>,
                             <span class="ruby-identifier">action</span>=<span class="ruby-string">&quot;store_true&quot;</span>, <span class="ruby-identifier">default</span>=<span class="ruby-constant">False</span>),
    ]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span> = <span class="ruby-constant">None</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">needsGit</span> = <span class="ruby-constant">False</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneBare</span> = <span class="ruby-constant">False</span>

<span class="ruby-comment"># This is required for the &quot;append&quot; cloneExclude action</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ensure_value</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">attr</span>, <span class="ruby-identifier">value</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">hasattr</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">attr</span>) <span class="ruby-keyword">or</span> <span class="ruby-identifier">getattr</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">attr</span>) <span class="ruby-identifier">is</span> <span class="ruby-constant">None</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">setattr</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">attr</span>, <span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">getattr</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">attr</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">defaultDestination</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
    <span class="ruby-comment">## TODO: use common prefix of args?</span>
    <span class="ruby-identifier">depotPath</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
    <span class="ruby-identifier">depotDir</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-string">&quot;(@[^@]*)$&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">depotPath</span>)
    <span class="ruby-identifier">depotDir</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">&quot;(#[^#]*)$&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">depotDir</span>)
    <span class="ruby-identifier">depotDir</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">r</span><span class="ruby-string">&quot;\.\.\.$&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">depotDir</span>)
    <span class="ruby-identifier">depotDir</span> = <span class="ruby-identifier">re</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">r</span><span class="ruby-string">&quot;/$&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">depotDir</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">depotDir</span>)[<span class="ruby-value">1</span>]

<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">args</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">keepRepoPath</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&quot;Must specify destination for --keep-path\n&quot;</span>)
        <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">exit</span>(<span class="ruby-value">1</span>)

    <span class="ruby-identifier">depotPaths</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">len</span>(<span class="ruby-identifier">depotPaths</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span> = <span class="ruby-identifier">depotPaths</span>[<span class="ruby-value">-1</span>]
        <span class="ruby-identifier">depotPaths</span> = <span class="ruby-identifier">depotPaths</span>[:<span class="ruby-value">-1</span>]

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneExclude</span> = [<span class="ruby-string">&quot;/&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">p</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneExclude</span>]
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">depotPaths</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&quot;//&quot;</span>)<span class="ruby-operator">:</span>
            <span class="ruby-identifier">sys</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">write</span>(<span class="ruby-string">&#39;Depot paths must start with &quot;//&quot;: %s\n&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">p</span>)
            <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">defaultDestination</span>(<span class="ruby-identifier">args</span>)

    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Importing from %s into %s&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-string">&#39;, &#39;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">depotPaths</span>), <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">os</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">exists</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">os</span>.<span class="ruby-identifier">makedirs</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span>)
    <span class="ruby-identifier">chdir</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneDestination</span>)

    <span class="ruby-identifier">init_cmd</span> = [ <span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;init&quot;</span> ]
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneBare</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">init_cmd</span>.<span class="ruby-identifier">append</span>(<span class="ruby-string">&quot;--bare&quot;</span>)
    <span class="ruby-identifier">retcode</span> = <span class="ruby-identifier">subprocess</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">init_cmd</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">retcode</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">CalledProcessError</span>(<span class="ruby-identifier">retcode</span>, <span class="ruby-identifier">init_cmd</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-constant">P4Sync</span>.<span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">depotPaths</span>)<span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-constant">False</span>

    <span class="ruby-comment"># create a master branch and check out a work tree</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitBranchExists</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">system</span>([ <span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;branch&quot;</span>, <span class="ruby-string">&quot;master&quot;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">branch</span> ])
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cloneBare</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">system</span>([ <span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;checkout&quot;</span>, <span class="ruby-string">&quot;-f&quot;</span> ])
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&#39;Not checking out any branch, use &#39;</span>                <span class="ruby-string">&#39;&quot;git checkout -q -b master &lt;branch&gt;&quot;&#39;</span>

    <span class="ruby-comment"># auto-set this variable if invoked with --use-client-spec</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">useClientSpec_from_options</span><span class="ruby-operator">:</span>
        <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git config --bool git-p4.useclientspec true&quot;</span>)

    <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>
</pre>

<p>class P4Branches(Command):</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-constant">Command</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">options</span> = [ ]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span> = (<span class="ruby-string">&quot;Shows the git branches that hold imports and their &quot;</span>
                        <span class="ruby-operator">+</span> <span class="ruby-string">&quot;corresponding perforce depot paths&quot;</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-constant">False</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">args</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">originP4BranchesExist</span>()<span class="ruby-operator">:</span>
        <span class="ruby-identifier">createOrUpdateBranchesFromOrigin</span>()

    <span class="ruby-identifier">cmdline</span> = <span class="ruby-string">&quot;git rev-parse --symbolic &quot;</span>
    <span class="ruby-identifier">cmdline</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot; --remotes&quot;</span>

    <span class="ruby-keyword">for</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">read_pipe_lines</span>(<span class="ruby-identifier">cmdline</span>)<span class="ruby-operator">:</span>
        <span class="ruby-identifier">line</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">strip</span>()

        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">startswith</span>(<span class="ruby-string">&#39;p4/&#39;</span>) <span class="ruby-keyword">or</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;p4/HEAD&quot;</span><span class="ruby-operator">:</span>
            <span class="ruby-identifier">continue</span>
        <span class="ruby-identifier">branch</span> = <span class="ruby-identifier">line</span>

        <span class="ruby-identifier">log</span> = <span class="ruby-identifier">extractLogMessageFromGitCommit</span>(<span class="ruby-string">&quot;refs/remotes/%s&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">branch</span>)
        <span class="ruby-identifier">settings</span> = <span class="ruby-identifier">extractSettingsGitLog</span>(<span class="ruby-identifier">log</span>)

        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;%s &lt;= %s (%s)&quot;</span> <span class="ruby-operator">%</span> (<span class="ruby-identifier">branch</span>, <span class="ruby-string">&quot;,&quot;</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">settings</span>[<span class="ruby-string">&quot;depot-paths&quot;</span>]), <span class="ruby-identifier">settings</span>[<span class="ruby-string">&quot;change&quot;</span>])
    <span class="ruby-keyword">return</span> <span class="ruby-constant">True</span>
</pre>

<p>class HelpFormatter(optparse.IndentedHelpFormatter):</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)<span class="ruby-operator">:</span>
    <span class="ruby-identifier">optparse</span>.<span class="ruby-constant">IndentedHelpFormatter</span>.<span class="ruby-identifier">__init__</span>(<span class="ruby-keyword">self</span>)

<span class="ruby-keyword">def</span> <span class="ruby-identifier">format_description</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">description</span>)<span class="ruby-operator">:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">description</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">description</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n&quot;</span>
    <span class="ruby-keyword">else</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
</pre>

<p>def printUsage(commands):</p>

<pre>print &quot;usage: %s &lt;command&gt; [options]&quot; % sys.argv[0]
print &quot;&quot;
print &quot;valid commands: %s&quot; % &quot;, &quot;.join(commands)
print &quot;&quot;
print &quot;Try %s &lt;command&gt; --help for command specific help.&quot; % sys.argv[0]
print &quot;&quot;</pre>

<p>commands = {</p>

<pre>&quot;debug&quot; : P4Debug,
&quot;submit&quot; : P4Submit,
&quot;commit&quot; : P4Submit,
&quot;sync&quot; : P4Sync,
&quot;rebase&quot; : P4Rebase,
&quot;clone&quot; : P4Clone,
&quot;rollback&quot; : P4RollBack,
&quot;branches&quot; : P4Branches</pre>

<p>}</p>

<p>def main():</p>

<pre>if len(sys.argv[1:]) == 0:
    printUsage(commands.keys())
    sys.exit(2)

cmdName = sys.argv[1]
try:
    klass = commands[cmdName]
    cmd = klass()
except KeyError:
    print &quot;unknown command %s&quot; % cmdName
    print &quot;&quot;
    printUsage(commands.keys())
    sys.exit(2)

options = cmd.options
cmd.gitdir = os.environ.get(&quot;GIT_DIR&quot;, None)

args = sys.argv[2:]

options.append(optparse.make_option(&quot;--verbose&quot;, &quot;-v&quot;, dest=&quot;verbose&quot;, action=&quot;store_true&quot;))
if cmd.needsGit:
    options.append(optparse.make_option(&quot;--git-dir&quot;, dest=&quot;gitdir&quot;))

parser = optparse.OptionParser(cmd.usage.replace(&quot;%prog&quot;, &quot;%prog &quot; + cmdName),
                               options,
                               description = cmd.description,
                               formatter = HelpFormatter())

(cmd, args) = parser.parse_args(sys.argv[2:], cmd);
global verbose
verbose = cmd.verbose
if cmd.needsGit:
    if cmd.gitdir == None:
        cmd.gitdir = os.path.abspath(&quot;.git&quot;)
        if not isValidGitDir(cmd.gitdir):
            cmd.gitdir = read_pipe(&quot;git rev-parse --git-dir&quot;).strip()
            if os.path.exists(cmd.gitdir):
                cdup = read_pipe(&quot;git rev-parse --show-cdup&quot;).strip()
                if len(cdup) &gt; 0:
                    chdir(cdup);

    if not isValidGitDir(cmd.gitdir):
        if isValidGitDir(cmd.gitdir + &quot;/.git&quot;):
            cmd.gitdir += &quot;/.git&quot;
        else:
            die(&quot;fatal: cannot locate git repository at %s&quot; % cmd.gitdir)

    os.environ[&quot;GIT_DIR&quot;] = cmd.gitdir

if not cmd.run(args):
    parser.print_help()
    sys.exit(2)</pre>

<p>if __name__ == &#39;__main__&#39;:</p>

<pre>main()</pre>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

