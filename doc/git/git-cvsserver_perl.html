<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>git-cvsserver.perl - RDoc Documentation</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-head1+NAME">head1 NAME</a>
    <li><a href="#label-head1+DESCRIPTION">head1 DESCRIPTION</a>
    <li><a href="#label-head1+METHODS">head1 METHODS</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+new">head2 new</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+setfile">head2 setfile</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+nofile">head2 nofile</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+_logopen">head2 _logopen</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+debug+info+warn+fatal">head2 debug info warn fatal</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+_log">head2 _log</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+DESTROY">head2 DESTROY</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head1+METHODS">head1 METHODS</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+new">head2 new</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+tablename">head2 tablename</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+update">head2 update</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+gethead">head2 gethead</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+getAnyHead">head2 getAnyHead</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+getRevisionDirMap">head2 getRevisionDirMap</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+getlog">head2 getlog</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+getmeta">head2 getmeta</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+lookupCommitRef">head2 lookupCommitRef</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+clearCommitRefCaches">head2 clearCommitRefCaches</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+commitmessage">head2 commitmessage</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+gethistorydense">head2 gethistorydense</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+escapeRefName">head2 escapeRefName</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+unescapeRefName">head2 unescapeRefName</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+in_array%28%29">head2 in_array()</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+safe_pipe_capture">head2 safe_pipe_capture</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+mangle_dirname">head2 mangle_dirname</a>
    <li><a href="#label-cut">cut</a>
    <li><a href="#label-head2+mangle_tablename">head2 mangle_tablename</a>
    <li><a href="#label-cut">cut</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../Gemfile.html">Gemfile</a>
  
    <li><a href="../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../README_md.html">README</a>
  
    <li><a href="../Rakefile.html">Rakefile</a>
  
    <li><a href="../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../app/assets/javascripts/pages_js_coffee.html">pages.js.coffee</a>
  
    <li><a href="../app/assets/javascripts/pins_js_coffee.html">pins.js.coffee</a>
  
    <li><a href="../app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="../app/assets/stylesheets/bootstrap_and_customization_css_scss.html">bootstrap_and_customization.css.scss</a>
  
    <li><a href="../app/assets/stylesheets/pages_css_scss.html">pages.css.scss</a>
  
    <li><a href="../app/assets/stylesheets/pins_css_scss.html">pins.css.scss</a>
  
    <li><a href="../config_ru.html">config.ru</a>
  
    <li><a href="../git/COPYING.html">COPYING</a>
  
    <li><a href="../git/Documentation/CodingGuidelines.html">CodingGuidelines</a>
  
    <li><a href="../git/Documentation/Makefile.html">Makefile</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_1_txt.html">1.5.0.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_2_txt.html">1.5.0.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_3_txt.html">1.5.0.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_4_txt.html">1.5.0.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_5_txt.html">1.5.0.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_6_txt.html">1.5.0.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_7_txt.html">1.5.0.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_0_txt.html">1.5.0</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_1_txt.html">1.5.1.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_2_txt.html">1.5.1.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_3_txt.html">1.5.1.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_4_txt.html">1.5.1.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_5_txt.html">1.5.1.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_6_txt.html">1.5.1.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_1_txt.html">1.5.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_1_txt.html">1.5.2.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_2_txt.html">1.5.2.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_3_txt.html">1.5.2.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_4_txt.html">1.5.2.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_5_txt.html">1.5.2.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_2_txt.html">1.5.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_1_txt.html">1.5.3.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_2_txt.html">1.5.3.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_3_txt.html">1.5.3.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_4_txt.html">1.5.3.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_5_txt.html">1.5.3.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_6_txt.html">1.5.3.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_7_txt.html">1.5.3.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_8_txt.html">1.5.3.8</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_3_txt.html">1.5.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_1_txt.html">1.5.4.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_2_txt.html">1.5.4.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_3_txt.html">1.5.4.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_4_txt.html">1.5.4.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_5_txt.html">1.5.4.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_6_txt.html">1.5.4.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_7_txt.html">1.5.4.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_4_txt.html">1.5.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_1_txt.html">1.5.5.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_2_txt.html">1.5.5.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_3_txt.html">1.5.5.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_4_txt.html">1.5.5.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_5_txt.html">1.5.5.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_6_txt.html">1.5.5.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_5_txt.html">1.5.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_1_txt.html">1.5.6.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_2_txt.html">1.5.6.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_3_txt.html">1.5.6.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_4_txt.html">1.5.6.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_5_txt.html">1.5.6.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_6_txt.html">1.5.6.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_5_6_txt.html">1.5.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_1_txt.html">1.6.0.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_2_txt.html">1.6.0.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_3_txt.html">1.6.0.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_4_txt.html">1.6.0.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_5_txt.html">1.6.0.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_6_txt.html">1.6.0.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_0_txt.html">1.6.0</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_1_txt.html">1.6.1.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_2_txt.html">1.6.1.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_3_txt.html">1.6.1.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_4_txt.html">1.6.1.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_1_txt.html">1.6.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_1_txt.html">1.6.2.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_2_txt.html">1.6.2.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_3_txt.html">1.6.2.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_4_txt.html">1.6.2.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_5_txt.html">1.6.2.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_2_txt.html">1.6.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_1_txt.html">1.6.3.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_2_txt.html">1.6.3.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_3_txt.html">1.6.3.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_4_txt.html">1.6.3.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_3_txt.html">1.6.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_1_txt.html">1.6.4.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_2_txt.html">1.6.4.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_3_txt.html">1.6.4.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_4_txt.html">1.6.4.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_5_txt.html">1.6.4.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_4_txt.html">1.6.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_1_txt.html">1.6.5.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_2_txt.html">1.6.5.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_3_txt.html">1.6.5.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_4_txt.html">1.6.5.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_5_txt.html">1.6.5.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_6_txt.html">1.6.5.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_7_txt.html">1.6.5.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_8_txt.html">1.6.5.8</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_9_txt.html">1.6.5.9</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_5_txt.html">1.6.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_6_1_txt.html">1.6.6.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_6_2_txt.html">1.6.6.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_6_3_txt.html">1.6.6.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_6_6_txt.html">1.6.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_1_txt.html">1.7.0.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_2_txt.html">1.7.0.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_3_txt.html">1.7.0.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_4_txt.html">1.7.0.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_5_txt.html">1.7.0.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_6_txt.html">1.7.0.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_7_txt.html">1.7.0.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_8_txt.html">1.7.0.8</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_9_txt.html">1.7.0.9</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_0_txt.html">1.7.0</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_1_txt.html">1.7.1.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_2_txt.html">1.7.1.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_3_txt.html">1.7.1.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_4_txt.html">1.7.1.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_1_txt.html">1.7.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_1_txt.html">1.7.10.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_2_txt.html">1.7.10.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_3_txt.html">1.7.10.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_4_txt.html">1.7.10.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_5_txt.html">1.7.10.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_10_txt.html">1.7.10</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_1_txt.html">1.7.11.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_2_txt.html">1.7.11.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_3_txt.html">1.7.11.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_4_txt.html">1.7.11.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_5_txt.html">1.7.11.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_6_txt.html">1.7.11.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_7_txt.html">1.7.11.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_11_txt.html">1.7.11</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_1_txt.html">1.7.12.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_2_txt.html">1.7.12.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_3_txt.html">1.7.12.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_4_txt.html">1.7.12.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_12_txt.html">1.7.12</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_1_txt.html">1.7.2.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_2_txt.html">1.7.2.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_3_txt.html">1.7.2.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_4_txt.html">1.7.2.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_5_txt.html">1.7.2.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_2_txt.html">1.7.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_1_txt.html">1.7.3.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_2_txt.html">1.7.3.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_3_txt.html">1.7.3.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_4_txt.html">1.7.3.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_5_txt.html">1.7.3.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_3_txt.html">1.7.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_1_txt.html">1.7.4.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_2_txt.html">1.7.4.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_3_txt.html">1.7.4.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_4_txt.html">1.7.4.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_5_txt.html">1.7.4.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_4_txt.html">1.7.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_1_txt.html">1.7.5.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_2_txt.html">1.7.5.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_3_txt.html">1.7.5.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_4_txt.html">1.7.5.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_5_txt.html">1.7.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_1_txt.html">1.7.6.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_2_txt.html">1.7.6.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_3_txt.html">1.7.6.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_4_txt.html">1.7.6.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_5_txt.html">1.7.6.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_6_txt.html">1.7.6.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_6_txt.html">1.7.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_1_txt.html">1.7.7.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_2_txt.html">1.7.7.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_3_txt.html">1.7.7.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_4_txt.html">1.7.7.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_5_txt.html">1.7.7.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_6_txt.html">1.7.7.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_7_txt.html">1.7.7.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_7_txt.html">1.7.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_1_txt.html">1.7.8.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_2_txt.html">1.7.8.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_3_txt.html">1.7.8.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_4_txt.html">1.7.8.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_5_txt.html">1.7.8.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_6_txt.html">1.7.8.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_8_txt.html">1.7.8</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_1_txt.html">1.7.9.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_2_txt.html">1.7.9.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_3_txt.html">1.7.9.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_4_txt.html">1.7.9.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_5_txt.html">1.7.9.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_6_txt.html">1.7.9.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_7_txt.html">1.7.9.7</a>
  
    <li><a href="../git/Documentation/RelNotes/1_7_9_txt.html">1.7.9</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_0_1_txt.html">1.8.0.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_0_2_txt.html">1.8.0.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_0_3_txt.html">1.8.0.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_0_txt.html">1.8.0</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_1_txt.html">1.8.1.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_2_txt.html">1.8.1.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_3_txt.html">1.8.1.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_4_txt.html">1.8.1.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_5_txt.html">1.8.1.5</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_6_txt.html">1.8.1.6</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_1_txt.html">1.8.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_2_1_txt.html">1.8.2.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_2_2_txt.html">1.8.2.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_2_3_txt.html">1.8.2.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_2_txt.html">1.8.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_1_txt.html">1.8.3.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_2_txt.html">1.8.3.2</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_3_txt.html">1.8.3.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_4_txt.html">1.8.3.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_3_txt.html">1.8.3</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_4_1_txt.html">1.8.4.1</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_4_txt.html">1.8.4</a>
  
    <li><a href="../git/Documentation/RelNotes/1_8_5_txt.html">1.8.5</a>
  
    <li><a href="../git/Documentation/SubmittingPatches.html">SubmittingPatches</a>
  
    <li><a href="../git/Documentation/asciidoc_conf.html">asciidoc.conf</a>
  
    <li><a href="../git/Documentation/blame-options_txt.html">blame-options</a>
  
    <li><a href="../git/Documentation/build-docdep_perl.html">build-docdep.perl</a>
  
    <li><a href="../git/Documentation/cat-texi_perl.html">cat-texi.perl</a>
  
    <li><a href="../git/Documentation/cmd-list_perl.html">cmd-list.perl</a>
  
    <li><a href="../git/Documentation/config_txt.html">config</a>
  
    <li><a href="../git/Documentation/date-formats_txt.html">date-formats</a>
  
    <li><a href="../git/Documentation/diff-config_txt.html">diff-config</a>
  
    <li><a href="../git/Documentation/diff-format_txt.html">diff-format</a>
  
    <li><a href="../git/Documentation/diff-generate-patch_txt.html">diff-generate-patch</a>
  
    <li><a href="../git/Documentation/diff-options_txt.html">diff-options</a>
  
    <li><a href="../git/Documentation/docbook-xsl_css.html">docbook-xsl.css</a>
  
    <li><a href="../git/Documentation/docbook_xsl.html">docbook.xsl</a>
  
    <li><a href="../git/Documentation/everyday_txt.html">everyday</a>
  
    <li><a href="../git/Documentation/fetch-options_txt.html">fetch-options</a>
  
    <li><a href="../git/Documentation/fix-texi_perl.html">fix-texi.perl</a>
  
    <li><a href="../git/Documentation/git-add_txt.html">git-add</a>
  
    <li><a href="../git/Documentation/git-am_txt.html">git-am</a>
  
    <li><a href="../git/Documentation/git-annotate_txt.html">git-annotate</a>
  
    <li><a href="../git/Documentation/git-apply_txt.html">git-apply</a>
  
    <li><a href="../git/Documentation/git-archimport_txt.html">git-archimport</a>
  
    <li><a href="../git/Documentation/git-archive_txt.html">git-archive</a>
  
    <li><a href="../git/Documentation/git-bisect-lk2009_txt.html">git-bisect-lk2009</a>
  
    <li><a href="../git/Documentation/git-bisect_txt.html">git-bisect</a>
  
    <li><a href="../git/Documentation/git-blame_txt.html">git-blame</a>
  
    <li><a href="../git/Documentation/git-branch_txt.html">git-branch</a>
  
    <li><a href="../git/Documentation/git-bundle_txt.html">git-bundle</a>
  
    <li><a href="../git/Documentation/git-cat-file_txt.html">git-cat-file</a>
  
    <li><a href="../git/Documentation/git-check-attr_txt.html">git-check-attr</a>
  
    <li><a href="../git/Documentation/git-check-ignore_txt.html">git-check-ignore</a>
  
    <li><a href="../git/Documentation/git-check-mailmap_txt.html">git-check-mailmap</a>
  
    <li><a href="../git/Documentation/git-check-ref-format_txt.html">git-check-ref-format</a>
  
    <li><a href="../git/Documentation/git-checkout-index_txt.html">git-checkout-index</a>
  
    <li><a href="../git/Documentation/git-checkout_txt.html">git-checkout</a>
  
    <li><a href="../git/Documentation/git-cherry-pick_txt.html">git-cherry-pick</a>
  
    <li><a href="../git/Documentation/git-cherry_txt.html">git-cherry</a>
  
    <li><a href="../git/Documentation/git-citool_txt.html">git-citool</a>
  
    <li><a href="../git/Documentation/git-clean_txt.html">git-clean</a>
  
    <li><a href="../git/Documentation/git-clone_txt.html">git-clone</a>
  
    <li><a href="../git/Documentation/git-column_txt.html">git-column</a>
  
    <li><a href="../git/Documentation/git-commit-tree_txt.html">git-commit-tree</a>
  
    <li><a href="../git/Documentation/git-commit_txt.html">git-commit</a>
  
    <li><a href="../git/Documentation/git-config_txt.html">git-config</a>
  
    <li><a href="../git/Documentation/git-count-objects_txt.html">git-count-objects</a>
  
    <li><a href="../git/Documentation/git-credential-cache--daemon_txt.html">git-credential-cache--daemon</a>
  
    <li><a href="../git/Documentation/git-credential-cache_txt.html">git-credential-cache</a>
  
    <li><a href="../git/Documentation/git-credential-store_txt.html">git-credential-store</a>
  
    <li><a href="../git/Documentation/git-credential_txt.html">git-credential</a>
  
    <li><a href="../git/Documentation/git-cvsexportcommit_txt.html">git-cvsexportcommit</a>
  
    <li><a href="../git/Documentation/git-cvsimport_txt.html">git-cvsimport</a>
  
    <li><a href="../git/Documentation/git-cvsserver_txt.html">git-cvsserver</a>
  
    <li><a href="../git/Documentation/git-daemon_txt.html">git-daemon</a>
  
    <li><a href="../git/Documentation/git-describe_txt.html">git-describe</a>
  
    <li><a href="../git/Documentation/git-diff-files_txt.html">git-diff-files</a>
  
    <li><a href="../git/Documentation/git-diff-index_txt.html">git-diff-index</a>
  
    <li><a href="../git/Documentation/git-diff-tree_txt.html">git-diff-tree</a>
  
    <li><a href="../git/Documentation/git-diff_txt.html">git-diff</a>
  
    <li><a href="../git/Documentation/git-difftool_txt.html">git-difftool</a>
  
    <li><a href="../git/Documentation/git-fast-export_txt.html">git-fast-export</a>
  
    <li><a href="../git/Documentation/git-fast-import_txt.html">git-fast-import</a>
  
    <li><a href="../git/Documentation/git-fetch-pack_txt.html">git-fetch-pack</a>
  
    <li><a href="../git/Documentation/git-fetch_txt.html">git-fetch</a>
  
    <li><a href="../git/Documentation/git-filter-branch_txt.html">git-filter-branch</a>
  
    <li><a href="../git/Documentation/git-fmt-merge-msg_txt.html">git-fmt-merge-msg</a>
  
    <li><a href="../git/Documentation/git-for-each-ref_txt.html">git-for-each-ref</a>
  
    <li><a href="../git/Documentation/git-format-patch_txt.html">git-format-patch</a>
  
    <li><a href="../git/Documentation/git-fsck-objects_txt.html">git-fsck-objects</a>
  
    <li><a href="../git/Documentation/git-fsck_txt.html">git-fsck</a>
  
    <li><a href="../git/Documentation/git-gc_txt.html">git-gc</a>
  
    <li><a href="../git/Documentation/git-get-tar-commit-id_txt.html">git-get-tar-commit-id</a>
  
    <li><a href="../git/Documentation/git-grep_txt.html">git-grep</a>
  
    <li><a href="../git/Documentation/git-gui_txt.html">git-gui</a>
  
    <li><a href="../git/Documentation/git-hash-object_txt.html">git-hash-object</a>
  
    <li><a href="../git/Documentation/git-help_txt.html">git-help</a>
  
    <li><a href="../git/Documentation/git-http-backend_txt.html">git-http-backend</a>
  
    <li><a href="../git/Documentation/git-http-fetch_txt.html">git-http-fetch</a>
  
    <li><a href="../git/Documentation/git-http-push_txt.html">git-http-push</a>
  
    <li><a href="../git/Documentation/git-imap-send_txt.html">git-imap-send</a>
  
    <li><a href="../git/Documentation/git-index-pack_txt.html">git-index-pack</a>
  
    <li><a href="../git/Documentation/git-init-db_txt.html">git-init-db</a>
  
    <li><a href="../git/Documentation/git-init_txt.html">git-init</a>
  
    <li><a href="../git/Documentation/git-instaweb_txt.html">git-instaweb</a>
  
    <li><a href="../git/Documentation/git-log_txt.html">git-log</a>
  
    <li><a href="../git/Documentation/git-lost-found_txt.html">git-lost-found</a>
  
    <li><a href="../git/Documentation/git-ls-files_txt.html">git-ls-files</a>
  
    <li><a href="../git/Documentation/git-ls-remote_txt.html">git-ls-remote</a>
  
    <li><a href="../git/Documentation/git-ls-tree_txt.html">git-ls-tree</a>
  
    <li><a href="../git/Documentation/git-mailinfo_txt.html">git-mailinfo</a>
  
    <li><a href="../git/Documentation/git-mailsplit_txt.html">git-mailsplit</a>
  
    <li><a href="../git/Documentation/git-merge-base_txt.html">git-merge-base</a>
  
    <li><a href="../git/Documentation/git-merge-file_txt.html">git-merge-file</a>
  
    <li><a href="../git/Documentation/git-merge-index_txt.html">git-merge-index</a>
  
    <li><a href="../git/Documentation/git-merge-one-file_txt.html">git-merge-one-file</a>
  
    <li><a href="../git/Documentation/git-merge-tree_txt.html">git-merge-tree</a>
  
    <li><a href="../git/Documentation/git-merge_txt.html">git-merge</a>
  
    <li><a href="../git/Documentation/git-mergetool--lib_txt.html">git-mergetool--lib</a>
  
    <li><a href="../git/Documentation/git-mergetool_txt.html">git-mergetool</a>
  
    <li><a href="../git/Documentation/git-mktag_txt.html">git-mktag</a>
  
    <li><a href="../git/Documentation/git-mktree_txt.html">git-mktree</a>
  
    <li><a href="../git/Documentation/git-mv_txt.html">git-mv</a>
  
    <li><a href="../git/Documentation/git-name-rev_txt.html">git-name-rev</a>
  
    <li><a href="../git/Documentation/git-notes_txt.html">git-notes</a>
  
    <li><a href="../git/Documentation/git-p4_txt.html">git-p4</a>
  
    <li><a href="../git/Documentation/git-pack-objects_txt.html">git-pack-objects</a>
  
    <li><a href="../git/Documentation/git-pack-redundant_txt.html">git-pack-redundant</a>
  
    <li><a href="../git/Documentation/git-pack-refs_txt.html">git-pack-refs</a>
  
    <li><a href="../git/Documentation/git-parse-remote_txt.html">git-parse-remote</a>
  
    <li><a href="../git/Documentation/git-patch-id_txt.html">git-patch-id</a>
  
    <li><a href="../git/Documentation/git-peek-remote_txt.html">git-peek-remote</a>
  
    <li><a href="../git/Documentation/git-prune-packed_txt.html">git-prune-packed</a>
  
    <li><a href="../git/Documentation/git-prune_txt.html">git-prune</a>
  
    <li><a href="../git/Documentation/git-pull_txt.html">git-pull</a>
  
    <li><a href="../git/Documentation/git-push_txt.html">git-push</a>
  
    <li><a href="../git/Documentation/git-quiltimport_txt.html">git-quiltimport</a>
  
    <li><a href="../git/Documentation/git-read-tree_txt.html">git-read-tree</a>
  
    <li><a href="../git/Documentation/git-rebase_txt.html">git-rebase</a>
  
    <li><a href="../git/Documentation/git-receive-pack_txt.html">git-receive-pack</a>
  
    <li><a href="../git/Documentation/git-reflog_txt.html">git-reflog</a>
  
    <li><a href="../git/Documentation/git-relink_txt.html">git-relink</a>
  
    <li><a href="../git/Documentation/git-remote-ext_txt.html">git-remote-ext</a>
  
    <li><a href="../git/Documentation/git-remote-fd_txt.html">git-remote-fd</a>
  
    <li><a href="../git/Documentation/git-remote-helpers_txto.html">git-remote-helpers.txto</a>
  
    <li><a href="../git/Documentation/git-remote-testgit_txt.html">git-remote-testgit</a>
  
    <li><a href="../git/Documentation/git-remote_txt.html">git-remote</a>
  
    <li><a href="../git/Documentation/git-repack_txt.html">git-repack</a>
  
    <li><a href="../git/Documentation/git-replace_txt.html">git-replace</a>
  
    <li><a href="../git/Documentation/git-repo-config_txt.html">git-repo-config</a>
  
    <li><a href="../git/Documentation/git-request-pull_txt.html">git-request-pull</a>
  
    <li><a href="../git/Documentation/git-rerere_txt.html">git-rerere</a>
  
    <li><a href="../git/Documentation/git-reset_txt.html">git-reset</a>
  
    <li><a href="../git/Documentation/git-rev-list_txt.html">git-rev-list</a>
  
    <li><a href="../git/Documentation/git-rev-parse_txt.html">git-rev-parse</a>
  
    <li><a href="../git/Documentation/git-revert_txt.html">git-revert</a>
  
    <li><a href="../git/Documentation/git-rm_txt.html">git-rm</a>
  
    <li><a href="../git/Documentation/git-send-email_txt.html">git-send-email</a>
  
    <li><a href="../git/Documentation/git-send-pack_txt.html">git-send-pack</a>
  
    <li><a href="../git/Documentation/git-sh-i18n--envsubst_txt.html">git-sh-i18n--envsubst</a>
  
    <li><a href="../git/Documentation/git-sh-i18n_txt.html">git-sh-i18n</a>
  
    <li><a href="../git/Documentation/git-sh-setup_txt.html">git-sh-setup</a>
  
    <li><a href="../git/Documentation/git-shell_txt.html">git-shell</a>
  
    <li><a href="../git/Documentation/git-shortlog_txt.html">git-shortlog</a>
  
    <li><a href="../git/Documentation/git-show-branch_txt.html">git-show-branch</a>
  
    <li><a href="../git/Documentation/git-show-index_txt.html">git-show-index</a>
  
    <li><a href="../git/Documentation/git-show-ref_txt.html">git-show-ref</a>
  
    <li><a href="../git/Documentation/git-show_txt.html">git-show</a>
  
    <li><a href="../git/Documentation/git-stage_txt.html">git-stage</a>
  
    <li><a href="../git/Documentation/git-stash_txt.html">git-stash</a>
  
    <li><a href="../git/Documentation/git-status_txt.html">git-status</a>
  
    <li><a href="../git/Documentation/git-stripspace_txt.html">git-stripspace</a>
  
    <li><a href="../git/Documentation/git-submodule_txt.html">git-submodule</a>
  
    <li><a href="../git/Documentation/git-svn_txt.html">git-svn</a>
  
    <li><a href="../git/Documentation/git-symbolic-ref_txt.html">git-symbolic-ref</a>
  
    <li><a href="../git/Documentation/git-tag_txt.html">git-tag</a>
  
    <li><a href="../git/Documentation/git-tar-tree_txt.html">git-tar-tree</a>
  
    <li><a href="../git/Documentation/git-tools_txt.html">git-tools</a>
  
    <li><a href="../git/Documentation/git-unpack-file_txt.html">git-unpack-file</a>
  
    <li><a href="../git/Documentation/git-unpack-objects_txt.html">git-unpack-objects</a>
  
    <li><a href="../git/Documentation/git-update-index_txt.html">git-update-index</a>
  
    <li><a href="../git/Documentation/git-update-ref_txt.html">git-update-ref</a>
  
    <li><a href="../git/Documentation/git-update-server-info_txt.html">git-update-server-info</a>
  
    <li><a href="../git/Documentation/git-upload-archive_txt.html">git-upload-archive</a>
  
    <li><a href="../git/Documentation/git-upload-pack_txt.html">git-upload-pack</a>
  
    <li><a href="../git/Documentation/git-var_txt.html">git-var</a>
  
    <li><a href="../git/Documentation/git-verify-pack_txt.html">git-verify-pack</a>
  
    <li><a href="../git/Documentation/git-verify-tag_txt.html">git-verify-tag</a>
  
    <li><a href="../git/Documentation/git-web--browse_txt.html">git-web--browse</a>
  
    <li><a href="../git/Documentation/git-whatchanged_txt.html">git-whatchanged</a>
  
    <li><a href="../git/Documentation/git-write-tree_txt.html">git-write-tree</a>
  
    <li><a href="../git/Documentation/git_txt.html">git</a>
  
    <li><a href="../git/Documentation/gitattributes_txt.html">gitattributes</a>
  
    <li><a href="../git/Documentation/gitcli_txt.html">gitcli</a>
  
    <li><a href="../git/Documentation/gitcore-tutorial_txt.html">gitcore-tutorial</a>
  
    <li><a href="../git/Documentation/gitcredentials_txt.html">gitcredentials</a>
  
    <li><a href="../git/Documentation/gitcvs-migration_txt.html">gitcvs-migration</a>
  
    <li><a href="../git/Documentation/gitdiffcore_txt.html">gitdiffcore</a>
  
    <li><a href="../git/Documentation/gitglossary_txt.html">gitglossary</a>
  
    <li><a href="../git/Documentation/githooks_txt.html">githooks</a>
  
    <li><a href="../git/Documentation/gitignore_txt.html">gitignore</a>
  
    <li><a href="../git/Documentation/gitk_txt.html">gitk</a>
  
    <li><a href="../git/Documentation/gitmodules_txt.html">gitmodules</a>
  
    <li><a href="../git/Documentation/gitnamespaces_txt.html">gitnamespaces</a>
  
    <li><a href="../git/Documentation/gitremote-helpers_txt.html">gitremote-helpers</a>
  
    <li><a href="../git/Documentation/gitrepository-layout_txt.html">gitrepository-layout</a>
  
    <li><a href="../git/Documentation/gitrevisions_txt.html">gitrevisions</a>
  
    <li><a href="../git/Documentation/gittutorial-2_txt.html">gittutorial-2</a>
  
    <li><a href="../git/Documentation/gittutorial_txt.html">gittutorial</a>
  
    <li><a href="../git/Documentation/gitweb_conf_txt.html">gitweb.conf</a>
  
    <li><a href="../git/Documentation/gitweb_txt.html">gitweb</a>
  
    <li><a href="../git/Documentation/gitworkflows_txt.html">gitworkflows</a>
  
    <li><a href="../git/Documentation/glossary-content_txt.html">glossary-content</a>
  
    <li><a href="../git/Documentation/howto-index_sh.html">howto-index.sh</a>
  
    <li><a href="../git/Documentation/howto/maintain-git_txt.html">maintain-git</a>
  
    <li><a href="../git/Documentation/howto/new-command_txt.html">new-command</a>
  
    <li><a href="../git/Documentation/howto/rebase-from-internal-branch_txt.html">rebase-from-internal-branch</a>
  
    <li><a href="../git/Documentation/howto/rebuild-from-update-hook_txt.html">rebuild-from-update-hook</a>
  
    <li><a href="../git/Documentation/howto/recover-corrupted-blob-object_txt.html">recover-corrupted-blob-object</a>
  
    <li><a href="../git/Documentation/howto/revert-a-faulty-merge_txt.html">revert-a-faulty-merge</a>
  
    <li><a href="../git/Documentation/howto/revert-branch-rebase_txt.html">revert-branch-rebase</a>
  
    <li><a href="../git/Documentation/howto/separating-topic-branches_txt.html">separating-topic-branches</a>
  
    <li><a href="../git/Documentation/howto/setup-git-server-over-http_txt.html">setup-git-server-over-http</a>
  
    <li><a href="../git/Documentation/howto/update-hook-example_txt.html">update-hook-example</a>
  
    <li><a href="../git/Documentation/howto/use-git-daemon_txt.html">use-git-daemon</a>
  
    <li><a href="../git/Documentation/howto/using-merge-subtree_txt.html">using-merge-subtree</a>
  
    <li><a href="../git/Documentation/howto/using-signed-tag-in-pull-request_txt.html">using-signed-tag-in-pull-request</a>
  
    <li><a href="../git/Documentation/i18n_txt.html">i18n</a>
  
    <li><a href="../git/Documentation/install-doc-quick_sh.html">install-doc-quick.sh</a>
  
    <li><a href="../git/Documentation/install-webdoc_sh.html">install-webdoc.sh</a>
  
    <li><a href="../git/Documentation/line-range-format_txt.html">line-range-format</a>
  
    <li><a href="../git/Documentation/mailmap_txt.html">mailmap</a>
  
    <li><a href="../git/Documentation/manpage-1_72_xsl.html">manpage-1.72.xsl</a>
  
    <li><a href="../git/Documentation/manpage-base-url_xsl_in.html">manpage-base-url.xsl.in</a>
  
    <li><a href="../git/Documentation/manpage-base_xsl.html">manpage-base.xsl</a>
  
    <li><a href="../git/Documentation/manpage-bold-literal_xsl.html">manpage-bold-literal.xsl</a>
  
    <li><a href="../git/Documentation/manpage-normal_xsl.html">manpage-normal.xsl</a>
  
    <li><a href="../git/Documentation/manpage-quote-apos_xsl.html">manpage-quote-apos.xsl</a>
  
    <li><a href="../git/Documentation/manpage-suppress-sp_xsl.html">manpage-suppress-sp.xsl</a>
  
    <li><a href="../git/Documentation/merge-config_txt.html">merge-config</a>
  
    <li><a href="../git/Documentation/merge-options_txt.html">merge-options</a>
  
    <li><a href="../git/Documentation/merge-strategies_txt.html">merge-strategies</a>
  
    <li><a href="../git/Documentation/pretty-formats_txt.html">pretty-formats</a>
  
    <li><a href="../git/Documentation/pretty-options_txt.html">pretty-options</a>
  
    <li><a href="../git/Documentation/pull-fetch-param_txt.html">pull-fetch-param</a>
  
    <li><a href="../git/Documentation/rev-list-options_txt.html">rev-list-options</a>
  
    <li><a href="../git/Documentation/revisions_txt.html">revisions</a>
  
    <li><a href="../git/Documentation/sequencer_txt.html">sequencer</a>
  
    <li><a href="../git/Documentation/technical/api-allocation-growing_txt.html">api-allocation-growing</a>
  
    <li><a href="../git/Documentation/technical/api-argv-array_txt.html">api-argv-array</a>
  
    <li><a href="../git/Documentation/technical/api-builtin_txt.html">api-builtin</a>
  
    <li><a href="../git/Documentation/technical/api-config_txt.html">api-config</a>
  
    <li><a href="../git/Documentation/technical/api-credentials_txt.html">api-credentials</a>
  
    <li><a href="../git/Documentation/technical/api-decorate_txt.html">api-decorate</a>
  
    <li><a href="../git/Documentation/technical/api-diff_txt.html">api-diff</a>
  
    <li><a href="../git/Documentation/technical/api-directory-listing_txt.html">api-directory-listing</a>
  
    <li><a href="../git/Documentation/technical/api-gitattributes_txt.html">api-gitattributes</a>
  
    <li><a href="../git/Documentation/technical/api-grep_txt.html">api-grep</a>
  
    <li><a href="../git/Documentation/technical/api-hash_txt.html">api-hash</a>
  
    <li><a href="../git/Documentation/technical/api-history-graph_txt.html">api-history-graph</a>
  
    <li><a href="../git/Documentation/technical/api-in-core-index_txt.html">api-in-core-index</a>
  
    <li><a href="../git/Documentation/technical/api-index-skel_txt.html">api-index-skel</a>
  
    <li><a href="../git/Documentation/technical/api-index_sh.html">api-index.sh</a>
  
    <li><a href="../git/Documentation/technical/api-lockfile_txt.html">api-lockfile</a>
  
    <li><a href="../git/Documentation/technical/api-merge_txt.html">api-merge</a>
  
    <li><a href="../git/Documentation/technical/api-object-access_txt.html">api-object-access</a>
  
    <li><a href="../git/Documentation/technical/api-parse-options_txt.html">api-parse-options</a>
  
    <li><a href="../git/Documentation/technical/api-quote_txt.html">api-quote</a>
  
    <li><a href="../git/Documentation/technical/api-ref-iteration_txt.html">api-ref-iteration</a>
  
    <li><a href="../git/Documentation/technical/api-remote_txt.html">api-remote</a>
  
    <li><a href="../git/Documentation/technical/api-revision-walking_txt.html">api-revision-walking</a>
  
    <li><a href="../git/Documentation/technical/api-run-command_txt.html">api-run-command</a>
  
    <li><a href="../git/Documentation/technical/api-setup_txt.html">api-setup</a>
  
    <li><a href="../git/Documentation/technical/api-sha1-array_txt.html">api-sha1-array</a>
  
    <li><a href="../git/Documentation/technical/api-sigchain_txt.html">api-sigchain</a>
  
    <li><a href="../git/Documentation/technical/api-strbuf_txt.html">api-strbuf</a>
  
    <li><a href="../git/Documentation/technical/api-string-list_txt.html">api-string-list</a>
  
    <li><a href="../git/Documentation/technical/api-tree-walking_txt.html">api-tree-walking</a>
  
    <li><a href="../git/Documentation/technical/api-xdiff-interface_txt.html">api-xdiff-interface</a>
  
    <li><a href="../git/Documentation/technical/http-protocol_txt.html">http-protocol</a>
  
    <li><a href="../git/Documentation/technical/index-format_txt.html">index-format</a>
  
    <li><a href="../git/Documentation/technical/pack-format_txt.html">pack-format</a>
  
    <li><a href="../git/Documentation/technical/pack-heuristics_txt.html">pack-heuristics</a>
  
    <li><a href="../git/Documentation/technical/pack-protocol_txt.html">pack-protocol</a>
  
    <li><a href="../git/Documentation/technical/protocol-capabilities_txt.html">protocol-capabilities</a>
  
    <li><a href="../git/Documentation/technical/protocol-common_txt.html">protocol-common</a>
  
    <li><a href="../git/Documentation/technical/racy-git_txt.html">racy-git</a>
  
    <li><a href="../git/Documentation/technical/send-pack-pipeline_txt.html">send-pack-pipeline</a>
  
    <li><a href="../git/Documentation/technical/shallow_txt.html">shallow</a>
  
    <li><a href="../git/Documentation/technical/trivial-merge_txt.html">trivial-merge</a>
  
    <li><a href="../git/Documentation/urls-remotes_txt.html">urls-remotes</a>
  
    <li><a href="../git/Documentation/urls_txt.html">urls</a>
  
    <li><a href="../git/Documentation/user-manual_conf.html">user-manual.conf</a>
  
    <li><a href="../git/Documentation/user-manual_txt.html">user-manual</a>
  
    <li><a href="../git/GIT-CFLAGS.html">GIT-CFLAGS</a>
  
    <li><a href="../git/GIT-VERSION-FILE.html">GIT-VERSION-FILE</a>
  
    <li><a href="../git/GIT-VERSION-GEN.html">GIT-VERSION-GEN</a>
  
    <li><a href="../git/INSTALL.html">INSTALL</a>
  
    <li><a href="../git/LGPL-2_1.html">LGPL-2.1</a>
  
    <li><a href="../git/Makefile.html">Makefile</a>
  
    <li><a href="../git/README.html">README</a>
  
    <li><a href="../git/RelNotes.html">RelNotes</a>
  
    <li><a href="../git/aclocal_m4.html">aclocal.m4</a>
  
    <li><a href="../git/check-builtins_sh.html">check-builtins.sh</a>
  
    <li><a href="../git/check_bindir.html">check_bindir</a>
  
    <li><a href="../git/command-list_txt.html">command-list</a>
  
    <li><a href="../git/compat/nedmalloc/License_txt.html">License</a>
  
    <li><a href="../git/compat/nedmalloc/Readme_txt.html">Readme</a>
  
    <li><a href="../git/compat/vcbuild/README.html">README</a>
  
    <li><a href="../git/compat/vcbuild/scripts/clink_pl.html">clink.pl</a>
  
    <li><a href="../git/compat/vcbuild/scripts/lib_pl.html">lib.pl</a>
  
    <li><a href="../git/config_mak_in.html">config.mak.in</a>
  
    <li><a href="../git/config_mak_uname.html">config.mak.uname</a>
  
    <li><a href="../git/contrib/README.html">README</a>
  
    <li><a href="../git/contrib/buildsystems/Generators_pm.html">Generators.pm</a>
  
    <li><a href="../git/contrib/buildsystems/Generators/QMake_pm.html">QMake.pm</a>
  
    <li><a href="../git/contrib/buildsystems/Generators/Vcproj_pm.html">Vcproj.pm</a>
  
    <li><a href="../git/contrib/buildsystems/engine_pl.html">engine.pl</a>
  
    <li><a href="../git/contrib/buildsystems/generate.html">generate</a>
  
    <li><a href="../git/contrib/buildsystems/parse_pl.html">parse.pl</a>
  
    <li><a href="../git/contrib/ciabot/INSTALL.html">INSTALL</a>
  
    <li><a href="../git/contrib/ciabot/README.html">README</a>
  
    <li><a href="../git/contrib/ciabot/ciabot_py.html">ciabot.py</a>
  
    <li><a href="../git/contrib/ciabot/ciabot_sh.html">ciabot.sh</a>
  
    <li><a href="../git/contrib/completion/git-completion_bash.html">git-completion.bash</a>
  
    <li><a href="../git/contrib/completion/git-completion_tcsh.html">git-completion.tcsh</a>
  
    <li><a href="../git/contrib/completion/git-completion_zsh.html">git-completion.zsh</a>
  
    <li><a href="../git/contrib/completion/git-prompt_sh.html">git-prompt.sh</a>
  
    <li><a href="../git/contrib/contacts/git-contacts.html">git-contacts</a>
  
    <li><a href="../git/contrib/contacts/git-contacts_txt.html">git-contacts</a>
  
    <li><a href="../git/contrib/convert-objects/git-convert-objects_txt.html">git-convert-objects</a>
  
    <li><a href="../git/contrib/credential/gnome-keyring/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/credential/netrc/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/credential/netrc/git-credential-netrc.html">git-credential-netrc</a>
  
    <li><a href="../git/contrib/credential/netrc/test_netrc.html">test.netrc</a>
  
    <li><a href="../git/contrib/credential/netrc/test_pl.html">test.pl</a>
  
    <li><a href="../git/contrib/credential/osxkeychain/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/credential/wincred/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/diff-highlight/README.html">README</a>
  
    <li><a href="../git/contrib/diff-highlight/diff-highlight.html">diff-highlight</a>
  
    <li><a href="../git/contrib/diffall/README.html">README</a>
  
    <li><a href="../git/contrib/diffall/git-diffall.html">git-diffall</a>
  
    <li><a href="../git/contrib/emacs/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/emacs/README.html">README</a>
  
    <li><a href="../git/contrib/emacs/git-blame_el.html">git-blame.el</a>
  
    <li><a href="../git/contrib/emacs/git_el.html">git.el</a>
  
    <li><a href="../git/contrib/examples/README.html">README</a>
  
    <li><a href="../git/contrib/examples/git-checkout_sh.html">git-checkout.sh</a>
  
    <li><a href="../git/contrib/examples/git-clean_sh.html">git-clean.sh</a>
  
    <li><a href="../git/contrib/examples/git-clone_sh.html">git-clone.sh</a>
  
    <li><a href="../git/contrib/examples/git-commit_sh.html">git-commit.sh</a>
  
    <li><a href="../git/contrib/examples/git-fetch_sh.html">git-fetch.sh</a>
  
    <li><a href="../git/contrib/examples/git-gc_sh.html">git-gc.sh</a>
  
    <li><a href="../git/contrib/examples/git-log_sh.html">git-log.sh</a>
  
    <li><a href="../git/contrib/examples/git-ls-remote_sh.html">git-ls-remote.sh</a>
  
    <li><a href="../git/contrib/examples/git-merge-ours_sh.html">git-merge-ours.sh</a>
  
    <li><a href="../git/contrib/examples/git-merge_sh.html">git-merge.sh</a>
  
    <li><a href="../git/contrib/examples/git-notes_sh.html">git-notes.sh</a>
  
    <li><a href="../git/contrib/examples/git-remote_perl.html">git-remote.perl</a>
  
    <li><a href="../git/contrib/examples/git-rerere_perl.html">git-rerere.perl</a>
  
    <li><a href="../git/contrib/examples/git-reset_sh.html">git-reset.sh</a>
  
    <li><a href="../git/contrib/examples/git-resolve_sh.html">git-resolve.sh</a>
  
    <li><a href="../git/contrib/examples/git-revert_sh.html">git-revert.sh</a>
  
    <li><a href="../git/contrib/examples/git-svnimport_perl.html">git-svnimport.perl</a>
  
    <li><a href="../git/contrib/examples/git-svnimport_txt.html">git-svnimport</a>
  
    <li><a href="../git/contrib/examples/git-tag_sh.html">git-tag.sh</a>
  
    <li><a href="../git/contrib/examples/git-verify-tag_sh.html">git-verify-tag.sh</a>
  
    <li><a href="../git/contrib/examples/git-whatchanged_sh.html">git-whatchanged.sh</a>
  
    <li><a href="../git/contrib/fast-import/git-import_perl.html">git-import.perl</a>
  
    <li><a href="../git/contrib/fast-import/git-import_sh.html">git-import.sh</a>
  
    <li><a href="../git/contrib/fast-import/git-p4_README.html">git-p4.README</a>
  
    <li><a href="../git/contrib/fast-import/import-directories_perl.html">import-directories.perl</a>
  
    <li><a href="../git/contrib/fast-import/import-tars_perl.html">import-tars.perl</a>
  
    <li><a href="../git/contrib/fast-import/import-zips_py.html">import-zips.py</a>
  
    <li><a href="../git/contrib/git-jump/README.html">README</a>
  
    <li><a href="../git/contrib/git-jump/git-jump.html">git-jump</a>
  
    <li><a href="../git/contrib/git-resurrect_sh.html">git-resurrect.sh</a>
  
    <li><a href="../git/contrib/git-shell-commands/README.html">README</a>
  
    <li><a href="../git/contrib/git-shell-commands/help.html">help</a>
  
    <li><a href="../git/contrib/git-shell-commands/list.html">list</a>
  
    <li><a href="../git/contrib/gitview/gitview.html">gitview</a>
  
    <li><a href="../git/contrib/gitview/gitview_txt.html">gitview</a>
  
    <li><a href="../git/contrib/hg-to-git/hg-to-git_py.html">hg-to-git.py</a>
  
    <li><a href="../git/contrib/hg-to-git/hg-to-git_txt.html">hg-to-git</a>
  
    <li><a href="../git/contrib/hooks/multimail/README.html">README</a>
  
    <li><a href="../git/contrib/hooks/multimail/README_Git.html">README.Git</a>
  
    <li><a href="../git/contrib/hooks/multimail/README_migrate-from-post-receive-email.html">README.migrate-from-post-receive-email</a>
  
    <li><a href="../git/contrib/hooks/multimail/git_multimail_py.html">git_multimail.py</a>
  
    <li><a href="../git/contrib/hooks/multimail/migrate-mailhook-config.html">migrate-mailhook-config</a>
  
    <li><a href="../git/contrib/hooks/multimail/post-receive.html">post-receive</a>
  
    <li><a href="../git/contrib/hooks/post-receive-email.html">post-receive-email</a>
  
    <li><a href="../git/contrib/hooks/pre-auto-gc-battery.html">pre-auto-gc-battery</a>
  
    <li><a href="../git/contrib/hooks/setgitperms_perl.html">setgitperms.perl</a>
  
    <li><a href="../git/contrib/hooks/update-paranoid.html">update-paranoid</a>
  
    <li><a href="../git/contrib/mw-to-git/Git/Mediawiki_pm.html">Mediawiki.pm</a>
  
    <li><a href="../git/contrib/mw-to-git/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/mw-to-git/bin-wrapper/git.html">git</a>
  
    <li><a href="../git/contrib/mw-to-git/git-mw_perl.html">git-mw.perl</a>
  
    <li><a href="../git/contrib/mw-to-git/git-remote-mediawiki_perl.html">git-remote-mediawiki.perl</a>
  
    <li><a href="../git/contrib/mw-to-git/git-remote-mediawiki_txt.html">git-remote-mediawiki</a>
  
    <li><a href="../git/contrib/mw-to-git/t/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/mw-to-git/t/README.html">README</a>
  
    <li><a href="../git/contrib/mw-to-git/t/install-wiki_sh.html">install-wiki.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/install-wiki/LocalSettings_php.html">LocalSettings.php</a>
  
    <li><a href="../git/contrib/mw-to-git/t/install-wiki/db_install_php.html">db_install.php</a>
  
    <li><a href="../git/contrib/mw-to-git/t/push-pull-tests_sh.html">push-pull-tests.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9360-mw-to-git-clone_sh.html">t9360-mw-to-git-clone.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9361-mw-to-git-push-pull_sh.html">t9361-mw-to-git-push-pull.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9362-mw-to-git-utf8_sh.html">t9362-mw-to-git-utf8.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9363-mw-to-git-export-import_sh.html">t9363-mw-to-git-export-import.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/t9364-pull-by-rev_sh.html">t9364-pull-by-rev.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/test-gitmw-lib_sh.html">test-gitmw-lib.sh</a>
  
    <li><a href="../git/contrib/mw-to-git/t/test-gitmw_pl.html">test-gitmw.pl</a>
  
    <li><a href="../git/contrib/mw-to-git/t/test_config.html">test.config</a>
  
    <li><a href="../git/contrib/p4import/README.html">README</a>
  
    <li><a href="../git/contrib/p4import/git-p4import_py.html">git-p4import.py</a>
  
    <li><a href="../git/contrib/p4import/git-p4import_txt.html">git-p4import</a>
  
    <li><a href="../git/contrib/persistent-https/LICENSE.html">LICENSE</a>
  
    <li><a href="../git/contrib/persistent-https/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/persistent-https/README.html">README</a>
  
    <li><a href="../git/contrib/persistent-https/client_go.html">client.go</a>
  
    <li><a href="../git/contrib/persistent-https/main_go.html">main.go</a>
  
    <li><a href="../git/contrib/persistent-https/proxy_go.html">proxy.go</a>
  
    <li><a href="../git/contrib/persistent-https/socket_go.html">socket.go</a>
  
    <li><a href="../git/contrib/remote-helpers/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/remote-helpers/git-remote-bzr.html">git-remote-bzr</a>
  
    <li><a href="../git/contrib/remote-helpers/git-remote-hg.html">git-remote-hg</a>
  
    <li><a href="../git/contrib/remote-helpers/test-bzr_sh.html">test-bzr.sh</a>
  
    <li><a href="../git/contrib/remote-helpers/test-hg-bidi_sh.html">test-hg-bidi.sh</a>
  
    <li><a href="../git/contrib/remote-helpers/test-hg-hg-git_sh.html">test-hg-hg-git.sh</a>
  
    <li><a href="../git/contrib/remote-helpers/test-hg_sh.html">test-hg.sh</a>
  
    <li><a href="../git/contrib/remotes2config_sh.html">remotes2config.sh</a>
  
    <li><a href="../git/contrib/rerere-train_sh.html">rerere-train.sh</a>
  
    <li><a href="../git/contrib/stats/git-common-hash.html">git-common-hash</a>
  
    <li><a href="../git/contrib/stats/mailmap_pl.html">mailmap.pl</a>
  
    <li><a href="../git/contrib/stats/packinfo_pl.html">packinfo.pl</a>
  
    <li><a href="../git/contrib/subtree/COPYING.html">COPYING</a>
  
    <li><a href="../git/contrib/subtree/INSTALL.html">INSTALL</a>
  
    <li><a href="../git/contrib/subtree/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/subtree/README.html">README</a>
  
    <li><a href="../git/contrib/subtree/git-subtree_sh.html">git-subtree.sh</a>
  
    <li><a href="../git/contrib/subtree/git-subtree_txt.html">git-subtree</a>
  
    <li><a href="../git/contrib/subtree/t/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/subtree/t/t7900-subtree_sh.html">t7900-subtree.sh</a>
  
    <li><a href="../git/contrib/subtree/todo.html">todo</a>
  
    <li><a href="../git/contrib/svn-fe/Makefile.html">Makefile</a>
  
    <li><a href="../git/contrib/svn-fe/svn-fe_txt.html">svn-fe</a>
  
    <li><a href="../git/contrib/svn-fe/svnrdump_sim_py.html">svnrdump_sim.py</a>
  
    <li><a href="../git/contrib/thunderbird-patch-inline/README.html">README</a>
  
    <li><a href="../git/contrib/thunderbird-patch-inline/appp_sh.html">appp.sh</a>
  
    <li><a href="../git/contrib/vim/README.html">README</a>
  
    <li><a href="../git/contrib/workdir/git-new-workdir.html">git-new-workdir</a>
  
    <li><a href="../git/generate-cmdlist_sh.html">generate-cmdlist.sh</a>
  
    <li><a href="../git/git-add--interactive_perl.html">git-add--interactive.perl</a>
  
    <li><a href="../git/git-am_sh.html">git-am.sh</a>
  
    <li><a href="../git/git-archimport_perl.html">git-archimport.perl</a>
  
    <li><a href="../git/git-bisect_sh.html">git-bisect.sh</a>
  
    <li><a href="../git/git-cvsexportcommit_perl.html">git-cvsexportcommit.perl</a>
  
    <li><a href="../git/git-cvsimport_perl.html">git-cvsimport.perl</a>
  
    <li><a href="../git/git-cvsserver_perl.html">git-cvsserver.perl</a>
  
    <li><a href="../git/git-difftool--helper_sh.html">git-difftool--helper.sh</a>
  
    <li><a href="../git/git-difftool_perl.html">git-difftool.perl</a>
  
    <li><a href="../git/git-filter-branch_sh.html">git-filter-branch.sh</a>
  
    <li><a href="../git/git-gui/GIT-VERSION-GEN.html">GIT-VERSION-GEN</a>
  
    <li><a href="../git/git-gui/Makefile.html">Makefile</a>
  
    <li><a href="../git/git-gui/git-gui--askpass.html">git-gui--askpass</a>
  
    <li><a href="../git/git-gui/git-gui_sh.html">git-gui.sh</a>
  
    <li><a href="../git/git-gui/lib/about_tcl.html">about.tcl</a>
  
    <li><a href="../git/git-gui/lib/blame_tcl.html">blame.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_tcl.html">branch.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_checkout_tcl.html">branch_checkout.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_create_tcl.html">branch_create.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_delete_tcl.html">branch_delete.tcl</a>
  
    <li><a href="../git/git-gui/lib/branch_rename_tcl.html">branch_rename.tcl</a>
  
    <li><a href="../git/git-gui/lib/browser_tcl.html">browser.tcl</a>
  
    <li><a href="../git/git-gui/lib/checkout_op_tcl.html">checkout_op.tcl</a>
  
    <li><a href="../git/git-gui/lib/choose_font_tcl.html">choose_font.tcl</a>
  
    <li><a href="../git/git-gui/lib/choose_repository_tcl.html">choose_repository.tcl</a>
  
    <li><a href="../git/git-gui/lib/choose_rev_tcl.html">choose_rev.tcl</a>
  
    <li><a href="../git/git-gui/lib/class_tcl.html">class.tcl</a>
  
    <li><a href="../git/git-gui/lib/commit_tcl.html">commit.tcl</a>
  
    <li><a href="../git/git-gui/lib/console_tcl.html">console.tcl</a>
  
    <li><a href="../git/git-gui/lib/database_tcl.html">database.tcl</a>
  
    <li><a href="../git/git-gui/lib/date_tcl.html">date.tcl</a>
  
    <li><a href="../git/git-gui/lib/diff_tcl.html">diff.tcl</a>
  
    <li><a href="../git/git-gui/lib/encoding_tcl.html">encoding.tcl</a>
  
    <li><a href="../git/git-gui/lib/error_tcl.html">error.tcl</a>
  
    <li><a href="../git/git-gui/lib/index_tcl.html">index.tcl</a>
  
    <li><a href="../git/git-gui/lib/line_tcl.html">line.tcl</a>
  
    <li><a href="../git/git-gui/lib/logo_tcl.html">logo.tcl</a>
  
    <li><a href="../git/git-gui/lib/merge_tcl.html">merge.tcl</a>
  
    <li><a href="../git/git-gui/lib/mergetool_tcl.html">mergetool.tcl</a>
  
    <li><a href="../git/git-gui/lib/option_tcl.html">option.tcl</a>
  
    <li><a href="../git/git-gui/lib/remote_tcl.html">remote.tcl</a>
  
    <li><a href="../git/git-gui/lib/remote_add_tcl.html">remote_add.tcl</a>
  
    <li><a href="../git/git-gui/lib/remote_branch_delete_tcl.html">remote_branch_delete.tcl</a>
  
    <li><a href="../git/git-gui/lib/search_tcl.html">search.tcl</a>
  
    <li><a href="../git/git-gui/lib/shortcut_tcl.html">shortcut.tcl</a>
  
    <li><a href="../git/git-gui/lib/spellcheck_tcl.html">spellcheck.tcl</a>
  
    <li><a href="../git/git-gui/lib/sshkey_tcl.html">sshkey.tcl</a>
  
    <li><a href="../git/git-gui/lib/status_bar_tcl.html">status_bar.tcl</a>
  
    <li><a href="../git/git-gui/lib/themed_tcl.html">themed.tcl</a>
  
    <li><a href="../git/git-gui/lib/tools_tcl.html">tools.tcl</a>
  
    <li><a href="../git/git-gui/lib/tools_dlg_tcl.html">tools_dlg.tcl</a>
  
    <li><a href="../git/git-gui/lib/transport_tcl.html">transport.tcl</a>
  
    <li><a href="../git/git-gui/lib/win32_tcl.html">win32.tcl</a>
  
    <li><a href="../git/git-gui/lib/win32_shortcut_js.html">win32_shortcut.js</a>
  
    <li><a href="../git/git-gui/macosx/AppMain_tcl.html">AppMain.tcl</a>
  
    <li><a href="../git/git-gui/macosx/Info_plist.html">Info.plist</a>
  
    <li><a href="../git/git-gui/po/README.html">README</a>
  
    <li><a href="../git/git-gui/po/de_po.html">de.po</a>
  
    <li><a href="../git/git-gui/po/el_po.html">el.po</a>
  
    <li><a href="../git/git-gui/po/fr_po.html">fr.po</a>
  
    <li><a href="../git/git-gui/po/git-gui_pot.html">git-gui.pot</a>
  
    <li><a href="../git/git-gui/po/glossary/Makefile.html">Makefile</a>
  
    <li><a href="../git/git-gui/po/glossary/de_po.html">de.po</a>
  
    <li><a href="../git/git-gui/po/glossary/el_po.html">el.po</a>
  
    <li><a href="../git/git-gui/po/glossary/fr_po.html">fr.po</a>
  
    <li><a href="../git/git-gui/po/glossary/git-gui-glossary_pot.html">git-gui-glossary.pot</a>
  
    <li><a href="../git/git-gui/po/glossary/git-gui-glossary_txt.html">git-gui-glossary</a>
  
    <li><a href="../git/git-gui/po/glossary/it_po.html">it.po</a>
  
    <li><a href="../git/git-gui/po/glossary/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../git/git-gui/po/glossary/txt-to-pot_sh.html">txt-to-pot.sh</a>
  
    <li><a href="../git/git-gui/po/glossary/zh_cn_po.html">zh_cn.po</a>
  
    <li><a href="../git/git-gui/po/hu_po.html">hu.po</a>
  
    <li><a href="../git/git-gui/po/it_po.html">it.po</a>
  
    <li><a href="../git/git-gui/po/ja_po.html">ja.po</a>
  
    <li><a href="../git/git-gui/po/nb_po.html">nb.po</a>
  
    <li><a href="../git/git-gui/po/po2msg_sh.html">po2msg.sh</a>
  
    <li><a href="../git/git-gui/po/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../git/git-gui/po/ru_po.html">ru.po</a>
  
    <li><a href="../git/git-gui/po/sv_po.html">sv.po</a>
  
    <li><a href="../git/git-gui/po/zh_cn_po.html">zh_cn.po</a>
  
    <li><a href="../git/git-gui/windows/git-gui_sh.html">git-gui.sh</a>
  
    <li><a href="../git/git-instaweb_sh.html">git-instaweb.sh</a>
  
    <li><a href="../git/git-lost-found_sh.html">git-lost-found.sh</a>
  
    <li><a href="../git/git-merge-octopus_sh.html">git-merge-octopus.sh</a>
  
    <li><a href="../git/git-merge-one-file_sh.html">git-merge-one-file.sh</a>
  
    <li><a href="../git/git-merge-resolve_sh.html">git-merge-resolve.sh</a>
  
    <li><a href="../git/git-mergetool--lib_sh.html">git-mergetool--lib.sh</a>
  
    <li><a href="../git/git-mergetool_sh.html">git-mergetool.sh</a>
  
    <li><a href="../git/git-p4_py.html">git-p4.py</a>
  
    <li><a href="../git/git-parse-remote_sh.html">git-parse-remote.sh</a>
  
    <li><a href="../git/git-pull_sh.html">git-pull.sh</a>
  
    <li><a href="../git/git-quiltimport_sh.html">git-quiltimport.sh</a>
  
    <li><a href="../git/git-rebase--am_sh.html">git-rebase--am.sh</a>
  
    <li><a href="../git/git-rebase--interactive_sh.html">git-rebase--interactive.sh</a>
  
    <li><a href="../git/git-rebase--merge_sh.html">git-rebase--merge.sh</a>
  
    <li><a href="../git/git-rebase_sh.html">git-rebase.sh</a>
  
    <li><a href="../git/git-relink_perl.html">git-relink.perl</a>
  
    <li><a href="../git/git-remote-testgit_sh.html">git-remote-testgit.sh</a>
  
    <li><a href="../git/git-repack_sh.html">git-repack.sh</a>
  
    <li><a href="../git/git-request-pull_sh.html">git-request-pull.sh</a>
  
    <li><a href="../git/git-send-email_perl.html">git-send-email.perl</a>
  
    <li><a href="../git/git-sh-i18n_sh.html">git-sh-i18n.sh</a>
  
    <li><a href="../git/git-sh-setup_sh.html">git-sh-setup.sh</a>
  
    <li><a href="../git/git-stash_sh.html">git-stash.sh</a>
  
    <li><a href="../git/git-submodule_sh.html">git-submodule.sh</a>
  
    <li><a href="../git/git-svn_perl.html">git-svn.perl</a>
  
    <li><a href="../git/git-web--browse_sh.html">git-web--browse.sh</a>
  
    <li><a href="../git/git_rc.html">git.rc</a>
  
    <li><a href="../git/git_spec_in.html">git.spec.in</a>
  
    <li><a href="../git/gitk-git/Makefile.html">Makefile</a>
  
    <li><a href="../git/gitk-git/gitk.html">gitk</a>
  
    <li><a href="../git/gitk-git/po/de_po.html">de.po</a>
  
    <li><a href="../git/gitk-git/po/es_po.html">es.po</a>
  
    <li><a href="../git/gitk-git/po/fr_po.html">fr.po</a>
  
    <li><a href="../git/gitk-git/po/hu_po.html">hu.po</a>
  
    <li><a href="../git/gitk-git/po/it_po.html">it.po</a>
  
    <li><a href="../git/gitk-git/po/ja_po.html">ja.po</a>
  
    <li><a href="../git/gitk-git/po/po2msg_sh.html">po2msg.sh</a>
  
    <li><a href="../git/gitk-git/po/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../git/gitk-git/po/ru_po.html">ru.po</a>
  
    <li><a href="../git/gitk-git/po/sv_po.html">sv.po</a>
  
    <li><a href="../git/gitweb/INSTALL.html">INSTALL</a>
  
    <li><a href="../git/gitweb/Makefile.html">Makefile</a>
  
    <li><a href="../git/gitweb/README.html">README</a>
  
    <li><a href="../git/gitweb/gitweb_perl.html">gitweb.perl</a>
  
    <li><a href="../git/gitweb/static/gitweb_css.html">gitweb.css</a>
  
    <li><a href="../git/gitweb/static/js/README.html">README</a>
  
    <li><a href="../git/gitweb/static/js/adjust-timezone_js.html">adjust-timezone.js</a>
  
    <li><a href="../git/gitweb/static/js/blame_incremental_js.html">blame_incremental.js</a>
  
    <li><a href="../git/gitweb/static/js/javascript-detection_js.html">javascript-detection.js</a>
  
    <li><a href="../git/gitweb/static/js/lib/common-lib_js.html">common-lib.js</a>
  
    <li><a href="../git/gitweb/static/js/lib/cookies_js.html">cookies.js</a>
  
    <li><a href="../git/gitweb/static/js/lib/datetime_js.html">datetime.js</a>
  
    <li><a href="../git/mergetools/araxis.html">araxis</a>
  
    <li><a href="../git/mergetools/bc3.html">bc3</a>
  
    <li><a href="../git/mergetools/codecompare.html">codecompare</a>
  
    <li><a href="../git/mergetools/deltawalker.html">deltawalker</a>
  
    <li><a href="../git/mergetools/diffuse.html">diffuse</a>
  
    <li><a href="../git/mergetools/ecmerge.html">ecmerge</a>
  
    <li><a href="../git/mergetools/emerge.html">emerge</a>
  
    <li><a href="../git/mergetools/gvimdiff.html">gvimdiff</a>
  
    <li><a href="../git/mergetools/gvimdiff2.html">gvimdiff2</a>
  
    <li><a href="../git/mergetools/kdiff3.html">kdiff3</a>
  
    <li><a href="../git/mergetools/kompare.html">kompare</a>
  
    <li><a href="../git/mergetools/meld.html">meld</a>
  
    <li><a href="../git/mergetools/opendiff.html">opendiff</a>
  
    <li><a href="../git/mergetools/p4merge.html">p4merge</a>
  
    <li><a href="../git/mergetools/tkdiff.html">tkdiff</a>
  
    <li><a href="../git/mergetools/tortoisemerge.html">tortoisemerge</a>
  
    <li><a href="../git/mergetools/vimdiff.html">vimdiff</a>
  
    <li><a href="../git/mergetools/vimdiff2.html">vimdiff2</a>
  
    <li><a href="../git/mergetools/xxdiff.html">xxdiff</a>
  
    <li><a href="../git/perl/Git_pm.html">Git.pm</a>
  
    <li><a href="../git/perl/Git/I18N_pm.html">I18N.pm</a>
  
    <li><a href="../git/perl/Git/IndexInfo_pm.html">IndexInfo.pm</a>
  
    <li><a href="../git/perl/Git/SVN_pm.html">SVN.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Editor_pm.html">Editor.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Fetcher_pm.html">Fetcher.pm</a>
  
    <li><a href="../git/perl/Git/SVN/GlobSpec_pm.html">GlobSpec.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Log_pm.html">Log.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Memoize/YAML_pm.html">YAML.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Migration_pm.html">Migration.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Prompt_pm.html">Prompt.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Ra_pm.html">Ra.pm</a>
  
    <li><a href="../git/perl/Git/SVN/Utils_pm.html">Utils.pm</a>
  
    <li><a href="../git/perl/Makefile.html">Makefile</a>
  
    <li><a href="../git/perl/Makefile_PL.html">Makefile.PL</a>
  
    <li><a href="../git/perl/private-Error_pm.html">private-Error.pm</a>
  
    <li><a href="../git/po/README.html">README</a>
  
    <li><a href="../git/po/TEAMS.html">TEAMS</a>
  
    <li><a href="../git/po/da_po.html">da.po</a>
  
    <li><a href="../git/po/de_po.html">de.po</a>
  
    <li><a href="../git/po/fr_po.html">fr.po</a>
  
    <li><a href="../git/po/git_pot.html">git.pot</a>
  
    <li><a href="../git/po/is_po.html">is.po</a>
  
    <li><a href="../git/po/it_po.html">it.po</a>
  
    <li><a href="../git/po/nl_po.html">nl.po</a>
  
    <li><a href="../git/po/pt_PT_po.html">pt_PT.po</a>
  
    <li><a href="../git/po/sv_po.html">sv.po</a>
  
    <li><a href="../git/po/vi_po.html">vi.po</a>
  
    <li><a href="../git/po/zh_CN_po.html">zh_CN.po</a>
  
    <li><a href="../git/ppc/sha1ppc_S.html">sha1ppc.S</a>
  
    <li><a href="../git/t/Git-SVN/00compile_t.html">00compile.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/add_path_to_url_t.html">add_path_to_url.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/can_compress_t.html">can_compress.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/canonicalize_url_t.html">canonicalize_url.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/collapse_dotdot_t.html">collapse_dotdot.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/fatal_t.html">fatal.t</a>
  
    <li><a href="../git/t/Git-SVN/Utils/join_paths_t.html">join_paths.t</a>
  
    <li><a href="../git/t/Makefile.html">Makefile</a>
  
    <li><a href="../git/t/README.html">README</a>
  
    <li><a href="../git/t/aggregate-results_sh.html">aggregate-results.sh</a>
  
    <li><a href="../git/t/annotate-tests_sh.html">annotate-tests.sh</a>
  
    <li><a href="../git/t/check-non-portable-shell_pl.html">check-non-portable-shell.pl</a>
  
    <li><a href="../git/t/diff-lib_sh.html">diff-lib.sh</a>
  
    <li><a href="../git/t/gitweb-lib_sh.html">gitweb-lib.sh</a>
  
    <li><a href="../git/t/lib-bash_sh.html">lib-bash.sh</a>
  
    <li><a href="../git/t/lib-credential_sh.html">lib-credential.sh</a>
  
    <li><a href="../git/t/lib-cvs_sh.html">lib-cvs.sh</a>
  
    <li><a href="../git/t/lib-diff-alternative_sh.html">lib-diff-alternative.sh</a>
  
    <li><a href="../git/t/lib-gettext_sh.html">lib-gettext.sh</a>
  
    <li><a href="../git/t/lib-git-daemon_sh.html">lib-git-daemon.sh</a>
  
    <li><a href="../git/t/lib-git-p4_sh.html">lib-git-p4.sh</a>
  
    <li><a href="../git/t/lib-git-svn_sh.html">lib-git-svn.sh</a>
  
    <li><a href="../git/t/lib-gpg_sh.html">lib-gpg.sh</a>
  
    <li><a href="../git/t/lib-httpd_sh.html">lib-httpd.sh</a>
  
    <li><a href="../git/t/lib-httpd/apache_conf.html">apache.conf</a>
  
    <li><a href="../git/t/lib-httpd/broken-smart-http_sh.html">broken-smart-http.sh</a>
  
    <li><a href="../git/t/lib-httpd/passwd.html">passwd</a>
  
    <li><a href="../git/t/lib-httpd/ssl_cnf.html">ssl.cnf</a>
  
    <li><a href="../git/t/lib-pack_sh.html">lib-pack.sh</a>
  
    <li><a href="../git/t/lib-pager_sh.html">lib-pager.sh</a>
  
    <li><a href="../git/t/lib-patch-mode_sh.html">lib-patch-mode.sh</a>
  
    <li><a href="../git/t/lib-prereq-FILEMODE_sh.html">lib-prereq-FILEMODE.sh</a>
  
    <li><a href="../git/t/lib-read-tree-m-3way_sh.html">lib-read-tree-m-3way.sh</a>
  
    <li><a href="../git/t/lib-read-tree_sh.html">lib-read-tree.sh</a>
  
    <li><a href="../git/t/lib-rebase_sh.html">lib-rebase.sh</a>
  
    <li><a href="../git/t/lib-t6000_sh.html">lib-t6000.sh</a>
  
    <li><a href="../git/t/lib-terminal_sh.html">lib-terminal.sh</a>
  
    <li><a href="../git/t/perf/Makefile.html">Makefile</a>
  
    <li><a href="../git/t/perf/README.html">README</a>
  
    <li><a href="../git/t/perf/aggregate_perl.html">aggregate.perl</a>
  
    <li><a href="../git/t/perf/min_time_perl.html">min_time.perl</a>
  
    <li><a href="../git/t/perf/p0000-perf-lib-sanity_sh.html">p0000-perf-lib-sanity.sh</a>
  
    <li><a href="../git/t/perf/p0001-rev-list_sh.html">p0001-rev-list.sh</a>
  
    <li><a href="../git/t/perf/p0002-read-cache_sh.html">p0002-read-cache.sh</a>
  
    <li><a href="../git/t/perf/p4000-diff-algorithms_sh.html">p4000-diff-algorithms.sh</a>
  
    <li><a href="../git/t/perf/p4211-line-log_sh.html">p4211-line-log.sh</a>
  
    <li><a href="../git/t/perf/p5302-pack-index_sh.html">p5302-pack-index.sh</a>
  
    <li><a href="../git/t/perf/p7810-grep_sh.html">p7810-grep.sh</a>
  
    <li><a href="../git/t/perf/perf-lib_sh.html">perf-lib.sh</a>
  
    <li><a href="../git/t/perf/run.html">run</a>
  
    <li><a href="../git/t/t0000-basic_sh.html">t0000-basic.sh</a>
  
    <li><a href="../git/t/t0001-init_sh.html">t0001-init.sh</a>
  
    <li><a href="../git/t/t0002-gitfile_sh.html">t0002-gitfile.sh</a>
  
    <li><a href="../git/t/t0003-attributes_sh.html">t0003-attributes.sh</a>
  
    <li><a href="../git/t/t0004-unwritable_sh.html">t0004-unwritable.sh</a>
  
    <li><a href="../git/t/t0005-signals_sh.html">t0005-signals.sh</a>
  
    <li><a href="../git/t/t0006-date_sh.html">t0006-date.sh</a>
  
    <li><a href="../git/t/t0007-git-var_sh.html">t0007-git-var.sh</a>
  
    <li><a href="../git/t/t0008-ignores_sh.html">t0008-ignores.sh</a>
  
    <li><a href="../git/t/t0009-prio-queue_sh.html">t0009-prio-queue.sh</a>
  
    <li><a href="../git/t/t0010-racy-git_sh.html">t0010-racy-git.sh</a>
  
    <li><a href="../git/t/t0020-crlf_sh.html">t0020-crlf.sh</a>
  
    <li><a href="../git/t/t0021-conversion_sh.html">t0021-conversion.sh</a>
  
    <li><a href="../git/t/t0022-crlf-rename_sh.html">t0022-crlf-rename.sh</a>
  
    <li><a href="../git/t/t0023-crlf-am_sh.html">t0023-crlf-am.sh</a>
  
    <li><a href="../git/t/t0024-crlf-archive_sh.html">t0024-crlf-archive.sh</a>
  
    <li><a href="../git/t/t0025-crlf-auto_sh.html">t0025-crlf-auto.sh</a>
  
    <li><a href="../git/t/t0026-eol-config_sh.html">t0026-eol-config.sh</a>
  
    <li><a href="../git/t/t0030-stripspace_sh.html">t0030-stripspace.sh</a>
  
    <li><a href="../git/t/t0040-parse-options_sh.html">t0040-parse-options.sh</a>
  
    <li><a href="../git/t/t0050-filesystem_sh.html">t0050-filesystem.sh</a>
  
    <li><a href="../git/t/t0055-beyond-symlinks_sh.html">t0055-beyond-symlinks.sh</a>
  
    <li><a href="../git/t/t0056-git-C_sh.html">t0056-git-C.sh</a>
  
    <li><a href="../git/t/t0060-path-utils_sh.html">t0060-path-utils.sh</a>
  
    <li><a href="../git/t/t0061-run-command_sh.html">t0061-run-command.sh</a>
  
    <li><a href="../git/t/t0062-revision-walking_sh.html">t0062-revision-walking.sh</a>
  
    <li><a href="../git/t/t0063-string-list_sh.html">t0063-string-list.sh</a>
  
    <li><a href="../git/t/t0070-fundamental_sh.html">t0070-fundamental.sh</a>
  
    <li><a href="../git/t/t0081-line-buffer_sh.html">t0081-line-buffer.sh</a>
  
    <li><a href="../git/t/t0090-cache-tree_sh.html">t0090-cache-tree.sh</a>
  
    <li><a href="../git/t/t0100-previous_sh.html">t0100-previous.sh</a>
  
    <li><a href="../git/t/t0101-at-syntax_sh.html">t0101-at-syntax.sh</a>
  
    <li><a href="../git/t/t0110-urlmatch-normalization_sh.html">t0110-urlmatch-normalization.sh</a>
  
    <li><a href="../git/t/t0110/README.html">README</a>
  
    <li><a href="../git/t/t0110/url-1.html">url-1</a>
  
    <li><a href="../git/t/t0110/url-11.html">url-11</a>
  
    <li><a href="../git/t/t0110/url-2.html">url-2</a>
  
    <li><a href="../git/t/t0200-gettext-basic_sh.html">t0200-gettext-basic.sh</a>
  
    <li><a href="../git/t/t0200/test_perl.html">test.perl</a>
  
    <li><a href="../git/t/t0200/test_sh.html">test.sh</a>
  
    <li><a href="../git/t/t0201-gettext-fallbacks_sh.html">t0201-gettext-fallbacks.sh</a>
  
    <li><a href="../git/t/t0202-gettext-perl_sh.html">t0202-gettext-perl.sh</a>
  
    <li><a href="../git/t/t0202/test_pl.html">test.pl</a>
  
    <li><a href="../git/t/t0203-gettext-setlocale-sanity_sh.html">t0203-gettext-setlocale-sanity.sh</a>
  
    <li><a href="../git/t/t0204-gettext-reencode-sanity_sh.html">t0204-gettext-reencode-sanity.sh</a>
  
    <li><a href="../git/t/t0205-gettext-poison_sh.html">t0205-gettext-poison.sh</a>
  
    <li><a href="../git/t/t0300-credentials_sh.html">t0300-credentials.sh</a>
  
    <li><a href="../git/t/t0301-credential-cache_sh.html">t0301-credential-cache.sh</a>
  
    <li><a href="../git/t/t0302-credential-store_sh.html">t0302-credential-store.sh</a>
  
    <li><a href="../git/t/t0303-credential-external_sh.html">t0303-credential-external.sh</a>
  
    <li><a href="../git/t/t1000-read-tree-m-3way_sh.html">t1000-read-tree-m-3way.sh</a>
  
    <li><a href="../git/t/t1001-read-tree-m-2way_sh.html">t1001-read-tree-m-2way.sh</a>
  
    <li><a href="../git/t/t1002-read-tree-m-u-2way_sh.html">t1002-read-tree-m-u-2way.sh</a>
  
    <li><a href="../git/t/t1003-read-tree-prefix_sh.html">t1003-read-tree-prefix.sh</a>
  
    <li><a href="../git/t/t1004-read-tree-m-u-wf_sh.html">t1004-read-tree-m-u-wf.sh</a>
  
    <li><a href="../git/t/t1005-read-tree-reset_sh.html">t1005-read-tree-reset.sh</a>
  
    <li><a href="../git/t/t1006-cat-file_sh.html">t1006-cat-file.sh</a>
  
    <li><a href="../git/t/t1007-hash-object_sh.html">t1007-hash-object.sh</a>
  
    <li><a href="../git/t/t1008-read-tree-overlay_sh.html">t1008-read-tree-overlay.sh</a>
  
    <li><a href="../git/t/t1009-read-tree-new-index_sh.html">t1009-read-tree-new-index.sh</a>
  
    <li><a href="../git/t/t1010-mktree_sh.html">t1010-mktree.sh</a>
  
    <li><a href="../git/t/t1011-read-tree-sparse-checkout_sh.html">t1011-read-tree-sparse-checkout.sh</a>
  
    <li><a href="../git/t/t1012-read-tree-df_sh.html">t1012-read-tree-df.sh</a>
  
    <li><a href="../git/t/t1013-loose-object-format_sh.html">t1013-loose-object-format.sh</a>
  
    <li><a href="../git/t/t1020-subdirectory_sh.html">t1020-subdirectory.sh</a>
  
    <li><a href="../git/t/t1021-rerere-in-workdir_sh.html">t1021-rerere-in-workdir.sh</a>
  
    <li><a href="../git/t/t1050-large_sh.html">t1050-large.sh</a>
  
    <li><a href="../git/t/t1051-large-conversion_sh.html">t1051-large-conversion.sh</a>
  
    <li><a href="../git/t/t1060-object-corruption_sh.html">t1060-object-corruption.sh</a>
  
    <li><a href="../git/t/t1100-commit-tree-options_sh.html">t1100-commit-tree-options.sh</a>
  
    <li><a href="../git/t/t1200-tutorial_sh.html">t1200-tutorial.sh</a>
  
    <li><a href="../git/t/t1300-repo-config_sh.html">t1300-repo-config.sh</a>
  
    <li><a href="../git/t/t1301-shared-repo_sh.html">t1301-shared-repo.sh</a>
  
    <li><a href="../git/t/t1302-repo-version_sh.html">t1302-repo-version.sh</a>
  
    <li><a href="../git/t/t1303-wacky-config_sh.html">t1303-wacky-config.sh</a>
  
    <li><a href="../git/t/t1304-default-acl_sh.html">t1304-default-acl.sh</a>
  
    <li><a href="../git/t/t1305-config-include_sh.html">t1305-config-include.sh</a>
  
    <li><a href="../git/t/t1306-xdg-files_sh.html">t1306-xdg-files.sh</a>
  
    <li><a href="../git/t/t1307-config-blob_sh.html">t1307-config-blob.sh</a>
  
    <li><a href="../git/t/t1400-update-ref_sh.html">t1400-update-ref.sh</a>
  
    <li><a href="../git/t/t1401-symbolic-ref_sh.html">t1401-symbolic-ref.sh</a>
  
    <li><a href="../git/t/t1402-check-ref-format_sh.html">t1402-check-ref-format.sh</a>
  
    <li><a href="../git/t/t1403-show-ref_sh.html">t1403-show-ref.sh</a>
  
    <li><a href="../git/t/t1410-reflog_sh.html">t1410-reflog.sh</a>
  
    <li><a href="../git/t/t1411-reflog-show_sh.html">t1411-reflog-show.sh</a>
  
    <li><a href="../git/t/t1412-reflog-loop_sh.html">t1412-reflog-loop.sh</a>
  
    <li><a href="../git/t/t1420-lost-found_sh.html">t1420-lost-found.sh</a>
  
    <li><a href="../git/t/t1450-fsck_sh.html">t1450-fsck.sh</a>
  
    <li><a href="../git/t/t1500-rev-parse_sh.html">t1500-rev-parse.sh</a>
  
    <li><a href="../git/t/t1501-worktree_sh.html">t1501-worktree.sh</a>
  
    <li><a href="../git/t/t1502-rev-parse-parseopt_sh.html">t1502-rev-parse-parseopt.sh</a>
  
    <li><a href="../git/t/t1503-rev-parse-verify_sh.html">t1503-rev-parse-verify.sh</a>
  
    <li><a href="../git/t/t1504-ceiling-dirs_sh.html">t1504-ceiling-dirs.sh</a>
  
    <li><a href="../git/t/t1505-rev-parse-last_sh.html">t1505-rev-parse-last.sh</a>
  
    <li><a href="../git/t/t1506-rev-parse-diagnosis_sh.html">t1506-rev-parse-diagnosis.sh</a>
  
    <li><a href="../git/t/t1507-rev-parse-upstream_sh.html">t1507-rev-parse-upstream.sh</a>
  
    <li><a href="../git/t/t1508-at-combinations_sh.html">t1508-at-combinations.sh</a>
  
    <li><a href="../git/t/t1509-root-worktree_sh.html">t1509-root-worktree.sh</a>
  
    <li><a href="../git/t/t1509/excludes.html">excludes</a>
  
    <li><a href="../git/t/t1509/prepare-chroot_sh.html">prepare-chroot.sh</a>
  
    <li><a href="../git/t/t1510-repo-setup_sh.html">t1510-repo-setup.sh</a>
  
    <li><a href="../git/t/t1511-rev-parse-caret_sh.html">t1511-rev-parse-caret.sh</a>
  
    <li><a href="../git/t/t1512-rev-parse-disambiguation_sh.html">t1512-rev-parse-disambiguation.sh</a>
  
    <li><a href="../git/t/t1513-rev-parse-prefix_sh.html">t1513-rev-parse-prefix.sh</a>
  
    <li><a href="../git/t/t2000-checkout-cache-clash_sh.html">t2000-checkout-cache-clash.sh</a>
  
    <li><a href="../git/t/t2001-checkout-cache-clash_sh.html">t2001-checkout-cache-clash.sh</a>
  
    <li><a href="../git/t/t2002-checkout-cache-u_sh.html">t2002-checkout-cache-u.sh</a>
  
    <li><a href="../git/t/t2003-checkout-cache-mkdir_sh.html">t2003-checkout-cache-mkdir.sh</a>
  
    <li><a href="../git/t/t2004-checkout-cache-temp_sh.html">t2004-checkout-cache-temp.sh</a>
  
    <li><a href="../git/t/t2005-checkout-index-symlinks_sh.html">t2005-checkout-index-symlinks.sh</a>
  
    <li><a href="../git/t/t2006-checkout-index-basic_sh.html">t2006-checkout-index-basic.sh</a>
  
    <li><a href="../git/t/t2007-checkout-symlink_sh.html">t2007-checkout-symlink.sh</a>
  
    <li><a href="../git/t/t2008-checkout-subdir_sh.html">t2008-checkout-subdir.sh</a>
  
    <li><a href="../git/t/t2009-checkout-statinfo_sh.html">t2009-checkout-statinfo.sh</a>
  
    <li><a href="../git/t/t2010-checkout-ambiguous_sh.html">t2010-checkout-ambiguous.sh</a>
  
    <li><a href="../git/t/t2011-checkout-invalid-head_sh.html">t2011-checkout-invalid-head.sh</a>
  
    <li><a href="../git/t/t2012-checkout-last_sh.html">t2012-checkout-last.sh</a>
  
    <li><a href="../git/t/t2013-checkout-submodule_sh.html">t2013-checkout-submodule.sh</a>
  
    <li><a href="../git/t/t2014-switch_sh.html">t2014-switch.sh</a>
  
    <li><a href="../git/t/t2015-checkout-unborn_sh.html">t2015-checkout-unborn.sh</a>
  
    <li><a href="../git/t/t2016-checkout-patch_sh.html">t2016-checkout-patch.sh</a>
  
    <li><a href="../git/t/t2017-checkout-orphan_sh.html">t2017-checkout-orphan.sh</a>
  
    <li><a href="../git/t/t2018-checkout-branch_sh.html">t2018-checkout-branch.sh</a>
  
    <li><a href="../git/t/t2019-checkout-ambiguous-ref_sh.html">t2019-checkout-ambiguous-ref.sh</a>
  
    <li><a href="../git/t/t2020-checkout-detach_sh.html">t2020-checkout-detach.sh</a>
  
    <li><a href="../git/t/t2021-checkout-overwrite_sh.html">t2021-checkout-overwrite.sh</a>
  
    <li><a href="../git/t/t2022-checkout-paths_sh.html">t2022-checkout-paths.sh</a>
  
    <li><a href="../git/t/t2023-checkout-m_sh.html">t2023-checkout-m.sh</a>
  
    <li><a href="../git/t/t2024-checkout-dwim_sh.html">t2024-checkout-dwim.sh</a>
  
    <li><a href="../git/t/t2030-unresolve-info_sh.html">t2030-unresolve-info.sh</a>
  
    <li><a href="../git/t/t2050-git-dir-relative_sh.html">t2050-git-dir-relative.sh</a>
  
    <li><a href="../git/t/t2100-update-cache-badpath_sh.html">t2100-update-cache-badpath.sh</a>
  
    <li><a href="../git/t/t2101-update-index-reupdate_sh.html">t2101-update-index-reupdate.sh</a>
  
    <li><a href="../git/t/t2102-update-index-symlinks_sh.html">t2102-update-index-symlinks.sh</a>
  
    <li><a href="../git/t/t2103-update-index-ignore-missing_sh.html">t2103-update-index-ignore-missing.sh</a>
  
    <li><a href="../git/t/t2104-update-index-skip-worktree_sh.html">t2104-update-index-skip-worktree.sh</a>
  
    <li><a href="../git/t/t2105-update-index-gitfile_sh.html">t2105-update-index-gitfile.sh</a>
  
    <li><a href="../git/t/t2106-update-index-assume-unchanged_sh.html">t2106-update-index-assume-unchanged.sh</a>
  
    <li><a href="../git/t/t2107-update-index-basic_sh.html">t2107-update-index-basic.sh</a>
  
    <li><a href="../git/t/t2200-add-update_sh.html">t2200-add-update.sh</a>
  
    <li><a href="../git/t/t2201-add-update-typechange_sh.html">t2201-add-update-typechange.sh</a>
  
    <li><a href="../git/t/t2202-add-addremove_sh.html">t2202-add-addremove.sh</a>
  
    <li><a href="../git/t/t2203-add-intent_sh.html">t2203-add-intent.sh</a>
  
    <li><a href="../git/t/t2204-add-ignored_sh.html">t2204-add-ignored.sh</a>
  
    <li><a href="../git/t/t2300-cd-to-toplevel_sh.html">t2300-cd-to-toplevel.sh</a>
  
    <li><a href="../git/t/t3000-ls-files-others_sh.html">t3000-ls-files-others.sh</a>
  
    <li><a href="../git/t/t3001-ls-files-others-exclude_sh.html">t3001-ls-files-others-exclude.sh</a>
  
    <li><a href="../git/t/t3002-ls-files-dashpath_sh.html">t3002-ls-files-dashpath.sh</a>
  
    <li><a href="../git/t/t3003-ls-files-exclude_sh.html">t3003-ls-files-exclude.sh</a>
  
    <li><a href="../git/t/t3004-ls-files-basic_sh.html">t3004-ls-files-basic.sh</a>
  
    <li><a href="../git/t/t3005-ls-files-relative_sh.html">t3005-ls-files-relative.sh</a>
  
    <li><a href="../git/t/t3006-ls-files-long_sh.html">t3006-ls-files-long.sh</a>
  
    <li><a href="../git/t/t3010-ls-files-killed-modified_sh.html">t3010-ls-files-killed-modified.sh</a>
  
    <li><a href="../git/t/t3020-ls-files-error-unmatch_sh.html">t3020-ls-files-error-unmatch.sh</a>
  
    <li><a href="../git/t/t3030-merge-recursive_sh.html">t3030-merge-recursive.sh</a>
  
    <li><a href="../git/t/t3031-merge-criscross_sh.html">t3031-merge-criscross.sh</a>
  
    <li><a href="../git/t/t3032-merge-recursive-options_sh.html">t3032-merge-recursive-options.sh</a>
  
    <li><a href="../git/t/t3040-subprojects-basic_sh.html">t3040-subprojects-basic.sh</a>
  
    <li><a href="../git/t/t3050-subprojects-fetch_sh.html">t3050-subprojects-fetch.sh</a>
  
    <li><a href="../git/t/t3060-ls-files-with-tree_sh.html">t3060-ls-files-with-tree.sh</a>
  
    <li><a href="../git/t/t3070-wildmatch_sh.html">t3070-wildmatch.sh</a>
  
    <li><a href="../git/t/t3100-ls-tree-restrict_sh.html">t3100-ls-tree-restrict.sh</a>
  
    <li><a href="../git/t/t3101-ls-tree-dirname_sh.html">t3101-ls-tree-dirname.sh</a>
  
    <li><a href="../git/t/t3102-ls-tree-wildcards_sh.html">t3102-ls-tree-wildcards.sh</a>
  
    <li><a href="../git/t/t3103-ls-tree-misc_sh.html">t3103-ls-tree-misc.sh</a>
  
    <li><a href="../git/t/t3200-branch_sh.html">t3200-branch.sh</a>
  
    <li><a href="../git/t/t3201-branch-contains_sh.html">t3201-branch-contains.sh</a>
  
    <li><a href="../git/t/t3202-show-branch-octopus_sh.html">t3202-show-branch-octopus.sh</a>
  
    <li><a href="../git/t/t3203-branch-output_sh.html">t3203-branch-output.sh</a>
  
    <li><a href="../git/t/t3210-pack-refs_sh.html">t3210-pack-refs.sh</a>
  
    <li><a href="../git/t/t3211-peel-ref_sh.html">t3211-peel-ref.sh</a>
  
    <li><a href="../git/t/t3300-funny-names_sh.html">t3300-funny-names.sh</a>
  
    <li><a href="../git/t/t3301-notes_sh.html">t3301-notes.sh</a>
  
    <li><a href="../git/t/t3302-notes-index-expensive_sh.html">t3302-notes-index-expensive.sh</a>
  
    <li><a href="../git/t/t3303-notes-subtrees_sh.html">t3303-notes-subtrees.sh</a>
  
    <li><a href="../git/t/t3304-notes-mixed_sh.html">t3304-notes-mixed.sh</a>
  
    <li><a href="../git/t/t3305-notes-fanout_sh.html">t3305-notes-fanout.sh</a>
  
    <li><a href="../git/t/t3306-notes-prune_sh.html">t3306-notes-prune.sh</a>
  
    <li><a href="../git/t/t3307-notes-man_sh.html">t3307-notes-man.sh</a>
  
    <li><a href="../git/t/t3308-notes-merge_sh.html">t3308-notes-merge.sh</a>
  
    <li><a href="../git/t/t3309-notes-merge-auto-resolve_sh.html">t3309-notes-merge-auto-resolve.sh</a>
  
    <li><a href="../git/t/t3310-notes-merge-manual-resolve_sh.html">t3310-notes-merge-manual-resolve.sh</a>
  
    <li><a href="../git/t/t3311-notes-merge-fanout_sh.html">t3311-notes-merge-fanout.sh</a>
  
    <li><a href="../git/t/t3400-rebase_sh.html">t3400-rebase.sh</a>
  
    <li><a href="../git/t/t3402-rebase-merge_sh.html">t3402-rebase-merge.sh</a>
  
    <li><a href="../git/t/t3403-rebase-skip_sh.html">t3403-rebase-skip.sh</a>
  
    <li><a href="../git/t/t3404-rebase-interactive_sh.html">t3404-rebase-interactive.sh</a>
  
    <li><a href="../git/t/t3405-rebase-malformed_sh.html">t3405-rebase-malformed.sh</a>
  
    <li><a href="../git/t/t3406-rebase-message_sh.html">t3406-rebase-message.sh</a>
  
    <li><a href="../git/t/t3407-rebase-abort_sh.html">t3407-rebase-abort.sh</a>
  
    <li><a href="../git/t/t3408-rebase-multi-line_sh.html">t3408-rebase-multi-line.sh</a>
  
    <li><a href="../git/t/t3409-rebase-preserve-merges_sh.html">t3409-rebase-preserve-merges.sh</a>
  
    <li><a href="../git/t/t3410-rebase-preserve-dropped-merges_sh.html">t3410-rebase-preserve-dropped-merges.sh</a>
  
    <li><a href="../git/t/t3411-rebase-preserve-around-merges_sh.html">t3411-rebase-preserve-around-merges.sh</a>
  
    <li><a href="../git/t/t3412-rebase-root_sh.html">t3412-rebase-root.sh</a>
  
    <li><a href="../git/t/t3413-rebase-hook_sh.html">t3413-rebase-hook.sh</a>
  
    <li><a href="../git/t/t3414-rebase-preserve-onto_sh.html">t3414-rebase-preserve-onto.sh</a>
  
    <li><a href="../git/t/t3415-rebase-autosquash_sh.html">t3415-rebase-autosquash.sh</a>
  
    <li><a href="../git/t/t3416-rebase-onto-threedots_sh.html">t3416-rebase-onto-threedots.sh</a>
  
    <li><a href="../git/t/t3417-rebase-whitespace-fix_sh.html">t3417-rebase-whitespace-fix.sh</a>
  
    <li><a href="../git/t/t3418-rebase-continue_sh.html">t3418-rebase-continue.sh</a>
  
    <li><a href="../git/t/t3419-rebase-patch-id_sh.html">t3419-rebase-patch-id.sh</a>
  
    <li><a href="../git/t/t3420-rebase-autostash_sh.html">t3420-rebase-autostash.sh</a>
  
    <li><a href="../git/t/t3421-rebase-topology-linear_sh.html">t3421-rebase-topology-linear.sh</a>
  
    <li><a href="../git/t/t3425-rebase-topology-merges_sh.html">t3425-rebase-topology-merges.sh</a>
  
    <li><a href="../git/t/t3500-cherry_sh.html">t3500-cherry.sh</a>
  
    <li><a href="../git/t/t3501-revert-cherry-pick_sh.html">t3501-revert-cherry-pick.sh</a>
  
    <li><a href="../git/t/t3502-cherry-pick-merge_sh.html">t3502-cherry-pick-merge.sh</a>
  
    <li><a href="../git/t/t3503-cherry-pick-root_sh.html">t3503-cherry-pick-root.sh</a>
  
    <li><a href="../git/t/t3504-cherry-pick-rerere_sh.html">t3504-cherry-pick-rerere.sh</a>
  
    <li><a href="../git/t/t3505-cherry-pick-empty_sh.html">t3505-cherry-pick-empty.sh</a>
  
    <li><a href="../git/t/t3506-cherry-pick-ff_sh.html">t3506-cherry-pick-ff.sh</a>
  
    <li><a href="../git/t/t3507-cherry-pick-conflict_sh.html">t3507-cherry-pick-conflict.sh</a>
  
    <li><a href="../git/t/t3508-cherry-pick-many-commits_sh.html">t3508-cherry-pick-many-commits.sh</a>
  
    <li><a href="../git/t/t3509-cherry-pick-merge-df_sh.html">t3509-cherry-pick-merge-df.sh</a>
  
    <li><a href="../git/t/t3510-cherry-pick-sequence_sh.html">t3510-cherry-pick-sequence.sh</a>
  
    <li><a href="../git/t/t3511-cherry-pick-x_sh.html">t3511-cherry-pick-x.sh</a>
  
    <li><a href="../git/t/t3600-rm_sh.html">t3600-rm.sh</a>
  
    <li><a href="../git/t/t3700-add_sh.html">t3700-add.sh</a>
  
    <li><a href="../git/t/t3701-add-interactive_sh.html">t3701-add-interactive.sh</a>
  
    <li><a href="../git/t/t3702-add-edit_sh.html">t3702-add-edit.sh</a>
  
    <li><a href="../git/t/t3703-add-magic-pathspec_sh.html">t3703-add-magic-pathspec.sh</a>
  
    <li><a href="../git/t/t3800-mktag_sh.html">t3800-mktag.sh</a>
  
    <li><a href="../git/t/t3900-i18n-commit_sh.html">t3900-i18n-commit.sh</a>
  
    <li><a href="../git/t/t3900/1-UTF-8_txt.html">1-UTF-8</a>
  
    <li><a href="../git/t/t3900/2-UTF-8_txt.html">2-UTF-8</a>
  
    <li><a href="../git/t/t3900/ISO-2022-JP_txt.html">ISO-2022-JP</a>
  
    <li><a href="../git/t/t3901-i18n-patch_sh.html">t3901-i18n-patch.sh</a>
  
    <li><a href="../git/t/t3901-utf8_txt.html">t3901-utf8</a>
  
    <li><a href="../git/t/t3902-quoted_sh.html">t3902-quoted.sh</a>
  
    <li><a href="../git/t/t3903-stash_sh.html">t3903-stash.sh</a>
  
    <li><a href="../git/t/t3904-stash-patch_sh.html">t3904-stash-patch.sh</a>
  
    <li><a href="../git/t/t3905-stash-include-untracked_sh.html">t3905-stash-include-untracked.sh</a>
  
    <li><a href="../git/t/t3910-mac-os-precompose_sh.html">t3910-mac-os-precompose.sh</a>
  
    <li><a href="../git/t/t4000-diff-format_sh.html">t4000-diff-format.sh</a>
  
    <li><a href="../git/t/t4001-diff-rename_sh.html">t4001-diff-rename.sh</a>
  
    <li><a href="../git/t/t4002-diff-basic_sh.html">t4002-diff-basic.sh</a>
  
    <li><a href="../git/t/t4003-diff-rename-1_sh.html">t4003-diff-rename-1.sh</a>
  
    <li><a href="../git/t/t4004-diff-rename-symlink_sh.html">t4004-diff-rename-symlink.sh</a>
  
    <li><a href="../git/t/t4005-diff-rename-2_sh.html">t4005-diff-rename-2.sh</a>
  
    <li><a href="../git/t/t4006-diff-mode_sh.html">t4006-diff-mode.sh</a>
  
    <li><a href="../git/t/t4007-rename-3_sh.html">t4007-rename-3.sh</a>
  
    <li><a href="../git/t/t4008-diff-break-rewrite_sh.html">t4008-diff-break-rewrite.sh</a>
  
    <li><a href="../git/t/t4009-diff-rename-4_sh.html">t4009-diff-rename-4.sh</a>
  
    <li><a href="../git/t/t4010-diff-pathspec_sh.html">t4010-diff-pathspec.sh</a>
  
    <li><a href="../git/t/t4011-diff-symlink_sh.html">t4011-diff-symlink.sh</a>
  
    <li><a href="../git/t/t4012-diff-binary_sh.html">t4012-diff-binary.sh</a>
  
    <li><a href="../git/t/t4013-diff-various_sh.html">t4013-diff-various.sh</a>
  
    <li><a href="../git/t/t4013/diff_config_format_subjectprefix_DIFFERENT_PREFIX.html">diff.config_format.subjectprefix_DIFFERENT_PREFIX</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_--summary_master.html">diff.diff-tree_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_--summary_side.html">diff.diff-tree_--cc_--patch-with-stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_master.html">diff.diff-tree_--cc_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--stat_--summary_master.html">diff.diff-tree_--cc_--stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--stat_--summary_side.html">diff.diff-tree_--cc_--stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_--stat_master.html">diff.diff-tree_--cc_--stat_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--cc_master.html">diff.diff-tree_--cc_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--patch-with-raw_initial.html">diff.diff-tree_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--patch-with-stat_initial.html">diff.diff-tree_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--patch-with-raw_initial.html">diff.diff-tree_--pretty=oneline_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--patch-with-stat_initial.html">diff.diff-tree_--pretty=oneline_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_--patch-with-raw_initial.html">diff.diff-tree_--pretty=oneline_--root_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_--patch-with-stat_initial.html">diff.diff-tree_--pretty=oneline_--root_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_-p_initial.html">diff.diff-tree_--pretty=oneline_--root_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_initial.html">diff.diff-tree_--pretty=oneline_--root_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_-p_initial.html">diff.diff-tree_--pretty=oneline_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty=oneline_initial.html">diff.diff-tree_--pretty=oneline_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--patch-with-raw_initial.html">diff.diff-tree_--pretty_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--patch-with-stat_initial.html">diff.diff-tree_--pretty_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--patch-with-stat_side.html">diff.diff-tree_--pretty_--patch-with-stat_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--patch-with-raw_initial.html">diff.diff-tree_--pretty_--root_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--patch-with-stat_initial.html">diff.diff-tree_--pretty_--root_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--stat_--summary_initial.html">diff.diff-tree_--pretty_--root_--stat_--summary_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--stat_initial.html">diff.diff-tree_--pretty_--root_--stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--summary_-r_initial.html">diff.diff-tree_--pretty_--root_--summary_-r_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_--summary_initial.html">diff.diff-tree_--pretty_--root_--summary_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_-p_initial.html">diff.diff-tree_--pretty_--root_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--root_initial.html">diff.diff-tree_--pretty_--root_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--stat_--summary_initial.html">diff.diff-tree_--pretty_--stat_--summary_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--stat_initial.html">diff.diff-tree_--pretty_--stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_--summary_initial.html">diff.diff-tree_--pretty_--summary_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_-p_initial.html">diff.diff-tree_--pretty_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_-p_side.html">diff.diff-tree_--pretty_-p_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_initial.html">diff.diff-tree_--pretty_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--pretty_side.html">diff.diff-tree_--pretty_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_--abbrev_initial.html">diff.diff-tree_--root_--abbrev_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_--patch-with-raw_initial.html">diff.diff-tree_--root_--patch-with-raw_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_--patch-with-stat_initial.html">diff.diff-tree_--root_--patch-with-stat_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_-p_initial.html">diff.diff-tree_--root_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_-r_--abbrev=4_initial.html">diff.diff-tree_--root_-r_--abbrev=4_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_-r_--abbrev_initial.html">diff.diff-tree_--root_-r_--abbrev_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_-r_initial.html">diff.diff-tree_--root_-r_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_--root_initial.html">diff.diff-tree_--root_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_--abbrev_master.html">diff.diff-tree_-c_--abbrev_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_--stat_--summary_master.html">diff.diff-tree_-c_--stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_--stat_--summary_side.html">diff.diff-tree_-c_--stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_--stat_master.html">diff.diff-tree_-c_--stat_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-c_master.html">diff.diff-tree_-c_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-p_-m_master.html">diff.diff-tree_-p_-m_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-p_initial.html">diff.diff-tree_-p_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-p_master.html">diff.diff-tree_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-r_--abbrev=4_initial.html">diff.diff-tree_-r_--abbrev=4_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-r_--abbrev_initial.html">diff.diff-tree_-r_--abbrev_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_-r_initial.html">diff.diff-tree_-r_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_initial.html">diff.diff-tree_initial</a>
  
    <li><a href="../git/t/t4013/diff_diff-tree_master.html">diff.diff-tree_master</a>
  
    <li><a href="../git/t/t4013/diff_diff_--abbrev_initial__side.html">diff.diff_--abbrev_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--cached.html">diff.diff_--cached</a>
  
    <li><a href="../git/t/t4013/diff_diff_--cached_--_file0.html">diff.diff_--cached_--_file0</a>
  
    <li><a href="../git/t/t4013/diff_diff_--dirstat-by-file_initial_rearrange.html">diff.diff_--dirstat-by-file_initial_rearrange</a>
  
    <li><a href="../git/t/t4013/diff_diff_--dirstat_initial_rearrange.html">diff.diff_--dirstat_initial_rearrange</a>
  
    <li><a href="../git/t/t4013/diff_diff_--dirstat_master~1_master~2.html">diff.diff_--dirstat_master~1_master~2</a>
  
    <li><a href="../git/t/t4013/diff_diff_--name-status_dir2_dir.html">diff.diff_--name-status_dir2_dir</a>
  
    <li><a href="../git/t/t4013/diff_diff_--no-index_--name-status_--_dir2_dir.html">diff.diff_--no-index_--name-status_--_dir2_dir</a>
  
    <li><a href="../git/t/t4013/diff_diff_--no-index_--name-status_dir2_dir.html">diff.diff_--no-index_--name-status_dir2_dir</a>
  
    <li><a href="../git/t/t4013/diff_diff_--no-index_dir_dir3.html">diff.diff_--no-index_dir_dir3</a>
  
    <li><a href="../git/t/t4013/diff_diff_--patch-with-raw_-r_initial__side.html">diff.diff_--patch-with-raw_-r_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--patch-with-raw_initial__side.html">diff.diff_--patch-with-raw_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--patch-with-stat_-r_initial__side.html">diff.diff_--patch-with-stat_-r_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--patch-with-stat_initial__side.html">diff.diff_--patch-with-stat_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_--stat_initial__side.html">diff.diff_--stat_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_-r_--stat_initial__side.html">diff.diff_-r_--stat_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_-r_initial__side.html">diff.diff_-r_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_initial__side.html">diff.diff_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_diff_master_master^_side.html">diff.diff_master_master^_side</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--attach_--stdout_--suffix=_diff_initial__side.html">diff.format-patch_--attach_--stdout_--suffix=.diff_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--attach_--stdout_initial__master.html">diff.format-patch_--attach_--stdout_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--attach_--stdout_initial__master^.html">diff.format-patch_--attach_--stdout_initial..master^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--attach_--stdout_initial__side.html">diff.format-patch_--attach_--stdout_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_--numbered-files_initial__master.html">diff.format-patch_--inline_--stdout_--numbered-files_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_--subject-prefix=TESTCASE_initial__master.html">diff.format-patch_--inline_--stdout_--subject-prefix=TESTCASE_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master.html">diff.format-patch_--inline_--stdout_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master^.html">diff.format-patch_--inline_--stdout_initial..master^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master^^.html">diff.format-patch_--inline_--stdout_initial..master^^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--inline_--stdout_initial__side.html">diff.format-patch_--inline_--stdout_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_--cover-letter_-n_initial__master^.html">diff.format-patch_--stdout_--cover-letter_-n_initial..master^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_--no-numbered_initial__master.html">diff.format-patch_--stdout_--no-numbered_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_--numbered_initial__master.html">diff.format-patch_--stdout_--numbered_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_initial__master.html">diff.format-patch_--stdout_initial..master</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_initial__master^.html">diff.format-patch_--stdout_initial..master^</a>
  
    <li><a href="../git/t/t4013/diff_format-patch_--stdout_initial__side.html">diff.format-patch_--stdout_initial..side</a>
  
    <li><a href="../git/t/t4013/diff_log_--decorate=full_--all.html">diff.log_--decorate=full_--all</a>
  
    <li><a href="../git/t/t4013/diff_log_--decorate_--all.html">diff.log_--decorate_--all</a>
  
    <li><a href="../git/t/t4013/diff_log_--patch-with-stat_--summary_master_--_dir_.html">diff.log_--patch-with-stat_--summary_master_--_dir_</a>
  
    <li><a href="../git/t/t4013/diff_log_--patch-with-stat_master.html">diff.log_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--patch-with-stat_master_--_dir_.html">diff.log_--patch-with-stat_master_--_dir_</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_--cc_--patch-with-stat_--summary_master.html">diff.log_--root_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_--patch-with-stat_--summary_master.html">diff.log_--root_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_--patch-with-stat_master.html">diff.log_--root_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_-c_--patch-with-stat_--summary_master.html">diff.log_--root_-c_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_-p_master.html">diff.log_--root_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_--root_master.html">diff.log_--root_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-GF_-p_--pickaxe-all_master.html">diff.log_-GF_-p_--pickaxe-all_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-GF_-p_master.html">diff.log_-GF_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-GF_master.html">diff.log_-GF_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_-p_master.html">diff.log_-SF_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_master.html">diff.log_-SF_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_master_--max-count=0.html">diff.log_-SF_master_--max-count=0</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_master_--max-count=1.html">diff.log_-SF_master_--max-count=1</a>
  
    <li><a href="../git/t/t4013/diff_log_-SF_master_--max-count=2.html">diff.log_-SF_master_--max-count=2</a>
  
    <li><a href="../git/t/t4013/diff_log_-S_F_master.html">diff.log_-S_F_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-m_-p_--first-parent_master.html">diff.log_-m_-p_--first-parent_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-m_-p_master.html">diff.log_-m_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-p_--first-parent_master.html">diff.log_-p_--first-parent_master</a>
  
    <li><a href="../git/t/t4013/diff_log_-p_master.html">diff.log_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_log_master.html">diff.log_master</a>
  
    <li><a href="../git/t/t4013/diff_rev-list_--children_HEAD.html">diff.rev-list_--children_HEAD</a>
  
    <li><a href="../git/t/t4013/diff_rev-list_--parents_HEAD.html">diff.rev-list_--parents_HEAD</a>
  
    <li><a href="../git/t/t4013/diff_show_--first-parent_master.html">diff.show_--first-parent_master</a>
  
    <li><a href="../git/t/t4013/diff_show_--patch-with-raw_side.html">diff.show_--patch-with-raw_side</a>
  
    <li><a href="../git/t/t4013/diff_show_--patch-with-stat_--summary_side.html">diff.show_--patch-with-stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_show_--patch-with-stat_side.html">diff.show_--patch-with-stat_side</a>
  
    <li><a href="../git/t/t4013/diff_show_--root_initial.html">diff.show_--root_initial</a>
  
    <li><a href="../git/t/t4013/diff_show_--stat_--summary_side.html">diff.show_--stat_--summary_side</a>
  
    <li><a href="../git/t/t4013/diff_show_--stat_side.html">diff.show_--stat_side</a>
  
    <li><a href="../git/t/t4013/diff_show_-c_master.html">diff.show_-c_master</a>
  
    <li><a href="../git/t/t4013/diff_show_-m_master.html">diff.show_-m_master</a>
  
    <li><a href="../git/t/t4013/diff_show_initial.html">diff.show_initial</a>
  
    <li><a href="../git/t/t4013/diff_show_master.html">diff.show_master</a>
  
    <li><a href="../git/t/t4013/diff_show_side.html">diff.show_side</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--patch-with-stat_--summary_master_--_dir_.html">diff.whatchanged_--patch-with-stat_--summary_master_--_dir_</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--patch-with-stat_master.html">diff.whatchanged_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--patch-with-stat_master_--_dir_.html">diff.whatchanged_--patch-with-stat_master_--_dir_</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_--cc_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_--patch-with-stat_master.html">diff.whatchanged_--root_--patch-with-stat_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_-c_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_-c_--patch-with-stat_--summary_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_-p_master.html">diff.whatchanged_--root_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_--root_master.html">diff.whatchanged_--root_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_-SF_-p_master.html">diff.whatchanged_-SF_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_-SF_master.html">diff.whatchanged_-SF_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_-p_master.html">diff.whatchanged_-p_master</a>
  
    <li><a href="../git/t/t4013/diff_whatchanged_master.html">diff.whatchanged_master</a>
  
    <li><a href="../git/t/t4014-format-patch_sh.html">t4014-format-patch.sh</a>
  
    <li><a href="../git/t/t4015-diff-whitespace_sh.html">t4015-diff-whitespace.sh</a>
  
    <li><a href="../git/t/t4016-diff-quote_sh.html">t4016-diff-quote.sh</a>
  
    <li><a href="../git/t/t4017-diff-retval_sh.html">t4017-diff-retval.sh</a>
  
    <li><a href="../git/t/t4018-diff-funcname_sh.html">t4018-diff-funcname.sh</a>
  
    <li><a href="../git/t/t4019-diff-wserror_sh.html">t4019-diff-wserror.sh</a>
  
    <li><a href="../git/t/t4020-diff-external_sh.html">t4020-diff-external.sh</a>
  
    <li><a href="../git/t/t4021-format-patch-numbered_sh.html">t4021-format-patch-numbered.sh</a>
  
    <li><a href="../git/t/t4022-diff-rewrite_sh.html">t4022-diff-rewrite.sh</a>
  
    <li><a href="../git/t/t4023-diff-rename-typechange_sh.html">t4023-diff-rename-typechange.sh</a>
  
    <li><a href="../git/t/t4024-diff-optimize-common_sh.html">t4024-diff-optimize-common.sh</a>
  
    <li><a href="../git/t/t4025-hunk-header_sh.html">t4025-hunk-header.sh</a>
  
    <li><a href="../git/t/t4026-color_sh.html">t4026-color.sh</a>
  
    <li><a href="../git/t/t4027-diff-submodule_sh.html">t4027-diff-submodule.sh</a>
  
    <li><a href="../git/t/t4028-format-patch-mime-headers_sh.html">t4028-format-patch-mime-headers.sh</a>
  
    <li><a href="../git/t/t4029-diff-trailing-space_sh.html">t4029-diff-trailing-space.sh</a>
  
    <li><a href="../git/t/t4030-diff-textconv_sh.html">t4030-diff-textconv.sh</a>
  
    <li><a href="../git/t/t4031-diff-rewrite-binary_sh.html">t4031-diff-rewrite-binary.sh</a>
  
    <li><a href="../git/t/t4032-diff-inter-hunk-context_sh.html">t4032-diff-inter-hunk-context.sh</a>
  
    <li><a href="../git/t/t4033-diff-patience_sh.html">t4033-diff-patience.sh</a>
  
    <li><a href="../git/t/t4034-diff-words_sh.html">t4034-diff-words.sh</a>
  
    <li><a href="../git/t/t4034/ada/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/ada/post.html">post</a>
  
    <li><a href="../git/t/t4034/ada/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/bibtex/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/bibtex/post.html">post</a>
  
    <li><a href="../git/t/t4034/bibtex/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/cpp/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/cpp/post.html">post</a>
  
    <li><a href="../git/t/t4034/cpp/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/csharp/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/csharp/post.html">post</a>
  
    <li><a href="../git/t/t4034/csharp/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/fortran/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/fortran/post.html">post</a>
  
    <li><a href="../git/t/t4034/fortran/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/html/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/html/post.html">post</a>
  
    <li><a href="../git/t/t4034/html/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/java/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/java/post.html">post</a>
  
    <li><a href="../git/t/t4034/java/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/matlab/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/matlab/post.html">post</a>
  
    <li><a href="../git/t/t4034/matlab/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/objc/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/objc/post.html">post</a>
  
    <li><a href="../git/t/t4034/objc/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/pascal/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/pascal/post.html">post</a>
  
    <li><a href="../git/t/t4034/pascal/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/perl/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/perl/post.html">post</a>
  
    <li><a href="../git/t/t4034/perl/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/php/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/php/post.html">post</a>
  
    <li><a href="../git/t/t4034/php/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/python/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/python/post.html">post</a>
  
    <li><a href="../git/t/t4034/python/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/ruby/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/ruby/post.html">post</a>
  
    <li><a href="../git/t/t4034/ruby/pre.html">pre</a>
  
    <li><a href="../git/t/t4034/tex/expect.html">expect</a>
  
    <li><a href="../git/t/t4034/tex/post.html">post</a>
  
    <li><a href="../git/t/t4034/tex/pre.html">pre</a>
  
    <li><a href="../git/t/t4035-diff-quiet_sh.html">t4035-diff-quiet.sh</a>
  
    <li><a href="../git/t/t4036-format-patch-signer-mime_sh.html">t4036-format-patch-signer-mime.sh</a>
  
    <li><a href="../git/t/t4037-diff-r-t-dirs_sh.html">t4037-diff-r-t-dirs.sh</a>
  
    <li><a href="../git/t/t4038-diff-combined_sh.html">t4038-diff-combined.sh</a>
  
    <li><a href="../git/t/t4039-diff-assume-unchanged_sh.html">t4039-diff-assume-unchanged.sh</a>
  
    <li><a href="../git/t/t4040-whitespace-status_sh.html">t4040-whitespace-status.sh</a>
  
    <li><a href="../git/t/t4041-diff-submodule-option_sh.html">t4041-diff-submodule-option.sh</a>
  
    <li><a href="../git/t/t4042-diff-textconv-caching_sh.html">t4042-diff-textconv-caching.sh</a>
  
    <li><a href="../git/t/t4043-diff-rename-binary_sh.html">t4043-diff-rename-binary.sh</a>
  
    <li><a href="../git/t/t4044-diff-index-unique-abbrev_sh.html">t4044-diff-index-unique-abbrev.sh</a>
  
    <li><a href="../git/t/t4045-diff-relative_sh.html">t4045-diff-relative.sh</a>
  
    <li><a href="../git/t/t4046-diff-unmerged_sh.html">t4046-diff-unmerged.sh</a>
  
    <li><a href="../git/t/t4047-diff-dirstat_sh.html">t4047-diff-dirstat.sh</a>
  
    <li><a href="../git/t/t4048-diff-combined-binary_sh.html">t4048-diff-combined-binary.sh</a>
  
    <li><a href="../git/t/t4049-diff-stat-count_sh.html">t4049-diff-stat-count.sh</a>
  
    <li><a href="../git/t/t4050-diff-histogram_sh.html">t4050-diff-histogram.sh</a>
  
    <li><a href="../git/t/t4051-diff-function-context_sh.html">t4051-diff-function-context.sh</a>
  
    <li><a href="../git/t/t4052-stat-output_sh.html">t4052-stat-output.sh</a>
  
    <li><a href="../git/t/t4053-diff-no-index_sh.html">t4053-diff-no-index.sh</a>
  
    <li><a href="../git/t/t4054-diff-bogus-tree_sh.html">t4054-diff-bogus-tree.sh</a>
  
    <li><a href="../git/t/t4055-diff-context_sh.html">t4055-diff-context.sh</a>
  
    <li><a href="../git/t/t4100-apply-stat_sh.html">t4100-apply-stat.sh</a>
  
    <li><a href="../git/t/t4100/t-apply-1_expect.html">t-apply-1.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-1_patch.html">t-apply-1.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-2_expect.html">t-apply-2.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-2_patch.html">t-apply-2.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-3_expect.html">t-apply-3.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-3_patch.html">t-apply-3.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-4_expect.html">t-apply-4.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-4_patch.html">t-apply-4.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-5_expect.html">t-apply-5.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-5_patch.html">t-apply-5.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-6_expect.html">t-apply-6.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-6_patch.html">t-apply-6.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-7_expect.html">t-apply-7.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-7_patch.html">t-apply-7.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-8_expect.html">t-apply-8.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-8_patch.html">t-apply-8.patch</a>
  
    <li><a href="../git/t/t4100/t-apply-9_expect.html">t-apply-9.expect</a>
  
    <li><a href="../git/t/t4100/t-apply-9_patch.html">t-apply-9.patch</a>
  
    <li><a href="../git/t/t4101-apply-nonl_sh.html">t4101-apply-nonl.sh</a>
  
    <li><a href="../git/t/t4101/diff_0-1.html">diff.0-1</a>
  
    <li><a href="../git/t/t4101/diff_0-2.html">diff.0-2</a>
  
    <li><a href="../git/t/t4101/diff_0-3.html">diff.0-3</a>
  
    <li><a href="../git/t/t4101/diff_1-0.html">diff.1-0</a>
  
    <li><a href="../git/t/t4101/diff_1-2.html">diff.1-2</a>
  
    <li><a href="../git/t/t4101/diff_1-3.html">diff.1-3</a>
  
    <li><a href="../git/t/t4101/diff_2-0.html">diff.2-0</a>
  
    <li><a href="../git/t/t4101/diff_2-1.html">diff.2-1</a>
  
    <li><a href="../git/t/t4101/diff_2-3.html">diff.2-3</a>
  
    <li><a href="../git/t/t4101/diff_3-0.html">diff.3-0</a>
  
    <li><a href="../git/t/t4101/diff_3-1.html">diff.3-1</a>
  
    <li><a href="../git/t/t4101/diff_3-2.html">diff.3-2</a>
  
    <li><a href="../git/t/t4102-apply-rename_sh.html">t4102-apply-rename.sh</a>
  
    <li><a href="../git/t/t4103-apply-binary_sh.html">t4103-apply-binary.sh</a>
  
    <li><a href="../git/t/t4104-apply-boundary_sh.html">t4104-apply-boundary.sh</a>
  
    <li><a href="../git/t/t4105-apply-fuzz_sh.html">t4105-apply-fuzz.sh</a>
  
    <li><a href="../git/t/t4106-apply-stdin_sh.html">t4106-apply-stdin.sh</a>
  
    <li><a href="../git/t/t4107-apply-ignore-whitespace_sh.html">t4107-apply-ignore-whitespace.sh</a>
  
    <li><a href="../git/t/t4108-apply-threeway_sh.html">t4108-apply-threeway.sh</a>
  
    <li><a href="../git/t/t4109-apply-multifrag_sh.html">t4109-apply-multifrag.sh</a>
  
    <li><a href="../git/t/t4109/expect-1.html">expect-1</a>
  
    <li><a href="../git/t/t4109/expect-2.html">expect-2</a>
  
    <li><a href="../git/t/t4109/expect-3.html">expect-3</a>
  
    <li><a href="../git/t/t4109/patch1_patch.html">patch1.patch</a>
  
    <li><a href="../git/t/t4109/patch2_patch.html">patch2.patch</a>
  
    <li><a href="../git/t/t4109/patch3_patch.html">patch3.patch</a>
  
    <li><a href="../git/t/t4109/patch4_patch.html">patch4.patch</a>
  
    <li><a href="../git/t/t4110-apply-scan_sh.html">t4110-apply-scan.sh</a>
  
    <li><a href="../git/t/t4110/expect.html">expect</a>
  
    <li><a href="../git/t/t4110/patch1_patch.html">patch1.patch</a>
  
    <li><a href="../git/t/t4110/patch2_patch.html">patch2.patch</a>
  
    <li><a href="../git/t/t4110/patch3_patch.html">patch3.patch</a>
  
    <li><a href="../git/t/t4110/patch4_patch.html">patch4.patch</a>
  
    <li><a href="../git/t/t4110/patch5_patch.html">patch5.patch</a>
  
    <li><a href="../git/t/t4111-apply-subdir_sh.html">t4111-apply-subdir.sh</a>
  
    <li><a href="../git/t/t4112-apply-renames_sh.html">t4112-apply-renames.sh</a>
  
    <li><a href="../git/t/t4113-apply-ending_sh.html">t4113-apply-ending.sh</a>
  
    <li><a href="../git/t/t4114-apply-typechange_sh.html">t4114-apply-typechange.sh</a>
  
    <li><a href="../git/t/t4115-apply-symlink_sh.html">t4115-apply-symlink.sh</a>
  
    <li><a href="../git/t/t4116-apply-reverse_sh.html">t4116-apply-reverse.sh</a>
  
    <li><a href="../git/t/t4117-apply-reject_sh.html">t4117-apply-reject.sh</a>
  
    <li><a href="../git/t/t4118-apply-empty-context_sh.html">t4118-apply-empty-context.sh</a>
  
    <li><a href="../git/t/t4119-apply-config_sh.html">t4119-apply-config.sh</a>
  
    <li><a href="../git/t/t4120-apply-popt_sh.html">t4120-apply-popt.sh</a>
  
    <li><a href="../git/t/t4121-apply-diffs_sh.html">t4121-apply-diffs.sh</a>
  
    <li><a href="../git/t/t4122-apply-symlink-inside_sh.html">t4122-apply-symlink-inside.sh</a>
  
    <li><a href="../git/t/t4123-apply-shrink_sh.html">t4123-apply-shrink.sh</a>
  
    <li><a href="../git/t/t4124-apply-ws-rule_sh.html">t4124-apply-ws-rule.sh</a>
  
    <li><a href="../git/t/t4125-apply-ws-fuzz_sh.html">t4125-apply-ws-fuzz.sh</a>
  
    <li><a href="../git/t/t4126-apply-empty_sh.html">t4126-apply-empty.sh</a>
  
    <li><a href="../git/t/t4127-apply-same-fn_sh.html">t4127-apply-same-fn.sh</a>
  
    <li><a href="../git/t/t4128-apply-root_sh.html">t4128-apply-root.sh</a>
  
    <li><a href="../git/t/t4129-apply-samemode_sh.html">t4129-apply-samemode.sh</a>
  
    <li><a href="../git/t/t4130-apply-criss-cross-rename_sh.html">t4130-apply-criss-cross-rename.sh</a>
  
    <li><a href="../git/t/t4131-apply-fake-ancestor_sh.html">t4131-apply-fake-ancestor.sh</a>
  
    <li><a href="../git/t/t4132-apply-removal_sh.html">t4132-apply-removal.sh</a>
  
    <li><a href="../git/t/t4133-apply-filenames_sh.html">t4133-apply-filenames.sh</a>
  
    <li><a href="../git/t/t4134-apply-submodule_sh.html">t4134-apply-submodule.sh</a>
  
    <li><a href="../git/t/t4135-apply-weird-filenames_sh.html">t4135-apply-weird-filenames.sh</a>
  
    <li><a href="../git/t/t4135/add-plain_diff.html">add-plain.diff</a>
  
    <li><a href="../git/t/t4135/add-with backslash_diff.html">add-with backslash.diff</a>
  
    <li><a href="../git/t/t4135/add-with quote_diff.html">add-with quote.diff</a>
  
    <li><a href="../git/t/t4135/add-with spaces_diff.html">add-with spaces.diff</a>
  
    <li><a href="../git/t/t4135/add-with tab_diff.html">add-with tab.diff</a>
  
    <li><a href="../git/t/t4135/damaged-tz_diff.html">damaged-tz.diff</a>
  
    <li><a href="../git/t/t4135/damaged_diff.html">damaged.diff</a>
  
    <li><a href="../git/t/t4135/diff-plain_diff.html">diff-plain.diff</a>
  
    <li><a href="../git/t/t4135/diff-with backslash_diff.html">diff-with backslash.diff</a>
  
    <li><a href="../git/t/t4135/diff-with quote_diff.html">diff-with quote.diff</a>
  
    <li><a href="../git/t/t4135/diff-with spaces_diff.html">diff-with spaces.diff</a>
  
    <li><a href="../git/t/t4135/diff-with tab_diff.html">diff-with tab.diff</a>
  
    <li><a href="../git/t/t4135/funny-tz_diff.html">funny-tz.diff</a>
  
    <li><a href="../git/t/t4135/git-plain_diff.html">git-plain.diff</a>
  
    <li><a href="../git/t/t4135/git-with backslash_diff.html">git-with backslash.diff</a>
  
    <li><a href="../git/t/t4135/git-with quote_diff.html">git-with quote.diff</a>
  
    <li><a href="../git/t/t4135/git-with spaces_diff.html">git-with spaces.diff</a>
  
    <li><a href="../git/t/t4135/git-with tab_diff.html">git-with tab.diff</a>
  
    <li><a href="../git/t/t4135/make-patches.html">make-patches</a>
  
    <li><a href="../git/t/t4136-apply-check_sh.html">t4136-apply-check.sh</a>
  
    <li><a href="../git/t/t4150-am_sh.html">t4150-am.sh</a>
  
    <li><a href="../git/t/t4151-am-abort_sh.html">t4151-am-abort.sh</a>
  
    <li><a href="../git/t/t4152-am-subjects_sh.html">t4152-am-subjects.sh</a>
  
    <li><a href="../git/t/t4200-rerere_sh.html">t4200-rerere.sh</a>
  
    <li><a href="../git/t/t4202-log_sh.html">t4202-log.sh</a>
  
    <li><a href="../git/t/t4203-mailmap_sh.html">t4203-mailmap.sh</a>
  
    <li><a href="../git/t/t4204-patch-id_sh.html">t4204-patch-id.sh</a>
  
    <li><a href="../git/t/t4205-log-pretty-formats_sh.html">t4205-log-pretty-formats.sh</a>
  
    <li><a href="../git/t/t4206-log-follow-harder-copies_sh.html">t4206-log-follow-harder-copies.sh</a>
  
    <li><a href="../git/t/t4207-log-decoration-colors_sh.html">t4207-log-decoration-colors.sh</a>
  
    <li><a href="../git/t/t4208-log-magic-pathspec_sh.html">t4208-log-magic-pathspec.sh</a>
  
    <li><a href="../git/t/t4209-log-pickaxe_sh.html">t4209-log-pickaxe.sh</a>
  
    <li><a href="../git/t/t4210-log-i18n_sh.html">t4210-log-i18n.sh</a>
  
    <li><a href="../git/t/t4211-line-log_sh.html">t4211-line-log.sh</a>
  
    <li><a href="../git/t/t4211/expect_beginning-of-file.html">expect.beginning-of-file</a>
  
    <li><a href="../git/t/t4211/expect_end-of-file.html">expect.end-of-file</a>
  
    <li><a href="../git/t/t4211/expect_move-support-f.html">expect.move-support-f</a>
  
    <li><a href="../git/t/t4211/expect_multiple.html">expect.multiple</a>
  
    <li><a href="../git/t/t4211/expect_multiple-overlapping.html">expect.multiple-overlapping</a>
  
    <li><a href="../git/t/t4211/expect_multiple-superset.html">expect.multiple-superset</a>
  
    <li><a href="../git/t/t4211/expect_parallel-change-f-to-main.html">expect.parallel-change-f-to-main</a>
  
    <li><a href="../git/t/t4211/expect_simple-f.html">expect.simple-f</a>
  
    <li><a href="../git/t/t4211/expect_simple-f-to-main.html">expect.simple-f-to-main</a>
  
    <li><a href="../git/t/t4211/expect_simple-main.html">expect.simple-main</a>
  
    <li><a href="../git/t/t4211/expect_simple-main-to-end.html">expect.simple-main-to-end</a>
  
    <li><a href="../git/t/t4211/expect_two-ranges.html">expect.two-ranges</a>
  
    <li><a href="../git/t/t4211/expect_vanishes-early.html">expect.vanishes-early</a>
  
    <li><a href="../git/t/t4211/history_export.html">history.export</a>
  
    <li><a href="../git/t/t4212-log-corrupt_sh.html">t4212-log-corrupt.sh</a>
  
    <li><a href="../git/t/t4252-am-options_sh.html">t4252-am-options.sh</a>
  
    <li><a href="../git/t/t4252/am-test-1-1.html">am-test-1-1</a>
  
    <li><a href="../git/t/t4252/am-test-1-2.html">am-test-1-2</a>
  
    <li><a href="../git/t/t4252/am-test-2-1.html">am-test-2-1</a>
  
    <li><a href="../git/t/t4252/am-test-2-2.html">am-test-2-2</a>
  
    <li><a href="../git/t/t4252/am-test-3-1.html">am-test-3-1</a>
  
    <li><a href="../git/t/t4252/am-test-3-2.html">am-test-3-2</a>
  
    <li><a href="../git/t/t4252/am-test-4-1.html">am-test-4-1</a>
  
    <li><a href="../git/t/t4252/am-test-4-2.html">am-test-4-2</a>
  
    <li><a href="../git/t/t4252/am-test-5-1.html">am-test-5-1</a>
  
    <li><a href="../git/t/t4252/am-test-5-2.html">am-test-5-2</a>
  
    <li><a href="../git/t/t4252/am-test-6-1.html">am-test-6-1</a>
  
    <li><a href="../git/t/t4252/file-1-0.html">file-1-0</a>
  
    <li><a href="../git/t/t4252/file-2-0.html">file-2-0</a>
  
    <li><a href="../git/t/t4253-am-keep-cr-dos_sh.html">t4253-am-keep-cr-dos.sh</a>
  
    <li><a href="../git/t/t4254-am-corrupt_sh.html">t4254-am-corrupt.sh</a>
  
    <li><a href="../git/t/t4300-merge-tree_sh.html">t4300-merge-tree.sh</a>
  
    <li><a href="../git/t/t5000-tar-tree_sh.html">t5000-tar-tree.sh</a>
  
    <li><a href="../git/t/t5001-archive-attr_sh.html">t5001-archive-attr.sh</a>
  
    <li><a href="../git/t/t5002-archive-attr-pattern_sh.html">t5002-archive-attr-pattern.sh</a>
  
    <li><a href="../git/t/t5003-archive-zip_sh.html">t5003-archive-zip.sh</a>
  
    <li><a href="../git/t/t5004-archive-corner-cases_sh.html">t5004-archive-corner-cases.sh</a>
  
    <li><a href="../git/t/t5100-mailinfo_sh.html">t5100-mailinfo.sh</a>
  
    <li><a href="../git/t/t5100/empty.html">empty</a>
  
    <li><a href="../git/t/t5100/info-from_expect.html">info-from.expect</a>
  
    <li><a href="../git/t/t5100/info-from_in.html">info-from.in</a>
  
    <li><a href="../git/t/t5100/info0001.html">info0001</a>
  
    <li><a href="../git/t/t5100/info0002.html">info0002</a>
  
    <li><a href="../git/t/t5100/info0003.html">info0003</a>
  
    <li><a href="../git/t/t5100/info0004.html">info0004</a>
  
    <li><a href="../git/t/t5100/info0005.html">info0005</a>
  
    <li><a href="../git/t/t5100/info0006.html">info0006</a>
  
    <li><a href="../git/t/t5100/info0007.html">info0007</a>
  
    <li><a href="../git/t/t5100/info0008.html">info0008</a>
  
    <li><a href="../git/t/t5100/info0009.html">info0009</a>
  
    <li><a href="../git/t/t5100/info0010.html">info0010</a>
  
    <li><a href="../git/t/t5100/info0011.html">info0011</a>
  
    <li><a href="../git/t/t5100/info0012.html">info0012</a>
  
    <li><a href="../git/t/t5100/info0013.html">info0013</a>
  
    <li><a href="../git/t/t5100/info0014.html">info0014</a>
  
    <li><a href="../git/t/t5100/info0014--scissors.html">info0014--scissors</a>
  
    <li><a href="../git/t/t5100/info0015.html">info0015</a>
  
    <li><a href="../git/t/t5100/info0015--no-inbody-headers.html">info0015--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/info0016.html">info0016</a>
  
    <li><a href="../git/t/t5100/info0016--no-inbody-headers.html">info0016--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/info0017.html">info0017</a>
  
    <li><a href="../git/t/t5100/msg0001.html">msg0001</a>
  
    <li><a href="../git/t/t5100/msg0002.html">msg0002</a>
  
    <li><a href="../git/t/t5100/msg0003.html">msg0003</a>
  
    <li><a href="../git/t/t5100/msg0004.html">msg0004</a>
  
    <li><a href="../git/t/t5100/msg0005.html">msg0005</a>
  
    <li><a href="../git/t/t5100/msg0006.html">msg0006</a>
  
    <li><a href="../git/t/t5100/msg0007.html">msg0007</a>
  
    <li><a href="../git/t/t5100/msg0008.html">msg0008</a>
  
    <li><a href="../git/t/t5100/msg0009.html">msg0009</a>
  
    <li><a href="../git/t/t5100/msg0010.html">msg0010</a>
  
    <li><a href="../git/t/t5100/msg0011.html">msg0011</a>
  
    <li><a href="../git/t/t5100/msg0012.html">msg0012</a>
  
    <li><a href="../git/t/t5100/msg0013.html">msg0013</a>
  
    <li><a href="../git/t/t5100/msg0014.html">msg0014</a>
  
    <li><a href="../git/t/t5100/msg0014--scissors.html">msg0014--scissors</a>
  
    <li><a href="../git/t/t5100/msg0015.html">msg0015</a>
  
    <li><a href="../git/t/t5100/msg0015--no-inbody-headers.html">msg0015--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/msg0016.html">msg0016</a>
  
    <li><a href="../git/t/t5100/msg0016--no-inbody-headers.html">msg0016--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/msg0017.html">msg0017</a>
  
    <li><a href="../git/t/t5100/nul-b64_in.html">nul-b64.in</a>
  
    <li><a href="../git/t/t5100/patch0001.html">patch0001</a>
  
    <li><a href="../git/t/t5100/patch0002.html">patch0002</a>
  
    <li><a href="../git/t/t5100/patch0003.html">patch0003</a>
  
    <li><a href="../git/t/t5100/patch0004.html">patch0004</a>
  
    <li><a href="../git/t/t5100/patch0006.html">patch0006</a>
  
    <li><a href="../git/t/t5100/patch0007.html">patch0007</a>
  
    <li><a href="../git/t/t5100/patch0008.html">patch0008</a>
  
    <li><a href="../git/t/t5100/patch0009.html">patch0009</a>
  
    <li><a href="../git/t/t5100/patch0010.html">patch0010</a>
  
    <li><a href="../git/t/t5100/patch0011.html">patch0011</a>
  
    <li><a href="../git/t/t5100/patch0012.html">patch0012</a>
  
    <li><a href="../git/t/t5100/patch0013.html">patch0013</a>
  
    <li><a href="../git/t/t5100/patch0014.html">patch0014</a>
  
    <li><a href="../git/t/t5100/patch0014--scissors.html">patch0014--scissors</a>
  
    <li><a href="../git/t/t5100/patch0015.html">patch0015</a>
  
    <li><a href="../git/t/t5100/patch0015--no-inbody-headers.html">patch0015--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/patch0016.html">patch0016</a>
  
    <li><a href="../git/t/t5100/patch0016--no-inbody-headers.html">patch0016--no-inbody-headers</a>
  
    <li><a href="../git/t/t5100/patch0017.html">patch0017</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0001.html">rfc2047-info-0001</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0002.html">rfc2047-info-0002</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0003.html">rfc2047-info-0003</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0004.html">rfc2047-info-0004</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0005.html">rfc2047-info-0005</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0006.html">rfc2047-info-0006</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0007.html">rfc2047-info-0007</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0008.html">rfc2047-info-0008</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0009.html">rfc2047-info-0009</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0010.html">rfc2047-info-0010</a>
  
    <li><a href="../git/t/t5100/rfc2047-info-0011.html">rfc2047-info-0011</a>
  
    <li><a href="../git/t/t5100/rfc2047-samples_mbox.html">rfc2047-samples.mbox</a>
  
    <li><a href="../git/t/t5100/sample_mbox.html">sample.mbox</a>
  
    <li><a href="../git/t/t5150-request-pull_sh.html">t5150-request-pull.sh</a>
  
    <li><a href="../git/t/t5300-pack-object_sh.html">t5300-pack-object.sh</a>
  
    <li><a href="../git/t/t5301-sliding-window_sh.html">t5301-sliding-window.sh</a>
  
    <li><a href="../git/t/t5302-pack-index_sh.html">t5302-pack-index.sh</a>
  
    <li><a href="../git/t/t5303-pack-corruption-resilience_sh.html">t5303-pack-corruption-resilience.sh</a>
  
    <li><a href="../git/t/t5304-prune_sh.html">t5304-prune.sh</a>
  
    <li><a href="../git/t/t5305-include-tag_sh.html">t5305-include-tag.sh</a>
  
    <li><a href="../git/t/t5306-pack-nobase_sh.html">t5306-pack-nobase.sh</a>
  
    <li><a href="../git/t/t5307-pack-missing-commit_sh.html">t5307-pack-missing-commit.sh</a>
  
    <li><a href="../git/t/t5308-pack-detect-duplicates_sh.html">t5308-pack-detect-duplicates.sh</a>
  
    <li><a href="../git/t/t5309-pack-delta-cycles_sh.html">t5309-pack-delta-cycles.sh</a>
  
    <li><a href="../git/t/t5400-send-pack_sh.html">t5400-send-pack.sh</a>
  
    <li><a href="../git/t/t5401-update-hooks_sh.html">t5401-update-hooks.sh</a>
  
    <li><a href="../git/t/t5402-post-merge-hook_sh.html">t5402-post-merge-hook.sh</a>
  
    <li><a href="../git/t/t5403-post-checkout-hook_sh.html">t5403-post-checkout-hook.sh</a>
  
    <li><a href="../git/t/t5404-tracking-branches_sh.html">t5404-tracking-branches.sh</a>
  
    <li><a href="../git/t/t5405-send-pack-rewind_sh.html">t5405-send-pack-rewind.sh</a>
  
    <li><a href="../git/t/t5406-remote-rejects_sh.html">t5406-remote-rejects.sh</a>
  
    <li><a href="../git/t/t5407-post-rewrite-hook_sh.html">t5407-post-rewrite-hook.sh</a>
  
    <li><a href="../git/t/t5500-fetch-pack_sh.html">t5500-fetch-pack.sh</a>
  
    <li><a href="../git/t/t5501-fetch-push-alternates_sh.html">t5501-fetch-push-alternates.sh</a>
  
    <li><a href="../git/t/t5502-quickfetch_sh.html">t5502-quickfetch.sh</a>
  
    <li><a href="../git/t/t5503-tagfollow_sh.html">t5503-tagfollow.sh</a>
  
    <li><a href="../git/t/t5504-fetch-receive-strict_sh.html">t5504-fetch-receive-strict.sh</a>
  
    <li><a href="../git/t/t5505-remote_sh.html">t5505-remote.sh</a>
  
    <li><a href="../git/t/t5506-remote-groups_sh.html">t5506-remote-groups.sh</a>
  
    <li><a href="../git/t/t5509-fetch-push-namespaces_sh.html">t5509-fetch-push-namespaces.sh</a>
  
    <li><a href="../git/t/t5510-fetch_sh.html">t5510-fetch.sh</a>
  
    <li><a href="../git/t/t5511-refspec_sh.html">t5511-refspec.sh</a>
  
    <li><a href="../git/t/t5512-ls-remote_sh.html">t5512-ls-remote.sh</a>
  
    <li><a href="../git/t/t5513-fetch-track_sh.html">t5513-fetch-track.sh</a>
  
    <li><a href="../git/t/t5514-fetch-multiple_sh.html">t5514-fetch-multiple.sh</a>
  
    <li><a href="../git/t/t5515-fetch-merge-logic_sh.html">t5515-fetch-merge-logic.sh</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default.html">fetch.br-branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default-merge.html">fetch.br-branches-default-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default-merge_branches-default.html">fetch.br-branches-default-merge_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default-octopus.html">fetch.br-branches-default-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default-octopus_branches-default.html">fetch.br-branches-default-octopus_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-default_branches-default.html">fetch.br-branches-default_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one.html">fetch.br-branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one-merge.html">fetch.br-branches-one-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one-merge_branches-one.html">fetch.br-branches-one-merge_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one-octopus.html">fetch.br-branches-one-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one-octopus_branches-one.html">fetch.br-branches-one-octopus_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-branches-one_branches-one.html">fetch.br-branches-one_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit.html">fetch.br-config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit-merge.html">fetch.br-config-explicit-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit-merge_config-explicit.html">fetch.br-config-explicit-merge_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit-octopus.html">fetch.br-config-explicit-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit-octopus_config-explicit.html">fetch.br-config-explicit-octopus_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-explicit_config-explicit.html">fetch.br-config-explicit_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob.html">fetch.br-config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob-merge.html">fetch.br-config-glob-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob-merge_config-glob.html">fetch.br-config-glob-merge_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob-octopus.html">fetch.br-config-glob-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob-octopus_config-glob.html">fetch.br-config-glob-octopus_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-config-glob_config-glob.html">fetch.br-config-glob_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit.html">fetch.br-remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit-merge.html">fetch.br-remote-explicit-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit-merge_remote-explicit.html">fetch.br-remote-explicit-merge_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit-octopus.html">fetch.br-remote-explicit-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit-octopus_remote-explicit.html">fetch.br-remote-explicit-octopus_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-explicit_remote-explicit.html">fetch.br-remote-explicit_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob.html">fetch.br-remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob-merge.html">fetch.br-remote-glob-merge</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob-merge_remote-glob.html">fetch.br-remote-glob-merge_remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob-octopus.html">fetch.br-remote-glob-octopus</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob-octopus_remote-glob.html">fetch.br-remote-glob-octopus_remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-remote-glob_remote-glob.html">fetch.br-remote-glob_remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig.html">fetch.br-unconfig</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_--tags_____git.html">fetch.br-unconfig_--tags_.._.git</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git.html">fetch.br-unconfig_.._.git</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_one.html">fetch.br-unconfig_.._.git_one</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_one_tag_tag-one_tag_tag-three-file.html">fetch.br-unconfig_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_one_two.html">fetch.br-unconfig_.._.git_one_two</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_tag_tag-one-tree_tag_tag-three-file.html">fetch.br-unconfig_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_____git_tag_tag-one_tag_tag-three.html">fetch.br-unconfig_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_branches-default.html">fetch.br-unconfig_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_branches-one.html">fetch.br-unconfig_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_config-explicit.html">fetch.br-unconfig_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_config-glob.html">fetch.br-unconfig_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_remote-explicit.html">fetch.br-unconfig_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_br-unconfig_remote-glob.html">fetch.br-unconfig_remote-glob</a>
  
    <li><a href="../git/t/t5515/fetch_master.html">fetch.master</a>
  
    <li><a href="../git/t/t5515/fetch_master_--tags_____git.html">fetch.master_--tags_.._.git</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git.html">fetch.master_.._.git</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_one.html">fetch.master_.._.git_one</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_one_tag_tag-one_tag_tag-three-file.html">fetch.master_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_one_two.html">fetch.master_.._.git_one_two</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_tag_tag-one-tree_tag_tag-three-file.html">fetch.master_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/fetch_master_____git_tag_tag-one_tag_tag-three.html">fetch.master_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../git/t/t5515/fetch_master_branches-default.html">fetch.master_branches-default</a>
  
    <li><a href="../git/t/t5515/fetch_master_branches-one.html">fetch.master_branches-one</a>
  
    <li><a href="../git/t/t5515/fetch_master_config-explicit.html">fetch.master_config-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_master_config-glob.html">fetch.master_config-glob</a>
  
    <li><a href="../git/t/t5515/fetch_master_remote-explicit.html">fetch.master_remote-explicit</a>
  
    <li><a href="../git/t/t5515/fetch_master_remote-glob.html">fetch.master_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default.html">refs.br-branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default-merge.html">refs.br-branches-default-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default-merge_branches-default.html">refs.br-branches-default-merge_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default-octopus.html">refs.br-branches-default-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default-octopus_branches-default.html">refs.br-branches-default-octopus_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-default_branches-default.html">refs.br-branches-default_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one.html">refs.br-branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one-merge.html">refs.br-branches-one-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one-merge_branches-one.html">refs.br-branches-one-merge_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one-octopus.html">refs.br-branches-one-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one-octopus_branches-one.html">refs.br-branches-one-octopus_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-branches-one_branches-one.html">refs.br-branches-one_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit.html">refs.br-config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit-merge.html">refs.br-config-explicit-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit-merge_config-explicit.html">refs.br-config-explicit-merge_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit-octopus.html">refs.br-config-explicit-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit-octopus_config-explicit.html">refs.br-config-explicit-octopus_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-config-explicit_config-explicit.html">refs.br-config-explicit_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob.html">refs.br-config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob-merge.html">refs.br-config-glob-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob-merge_config-glob.html">refs.br-config-glob-merge_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob-octopus.html">refs.br-config-glob-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob-octopus_config-glob.html">refs.br-config-glob-octopus_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-config-glob_config-glob.html">refs.br-config-glob_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit.html">refs.br-remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit-merge.html">refs.br-remote-explicit-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit-merge_remote-explicit.html">refs.br-remote-explicit-merge_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit-octopus.html">refs.br-remote-explicit-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit-octopus_remote-explicit.html">refs.br-remote-explicit-octopus_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-explicit_remote-explicit.html">refs.br-remote-explicit_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob.html">refs.br-remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob-merge.html">refs.br-remote-glob-merge</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob-merge_remote-glob.html">refs.br-remote-glob-merge_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob-octopus.html">refs.br-remote-glob-octopus</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob-octopus_remote-glob.html">refs.br-remote-glob-octopus_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-remote-glob_remote-glob.html">refs.br-remote-glob_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig.html">refs.br-unconfig</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_--tags_____git.html">refs.br-unconfig_--tags_.._.git</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git.html">refs.br-unconfig_.._.git</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_one.html">refs.br-unconfig_.._.git_one</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_one_tag_tag-one_tag_tag-three-file.html">refs.br-unconfig_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_one_two.html">refs.br-unconfig_.._.git_one_two</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_tag_tag-one-tree_tag_tag-three-file.html">refs.br-unconfig_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_____git_tag_tag-one_tag_tag-three.html">refs.br-unconfig_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_branches-default.html">refs.br-unconfig_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_branches-one.html">refs.br-unconfig_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_config-explicit.html">refs.br-unconfig_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_config-glob.html">refs.br-unconfig_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_remote-explicit.html">refs.br-unconfig_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_br-unconfig_remote-glob.html">refs.br-unconfig_remote-glob</a>
  
    <li><a href="../git/t/t5515/refs_master.html">refs.master</a>
  
    <li><a href="../git/t/t5515/refs_master_--tags_____git.html">refs.master_--tags_.._.git</a>
  
    <li><a href="../git/t/t5515/refs_master_____git.html">refs.master_.._.git</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_one.html">refs.master_.._.git_one</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_one_tag_tag-one_tag_tag-three-file.html">refs.master_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_one_two.html">refs.master_.._.git_one_two</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_tag_tag-one-tree_tag_tag-three-file.html">refs.master_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../git/t/t5515/refs_master_____git_tag_tag-one_tag_tag-three.html">refs.master_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../git/t/t5515/refs_master_branches-default.html">refs.master_branches-default</a>
  
    <li><a href="../git/t/t5515/refs_master_branches-one.html">refs.master_branches-one</a>
  
    <li><a href="../git/t/t5515/refs_master_config-explicit.html">refs.master_config-explicit</a>
  
    <li><a href="../git/t/t5515/refs_master_config-glob.html">refs.master_config-glob</a>
  
    <li><a href="../git/t/t5515/refs_master_remote-explicit.html">refs.master_remote-explicit</a>
  
    <li><a href="../git/t/t5515/refs_master_remote-glob.html">refs.master_remote-glob</a>
  
    <li><a href="../git/t/t5516-fetch-push_sh.html">t5516-fetch-push.sh</a>
  
    <li><a href="../git/t/t5517-push-mirror_sh.html">t5517-push-mirror.sh</a>
  
    <li><a href="../git/t/t5518-fetch-exit-status_sh.html">t5518-fetch-exit-status.sh</a>
  
    <li><a href="../git/t/t5519-push-alternates_sh.html">t5519-push-alternates.sh</a>
  
    <li><a href="../git/t/t5520-pull_sh.html">t5520-pull.sh</a>
  
    <li><a href="../git/t/t5521-pull-options_sh.html">t5521-pull-options.sh</a>
  
    <li><a href="../git/t/t5522-pull-symlink_sh.html">t5522-pull-symlink.sh</a>
  
    <li><a href="../git/t/t5523-push-upstream_sh.html">t5523-push-upstream.sh</a>
  
    <li><a href="../git/t/t5524-pull-msg_sh.html">t5524-pull-msg.sh</a>
  
    <li><a href="../git/t/t5525-fetch-tagopt_sh.html">t5525-fetch-tagopt.sh</a>
  
    <li><a href="../git/t/t5526-fetch-submodules_sh.html">t5526-fetch-submodules.sh</a>
  
    <li><a href="../git/t/t5527-fetch-odd-refs_sh.html">t5527-fetch-odd-refs.sh</a>
  
    <li><a href="../git/t/t5528-push-default_sh.html">t5528-push-default.sh</a>
  
    <li><a href="../git/t/t5530-upload-pack-error_sh.html">t5530-upload-pack-error.sh</a>
  
    <li><a href="../git/t/t5531-deep-submodule-push_sh.html">t5531-deep-submodule-push.sh</a>
  
    <li><a href="../git/t/t5532-fetch-proxy_sh.html">t5532-fetch-proxy.sh</a>
  
    <li><a href="../git/t/t5533-push-cas_sh.html">t5533-push-cas.sh</a>
  
    <li><a href="../git/t/t5535-fetch-push-symref_sh.html">t5535-fetch-push-symref.sh</a>
  
    <li><a href="../git/t/t5540-http-push_sh.html">t5540-http-push.sh</a>
  
    <li><a href="../git/t/t5541-http-push_sh.html">t5541-http-push.sh</a>
  
    <li><a href="../git/t/t5550-http-fetch_sh.html">t5550-http-fetch.sh</a>
  
    <li><a href="../git/t/t5551-http-fetch_sh.html">t5551-http-fetch.sh</a>
  
    <li><a href="../git/t/t5560-http-backend-noserver_sh.html">t5560-http-backend-noserver.sh</a>
  
    <li><a href="../git/t/t5561-http-backend_sh.html">t5561-http-backend.sh</a>
  
    <li><a href="../git/t/t556x_common.html">t556x_common</a>
  
    <li><a href="../git/t/t5570-git-daemon_sh.html">t5570-git-daemon.sh</a>
  
    <li><a href="../git/t/t5571-pre-push-hook_sh.html">t5571-pre-push-hook.sh</a>
  
    <li><a href="../git/t/t5600-clone-fail-cleanup_sh.html">t5600-clone-fail-cleanup.sh</a>
  
    <li><a href="../git/t/t5601-clone_sh.html">t5601-clone.sh</a>
  
    <li><a href="../git/t/t5602-clone-remote-exec_sh.html">t5602-clone-remote-exec.sh</a>
  
    <li><a href="../git/t/t5700-clone-reference_sh.html">t5700-clone-reference.sh</a>
  
    <li><a href="../git/t/t5701-clone-local_sh.html">t5701-clone-local.sh</a>
  
    <li><a href="../git/t/t5702-clone-options_sh.html">t5702-clone-options.sh</a>
  
    <li><a href="../git/t/t5704-bundle_sh.html">t5704-bundle.sh</a>
  
    <li><a href="../git/t/t5705-clone-2gb_sh.html">t5705-clone-2gb.sh</a>
  
    <li><a href="../git/t/t5706-clone-branch_sh.html">t5706-clone-branch.sh</a>
  
    <li><a href="../git/t/t5707-clone-detached_sh.html">t5707-clone-detached.sh</a>
  
    <li><a href="../git/t/t5708-clone-config_sh.html">t5708-clone-config.sh</a>
  
    <li><a href="../git/t/t5709-clone-refspec_sh.html">t5709-clone-refspec.sh</a>
  
    <li><a href="../git/t/t5710-info-alternate_sh.html">t5710-info-alternate.sh</a>
  
    <li><a href="../git/t/t5801-remote-helpers_sh.html">t5801-remote-helpers.sh</a>
  
    <li><a href="../git/t/t5802-connect-helper_sh.html">t5802-connect-helper.sh</a>
  
    <li><a href="../git/t/t5900-repo-selection_sh.html">t5900-repo-selection.sh</a>
  
    <li><a href="../git/t/t6000-rev-list-misc_sh.html">t6000-rev-list-misc.sh</a>
  
    <li><a href="../git/t/t6001-rev-list-graft_sh.html">t6001-rev-list-graft.sh</a>
  
    <li><a href="../git/t/t6002-rev-list-bisect_sh.html">t6002-rev-list-bisect.sh</a>
  
    <li><a href="../git/t/t6003-rev-list-topo-order_sh.html">t6003-rev-list-topo-order.sh</a>
  
    <li><a href="../git/t/t6004-rev-list-path-optim_sh.html">t6004-rev-list-path-optim.sh</a>
  
    <li><a href="../git/t/t6005-rev-list-count_sh.html">t6005-rev-list-count.sh</a>
  
    <li><a href="../git/t/t6006-rev-list-format_sh.html">t6006-rev-list-format.sh</a>
  
    <li><a href="../git/t/t6007-rev-list-cherry-pick-file_sh.html">t6007-rev-list-cherry-pick-file.sh</a>
  
    <li><a href="../git/t/t6008-rev-list-submodule_sh.html">t6008-rev-list-submodule.sh</a>
  
    <li><a href="../git/t/t6009-rev-list-parent_sh.html">t6009-rev-list-parent.sh</a>
  
    <li><a href="../git/t/t6010-merge-base_sh.html">t6010-merge-base.sh</a>
  
    <li><a href="../git/t/t6011-rev-list-with-bad-commit_sh.html">t6011-rev-list-with-bad-commit.sh</a>
  
    <li><a href="../git/t/t6012-rev-list-simplify_sh.html">t6012-rev-list-simplify.sh</a>
  
    <li><a href="../git/t/t6013-rev-list-reverse-parents_sh.html">t6013-rev-list-reverse-parents.sh</a>
  
    <li><a href="../git/t/t6014-rev-list-all_sh.html">t6014-rev-list-all.sh</a>
  
    <li><a href="../git/t/t6015-rev-list-show-all-parents_sh.html">t6015-rev-list-show-all-parents.sh</a>
  
    <li><a href="../git/t/t6016-rev-list-graph-simplify-history_sh.html">t6016-rev-list-graph-simplify-history.sh</a>
  
    <li><a href="../git/t/t6017-rev-list-stdin_sh.html">t6017-rev-list-stdin.sh</a>
  
    <li><a href="../git/t/t6018-rev-list-glob_sh.html">t6018-rev-list-glob.sh</a>
  
    <li><a href="../git/t/t6019-rev-list-ancestry-path_sh.html">t6019-rev-list-ancestry-path.sh</a>
  
    <li><a href="../git/t/t6020-merge-df_sh.html">t6020-merge-df.sh</a>
  
    <li><a href="../git/t/t6021-merge-criss-cross_sh.html">t6021-merge-criss-cross.sh</a>
  
    <li><a href="../git/t/t6022-merge-rename_sh.html">t6022-merge-rename.sh</a>
  
    <li><a href="../git/t/t6023-merge-file_sh.html">t6023-merge-file.sh</a>
  
    <li><a href="../git/t/t6024-recursive-merge_sh.html">t6024-recursive-merge.sh</a>
  
    <li><a href="../git/t/t6025-merge-symlinks_sh.html">t6025-merge-symlinks.sh</a>
  
    <li><a href="../git/t/t6026-merge-attr_sh.html">t6026-merge-attr.sh</a>
  
    <li><a href="../git/t/t6027-merge-binary_sh.html">t6027-merge-binary.sh</a>
  
    <li><a href="../git/t/t6028-merge-up-to-date_sh.html">t6028-merge-up-to-date.sh</a>
  
    <li><a href="../git/t/t6029-merge-subtree_sh.html">t6029-merge-subtree.sh</a>
  
    <li><a href="../git/t/t6030-bisect-porcelain_sh.html">t6030-bisect-porcelain.sh</a>
  
    <li><a href="../git/t/t6031-merge-recursive_sh.html">t6031-merge-recursive.sh</a>
  
    <li><a href="../git/t/t6032-merge-large-rename_sh.html">t6032-merge-large-rename.sh</a>
  
    <li><a href="../git/t/t6033-merge-crlf_sh.html">t6033-merge-crlf.sh</a>
  
    <li><a href="../git/t/t6034-merge-rename-nocruft_sh.html">t6034-merge-rename-nocruft.sh</a>
  
    <li><a href="../git/t/t6035-merge-dir-to-symlink_sh.html">t6035-merge-dir-to-symlink.sh</a>
  
    <li><a href="../git/t/t6036-recursive-corner-cases_sh.html">t6036-recursive-corner-cases.sh</a>
  
    <li><a href="../git/t/t6037-merge-ours-theirs_sh.html">t6037-merge-ours-theirs.sh</a>
  
    <li><a href="../git/t/t6038-merge-text-auto_sh.html">t6038-merge-text-auto.sh</a>
  
    <li><a href="../git/t/t6040-tracking-info_sh.html">t6040-tracking-info.sh</a>
  
    <li><a href="../git/t/t6042-merge-rename-corner-cases_sh.html">t6042-merge-rename-corner-cases.sh</a>
  
    <li><a href="../git/t/t6050-replace_sh.html">t6050-replace.sh</a>
  
    <li><a href="../git/t/t6060-merge-index_sh.html">t6060-merge-index.sh</a>
  
    <li><a href="../git/t/t6101-rev-parse-parents_sh.html">t6101-rev-parse-parents.sh</a>
  
    <li><a href="../git/t/t6110-rev-list-sparse_sh.html">t6110-rev-list-sparse.sh</a>
  
    <li><a href="../git/t/t6111-rev-list-treesame_sh.html">t6111-rev-list-treesame.sh</a>
  
    <li><a href="../git/t/t6120-describe_sh.html">t6120-describe.sh</a>
  
    <li><a href="../git/t/t6130-pathspec-noglob_sh.html">t6130-pathspec-noglob.sh</a>
  
    <li><a href="../git/t/t6131-pathspec-icase_sh.html">t6131-pathspec-icase.sh</a>
  
    <li><a href="../git/t/t6200-fmt-merge-msg_sh.html">t6200-fmt-merge-msg.sh</a>
  
    <li><a href="../git/t/t6300-for-each-ref_sh.html">t6300-for-each-ref.sh</a>
  
    <li><a href="../git/t/t6500-gc_sh.html">t6500-gc.sh</a>
  
    <li><a href="../git/t/t7001-mv_sh.html">t7001-mv.sh</a>
  
    <li><a href="../git/t/t7003-filter-branch_sh.html">t7003-filter-branch.sh</a>
  
    <li><a href="../git/t/t7004-tag_sh.html">t7004-tag.sh</a>
  
    <li><a href="../git/t/t7005-editor_sh.html">t7005-editor.sh</a>
  
    <li><a href="../git/t/t7006-pager_sh.html">t7006-pager.sh</a>
  
    <li><a href="../git/t/t7007-show_sh.html">t7007-show.sh</a>
  
    <li><a href="../git/t/t7008-grep-binary_sh.html">t7008-grep-binary.sh</a>
  
    <li><a href="../git/t/t7009-filter-branch-null-sha1_sh.html">t7009-filter-branch-null-sha1.sh</a>
  
    <li><a href="../git/t/t7010-setup_sh.html">t7010-setup.sh</a>
  
    <li><a href="../git/t/t7011-skip-worktree-reading_sh.html">t7011-skip-worktree-reading.sh</a>
  
    <li><a href="../git/t/t7012-skip-worktree-writing_sh.html">t7012-skip-worktree-writing.sh</a>
  
    <li><a href="../git/t/t7060-wtstatus_sh.html">t7060-wtstatus.sh</a>
  
    <li><a href="../git/t/t7061-wtstatus-ignore_sh.html">t7061-wtstatus-ignore.sh</a>
  
    <li><a href="../git/t/t7062-wtstatus-ignorecase_sh.html">t7062-wtstatus-ignorecase.sh</a>
  
    <li><a href="../git/t/t7101-reset_sh.html">t7101-reset.sh</a>
  
    <li><a href="../git/t/t7102-reset_sh.html">t7102-reset.sh</a>
  
    <li><a href="../git/t/t7103-reset-bare_sh.html">t7103-reset-bare.sh</a>
  
    <li><a href="../git/t/t7104-reset_sh.html">t7104-reset.sh</a>
  
    <li><a href="../git/t/t7105-reset-patch_sh.html">t7105-reset-patch.sh</a>
  
    <li><a href="../git/t/t7106-reset-unborn-branch_sh.html">t7106-reset-unborn-branch.sh</a>
  
    <li><a href="../git/t/t7110-reset-merge_sh.html">t7110-reset-merge.sh</a>
  
    <li><a href="../git/t/t7111-reset-table_sh.html">t7111-reset-table.sh</a>
  
    <li><a href="../git/t/t7201-co_sh.html">t7201-co.sh</a>
  
    <li><a href="../git/t/t7300-clean_sh.html">t7300-clean.sh</a>
  
    <li><a href="../git/t/t7301-clean-interactive_sh.html">t7301-clean-interactive.sh</a>
  
    <li><a href="../git/t/t7400-submodule-basic_sh.html">t7400-submodule-basic.sh</a>
  
    <li><a href="../git/t/t7401-submodule-summary_sh.html">t7401-submodule-summary.sh</a>
  
    <li><a href="../git/t/t7402-submodule-rebase_sh.html">t7402-submodule-rebase.sh</a>
  
    <li><a href="../git/t/t7403-submodule-sync_sh.html">t7403-submodule-sync.sh</a>
  
    <li><a href="../git/t/t7405-submodule-merge_sh.html">t7405-submodule-merge.sh</a>
  
    <li><a href="../git/t/t7406-submodule-update_sh.html">t7406-submodule-update.sh</a>
  
    <li><a href="../git/t/t7407-submodule-foreach_sh.html">t7407-submodule-foreach.sh</a>
  
    <li><a href="../git/t/t7408-submodule-reference_sh.html">t7408-submodule-reference.sh</a>
  
    <li><a href="../git/t/t7409-submodule-detached-worktree_sh.html">t7409-submodule-detached-worktree.sh</a>
  
    <li><a href="../git/t/t7500-commit_sh.html">t7500-commit.sh</a>
  
    <li><a href="../git/t/t7500/add-comments.html">add-comments</a>
  
    <li><a href="../git/t/t7500/add-content.html">add-content</a>
  
    <li><a href="../git/t/t7500/add-content-and-comment.html">add-content-and-comment</a>
  
    <li><a href="../git/t/t7500/add-signed-off.html">add-signed-off</a>
  
    <li><a href="../git/t/t7500/add-whitespaced-content.html">add-whitespaced-content</a>
  
    <li><a href="../git/t/t7500/edit-content.html">edit-content</a>
  
    <li><a href="../git/t/t7501-commit_sh.html">t7501-commit.sh</a>
  
    <li><a href="../git/t/t7502-commit_sh.html">t7502-commit.sh</a>
  
    <li><a href="../git/t/t7503-pre-commit-hook_sh.html">t7503-pre-commit-hook.sh</a>
  
    <li><a href="../git/t/t7504-commit-msg-hook_sh.html">t7504-commit-msg-hook.sh</a>
  
    <li><a href="../git/t/t7505-prepare-commit-msg-hook_sh.html">t7505-prepare-commit-msg-hook.sh</a>
  
    <li><a href="../git/t/t7506-status-submodule_sh.html">t7506-status-submodule.sh</a>
  
    <li><a href="../git/t/t7507-commit-verbose_sh.html">t7507-commit-verbose.sh</a>
  
    <li><a href="../git/t/t7508-status_sh.html">t7508-status.sh</a>
  
    <li><a href="../git/t/t7509-commit_sh.html">t7509-commit.sh</a>
  
    <li><a href="../git/t/t7510-signed-commit_sh.html">t7510-signed-commit.sh</a>
  
    <li><a href="../git/t/t7511-status-index_sh.html">t7511-status-index.sh</a>
  
    <li><a href="../git/t/t7512-status-help_sh.html">t7512-status-help.sh</a>
  
    <li><a href="../git/t/t7600-merge_sh.html">t7600-merge.sh</a>
  
    <li><a href="../git/t/t7601-merge-pull-config_sh.html">t7601-merge-pull-config.sh</a>
  
    <li><a href="../git/t/t7602-merge-octopus-many_sh.html">t7602-merge-octopus-many.sh</a>
  
    <li><a href="../git/t/t7603-merge-reduce-heads_sh.html">t7603-merge-reduce-heads.sh</a>
  
    <li><a href="../git/t/t7604-merge-custom-message_sh.html">t7604-merge-custom-message.sh</a>
  
    <li><a href="../git/t/t7605-merge-resolve_sh.html">t7605-merge-resolve.sh</a>
  
    <li><a href="../git/t/t7606-merge-custom_sh.html">t7606-merge-custom.sh</a>
  
    <li><a href="../git/t/t7607-merge-overwrite_sh.html">t7607-merge-overwrite.sh</a>
  
    <li><a href="../git/t/t7608-merge-messages_sh.html">t7608-merge-messages.sh</a>
  
    <li><a href="../git/t/t7609-merge-co-error-msgs_sh.html">t7609-merge-co-error-msgs.sh</a>
  
    <li><a href="../git/t/t7610-mergetool_sh.html">t7610-mergetool.sh</a>
  
    <li><a href="../git/t/t7611-merge-abort_sh.html">t7611-merge-abort.sh</a>
  
    <li><a href="../git/t/t7612-merge-verify-signatures_sh.html">t7612-merge-verify-signatures.sh</a>
  
    <li><a href="../git/t/t7700-repack_sh.html">t7700-repack.sh</a>
  
    <li><a href="../git/t/t7701-repack-unpack-unreachable_sh.html">t7701-repack-unpack-unreachable.sh</a>
  
    <li><a href="../git/t/t7800-difftool_sh.html">t7800-difftool.sh</a>
  
    <li><a href="../git/t/t7810-grep_sh.html">t7810-grep.sh</a>
  
    <li><a href="../git/t/t7811-grep-open_sh.html">t7811-grep-open.sh</a>
  
    <li><a href="../git/t/t8001-annotate_sh.html">t8001-annotate.sh</a>
  
    <li><a href="../git/t/t8002-blame_sh.html">t8002-blame.sh</a>
  
    <li><a href="../git/t/t8003-blame-corner-cases_sh.html">t8003-blame-corner-cases.sh</a>
  
    <li><a href="../git/t/t8004-blame-with-conflicts_sh.html">t8004-blame-with-conflicts.sh</a>
  
    <li><a href="../git/t/t8005-blame-i18n_sh.html">t8005-blame-i18n.sh</a>
  
    <li><a href="../git/t/t8005/utf8_txt.html">utf8</a>
  
    <li><a href="../git/t/t8006-blame-textconv_sh.html">t8006-blame-textconv.sh</a>
  
    <li><a href="../git/t/t8007-cat-file-textconv_sh.html">t8007-cat-file-textconv.sh</a>
  
    <li><a href="../git/t/t8008-blame-formats_sh.html">t8008-blame-formats.sh</a>
  
    <li><a href="../git/t/t9001-send-email_sh.html">t9001-send-email.sh</a>
  
    <li><a href="../git/t/t9002-column_sh.html">t9002-column.sh</a>
  
    <li><a href="../git/t/t9010-svn-fe_sh.html">t9010-svn-fe.sh</a>
  
    <li><a href="../git/t/t9011-svn-da_sh.html">t9011-svn-da.sh</a>
  
    <li><a href="../git/t/t9020-remote-svn_sh.html">t9020-remote-svn.sh</a>
  
    <li><a href="../git/t/t9100-git-svn-basic_sh.html">t9100-git-svn-basic.sh</a>
  
    <li><a href="../git/t/t9101-git-svn-props_sh.html">t9101-git-svn-props.sh</a>
  
    <li><a href="../git/t/t9102-git-svn-deep-rmdir_sh.html">t9102-git-svn-deep-rmdir.sh</a>
  
    <li><a href="../git/t/t9103-git-svn-tracked-directory-removed_sh.html">t9103-git-svn-tracked-directory-removed.sh</a>
  
    <li><a href="../git/t/t9104-git-svn-follow-parent_sh.html">t9104-git-svn-follow-parent.sh</a>
  
    <li><a href="../git/t/t9105-git-svn-commit-diff_sh.html">t9105-git-svn-commit-diff.sh</a>
  
    <li><a href="../git/t/t9106-git-svn-commit-diff-clobber_sh.html">t9106-git-svn-commit-diff-clobber.sh</a>
  
    <li><a href="../git/t/t9107-git-svn-migrate_sh.html">t9107-git-svn-migrate.sh</a>
  
    <li><a href="../git/t/t9108-git-svn-glob_sh.html">t9108-git-svn-glob.sh</a>
  
    <li><a href="../git/t/t9109-git-svn-multi-glob_sh.html">t9109-git-svn-multi-glob.sh</a>
  
    <li><a href="../git/t/t9110-git-svn-use-svm-props_sh.html">t9110-git-svn-use-svm-props.sh</a>
  
    <li><a href="../git/t/t9110/svm_dump.html">svm.dump</a>
  
    <li><a href="../git/t/t9111-git-svn-use-svnsync-props_sh.html">t9111-git-svn-use-svnsync-props.sh</a>
  
    <li><a href="../git/t/t9111/svnsync_dump.html">svnsync.dump</a>
  
    <li><a href="../git/t/t9112-git-svn-md5less-file_sh.html">t9112-git-svn-md5less-file.sh</a>
  
    <li><a href="../git/t/t9113-git-svn-dcommit-new-file_sh.html">t9113-git-svn-dcommit-new-file.sh</a>
  
    <li><a href="../git/t/t9114-git-svn-dcommit-merge_sh.html">t9114-git-svn-dcommit-merge.sh</a>
  
    <li><a href="../git/t/t9115-git-svn-dcommit-funky-renames_sh.html">t9115-git-svn-dcommit-funky-renames.sh</a>
  
    <li><a href="../git/t/t9115/funky-names_dump.html">funky-names.dump</a>
  
    <li><a href="../git/t/t9116-git-svn-log_sh.html">t9116-git-svn-log.sh</a>
  
    <li><a href="../git/t/t9117-git-svn-init-clone_sh.html">t9117-git-svn-init-clone.sh</a>
  
    <li><a href="../git/t/t9118-git-svn-funky-branch-names_sh.html">t9118-git-svn-funky-branch-names.sh</a>
  
    <li><a href="../git/t/t9119-git-svn-info_sh.html">t9119-git-svn-info.sh</a>
  
    <li><a href="../git/t/t9120-git-svn-clone-with-percent-escapes_sh.html">t9120-git-svn-clone-with-percent-escapes.sh</a>
  
    <li><a href="../git/t/t9121-git-svn-fetch-renamed-dir_sh.html">t9121-git-svn-fetch-renamed-dir.sh</a>
  
    <li><a href="../git/t/t9121/renamed-dir_dump.html">renamed-dir.dump</a>
  
    <li><a href="../git/t/t9122-git-svn-author_sh.html">t9122-git-svn-author.sh</a>
  
    <li><a href="../git/t/t9123-git-svn-rebuild-with-rewriteroot_sh.html">t9123-git-svn-rebuild-with-rewriteroot.sh</a>
  
    <li><a href="../git/t/t9124-git-svn-dcommit-auto-props_sh.html">t9124-git-svn-dcommit-auto-props.sh</a>
  
    <li><a href="../git/t/t9125-git-svn-multi-glob-branch-names_sh.html">t9125-git-svn-multi-glob-branch-names.sh</a>
  
    <li><a href="../git/t/t9126-git-svn-follow-deleted-readded-directory_sh.html">t9126-git-svn-follow-deleted-readded-directory.sh</a>
  
    <li><a href="../git/t/t9126/follow-deleted-readded_dump.html">follow-deleted-readded.dump</a>
  
    <li><a href="../git/t/t9127-git-svn-partial-rebuild_sh.html">t9127-git-svn-partial-rebuild.sh</a>
  
    <li><a href="../git/t/t9128-git-svn-cmd-branch_sh.html">t9128-git-svn-cmd-branch.sh</a>
  
    <li><a href="../git/t/t9129-git-svn-i18n-commitencoding_sh.html">t9129-git-svn-i18n-commitencoding.sh</a>
  
    <li><a href="../git/t/t9130-git-svn-authors-file_sh.html">t9130-git-svn-authors-file.sh</a>
  
    <li><a href="../git/t/t9131-git-svn-empty-symlink_sh.html">t9131-git-svn-empty-symlink.sh</a>
  
    <li><a href="../git/t/t9132-git-svn-broken-symlink_sh.html">t9132-git-svn-broken-symlink.sh</a>
  
    <li><a href="../git/t/t9133-git-svn-nested-git-repo_sh.html">t9133-git-svn-nested-git-repo.sh</a>
  
    <li><a href="../git/t/t9134-git-svn-ignore-paths_sh.html">t9134-git-svn-ignore-paths.sh</a>
  
    <li><a href="../git/t/t9135-git-svn-moved-branch-empty-file_sh.html">t9135-git-svn-moved-branch-empty-file.sh</a>
  
    <li><a href="../git/t/t9135/svn_dump.html">svn.dump</a>
  
    <li><a href="../git/t/t9136-git-svn-recreated-branch-empty-file_sh.html">t9136-git-svn-recreated-branch-empty-file.sh</a>
  
    <li><a href="../git/t/t9136/svn_dump.html">svn.dump</a>
  
    <li><a href="../git/t/t9137-git-svn-dcommit-clobber-series_sh.html">t9137-git-svn-dcommit-clobber-series.sh</a>
  
    <li><a href="../git/t/t9138-git-svn-authors-prog_sh.html">t9138-git-svn-authors-prog.sh</a>
  
    <li><a href="../git/t/t9139-git-svn-non-utf8-commitencoding_sh.html">t9139-git-svn-non-utf8-commitencoding.sh</a>
  
    <li><a href="../git/t/t9140-git-svn-reset_sh.html">t9140-git-svn-reset.sh</a>
  
    <li><a href="../git/t/t9141-git-svn-multiple-branches_sh.html">t9141-git-svn-multiple-branches.sh</a>
  
    <li><a href="../git/t/t9142-git-svn-shallow-clone_sh.html">t9142-git-svn-shallow-clone.sh</a>
  
    <li><a href="../git/t/t9143-git-svn-gc_sh.html">t9143-git-svn-gc.sh</a>
  
    <li><a href="../git/t/t9144-git-svn-old-rev_map_sh.html">t9144-git-svn-old-rev_map.sh</a>
  
    <li><a href="../git/t/t9145-git-svn-master-branch_sh.html">t9145-git-svn-master-branch.sh</a>
  
    <li><a href="../git/t/t9146-git-svn-empty-dirs_sh.html">t9146-git-svn-empty-dirs.sh</a>
  
    <li><a href="../git/t/t9147-git-svn-include-paths_sh.html">t9147-git-svn-include-paths.sh</a>
  
    <li><a href="../git/t/t9150-svk-mergetickets_sh.html">t9150-svk-mergetickets.sh</a>
  
    <li><a href="../git/t/t9150/make-svk-dump.html">make-svk-dump</a>
  
    <li><a href="../git/t/t9150/svk-merge_dump.html">svk-merge.dump</a>
  
    <li><a href="../git/t/t9151-svn-mergeinfo_sh.html">t9151-svn-mergeinfo.sh</a>
  
    <li><a href="../git/t/t9151/make-svnmerge-dump.html">make-svnmerge-dump</a>
  
    <li><a href="../git/t/t9151/svn-mergeinfo_dump.html">svn-mergeinfo.dump</a>
  
    <li><a href="../git/t/t9152-svn-empty-dirs-after-gc_sh.html">t9152-svn-empty-dirs-after-gc.sh</a>
  
    <li><a href="../git/t/t9153-git-svn-rewrite-uuid_sh.html">t9153-git-svn-rewrite-uuid.sh</a>
  
    <li><a href="../git/t/t9153/svn_dump.html">svn.dump</a>
  
    <li><a href="../git/t/t9154-git-svn-fancy-glob_sh.html">t9154-git-svn-fancy-glob.sh</a>
  
    <li><a href="../git/t/t9154/svn_dump.html">svn.dump</a>
  
    <li><a href="../git/t/t9155-git-svn-fetch-deleted-tag_sh.html">t9155-git-svn-fetch-deleted-tag.sh</a>
  
    <li><a href="../git/t/t9156-git-svn-fetch-deleted-tag-2_sh.html">t9156-git-svn-fetch-deleted-tag-2.sh</a>
  
    <li><a href="../git/t/t9157-git-svn-fetch-merge_sh.html">t9157-git-svn-fetch-merge.sh</a>
  
    <li><a href="../git/t/t9158-git-svn-mergeinfo_sh.html">t9158-git-svn-mergeinfo.sh</a>
  
    <li><a href="../git/t/t9159-git-svn-no-parent-mergeinfo_sh.html">t9159-git-svn-no-parent-mergeinfo.sh</a>
  
    <li><a href="../git/t/t9160-git-svn-preserve-empty-dirs_sh.html">t9160-git-svn-preserve-empty-dirs.sh</a>
  
    <li><a href="../git/t/t9161-git-svn-mergeinfo-push_sh.html">t9161-git-svn-mergeinfo-push.sh</a>
  
    <li><a href="../git/t/t9161/branches_dump.html">branches.dump</a>
  
    <li><a href="../git/t/t9162-git-svn-dcommit-interactive_sh.html">t9162-git-svn-dcommit-interactive.sh</a>
  
    <li><a href="../git/t/t9163-git-svn-reset-clears-caches_sh.html">t9163-git-svn-reset-clears-caches.sh</a>
  
    <li><a href="../git/t/t9164-git-svn-dcommit-concurrent_sh.html">t9164-git-svn-dcommit-concurrent.sh</a>
  
    <li><a href="../git/t/t9165-git-svn-fetch-merge-branch-of-branch_sh.html">t9165-git-svn-fetch-merge-branch-of-branch.sh</a>
  
    <li><a href="../git/t/t9166-git-svn-fetch-merge-branch-of-branch2_sh.html">t9166-git-svn-fetch-merge-branch-of-branch2.sh</a>
  
    <li><a href="../git/t/t9167-git-svn-cmd-branch-subproject_sh.html">t9167-git-svn-cmd-branch-subproject.sh</a>
  
    <li><a href="../git/t/t9200-git-cvsexportcommit_sh.html">t9200-git-cvsexportcommit.sh</a>
  
    <li><a href="../git/t/t9300-fast-import_sh.html">t9300-fast-import.sh</a>
  
    <li><a href="../git/t/t9301-fast-import-notes_sh.html">t9301-fast-import-notes.sh</a>
  
    <li><a href="../git/t/t9350-fast-export_sh.html">t9350-fast-export.sh</a>
  
    <li><a href="../git/t/t9400-git-cvsserver-server_sh.html">t9400-git-cvsserver-server.sh</a>
  
    <li><a href="../git/t/t9401-git-cvsserver-crlf_sh.html">t9401-git-cvsserver-crlf.sh</a>
  
    <li><a href="../git/t/t9402-git-cvsserver-refs_sh.html">t9402-git-cvsserver-refs.sh</a>
  
    <li><a href="../git/t/t9500-gitweb-standalone-no-errors_sh.html">t9500-gitweb-standalone-no-errors.sh</a>
  
    <li><a href="../git/t/t9501-gitweb-standalone-http-status_sh.html">t9501-gitweb-standalone-http-status.sh</a>
  
    <li><a href="../git/t/t9502-gitweb-standalone-parse-output_sh.html">t9502-gitweb-standalone-parse-output.sh</a>
  
    <li><a href="../git/t/t9600-cvsimport_sh.html">t9600-cvsimport.sh</a>
  
    <li><a href="../git/t/t9601-cvsimport-vendor-branch_sh.html">t9601-cvsimport-vendor-branch.sh</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/added-imported_txt,v.html">added-imported.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-anonymously_txt,v.html">imported-anonymously.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-modified-imported_txt,v.html">imported-modified-imported.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-modified_txt,v.html">imported-modified.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-once_txt,v.html">imported-once.txt,v</a>
  
    <li><a href="../git/t/t9601/cvsroot/module/imported-twice_txt,v.html">imported-twice.txt,v</a>
  
    <li><a href="../git/t/t9602-cvsimport-branches-tags_sh.html">t9602-cvsimport-branches-tags.sh</a>
  
    <li><a href="../git/t/t9602/README.html">README</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub1/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub1/subsubA/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub1/subsubB/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub2/Attic/branch_B_MIXED_only,v.html">branch_B_MIXED_only,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub2/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub2/subsubA/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9602/cvsroot/module/sub3/default,v.html">default,v</a>
  
    <li><a href="../git/t/t9603-cvsimport-patchsets_sh.html">t9603-cvsimport-patchsets.sh</a>
  
    <li><a href="../git/t/t9603/cvsroot/module/a,v.html">a,v</a>
  
    <li><a href="../git/t/t9603/cvsroot/module/b,v.html">b,v</a>
  
    <li><a href="../git/t/t9604-cvsimport-timestamps_sh.html">t9604-cvsimport-timestamps.sh</a>
  
    <li><a href="../git/t/t9604/cvsroot/module/a,v.html">a,v</a>
  
    <li><a href="../git/t/t9700-perl-git_sh.html">t9700-perl-git.sh</a>
  
    <li><a href="../git/t/t9700/test_pl.html">test.pl</a>
  
    <li><a href="../git/t/t9800-git-p4-basic_sh.html">t9800-git-p4-basic.sh</a>
  
    <li><a href="../git/t/t9801-git-p4-branch_sh.html">t9801-git-p4-branch.sh</a>
  
    <li><a href="../git/t/t9802-git-p4-filetype_sh.html">t9802-git-p4-filetype.sh</a>
  
    <li><a href="../git/t/t9803-git-p4-shell-metachars_sh.html">t9803-git-p4-shell-metachars.sh</a>
  
    <li><a href="../git/t/t9804-git-p4-label_sh.html">t9804-git-p4-label.sh</a>
  
    <li><a href="../git/t/t9805-git-p4-skip-submit-edit_sh.html">t9805-git-p4-skip-submit-edit.sh</a>
  
    <li><a href="../git/t/t9806-git-p4-options_sh.html">t9806-git-p4-options.sh</a>
  
    <li><a href="../git/t/t9807-git-p4-submit_sh.html">t9807-git-p4-submit.sh</a>
  
    <li><a href="../git/t/t9808-git-p4-chdir_sh.html">t9808-git-p4-chdir.sh</a>
  
    <li><a href="../git/t/t9809-git-p4-client-view_sh.html">t9809-git-p4-client-view.sh</a>
  
    <li><a href="../git/t/t9810-git-p4-rcs_sh.html">t9810-git-p4-rcs.sh</a>
  
    <li><a href="../git/t/t9811-git-p4-label-import_sh.html">t9811-git-p4-label-import.sh</a>
  
    <li><a href="../git/t/t9812-git-p4-wildcards_sh.html">t9812-git-p4-wildcards.sh</a>
  
    <li><a href="../git/t/t9813-git-p4-preserve-users_sh.html">t9813-git-p4-preserve-users.sh</a>
  
    <li><a href="../git/t/t9814-git-p4-rename_sh.html">t9814-git-p4-rename.sh</a>
  
    <li><a href="../git/t/t9815-git-p4-submit-fail_sh.html">t9815-git-p4-submit-fail.sh</a>
  
    <li><a href="../git/t/t9901-git-web--browse_sh.html">t9901-git-web--browse.sh</a>
  
    <li><a href="../git/t/t9902-completion_sh.html">t9902-completion.sh</a>
  
    <li><a href="../git/t/t9903-bash-prompt_sh.html">t9903-bash-prompt.sh</a>
  
    <li><a href="../git/t/test-lib-functions_sh.html">test-lib-functions.sh</a>
  
    <li><a href="../git/t/test-lib_sh.html">test-lib.sh</a>
  
    <li><a href="../git/t/test-terminal_perl.html">test-terminal.perl</a>
  
    <li><a href="../git/t/valgrind/analyze_sh.html">analyze.sh</a>
  
    <li><a href="../git/t/valgrind/default_supp.html">default.supp</a>
  
    <li><a href="../git/t/valgrind/valgrind_sh.html">valgrind.sh</a>
  
    <li><a href="../git/templates/Makefile.html">Makefile</a>
  
    <li><a href="../git/templates/branches--.html">branches--</a>
  
    <li><a href="../git/templates/hooks--applypatch-msg_sample.html">hooks--applypatch-msg.sample</a>
  
    <li><a href="../git/templates/hooks--commit-msg_sample.html">hooks--commit-msg.sample</a>
  
    <li><a href="../git/templates/hooks--post-update_sample.html">hooks--post-update.sample</a>
  
    <li><a href="../git/templates/hooks--pre-applypatch_sample.html">hooks--pre-applypatch.sample</a>
  
    <li><a href="../git/templates/hooks--pre-commit_sample.html">hooks--pre-commit.sample</a>
  
    <li><a href="../git/templates/hooks--pre-push_sample.html">hooks--pre-push.sample</a>
  
    <li><a href="../git/templates/hooks--pre-rebase_sample.html">hooks--pre-rebase.sample</a>
  
    <li><a href="../git/templates/hooks--prepare-commit-msg_sample.html">hooks--prepare-commit-msg.sample</a>
  
    <li><a href="../git/templates/hooks--update_sample.html">hooks--update.sample</a>
  
    <li><a href="../git/templates/info--exclude.html">info--exclude</a>
  
    <li><a href="../git/templates/this--description.html">this--description</a>
  
    <li><a href="../git/test-sha1_sh.html">test-sha1.sh</a>
  
    <li><a href="../git/unimplemented_sh.html">unimplemented.sh</a>
  
    <li><a href="../git/vcs-svn/LICENSE.html">LICENSE</a>
  
    <li><a href="../git/vcs-svn/line_buffer_txt.html">line_buffer</a>
  
    <li><a href="../git/wrap-for-bin_sh.html">wrap-for-bin.sh</a>
  
    <li><a href="../log/development_log.html">development.log</a>
  
    <li><a href="../public/404_html.html">404.html</a>
  
    <li><a href="../public/422_html.html">422.html</a>
  
    <li><a href="../public/500_html.html">500.html</a>
  
    <li><a href="../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../public/robots_txt.html">robots</a>
  
    <li><a href="../tmp/pids/server_pid.html">server.pid</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page git/git-cvsserver.perl">

<p>#!/usr/bin/perl</p>

<p>#### #### This application is a CVS emulation layer for git. #### It is
intended for clients to connect over SSH. #### See the documentation for
more details. #### #### Copyright The Open University UK - 2006. #### ####
Authors: Martyn Smith    &lt;martyn@catalyst.net.nz&gt; ####         
Martin Langhoff &lt;martin@laptop.org&gt; #### #### #### Released under the
GNU Public <a href="compat/nedmalloc/License_txt.html">License</a>, version
2. #### ####</p>

<p>use 5.008; use strict; use warnings; use bytes;</p>

<p>use Fcntl; use File::Temp qw/tempdir tempfile/; use File::Path qw/rmtree/;
use File::Basename; use Getopt::Long qw(:config require_order
no_ignore_case);</p>

<p>my $VERSION = &#39;@@GIT_VERSION@@&#39;;</p>

<p>my $log = GITCVS::log-&gt;new(); my $cfg;</p>

<p>my $DATE_LIST = {</p>

<pre class="ruby"><span class="ruby-constant">Jan</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;01&quot;</span>,
<span class="ruby-constant">Feb</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;02&quot;</span>,
<span class="ruby-constant">Mar</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;03&quot;</span>,
<span class="ruby-constant">Apr</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;04&quot;</span>,
<span class="ruby-constant">May</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;05&quot;</span>,
<span class="ruby-constant">Jun</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;06&quot;</span>,
<span class="ruby-constant">Jul</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;07&quot;</span>,
<span class="ruby-constant">Aug</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;08&quot;</span>,
<span class="ruby-constant">Sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;09&quot;</span>,
<span class="ruby-constant">Oct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;10&quot;</span>,
<span class="ruby-constant">Nov</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;11&quot;</span>,
<span class="ruby-constant">Dec</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;12&quot;</span>,
</pre>

<p>};</p>

<p># Enable autoflush for STDOUT (otherwise the whole thing falls apart) $| =
1;</p>

<p>#### Definition and mappings of functions ####</p>

<p># NOTE: Despite the existence of req_CATCHALL and req_EMPTY unimplemented #
requests, this list is incomplete.  It is missing many rarer/optional # 
requests.  Perhaps some clients require a claim of support for #  these
specific requests for main functionality to work? my $methods = {</p>

<pre class="ruby"><span class="ruby-string">&#39;Root&#39;</span>            =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Root</span>,
<span class="ruby-string">&#39;Valid-responses&#39;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Validresponses</span>,
<span class="ruby-string">&#39;valid-requests&#39;</span>  =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_validrequests</span>,
<span class="ruby-string">&#39;Directory&#39;</span>       =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Directory</span>,
<span class="ruby-string">&#39;Sticky&#39;</span>          =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Sticky</span>,
<span class="ruby-string">&#39;Entry&#39;</span>           =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Entry</span>,
<span class="ruby-string">&#39;Modified&#39;</span>        =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Modified</span>,
<span class="ruby-string">&#39;Unchanged&#39;</span>       =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Unchanged</span>,
<span class="ruby-string">&#39;Questionable&#39;</span>    =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Questionable</span>,
<span class="ruby-string">&#39;Argument&#39;</span>        =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Argument</span>,
<span class="ruby-string">&#39;Argumentx&#39;</span>       =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Argument</span>,
<span class="ruby-string">&#39;expand-modules&#39;</span>  =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_expandmodules</span>,
<span class="ruby-string">&#39;add&#39;</span>             =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_add</span>,
<span class="ruby-string">&#39;remove&#39;</span>          =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_remove</span>,
<span class="ruby-string">&#39;co&#39;</span>              =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_co</span>,
<span class="ruby-string">&#39;update&#39;</span>          =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_update</span>,
<span class="ruby-string">&#39;ci&#39;</span>              =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_ci</span>,
<span class="ruby-string">&#39;diff&#39;</span>            =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_diff</span>,
<span class="ruby-string">&#39;log&#39;</span>             =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_log</span>,
<span class="ruby-string">&#39;rlog&#39;</span>            =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_log</span>,
<span class="ruby-string">&#39;tag&#39;</span>             =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_CATCHALL</span>,
<span class="ruby-string">&#39;status&#39;</span>          =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_status</span>,
<span class="ruby-string">&#39;admin&#39;</span>           =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_CATCHALL</span>,
<span class="ruby-string">&#39;history&#39;</span>         =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_CATCHALL</span>,
<span class="ruby-string">&#39;watchers&#39;</span>        =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_EMPTY</span>,
<span class="ruby-string">&#39;editors&#39;</span>         =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_EMPTY</span>,
<span class="ruby-string">&#39;noop&#39;</span>            =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_EMPTY</span>,
<span class="ruby-string">&#39;annotate&#39;</span>        =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_annotate</span>,
<span class="ruby-string">&#39;Global_option&#39;</span>   =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">req_Globaloption</span>,
</pre>

<p>};</p>

<p>##############################################</p>

<p># $state holds all the bits of information the clients sends us that could
# potentially be useful when it comes to actually <em>doing</em> something.
my $state = { prependdir =&gt; &#39;&#39; };</p>

<p># Work is for managing temporary working directory my $work =</p>

<pre class="ruby">{
    <span class="ruby-identifier">state</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,  <span class="ruby-comment"># undef, 1 (empty), 2 (with stuff)</span>
    <span class="ruby-identifier">workDir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,
    <span class="ruby-identifier">index</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,
    <span class="ruby-identifier">emptyDir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,
    <span class="ruby-identifier">tmpDir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>
};
</pre>

<p>$log-&gt;info(“————— STARTING —————–”);</p>

<p>my $usage =</p>

<pre>&quot;usage: git cvsserver [options] [pserver|server] [&lt;directory&gt; ...]\n&quot;.
&quot;    --base-path &lt;path&gt;  : Prepend to requested CVSROOT\n&quot;.
&quot;                          Can be read from GIT_CVSSERVER_BASE_PATH\n&quot;.
&quot;    --strict-paths      : Don&#39;t allow recursing into subdirectories\n&quot;.
&quot;    --export-all        : Don&#39;t check for gitcvs.enabled in config\n&quot;.
&quot;    --version, -V       : Print version information and exit\n&quot;.
&quot;    -h, -H              : Print usage information and exit\n&quot;.
&quot;\n&quot;.
&quot;&lt;directory&gt; ... is a list of allowed directories. If no directories\n&quot;.
&quot;are given, all are allowed. This is an additional restriction, gitcvs\n&quot;.
&quot;access still needs to be enabled by the gitcvs.enabled config option.\n&quot;.
&quot;Alternately, one directory may be specified in GIT_CVSSERVER_ROOT.\n&quot;;</pre>

<p>my @opts = ( &#39;h|H&#39;, &#39;version|V&#39;,</p>

<pre>&#39;base-path=s&#39;, &#39;strict-paths&#39;, &#39;export-all&#39; );</pre>

<p>GetOptions( $state, @opts )</p>

<pre>or die $usage;</pre>

<p>if ($state-&gt;{version}) {</p>

<pre>print &quot;git-cvsserver version $VERSION\n&quot;;
exit;</pre>

<p>} if ($state-&gt;{help}) {</p>

<pre>print $usage;
exit;</pre>

<p>}</p>

<p>my $TEMP_DIR = tempdir( CLEANUP =&gt; 1 ); $log-&gt;debug(“Temporary
directory is &#39;$TEMP_DIR&#39;”);</p>

<p>$state-&gt;{method} = &#39;ext&#39;; if (@ARGV) {</p>

<pre>if ($ARGV[0] eq &#39;pserver&#39;) {
    $state-&gt;{method} = &#39;pserver&#39;;
    shift @ARGV;
} elsif ($ARGV[0] eq &#39;server&#39;) {
    shift @ARGV;
}</pre>

<p>}</p>

<p># everything else is a directory $state-&gt;{allowed_roots} = [ @ARGV ];</p>

<p># don&#39;t export the whole system unless the users requests it if
($state-&gt;{&#39;export-all&#39;} &amp;&amp;
!@{$state-&gt;{allowed_roots}}) {</p>

<pre>die &quot;--export-all can only be used together with an explicit whitelist\n&quot;;</pre>

<p>}</p>

<p># Environment handling for running under git-shell if (exists
$ENV{GIT_CVSSERVER_BASE_PATH}) {</p>

<pre>if ($state-&gt;{&#39;base-path&#39;}) {
    die &quot;Cannot specify base path both ways.\n&quot;;
}
my $base_path = $ENV{GIT_CVSSERVER_BASE_PATH};
$state-&gt;{&#39;base-path&#39;} = $base_path;
$log-&gt;debug(&quot;Picked up base path &#39;$base_path&#39; from environment.\n&quot;);</pre>

<p>} if (exists $ENV{GIT_CVSSERVER_ROOT}) {</p>

<pre>if (@{$state-&gt;{allowed_roots}}) {
    die &quot;Cannot specify roots both ways: @ARGV\n&quot;;
}
my $allowed_root = $ENV{GIT_CVSSERVER_ROOT};
$state-&gt;{allowed_roots} = [ $allowed_root ];
$log-&gt;debug(&quot;Picked up allowed root &#39;$allowed_root&#39; from environment.\n&quot;);</pre>

<p>}</p>

<p># if we are called with a pserver argument, # deal with the authentication
cat before entering the # main loop if ($state-&gt;{method} eq
&#39;pserver&#39;) {</p>

<pre>my $line = &lt;STDIN&gt;; chomp $line;
unless( $line =~ /^BEGIN (AUTH|VERIFICATION) REQUEST$/) {
   die &quot;E Do not understand $line - expecting BEGIN AUTH REQUEST\n&quot;;
}
my $request = $1;
$line = &lt;STDIN&gt;; chomp $line;
unless (req_Root(&#39;root&#39;, $line)) { # reuse Root
   print &quot;E Invalid root $line \n&quot;;
   exit 1;
}
$line = &lt;STDIN&gt;; chomp $line;
my $user = $line;
$line = &lt;STDIN&gt;; chomp $line;
my $password = $line;

if ($user eq &#39;anonymous&#39;) {
    # &quot;A&quot; will be 1 byte, use length instead in case the
    # encryption method ever changes (yeah, right!)
    if (length($password) &gt; 1 ) {
        print &quot;E Don&#39;t supply a password for the `anonymous&#39; user\n&quot;;
        print &quot;I HATE YOU\n&quot;;
        exit 1;
    }

    # Fall through to LOVE
} else {
    # Trying to authenticate a user
    if (not exists $cfg-&gt;{gitcvs}-&gt;{authdb}) {
        print &quot;E the repo config file needs a [gitcvs] section with an &#39;authdb&#39; parameter set to the filename of the authentication database\n&quot;;
        print &quot;I HATE YOU\n&quot;;
        exit 1;
    }

    my $authdb = $cfg-&gt;{gitcvs}-&gt;{authdb};

    unless (-e $authdb) {
        print &quot;E The authentication database specified in [gitcvs.authdb] does not exist\n&quot;;
        print &quot;I HATE YOU\n&quot;;
        exit 1;
    }

    my $auth_ok;
    open my $passwd, &quot;&lt;&quot;, $authdb or die $!;
    while (&lt;$passwd&gt;) {
        if (m{^\Q$user\E:(.*)}) {
            if (crypt($user, descramble($password)) eq $1) {
                $auth_ok = 1;
            }
        };
    }
    close $passwd;

    unless ($auth_ok) {
        print &quot;I HATE YOU\n&quot;;
        exit 1;
    }

    # Fall through to LOVE
}

# For checking whether the user is anonymous on commit
$state-&gt;{user} = $user;

$line = &lt;STDIN&gt;; chomp $line;
unless ($line eq &quot;END $request REQUEST&quot;) {
   die &quot;E Do not understand $line -- expecting END $request REQUEST\n&quot;;
}
print &quot;I LOVE YOU\n&quot;;
exit if $request eq &#39;VERIFICATION&#39;; # cvs login
# and now back to our regular programme...</pre>

<p>}</p>

<p># Keep going until the client closes the connection while (&lt;STDIN&gt;) {</p>

<pre>chomp;

# Check to see if we&#39;ve seen this method, and call appropriate function.
if ( /^([\w-]+)(?:\s+(.*))?$/ and defined($methods-&gt;{$1}) )
{
    # use the $methods hash to call the appropriate sub for this command
    #$log-&gt;info(&quot;Method : $1&quot;);
    &amp;{$methods-&gt;{$1}}($1,$2);
} else {
    # log fatal because we don&#39;t understand this function. If this happens
    # we&#39;re fairly screwed because we don&#39;t know if the client is expecting
    # a response. If it is, the client will hang, we&#39;ll hang, and the whole
    # thing will be custard.
    $log-&gt;fatal(&quot;Don&#39;t understand command $_\n&quot;);
    die(&quot;Unknown command $_&quot;);
}</pre>

<p>}</p>

<p>$log-&gt;debug(“Processing time : user=” . (<a href="0">times)</a> . “
system=” . (<a href="1">times)</a>); $log-&gt;info(“————— FINISH —————–”);</p>

<p>chdir &#39;/&#39;; exit 0;</p>

<p># Magic catchall method. #    This is the method that will handle all
commands we haven&#39;t yet #    implemented. It simply sends a warning to
the log file indicating a #    command that hasn&#39;t been implemented has
been invoked. sub req_CATCHALL {</p>

<pre>my ( $cmd, $data ) = @_;
$log-&gt;warn(&quot;Unhandled command : req_$cmd : $data&quot;);</pre>

<p>}</p>

<p># This method invariably succeeds with an empty response. sub req_EMPTY {</p>

<pre>print &quot;ok\n&quot;;</pre>

<p>}</p>

<p># Root pathname n #     Response expected: no. Tell the server which
CVSROOT to use. Note that #     pathname is a local directory and not a
fully qualified CVSROOT variable. #     pathname must already exist; if
creating a new root, use the init #     request, not Root. pathname does
not include the hostname of the server, #     how to access the server,
etc.; by the time the CVS protocol is in use, #     connection,
authentication, etc., are already taken care of. The Root #     request
must be sent only once, and it must be sent before any requests #     other
than Valid-responses, valid-requests, UseUnchanged, Set or init. sub
req_Root {</p>

<pre>my ( $cmd, $data ) = @_;
$log-&gt;debug(&quot;req_Root : $data&quot;);

unless ($data =~ m#^/#) {
    print &quot;error 1 Root must be an absolute pathname\n&quot;;
    return 0;
}

my $cvsroot = $state-&gt;{&#39;base-path&#39;} || &#39;&#39;;
$cvsroot =~ s#/+$##;
$cvsroot .= $data;

if ($state-&gt;{CVSROOT}
    &amp;&amp; ($state-&gt;{CVSROOT} ne $cvsroot)) {
    print &quot;error 1 Conflicting roots specified\n&quot;;
    return 0;
}

$state-&gt;{CVSROOT} = $cvsroot;

$ENV{GIT_DIR} = $state-&gt;{CVSROOT} . &quot;/&quot;;

if (@{$state-&gt;{allowed_roots}}) {
    my $allowed = 0;
    foreach my $dir (@{$state-&gt;{allowed_roots}}) {
        next unless $dir =~ m#^/#;
        $dir =~ s#/+$##;
        if ($state-&gt;{&#39;strict-paths&#39;}) {
            if ($ENV{GIT_DIR} =~ m#^\Q$dir\E/?$#) {
                $allowed = 1;
                last;
            }
        } elsif ($ENV{GIT_DIR} =~ m#^\Q$dir\E(/?$|/)#) {
            $allowed = 1;
            last;
        }
    }

    unless ($allowed) {
        print &quot;E $ENV{GIT_DIR} does not seem to be a valid GIT repository\n&quot;;
        print &quot;E \n&quot;;
        print &quot;error 1 $ENV{GIT_DIR} is not a valid repository\n&quot;;
        return 0;
    }
}

unless (-d $ENV{GIT_DIR} &amp;&amp; -e $ENV{GIT_DIR}.&#39;HEAD&#39;) {
   print &quot;E $ENV{GIT_DIR} does not seem to be a valid GIT repository\n&quot;;
   print &quot;E \n&quot;;
   print &quot;error 1 $ENV{GIT_DIR} is not a valid repository\n&quot;;
   return 0;
}

my @gitvars = `git config -l`;
if ($?) {
   print &quot;E problems executing git-config on the server -- this is not a git repository or the PATH is not set correctly.\n&quot;;
    print &quot;E \n&quot;;
    print &quot;error 1 - problem executing git-config\n&quot;;
   return 0;
}
foreach my $line ( @gitvars )
{
    next unless ( $line =~ /^(gitcvs)\.(?:(ext|pserver)\.)?([\w-]+)=(.*)$/ );
    unless ($2) {
        $cfg-&gt;{$1}{$3} = $4;
    } else {
        $cfg-&gt;{$1}{$2}{$3} = $4;
    }
}

my $enabled = ($cfg-&gt;{gitcvs}{$state-&gt;{method}}{enabled}
               || $cfg-&gt;{gitcvs}{enabled});
unless ($state-&gt;{&#39;export-all&#39;} ||
        ($enabled &amp;&amp; $enabled =~ /^\s*(1|true|yes)\s*$/i)) {
    print &quot;E GITCVS emulation needs to be enabled on this repo\n&quot;;
    print &quot;E the repo config file needs a [gitcvs] section added, and the parameter &#39;enabled&#39; set to 1\n&quot;;
    print &quot;E \n&quot;;
    print &quot;error 1 GITCVS emulation disabled\n&quot;;
    return 0;
}

my $logfile = $cfg-&gt;{gitcvs}{$state-&gt;{method}}{logfile} || $cfg-&gt;{gitcvs}{logfile};
if ( $logfile )
{
    $log-&gt;setfile($logfile);
} else {
    $log-&gt;nofile();
}

return 1;</pre>

<p>}</p>

<p># Global_option option n #     Response expected: no. Transmit one of the
global options `-q&#39;, `-Q&#39;, #     `-l&#39;, `-t&#39;, `-r&#39;, or
`-n&#39;. option must be one of those strings, no #     variations (such as
combining of options) are allowed. For graceful #     handling of
valid-requests, it is probably better to make new global #     options
separate requests, rather than trying to add them to this #     request.
sub req_Globaloption {</p>

<pre>my ( $cmd, $data ) = @_;
$log-&gt;debug(&quot;req_Globaloption : $data&quot;);
$state-&gt;{globaloptions}{$data} = 1;</pre>

<p>}</p>

<p># Valid-responses request-list n #     Response expected: no. Tell the
server what responses the client will #     accept. request-list is a space
separated list of tokens. sub req_Validresponses {</p>

<pre>my ( $cmd, $data ) = @_;
$log-&gt;debug(&quot;req_Validresponses : $data&quot;);

# TODO : re-enable this, currently it&#39;s not particularly useful
#$state-&gt;{validresponses} = [ split /\s+/, $data ];</pre>

<p>}</p>

<p># valid-requests n #     Response expected: yes. Ask the server to send
back a Valid-requests #     response. sub req_validrequests {</p>

<pre>my ( $cmd, $data ) = @_;

$log-&gt;debug(&quot;req_validrequests&quot;);

$log-&gt;debug(&quot;SEND : Valid-requests &quot; . join(&quot; &quot;,keys %$methods));
$log-&gt;debug(&quot;SEND : ok&quot;);

print &quot;Valid-requests &quot; . join(&quot; &quot;,keys %$methods) . &quot;\n&quot;;
print &quot;ok\n&quot;;</pre>

<p>}</p>

<p># Directory local-directory n #     Additional data: repository n. Response
expected: no. Tell the server #     what directory to use. The repository
should be a directory name from a #     previous server response. Note that
this both gives a default for Entry #     and Modified and also for ci and
the other commands; normal usage is to #     send Directory for each
directory in which there will be an Entry or #     Modified, and then a
final Directory for the original directory, then the #     command. The
local-directory is relative to the top level at which the #     command is
occurring (i.e. the last Directory which is sent before the #     command);
to indicate that top level, `.&#39; should be sent for #    
local-directory. sub req_Directory {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$data</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$repository</span> = <span class="ruby-operator">&lt;</span><span class="ruby-constant">STDIN</span><span class="ruby-operator">&gt;</span>;
<span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$repository</span>;

<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">localdir</span>} = <span class="ruby-identifier">$data</span>;
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">repository</span>} = <span class="ruby-identifier">$repository</span>;
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">path</span>} = <span class="ruby-identifier">$repository</span>;
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">path</span>} <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>\<span class="ruby-constant">Q</span><span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>}\<span class="ruby-constant">E</span>\<span class="ruby-operator">/</span><span class="ruby-regexp">//</span>;
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-keyword">module</span>} = <span class="ruby-node">$1</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">path</span>} <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>(.<span class="ruby-operator">*</span><span class="ruby-value">?)</span>(\<span class="ruby-regexp">/|$)/</span><span class="ruby-operator">/</span>);
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">path</span>} .= <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">path</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\S/</span> );

<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>} = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">localdir</span>};
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>} = <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;.&quot;</span> );
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>} .= <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\S/</span> );

<span class="ruby-keyword">if</span> ( (<span class="ruby-keyword">not</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">prependdir</span>}) <span class="ruby-keyword">or</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">prependdir</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">localdir</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;.&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">path</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\S/</span> )
{
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Setting prepend to &#39;$state-&gt;{path}&#39;&quot;</span>);
    <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">prependdir</span>} = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">path</span>};
    <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ntries</span>;
    <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$entry</span> ( <span class="ruby-identifier">keys</span> <span class="ruby-string">%Q{$state-&gt;{entries}}</span> )
    {
        <span class="ruby-identifier">$entries</span>{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">prependdir</span>} . <span class="ruby-identifier">$entry</span>} = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$entry</span>};
    }
    <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}=\<span class="ruby-operator">%</span><span class="ruby-identifier">ntries</span>;

    <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">irMap</span>;
    <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$dir</span> ( <span class="ruby-identifier">keys</span> <span class="ruby-string">%Q{$state-&gt;{dirMap}}</span> )
    {
        <span class="ruby-identifier">$dirMap</span>{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">prependdir</span>} . <span class="ruby-identifier">$dir</span>} = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirMap</span>}{<span class="ruby-identifier">$dir</span>};
    }
    <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirMap</span>}=\<span class="ruby-operator">%</span><span class="ruby-identifier">irMap</span>;
}

<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">prependdir</span>} ) )
{
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Prepending &#39;$state-&gt;{prependdir}&#39; to state|directory&quot;</span>);
    <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>} = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">prependdir</span>} . <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}
}

<span class="ruby-keyword">if</span> ( <span class="ruby-operator">!</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirMap</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}}) )
{
    <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirMap</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}} =
        {
            <span class="ruby-string">&#39;names&#39;</span> =<span class="ruby-operator">&gt;</span> {}
            <span class="ruby-comment">#&#39;tagspec&#39; =&gt; undef</span>
        };
}

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;req_Directory : localdir=$data repository=$repository path=$state-&gt;{path} directory=$state-&gt;{directory} module=$state-&gt;{module}&quot;</span>);
</pre>

<p>}</p>

<p># Sticky tagspec n #     Response expected: no. Tell the server that the
directory most #     recently specified with Directory has a sticky tag or
date #     tagspec. The first character of tagspec is T for a tag, D for # 
a date, or some other character supplied by a Set-sticky #     response
from a previous request to the server. The remainder #     of tagspec
contains the actual tag or date, again as supplied #     by Set-sticky. #  
The server should remember Static-directory and Sticky requests #     for a
particular directory; the client need not resend them each #     time it
sends a Directory request for a given directory. However, #     the server
is not obliged to remember them beyond the context #     of a single
command. sub req_Sticky {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$tagspec</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$stickyInfo</span> );
<span class="ruby-keyword">if</span>(<span class="ruby-identifier">$tagspec</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;&quot;</span>)
{
    <span class="ruby-comment"># nothing</span>
}
<span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">$tagspec</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^T([^ ]+)\s*$/</span>)
{
    <span class="ruby-identifier">$stickyInfo</span> = { <span class="ruby-string">&#39;tag&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span> };
}
<span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">$tagspec</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^D([0-9.]+)\s*$/</span>)
{
    <span class="ruby-identifier">$stickyInfo</span>= { <span class="ruby-string">&#39;date&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span> };
}
<span class="ruby-keyword">else</span>
{
    <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Unknown tag_or_date format\n&quot;</span>;
}
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirMap</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}}{<span class="ruby-identifier">stickyInfo</span>}=<span class="ruby-identifier">$stickyInfo</span>;

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;req_Sticky : tagspec=$tagspec repository=$state-&gt;{repository}&quot;</span>
            . <span class="ruby-string">&quot; path=$state-&gt;{path} directory=$state-&gt;{directory}&quot;</span>
            . <span class="ruby-string">&quot; module=$state-&gt;{module}&quot;</span>);
</pre>

<p>}</p>

<p># Entry entry-line n #     Response expected: no. Tell the server what
version of a file is on the #     local machine. The name in entry-line is
a name relative to the directory #     most recently specified with
Directory. If the user is operating on only #     some files in a
directory, Entry requests for only those files need be #     included. If
an Entry request is sent without Modified, Is-modified, or #     Unchanged,
it means the file is lost (does not exist in the working #     directory).
If both Entry and one of Modified, Is-modified, or Unchanged #     are sent
for the same file, Entry must be sent first. For a given file, #     one
can send Modified, Is-modified, or Unchanged, but not more than one #    
of these three. sub req_Entry {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$data</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-comment">#$log-&gt;debug(&quot;req_Entry : $data&quot;);</span>

<span class="ruby-identifier">my</span> <span class="ruby-ivar">@data</span> = <span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\//</span>, <span class="ruby-identifier">$data</span>, <span class="ruby-value">-1</span>);

<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}.<span class="ruby-identifier">$data</span>[<span class="ruby-value">1</span>]} = {
    <span class="ruby-identifier">revision</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$data</span>[<span class="ruby-value">2</span>],
    <span class="ruby-identifier">conflict</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$data</span>[<span class="ruby-value">3</span>],
    <span class="ruby-identifier">options</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$data</span>[<span class="ruby-value">4</span>],
    <span class="ruby-identifier">tag_or_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$data</span>[<span class="ruby-value">5</span>],
};

<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirMap</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}}{<span class="ruby-identifier">names</span>}{<span class="ruby-identifier">$data</span>[<span class="ruby-value">1</span>]} = <span class="ruby-string">&#39;F&#39;</span>;

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Received entry line &#39;$data&#39; =&gt; &#39;&quot;</span> . <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>} . <span class="ruby-identifier">$data</span>[<span class="ruby-value">1</span>] . <span class="ruby-string">&quot;&#39;&quot;</span>);
</pre>

<p>}</p>

<p># Questionable filename n #     Response expected: no. Additional data: no.
Tell the server to check #     whether filename should be ignored, and if
not, next time the server #     sends responses, send (in a M response)
`?&#39; followed by the directory and #     filename. filename must not
contain `/&#39;; it needs to be a file in the #     directory named by the
most recent Directory request. sub req_Questionable {</p>

<pre>my ( $cmd, $data ) = @_;

$log-&gt;debug(&quot;req_Questionable : $data&quot;);
$state-&gt;{entries}{$state-&gt;{directory}.$data}{questionable} = 1;</pre>

<p>}</p>

<p># add n #     Response expected: yes. Add a file or directory. This uses
any previous #     Argument, Directory, Entry, or Modified requests, if
they have been sent. #     The last Directory sent specifies the working
directory at the time of #     the operation. To add a directory, send the
directory to be added using #     Directory and Argument requests. sub
req_add {</p>

<pre>my ( $cmd, $data ) = @_;

argsplit(&quot;add&quot;);

my $updater = GITCVS::updater-&gt;new($state-&gt;{CVSROOT}, $state-&gt;{module}, $log);
$updater-&gt;update();

my $addcount = 0;

foreach my $filename ( @{$state-&gt;{args}} )
{
    $filename = filecleanup($filename);

    # no -r, -A, or -D with add
    my $stickyInfo = resolveStickyInfo($filename);

    my $meta = $updater-&gt;getmeta($filename,$stickyInfo);
    my $wrev = revparse($filename);

    if ($wrev &amp;&amp; $meta &amp;&amp; ($wrev=~/^-/))
    {
        # previously removed file, add back
        $log-&gt;info(&quot;added file $filename was previously removed, send $meta-&gt;{revision}&quot;);

        print &quot;MT +updated\n&quot;;
        print &quot;MT text U \n&quot;;
        print &quot;MT fname $filename\n&quot;;
        print &quot;MT newline\n&quot;;
        print &quot;MT -updated\n&quot;;

        unless ( $state-&gt;{globaloptions}{-n} )
        {
            my ( $filepart, $dirpart ) = filenamesplit($filename,1);

            print &quot;Created $dirpart\n&quot;;
            print $state-&gt;{CVSROOT} . &quot;/$state-&gt;{module}/$filename\n&quot;;

            # this is an &quot;entries&quot; line
            my $kopts = kopts_from_path($filename,&quot;sha1&quot;,$meta-&gt;{filehash});
            my $entryLine = &quot;/$filepart/$meta-&gt;{revision}//$kopts/&quot;;
            $entryLine .= getStickyTagOrDate($stickyInfo);
            $log-&gt;debug($entryLine);
            print &quot;$entryLine\n&quot;;
            # permissions
            $log-&gt;debug(&quot;SEND : u=$meta-&gt;{mode},g=$meta-&gt;{mode},o=$meta-&gt;{mode}&quot;);
            print &quot;u=$meta-&gt;{mode},g=$meta-&gt;{mode},o=$meta-&gt;{mode}\n&quot;;
            # transmit file
            transmitfile($meta-&gt;{filehash});
        }

        next;
    }

    unless ( defined ( $state-&gt;{entries}{$filename}{modified_filename} ) )
    {
        print &quot;E cvs add: nothing known about `$filename&#39;\n&quot;;
        next;
    }
    # TODO : check we&#39;re not squashing an already existing file
    if ( defined ( $state-&gt;{entries}{$filename}{revision} ) )
    {
        print &quot;E cvs add: `$filename&#39; has already been entered\n&quot;;
        next;
    }

    my ( $filepart, $dirpart ) = filenamesplit($filename, 1);

    print &quot;E cvs add: scheduling file `$filename&#39; for addition\n&quot;;

    print &quot;Checked-in $dirpart\n&quot;;
    print &quot;$filename\n&quot;;
    my $kopts = kopts_from_path($filename,&quot;file&quot;,
                    $state-&gt;{entries}{$filename}{modified_filename});
    print &quot;/$filepart/0//$kopts/&quot; .
          getStickyTagOrDate($stickyInfo) . &quot;\n&quot;;

    my $requestedKopts = $state-&gt;{opt}{k};
    if(defined($requestedKopts))
    {
        $requestedKopts = &quot;-k$requestedKopts&quot;;
    }
    else
    {
        $requestedKopts = &quot;&quot;;
    }
    if( $kopts ne $requestedKopts )
    {
        $log-&gt;warn(&quot;Ignoring requested -k=&#39;$requestedKopts&#39;&quot;
                    . &quot; for &#39;$filename&#39;; detected -k=&#39;$kopts&#39; instead&quot;);
        #TODO: Also have option to send warning to user?
    }

    $addcount++;
}

if ( $addcount == 1 )
{
    print &quot;E cvs add: use `cvs commit&#39; to add this file permanently\n&quot;;
}
elsif ( $addcount &gt; 1 )
{
    print &quot;E cvs add: use `cvs commit&#39; to add these files permanently\n&quot;;
}

print &quot;ok\n&quot;;</pre>

<p>}</p>

<p># remove n #     Response expected: yes. Remove a file. This uses any
previous Argument, #     Directory, Entry, or Modified requests, if they
have been sent. The last #     Directory sent specifies the working
directory at the time of the #     operation. Note that this request does
not actually do anything to the #     repository; the only effect of a
successful remove request is to supply #     the client with a new entries
line containing `-&#39; to indicate a removed #     file. In fact, the
client probably could perform this operation without #     contacting the
server, although using remove may cause the server to #     perform a few
more checks. The client sends a subsequent ci request to #     actually
record the removal in the repository. sub req_remove {</p>

<pre>my ( $cmd, $data ) = @_;

argsplit(&quot;remove&quot;);

# Grab a handle to the SQLite db and do any necessary updates
my $updater = GITCVS::updater-&gt;new($state-&gt;{CVSROOT}, $state-&gt;{module}, $log);
$updater-&gt;update();

#$log-&gt;debug(&quot;add state : &quot; . Dumper($state));

my $rmcount = 0;

foreach my $filename ( @{$state-&gt;{args}} )
{
    $filename = filecleanup($filename);

    if ( defined ( $state-&gt;{entries}{$filename}{unchanged} ) or defined ( $state-&gt;{entries}{$filename}{modified_filename} ) )
    {
        print &quot;E cvs remove: file `$filename&#39; still in working directory\n&quot;;
        next;
    }

    # only from entries
    my $stickyInfo = resolveStickyInfo($filename);

    my $meta = $updater-&gt;getmeta($filename,$stickyInfo);
    my $wrev = revparse($filename);

    unless ( defined ( $wrev ) )
    {
        print &quot;E cvs remove: nothing known about `$filename&#39;\n&quot;;
        next;
    }

    if ( defined($wrev) and ($wrev=~/^-/) )
    {
        print &quot;E cvs remove: file `$filename&#39; already scheduled for removal\n&quot;;
        next;
    }

    unless ( $wrev eq $meta-&gt;{revision} )
    {
        # TODO : not sure if the format of this message is quite correct.
        print &quot;E cvs remove: Up to date check failed for `$filename&#39;\n&quot;;
        next;
    }

    my ( $filepart, $dirpart ) = filenamesplit($filename, 1);

    print &quot;E cvs remove: scheduling `$filename&#39; for removal\n&quot;;

    print &quot;Checked-in $dirpart\n&quot;;
    print &quot;$filename\n&quot;;
    my $kopts = kopts_from_path($filename,&quot;sha1&quot;,$meta-&gt;{filehash});
    print &quot;/$filepart/-$wrev//$kopts/&quot; . getStickyTagOrDate($stickyInfo) . &quot;\n&quot;;

    $rmcount++;
}

if ( $rmcount == 1 )
{
    print &quot;E cvs remove: use `cvs commit&#39; to remove this file permanently\n&quot;;
}
elsif ( $rmcount &gt; 1 )
{
    print &quot;E cvs remove: use `cvs commit&#39; to remove these files permanently\n&quot;;
}

print &quot;ok\n&quot;;</pre>

<p>}</p>

<p># Modified filename n #     Response expected: no. Additional data: mode,
n, file transmission. Send #     the server a copy of one locally modified
file. filename is a file within #     the most recent directory sent with
Directory; it must not contain `/&#39;. #     If the user is operating on
only some files in a directory, only those #     files need to be included.
This can also be sent without Entry, if there #     is no entry for the
file. sub req_Modified {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$data</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$mode</span> = <span class="ruby-operator">&lt;</span><span class="ruby-constant">STDIN</span><span class="ruby-operator">&gt;</span>;
<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$mode</span>
    <span class="ruby-keyword">or</span> (<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E end of file reading mode for $data\n&quot;</span>), <span class="ruby-keyword">return</span>;
<span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$mode</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$size</span> = <span class="ruby-operator">&lt;</span><span class="ruby-constant">STDIN</span><span class="ruby-operator">&gt;</span>;
<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$size</span>
    <span class="ruby-keyword">or</span> (<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E end of file reading size of $data\n&quot;</span>), <span class="ruby-keyword">return</span>;
<span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$size</span>;

<span class="ruby-comment"># Grab config information</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$blocksize</span> = <span class="ruby-value">8192</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$bytesleft</span> = <span class="ruby-identifier">$size</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$tmp</span>;

<span class="ruby-comment"># Get a filehandle/name to write it to</span>
<span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$fh</span>, <span class="ruby-identifier">$filename</span> ) = <span class="ruby-identifier">tempfile</span>( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span> );

<span class="ruby-comment"># Loop over file data writing out to temporary file.</span>
<span class="ruby-keyword">while</span> ( <span class="ruby-identifier">$bytesleft</span> )
{
    <span class="ruby-identifier">$blocksize</span> = <span class="ruby-identifier">$bytesleft</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$bytesleft</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">$blocksize</span> );
    <span class="ruby-identifier">read</span> <span class="ruby-constant">STDIN</span>, <span class="ruby-identifier">$tmp</span>, <span class="ruby-identifier">$blocksize</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-identifier">$fh</span> <span class="ruby-identifier">$tmp</span>;
    <span class="ruby-identifier">$bytesleft</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">$blocksize</span>;
}

<span class="ruby-identifier">close</span> <span class="ruby-identifier">$fh</span>
    <span class="ruby-keyword">or</span> (<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E failed to write temporary, $filename: $!\n&quot;</span>), <span class="ruby-keyword">return</span>;

<span class="ruby-comment"># Ensure we have something sensible for the file mode</span>
<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$mode</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/u=(\w+)/</span> )
{
    <span class="ruby-identifier">$mode</span> = <span class="ruby-node">$1</span>;
} <span class="ruby-keyword">else</span> {
    <span class="ruby-identifier">$mode</span> = <span class="ruby-string">&quot;rw&quot;</span>;
}

<span class="ruby-comment"># Save the file data in $state</span>
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}.<span class="ruby-identifier">$data</span>}{<span class="ruby-identifier">modified_filename</span>} = <span class="ruby-identifier">$filename</span>;
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}.<span class="ruby-identifier">$data</span>}{<span class="ruby-identifier">modified_mode</span>} = <span class="ruby-identifier">$mode</span>;
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}.<span class="ruby-identifier">$data</span>}{<span class="ruby-identifier">modified_hash</span>} = <span class="ruby-value">%xgit hash-object $filename`</span>;
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">directory</span>}.<span class="ruby-identifier">$data</span>}{<span class="ruby-identifier">modified_hash</span>} <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span>\<span class="ruby-identifier">s</span>.<span class="ruby-operator">*</span><span class="ruby-identifier">$/</span><span class="ruby-operator">/</span><span class="ruby-identifier">s</span>;

<span class="ruby-comment">#$log-&gt;debug(&quot;req_Modified : file=$data mode=$mode size=$size&quot;);</span>
</pre>

<p>}</p>

<p># Unchanged filename n #     Response expected: no. Tell the server that
filename has not been #     modified in the checked out directory. The
filename is a file within the #     most recent directory sent with
Directory; it must not contain `/&#39;. sub req_Unchanged {</p>

<pre>my ( $cmd, $data ) = @_;

$state-&gt;{entries}{$state-&gt;{directory}.$data}{unchanged} = 1;

#$log-&gt;debug(&quot;req_Unchanged : $data&quot;);</pre>

<p>}</p>

<p># Argument text n #     Response expected: no. Save argument for use in a
subsequent command. #     Arguments accumulate until an argument-using
command is given, at which #     point they are forgotten. # Argumentx text
n #     Response expected: no. Append n followed by text to the current
argument #     being saved. sub req_Argument {</p>

<pre>my ( $cmd, $data ) = @_;

# Argumentx means: append to last Argument (with a newline in front)

$log-&gt;debug(&quot;$cmd : $data&quot;);

if ( $cmd eq &#39;Argumentx&#39;) {
    ${$state-&gt;{arguments}}[$#{$state-&gt;{arguments}}] .= &quot;\n&quot; . $data;
} else {
    push @{$state-&gt;{arguments}}, $data;
}</pre>

<p>}</p>

<p># expand-modules n #     Response expected: yes. Expand the modules which
are specified in the #     arguments. Returns the data in Module-expansion
responses. Note that the #     server can assume that this is checkout or
export, not rtag or rdiff; the #     latter do not access the working
directory and thus have no need to #     expand modules on the client side.
Expand may not be the best word for #     what this request does. It does
not necessarily tell you all the files #     contained in a module, for
example. Basically it is a way of telling you #     which working
directories the server needs to know about in order to #     handle a
checkout of the specified modules. For example, suppose that the #    
server has a module defined by #   aliasmodule -a 1dir #     That is, one
can check out aliasmodule and it will take 1dir in the #     repository and
check it out to 1dir in the working directory. Now suppose #     the client
already has this module checked out and is planning on using #     the co
request to update it. Without using expand-modules, the client #     would
have two bad choices: it could either send information about all #    
working directories under the current directory, which could be #    
unnecessarily slow, or it could be ignorant of the fact that aliasmodule # 
stands for 1dir, and neglect to send information for 1dir, which would #   
lead to incorrect operation. With expand-modules, the client would first # 
ask for the module to be expanded: sub req_expandmodules {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$data</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">argsplit</span>();

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;req_expandmodules : &quot;</span> . ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$data</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">$data</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;[NULL]&quot;</span> ) );

<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">ref</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;ARRAY&quot;</span> )
{
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ok\n&quot;</span>;
    <span class="ruby-keyword">return</span>;
}

<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$module</span> ( @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>}} )
{
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;SEND : Module-expansion $module&quot;</span>);
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Module-expansion $module\n&quot;</span>;
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ok\n&quot;</span>;
<span class="ruby-identifier">statecleanup</span>();
</pre>

<p>}</p>

<p># co n #     Response expected: yes. Get files from the repository. This
uses any #     previous Argument, Directory, Entry, or Modified requests,
if they have #     been sent. Arguments to this command are module names;
the client cannot #     know what directories they correspond to except by
(1) just sending the #     co request, and then seeing what directory names
the server sends back in #     its responses, and (2) the expand-modules
request. sub req_co {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$data</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">argsplit</span>(<span class="ruby-string">&quot;co&quot;</span>);

<span class="ruby-comment"># Provide list of modules, if -c was used.</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">exists</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">c</span>}) {
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$showref</span> = <span class="ruby-value">%xgit show-ref --heads`</span>;
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> (<span class="ruby-identifier">split</span> <span class="ruby-string">&#39;\n&#39;</span>, <span class="ruby-identifier">$showref</span>) {
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">%</span> <span class="ruby-identifier">refs</span><span class="ruby-operator">/</span><span class="ruby-identifier">heads</span><span class="ruby-operator">/</span>(.<span class="ruby-operator">*</span>)$<span class="ruby-operator">%</span> ) {
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M $1\t$1\n&quot;</span>;
        }
    }
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ok\n&quot;</span>;
    <span class="ruby-keyword">return</span> <span class="ruby-value">1</span>;
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$stickyInfo</span> = { <span class="ruby-string">&#39;tag&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>},
                   <span class="ruby-string">&#39;date&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">D</span>} };

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$module</span> = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>}[<span class="ruby-value">0</span>];
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-keyword">module</span>} = <span class="ruby-identifier">$module</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$checkout_path</span> = <span class="ruby-identifier">$module</span>;

<span class="ruby-comment"># use the user specified directory if we&#39;re given it</span>
<span class="ruby-identifier">$checkout_path</span> = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">d</span>} <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">exists</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">d</span>} ) );

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;req_co : &quot;</span> . ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$data</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">$data</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;[NULL]&quot;</span> ) );

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Checking out module &#39;$module&#39; ($state-&gt;{CVSROOT}) to &#39;$checkout_path&#39;&quot;</span>);

<span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_DIR</span>} = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>} . <span class="ruby-string">&quot;/&quot;</span>;

<span class="ruby-comment"># Grab a handle to the SQLite db and do any necessary updates</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$updater</span> = <span class="ruby-constant">GITCVS</span><span class="ruby-operator">::</span><span class="ruby-identifier">updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">new</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>}, <span class="ruby-identifier">$module</span>, <span class="ruby-identifier">$log</span>);
<span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">update</span>();

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$headHash</span>;
<span class="ruby-keyword">if</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tag</span>}) )
{
    <span class="ruby-identifier">$headHash</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">lookupCommitRef</span>(<span class="ruby-identifier">$stickyInfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tag</span>});
    <span class="ruby-keyword">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$headHash</span>) )
    {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 no such tag `$stickyInfo-&gt;{tag}&#39;\n&quot;</span>;
        <span class="ruby-identifier">cleanupWorkTree</span>();
        <span class="ruby-identifier">exit</span>;
    }
}

<span class="ruby-identifier">$checkout_path</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">|</span><span class="ruby-node">/$||; # get rid of trailing slashes

my %seendirs = ();
my $lastdir =&#39;&#39;;

prepDirForOutput(
        &quot;.&quot;,
        $state-&gt;{CVSROOT} . &quot;/</span><span class="ruby-identifier">$module</span><span class="ruby-node">&quot;,
        $checkout_path,
        \%seendirs,
        &#39;checkout&#39;,
        $state-&gt;{dirArgs} );

foreach my $git ( @{$updater-&gt;getAnyHead($headHash)} )
{
    # Don&#39;t want to check out deleted files
    next if ( $git-&gt;{filehash} eq &quot;</span><span class="ruby-identifier">deleted</span><span class="ruby-string">&quot; );

    my $fullName = $git-&gt;{name};
    ( $git-&gt;{name}, $git-&gt;{dir} ) = filenamesplit($git-&gt;{name});

    unless (exists($seendirs{$git-&gt;{dir}})) {
        prepDirForOutput($git-&gt;{dir}, $state-&gt;{CVSROOT} . &quot;</span><span class="ruby-operator">/</span><span class="ruby-identifier">$module</span><span class="ruby-operator">/</span><span class="ruby-node">&quot;,
                         $checkout_path, \%seendirs, &#39;checkout&#39;,
                         $state-&gt;{dirArgs} );
        $lastdir = $git-&gt;{dir};
        $seendirs{$git-&gt;{dir}} = 1;
    }

    # modification time of this file
    print &quot;</span><span class="ruby-constant">Mod</span><span class="ruby-operator">-</span><span class="ruby-identifier">time</span> <span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">modified</span>}\<span class="ruby-identifier">n</span><span class="ruby-node">&quot;;

    # print some information to the client
    if ( defined ( $git-&gt;{dir} ) and $git-&gt;{dir} ne &quot;</span>.<span class="ruby-operator">/</span><span class="ruby-string">&quot; )
    {
        print &quot;</span><span class="ruby-constant">M</span> <span class="ruby-constant">U</span> <span class="ruby-identifier">$checkout_path</span><span class="ruby-operator">/</span><span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dir</span>}<span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">name</span>}\<span class="ruby-identifier">n</span><span class="ruby-string">&quot;;
    } else {
        print &quot;</span><span class="ruby-constant">M</span> <span class="ruby-constant">U</span> <span class="ruby-identifier">$checkout_path</span><span class="ruby-operator">/</span><span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">name</span>}\<span class="ruby-identifier">n</span><span class="ruby-node">&quot;;
    }

   # instruct client we&#39;re sending a file to put in this path
   print &quot;</span><span class="ruby-constant">Created</span> <span class="ruby-identifier">$checkout_path</span><span class="ruby-operator">/</span><span class="ruby-string">&quot; . ( defined ( $git-&gt;{dir} ) and $git-&gt;{dir} ne &quot;</span>.<span class="ruby-operator">/</span><span class="ruby-string">&quot; ? $git-&gt;{dir} . &quot;</span><span class="ruby-operator">/</span><span class="ruby-string">&quot; : &quot;</span><span class="ruby-string">&quot; ) . &quot;</span>\<span class="ruby-identifier">n</span><span class="ruby-string">&quot;;

   print $state-&gt;{CVSROOT} . &quot;</span><span class="ruby-operator">/</span><span class="ruby-identifier">$module</span><span class="ruby-operator">/</span><span class="ruby-string">&quot; . ( defined ( $git-&gt;{dir} ) and $git-&gt;{dir} ne &quot;</span>.<span class="ruby-operator">/</span><span class="ruby-string">&quot; ? $git-&gt;{dir} . &quot;</span><span class="ruby-operator">/</span><span class="ruby-string">&quot; : &quot;</span><span class="ruby-string">&quot; ) . &quot;</span><span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">name</span>}\<span class="ruby-identifier">n</span><span class="ruby-node">&quot;;

    # this is an &quot;</span><span class="ruby-identifier">entries</span><span class="ruby-string">&quot; line
    my $kopts = kopts_from_path($fullName,&quot;</span><span class="ruby-identifier">sha1</span><span class="ruby-string">&quot;,$git-&gt;{filehash});
    print &quot;</span><span class="ruby-operator">/</span><span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">name</span>}<span class="ruby-operator">/</span><span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>}<span class="ruby-operator">/</span><span class="ruby-regexp">/$kopts/</span><span class="ruby-string">&quot; .
                    getStickyTagOrDate($stickyInfo) . &quot;</span>\<span class="ruby-identifier">n</span><span class="ruby-node">&quot;;
    # permissions
    print &quot;</span><span class="ruby-identifier">u</span>=<span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mode</span>},<span class="ruby-identifier">g</span>=<span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mode</span>},<span class="ruby-identifier">o</span>=<span class="ruby-identifier">$git</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mode</span>}\<span class="ruby-identifier">n</span><span class="ruby-node">&quot;;

    # transmit file
    transmitfile($git-&gt;{filehash});
}

print &quot;</span><span class="ruby-identifier">ok</span>\<span class="ruby-identifier">n</span><span class="ruby-string">&quot;;

statecleanup();
</span></pre>

<p>}</p>

<p># used by req_co and req_update to set up directories for files #
recursively handles parents sub prepDirForOutput {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$dir</span>, <span class="ruby-identifier">$repodir</span>, <span class="ruby-identifier">$remotedir</span>, <span class="ruby-identifier">$seendirs</span>, <span class="ruby-identifier">$request</span>, <span class="ruby-identifier">$dirArgs</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$parent</span> = <span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">$dir</span>);
<span class="ruby-identifier">$dir</span>       <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">|</span><span class="ruby-regexp">/+$||;
$repodir   =~ s|/</span><span class="ruby-operator">+</span>$<span class="ruby-operator">||</span>;
<span class="ruby-identifier">$remotedir</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">|</span><span class="ruby-regexp">/+$||;
$parent    =~ s|/</span><span class="ruby-operator">+</span>$<span class="ruby-operator">||</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$parent</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;.&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$parent</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;./&#39;</span>)
{
    <span class="ruby-identifier">$parent</span> = <span class="ruby-string">&#39;&#39;</span>;
}
<span class="ruby-comment"># recurse to announce unseen parents first</span>
<span class="ruby-keyword">if</span>( <span class="ruby-identifier">length</span>(<span class="ruby-identifier">$parent</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-operator">!</span><span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$seendirs</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$parent</span>}) <span class="ruby-operator">&amp;&amp;</span>
    ( <span class="ruby-identifier">$request</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;checkout&quot;</span> <span class="ruby-operator">||</span>
      <span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$dirArgs</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$parent</span>}) ) )
{
    <span class="ruby-identifier">prepDirForOutput</span>(<span class="ruby-identifier">$parent</span>, <span class="ruby-identifier">$repodir</span>, <span class="ruby-identifier">$remotedir</span>,
                     <span class="ruby-identifier">$seendirs</span>, <span class="ruby-identifier">$request</span>, <span class="ruby-identifier">$dirArgs</span>);
}
<span class="ruby-comment"># Announce that we are going to modify at the parent level</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$dir</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;.&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$dir</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;./&#39;</span>)
{
    <span class="ruby-identifier">$dir</span> = <span class="ruby-string">&#39;&#39;</span>;
}
<span class="ruby-keyword">if</span>(<span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$seendirs</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$dir</span>}))
{
    <span class="ruby-keyword">return</span>;
}
<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;announcedir $dir, $repodir, $remotedir&quot;</span> );
<span class="ruby-identifier">my</span>(<span class="ruby-identifier">$thisRemoteDir</span>,<span class="ruby-identifier">$thisRepoDir</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$dir</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;&quot;</span>)
{
    <span class="ruby-identifier">$thisRepoDir</span>=<span class="ruby-string">&quot;$repodir/$dir&quot;</span>;
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$remotedir</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;.&quot;</span>)
    {
        <span class="ruby-identifier">$thisRemoteDir</span>=<span class="ruby-identifier">$dir</span>;
    }
    <span class="ruby-keyword">else</span>
    {
        <span class="ruby-identifier">$thisRemoteDir</span>=<span class="ruby-string">&quot;$remotedir/$dir&quot;</span>;
    }
}
<span class="ruby-keyword">else</span>
{
    <span class="ruby-identifier">$thisRepoDir</span>=<span class="ruby-identifier">$repodir</span>;
    <span class="ruby-identifier">$thisRemoteDir</span>=<span class="ruby-identifier">$remotedir</span>;
}
<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-operator">-</span><span class="ruby-constant">Q</span>} <span class="ruby-operator">||</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-operator">-</span><span class="ruby-identifier">q</span>} )
{
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E cvs $request: Updating $thisRemoteDir\n&quot;</span>;
}

<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$opt_r</span>)=<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>};
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$stickyInfo</span>;
<span class="ruby-keyword">if</span>(<span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">A</span>}))
{
    <span class="ruby-comment"># $stickyInfo=undef;</span>
}
<span class="ruby-keyword">elsif</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$opt_r</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$opt_r</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;&quot;</span> )
       <span class="ruby-comment"># || ( defined($state-&gt;{opt}{D}) &amp;&amp; $state-&gt;{opt}{D} ne &quot;&quot; ) # TODO</span>
{
    <span class="ruby-identifier">$stickyInfo</span>={ <span class="ruby-string">&#39;tag&#39;</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$opt_r</span>)<span class="ruby-operator">?</span><span class="ruby-identifier">$opt_r</span><span class="ruby-operator">:</span><span class="ruby-keyword">undef</span>) };

    <span class="ruby-comment"># TODO: Convert -D value into the form 2011.04.10.04.46.57,</span>
    <span class="ruby-comment">#   similar to an entry line&#39;s sticky date, without the D prefix.</span>
    <span class="ruby-comment">#   It sometimes (always?) arrives as something more like</span>
    <span class="ruby-comment">#   &#39;10 Apr 2011 04:46:57 -0000&#39;...</span>
    <span class="ruby-comment"># $stickyInfo={ &#39;date&#39; =&gt; (defined($stickyDate)?$stickyDate:undef) };</span>
}
<span class="ruby-keyword">else</span>
{
    <span class="ruby-identifier">$stickyInfo</span>=<span class="ruby-identifier">getDirStickyInfo</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">prependdir</span>} . <span class="ruby-identifier">$dir</span>);
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$stickyResponse</span>;
<span class="ruby-keyword">if</span>(<span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span>))
{
    <span class="ruby-identifier">$stickyResponse</span> = <span class="ruby-string">&quot;Set-sticky $thisRemoteDir/\n&quot;</span> .
                      <span class="ruby-string">&quot;$thisRepoDir/\n&quot;</span> .
                      <span class="ruby-identifier">getStickyTagOrDate</span>(<span class="ruby-identifier">$stickyInfo</span>) . <span class="ruby-string">&quot;\n&quot;</span>;
}
<span class="ruby-keyword">else</span>
{
    <span class="ruby-identifier">$stickyResponse</span> = <span class="ruby-string">&quot;Clear-sticky $thisRemoteDir/\n&quot;</span> .
                      <span class="ruby-string">&quot;$thisRepoDir/\n&quot;</span>;
}

<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-operator">-</span><span class="ruby-identifier">n</span>} )
{
    <span class="ruby-identifier">print</span> <span class="ruby-identifier">$stickyResponse</span>;

    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Clear-static-directory $thisRemoteDir/\n&quot;</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$thisRepoDir/\n&quot;</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-identifier">$stickyResponse</span>; <span class="ruby-comment"># yes, twice</span>
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Template $thisRemoteDir/\n&quot;</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$thisRepoDir/\n&quot;</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;0\n&quot;</span>;
}

<span class="ruby-identifier">$seendirs</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$dir</span>} = <span class="ruby-value">1</span>;

<span class="ruby-comment"># FUTURE: This would more accurately emulate CVS by sending</span>
<span class="ruby-comment">#   another copy of sticky after processing the files in that</span>
<span class="ruby-comment">#   directory.  Or intermediate: perhaps send all sticky&#39;s for</span>
<span class="ruby-comment">#   $seendirs after after processing all files.</span>
</pre>

<p>}</p>

<p># update n #     Response expected: yes. Actually do a cvs update command.
This uses any #     previous Argument, Directory, Entry, or Modified
requests, if they have #     been sent. The last Directory sent specifies
the working directory at the #     time of the operation. The -I option is
not used–files which the client #     can decide whether to ignore are not
mentioned and the client sends the #     Questionable request for others.
sub req_update {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$data</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;req_update : &quot;</span> . ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$data</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">$data</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;[NULL]&quot;</span> ));

<span class="ruby-identifier">argsplit</span>(<span class="ruby-string">&quot;update&quot;</span>);

<span class="ruby-comment">#</span>
<span class="ruby-comment"># It may just be a client exploring the available heads/modules</span>
<span class="ruby-comment"># in that case, list them as top level directories and leave it</span>
<span class="ruby-comment"># at that. Eclipse uses this technique to offer you a list of</span>
<span class="ruby-comment"># projects (heads in this case) to checkout.</span>
<span class="ruby-comment">#</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-keyword">module</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;&#39;</span>) {
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$showref</span> = <span class="ruby-value">%xgit show-ref --heads`</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E cvs update: Updating .\n&quot;</span>;
    <span class="ruby-keyword">for</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> (<span class="ruby-identifier">split</span> <span class="ruby-string">&#39;\n&#39;</span>, <span class="ruby-identifier">$showref</span>) {
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">%</span> <span class="ruby-identifier">refs</span><span class="ruby-operator">/</span><span class="ruby-identifier">heads</span><span class="ruby-operator">/</span>(.<span class="ruby-operator">*</span>)$<span class="ruby-operator">%</span> ) {
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E cvs update: New directory `$1&#39;\n&quot;</span>;
        }
    }
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ok\n&quot;</span>;
    <span class="ruby-keyword">return</span> <span class="ruby-value">1</span>;
}

<span class="ruby-comment"># Grab a handle to the SQLite db and do any necessary updates</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$updater</span> = <span class="ruby-constant">GITCVS</span><span class="ruby-operator">::</span><span class="ruby-identifier">updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">new</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>}, <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-keyword">module</span>}, <span class="ruby-identifier">$log</span>);

<span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">update</span>();

<span class="ruby-identifier">argsfromdir</span>(<span class="ruby-identifier">$updater</span>);

<span class="ruby-comment">#$log-&gt;debug(&quot;update state : &quot; . Dumper($state));</span>

<span class="ruby-identifier">my</span>(<span class="ruby-identifier">$repoDir</span>);
<span class="ruby-identifier">$repoDir</span>=<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>} . <span class="ruby-string">&quot;/$state-&gt;{module}/$state-&gt;{prependdir}&quot;</span>;

<span class="ruby-identifier">my</span> <span class="ruby-value">%se</span><span class="ruby-identifier">ndirs</span> = ();

<span class="ruby-comment"># foreach file specified on the command line ...</span>
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$argsFilename</span> ( @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>}} )
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filename</span>;
    <span class="ruby-identifier">$filename</span> = <span class="ruby-identifier">filecleanup</span>(<span class="ruby-identifier">$argsFilename</span>);

    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Processing file $filename&quot;</span>);

    <span class="ruby-comment"># if we have a -C we should pretend we never saw modified stuff</span>
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">exists</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">C</span>} ) )
    {
        <span class="ruby-identifier">delete</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_hash</span>};
        <span class="ruby-identifier">delete</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_filename</span>};
        <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">unchanged</span>} = <span class="ruby-value">1</span>;
    }

    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$stickyInfo</span> = <span class="ruby-identifier">resolveStickyInfo</span>(<span class="ruby-identifier">$filename</span>,
                                       <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>},
                                       <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">D</span>},
                                       <span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">A</span>}));
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$meta</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getmeta</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-identifier">$stickyInfo</span>);

    <span class="ruby-comment"># If -p was given, &quot;print&quot; the contents of the requested revision.</span>
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">exists</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">p</span>} ) ) {
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} ) ) {
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Printing &#39;$filename&#39; revision &quot;</span> . <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>});

            <span class="ruby-identifier">transmitfile</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>}, { <span class="ruby-identifier">print</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> });
        }

        <span class="ruby-keyword">next</span>;
    }

    <span class="ruby-comment"># Directories:</span>
    <span class="ruby-identifier">prepDirForOutput</span>(
            <span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">$argsFilename</span>),
            <span class="ruby-identifier">$repoDir</span>,
            <span class="ruby-string">&quot;.&quot;</span>,
            \<span class="ruby-value">%se</span><span class="ruby-identifier">ndirs</span>,
            <span class="ruby-string">&quot;update&quot;</span>,
            <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirArgs</span>} );

    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$wrev</span> = <span class="ruby-identifier">revparse</span>(<span class="ruby-identifier">$filename</span>);

    <span class="ruby-keyword">if</span> ( <span class="ruby-operator">!</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$meta</span> )
    {
        <span class="ruby-identifier">$meta</span> = {
            <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$filename</span>,
            <span class="ruby-identifier">revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;0&#39;</span>,
            <span class="ruby-identifier">filehash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;added&#39;</span>
        };
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;0&quot;</span>)
        {
            <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>}=<span class="ruby-string">&#39;deleted&#39;</span>;
        }
    }

    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$oldmeta</span> = <span class="ruby-identifier">$meta</span>;

    <span class="ruby-comment"># If the working copy is an old revision, lets get that version too for comparison.</span>
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$oldWrev</span>=<span class="ruby-identifier">$wrev</span>;
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$oldWrev</span>))
    {
        <span class="ruby-identifier">$oldWrev</span><span class="ruby-operator">=~</span><span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-operator">-</span><span class="ruby-regexp">//</span>;
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$oldWrev</span> <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>})
        {
            <span class="ruby-identifier">$oldmeta</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getmeta</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-identifier">$oldWrev</span>);
        }
    }

    <span class="ruby-comment">#$log-&gt;debug(&quot;Target revision is $meta-&gt;{revision}, current working revision is $wrev&quot;);</span>

    <span class="ruby-comment"># Files are up to date if the working copy and repo copy have the same revision,</span>
    <span class="ruby-comment"># and the working copy is unmodified _and_ the user hasn&#39;t specified -C</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$wrev</span> )
              <span class="ruby-keyword">and</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>})
              <span class="ruby-keyword">and</span> <span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>}
              <span class="ruby-keyword">and</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">unchanged</span>}
              <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">exists</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">C</span>} ) );

    <span class="ruby-comment"># If the working copy and repo copy have the same revision,</span>
    <span class="ruby-comment"># but the working copy is modified, tell the client it&#39;s modified</span>
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$wrev</span> )
         <span class="ruby-keyword">and</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>})
         <span class="ruby-keyword">and</span> <span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>}
         <span class="ruby-keyword">and</span> <span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;0&quot;</span>
         <span class="ruby-keyword">and</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_hash</span>})
         <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">exists</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">C</span>} ) )
    {
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Tell the client the file is modified&quot;</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT text M \n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT fname $filename\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT newline\n&quot;</span>;
        <span class="ruby-keyword">next</span>;
    }

    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;deleted&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;0&quot;</span> )
    {
        <span class="ruby-comment"># TODO: If it has been modified in the sandbox, error out</span>
        <span class="ruby-comment">#   with the appropriate message, rather than deleting a modified</span>
        <span class="ruby-comment">#   file.</span>

        <span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$filepart</span>, <span class="ruby-identifier">$dirpart</span> ) = <span class="ruby-identifier">filenamesplit</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-value">1</span>);

        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Removing &#39;$filename&#39; from working copy (no longer in the repo)&quot;</span>);

        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E cvs update: `$filename&#39; is no longer in the repository\n&quot;</span>;
        <span class="ruby-comment"># Don&#39;t want to actually _DO_ the update if -n specified</span>
        <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-operator">-</span><span class="ruby-identifier">n</span>} ) {
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Removed $dirpart\n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$filepart\n&quot;</span>;
        }
    }
    <span class="ruby-keyword">elsif</span> ( <span class="ruby-keyword">not</span> <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_hash</span>} )
            <span class="ruby-keyword">or</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_hash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$oldmeta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>}
            <span class="ruby-keyword">or</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;added&#39;</span> )
    {
        <span class="ruby-comment"># normal update, just send the new revision (either U=Update,</span>
        <span class="ruby-comment"># or A=Add, or R=Remove)</span>
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$wrev</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">$wrev</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^-/</span>) )
        {
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Tell the client the file is scheduled for removal&quot;</span>);
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT text R \n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT fname $filename\n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT newline\n&quot;</span>;
            <span class="ruby-keyword">next</span>;
        }
        <span class="ruby-keyword">elsif</span> ( (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$wrev</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;0&#39;</span>) <span class="ruby-operator">&amp;&amp;</span>
                (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>}) <span class="ruby-operator">||</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;0&#39;</span>) )
        {
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Tell the client the file is scheduled for addition&quot;</span>);
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT text A \n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT fname $filename\n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT newline\n&quot;</span>;
            <span class="ruby-keyword">next</span>;

        }
        <span class="ruby-keyword">else</span> {
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;UpdatingX3 &#39;$filename&#39; to &quot;</span>.<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>});
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT +updated\n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT text U \n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT fname $filename\n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT newline\n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;MT -updated\n&quot;</span>;
        }

        <span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$filepart</span>, <span class="ruby-identifier">$dirpart</span> ) = <span class="ruby-identifier">filenamesplit</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-value">1</span>);

        <span class="ruby-comment"># Don&#39;t want to actually _DO_ the update if -n specified</span>
        <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-operator">-</span><span class="ruby-identifier">n</span>} )
        {
            <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$wrev</span> ) )
            {
                <span class="ruby-comment"># instruct client we&#39;re sending a file to put in this path as a replacement</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Update-existing $dirpart\n&quot;</span>;
                <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Updating existing file &#39;Update-existing $dirpart&#39;&quot;</span>);
            } <span class="ruby-keyword">else</span> {
                <span class="ruby-comment"># instruct client we&#39;re sending a file to put in this path as a new file</span>

                <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Creating new file &#39;Created $dirpart&#39;&quot;</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Created $dirpart\n&quot;</span>;
            }
            <span class="ruby-identifier">print</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>} . <span class="ruby-string">&quot;/$state-&gt;{module}/$filename\n&quot;</span>;

            <span class="ruby-comment"># this is an &quot;entries&quot; line</span>
            <span class="ruby-identifier">my</span> <span class="ruby-identifier">$kopts</span> = <span class="ruby-identifier">kopts_from_path</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-string">&quot;sha1&quot;</span>,<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>});
            <span class="ruby-identifier">my</span> <span class="ruby-identifier">$entriesLine</span> = <span class="ruby-string">&quot;/$filepart/$meta-&gt;{revision}//$kopts/&quot;</span>;
            <span class="ruby-identifier">$entriesLine</span> .= <span class="ruby-identifier">getStickyTagOrDate</span>(<span class="ruby-identifier">$stickyInfo</span>);
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-identifier">$entriesLine</span>);
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$entriesLine\n&quot;</span>;

            <span class="ruby-comment"># permissions</span>
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;SEND : u=$meta-&gt;{mode},g=$meta-&gt;{mode},o=$meta-&gt;{mode}&quot;</span>);
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;u=$meta-&gt;{mode},g=$meta-&gt;{mode},o=$meta-&gt;{mode}\n&quot;</span>;

            <span class="ruby-comment"># transmit file</span>
            <span class="ruby-identifier">transmitfile</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>});
        }
    } <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$filepart</span>, <span class="ruby-identifier">$dirpart</span> ) = <span class="ruby-identifier">filenamesplit</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">name</span>},<span class="ruby-value">1</span>);

        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$mergeDir</span> = <span class="ruby-identifier">setupTmpDir</span>();

        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file_local</span> = <span class="ruby-identifier">$filepart</span> . <span class="ruby-string">&quot;.mine&quot;</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$mergedFile</span> = <span class="ruby-string">&quot;$mergeDir/$file_local&quot;</span>;
        <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;ln&quot;</span>,<span class="ruby-string">&quot;-s&quot;</span>,<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_filename</span>}, <span class="ruby-identifier">$file_local</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file_old</span> = <span class="ruby-identifier">$filepart</span> . <span class="ruby-string">&quot;.&quot;</span> . <span class="ruby-identifier">$oldmeta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>};
        <span class="ruby-identifier">transmitfile</span>(<span class="ruby-identifier">$oldmeta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>}, { <span class="ruby-identifier">targetfile</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$file_old</span> });
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file_new</span> = <span class="ruby-identifier">$filepart</span> . <span class="ruby-string">&quot;.&quot;</span> . <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>};
        <span class="ruby-identifier">transmitfile</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>}, { <span class="ruby-identifier">targetfile</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$file_new</span> });

        <span class="ruby-comment"># we need to merge with the local changes ( M=successful merge, C=conflict merge )</span>
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Merging $file_local, $file_old, $file_new&quot;</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M Merging differences between $oldmeta-&gt;{revision} and $meta-&gt;{revision} into $filename\n&quot;</span>;

        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Temporary directory for merge is $mergeDir&quot;</span>);

        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$return</span> = <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;merge-file&quot;</span>, <span class="ruby-identifier">$file_local</span>, <span class="ruby-identifier">$file_old</span>, <span class="ruby-identifier">$file_new</span>);
        <span class="ruby-identifier">$return</span> <span class="ruby-operator">&gt;&gt;=</span> <span class="ruby-value">8</span>;

        <span class="ruby-identifier">cleanupTmpDir</span>();

        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$return</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> )
        {
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Merged successfully&quot;</span>);
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M M $filename\n&quot;</span>;
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Merged $dirpart&quot;</span>);

            <span class="ruby-comment"># Don&#39;t want to actually _DO_ the update if -n specified</span>
            <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-operator">-</span><span class="ruby-identifier">n</span>} )
            {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Merged $dirpart\n&quot;</span>;
                <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>} . <span class="ruby-string">&quot;/$state-&gt;{module}/$filename&quot;</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>} . <span class="ruby-string">&quot;/$state-&gt;{module}/$filename\n&quot;</span>;
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$kopts</span> = <span class="ruby-identifier">kopts_from_path</span>(<span class="ruby-string">&quot;$dirpart/$filepart&quot;</span>,
                                            <span class="ruby-string">&quot;file&quot;</span>,<span class="ruby-identifier">$mergedFile</span>);
                <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;/$filepart/$meta-&gt;{revision}//$kopts/&quot;</span>);
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$entriesLine</span>=<span class="ruby-string">&quot;/$filepart/$meta-&gt;{revision}//$kopts/&quot;</span>;
                <span class="ruby-identifier">$entriesLine</span> .= <span class="ruby-identifier">getStickyTagOrDate</span>(<span class="ruby-identifier">$stickyInfo</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$entriesLine\n&quot;</span>;
            }
        }
        <span class="ruby-keyword">elsif</span> ( <span class="ruby-identifier">$return</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
        {
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Merged with conflicts&quot;</span>);
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E cvs update: conflicts found in $filename\n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M C $filename\n&quot;</span>;

            <span class="ruby-comment"># Don&#39;t want to actually _DO_ the update if -n specified</span>
            <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-operator">-</span><span class="ruby-identifier">n</span>} )
            {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Merged $dirpart\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>} . <span class="ruby-string">&quot;/$state-&gt;{module}/$filename\n&quot;</span>;
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$kopts</span> = <span class="ruby-identifier">kopts_from_path</span>(<span class="ruby-string">&quot;$dirpart/$filepart&quot;</span>,
                                            <span class="ruby-string">&quot;file&quot;</span>,<span class="ruby-identifier">$mergedFile</span>);
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$entriesLine</span> = <span class="ruby-string">&quot;/$filepart/$meta-&gt;{revision}/+/$kopts/&quot;</span>;
                <span class="ruby-identifier">$entriesLine</span> .= <span class="ruby-identifier">getStickyTagOrDate</span>(<span class="ruby-identifier">$stickyInfo</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$entriesLine\n&quot;</span>;
            }
        }
        <span class="ruby-keyword">else</span>
        {
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Merge failed&quot;</span>);
            <span class="ruby-keyword">next</span>;
        }

        <span class="ruby-comment"># Don&#39;t want to actually _DO_ the update if -n specified</span>
        <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-operator">-</span><span class="ruby-identifier">n</span>} )
        {
            <span class="ruby-comment"># permissions</span>
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;SEND : u=$meta-&gt;{mode},g=$meta-&gt;{mode},o=$meta-&gt;{mode}&quot;</span>);
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;u=$meta-&gt;{mode},g=$meta-&gt;{mode},o=$meta-&gt;{mode}\n&quot;</span>;

            <span class="ruby-comment"># transmit file, format is single integer on a line by itself (file</span>
            <span class="ruby-comment"># size) followed by the file contents</span>
            <span class="ruby-comment"># TODO : we should copy files in blocks</span>
            <span class="ruby-identifier">my</span> <span class="ruby-identifier">$data</span> = <span class="ruby-value">%xcat $mergedFile`</span>;
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;File size : &quot;</span> . <span class="ruby-identifier">length</span>(<span class="ruby-identifier">$data</span>));
            <span class="ruby-identifier">print</span> <span class="ruby-identifier">length</span>(<span class="ruby-identifier">$data</span>) . <span class="ruby-string">&quot;\n&quot;</span>;
            <span class="ruby-identifier">print</span> <span class="ruby-identifier">$data</span>;
        }
    }

}

<span class="ruby-comment"># prepDirForOutput() any other existing directories unless they already</span>
<span class="ruby-comment"># have the right sticky tag:</span>
<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">globaloptions</span>}{<span class="ruby-identifier">n</span>} )
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$dir</span>;
    <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">$dir</span> (<span class="ruby-identifier">keys</span>(<span class="ruby-string">%Q{$state-&gt;{dirMap}}</span>))
    {
        <span class="ruby-keyword">if</span>( <span class="ruby-operator">!</span> <span class="ruby-identifier">$seendirs</span>{<span class="ruby-identifier">$dir</span>} <span class="ruby-operator">&amp;&amp;</span>
            <span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirArgs</span>}{<span class="ruby-identifier">$dir</span>}) )
        {
            <span class="ruby-identifier">my</span>(<span class="ruby-identifier">$oldTag</span>);
            <span class="ruby-identifier">$oldTag</span>=<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirMap</span>}{<span class="ruby-identifier">$dir</span>}{<span class="ruby-identifier">tagspec</span>};

            <span class="ruby-keyword">unless</span>( ( <span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">A</span>}) <span class="ruby-operator">&amp;&amp;</span>
                      <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$oldTag</span>) ) <span class="ruby-operator">||</span>
                      ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>}) <span class="ruby-operator">&amp;&amp;</span>
                        ( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$oldTag</span>) <span class="ruby-operator">||</span>
                          <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>} <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$oldTag</span> ) ) )
                    <span class="ruby-comment"># TODO?: OR sticky dir is different...</span>
            {
                <span class="ruby-keyword">next</span>;
            }

            <span class="ruby-identifier">prepDirForOutput</span>(
                    <span class="ruby-identifier">$dir</span>,
                    <span class="ruby-identifier">$repoDir</span>,
                    <span class="ruby-string">&quot;.&quot;</span>,
                    \<span class="ruby-value">%se</span><span class="ruby-identifier">ndirs</span>,
                    <span class="ruby-string">&#39;update&#39;</span>,
                    <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirArgs</span>} );
        }

        <span class="ruby-comment"># TODO?: Consider sending a final duplicate Sticky response</span>
        <span class="ruby-comment">#   to more closely mimic real CVS.</span>
    }
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ok\n&quot;</span>;
</pre>

<p>}</p>

<p>sub req_ci {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$data</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">argsplit</span>(<span class="ruby-string">&quot;ci&quot;</span>);

<span class="ruby-comment">#$log-&gt;debug(&quot;State : &quot; . Dumper($state));</span>

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;req_ci : &quot;</span> . ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$data</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">$data</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;[NULL]&quot;</span> ));

<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">method</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;pserver&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">user</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;anonymous&#39;</span> )
{
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 anonymous user cannot commit via pserver\n&quot;</span>;
    <span class="ruby-identifier">cleanupWorkTree</span>();
    <span class="ruby-identifier">exit</span>;
}

<span class="ruby-keyword">if</span> ( <span class="ruby-operator">-</span><span class="ruby-identifier">e</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>} . <span class="ruby-string">&quot;/index&quot;</span> )
{
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;file &#39;index&#39; already exists in the git repository&quot;</span>);
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 Index already exists in git repo\n&quot;</span>;
    <span class="ruby-identifier">cleanupWorkTree</span>();
    <span class="ruby-identifier">exit</span>;
}

<span class="ruby-comment"># Grab a handle to the SQLite db and do any necessary updates</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$updater</span> = <span class="ruby-constant">GITCVS</span><span class="ruby-operator">::</span><span class="ruby-identifier">updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">new</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>}, <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-keyword">module</span>}, <span class="ruby-identifier">$log</span>);
<span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">update</span>();

<span class="ruby-identifier">my</span> <span class="ruby-ivar">@committedfiles</span> = ();
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ldmeta</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$stickyInfo</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$branchRef</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$parenthash</span>;

<span class="ruby-comment"># foreach file specified on the command line ...</span>
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filename</span> ( @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>}} )
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$committedfile</span> = <span class="ruby-identifier">$filename</span>;
    <span class="ruby-identifier">$filename</span> = <span class="ruby-identifier">filecleanup</span>(<span class="ruby-identifier">$filename</span>);

    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">exists</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_filename</span>} <span class="ruby-keyword">or</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">unchanged</span>} );

    <span class="ruby-comment">#####</span>
    <span class="ruby-comment"># Figure out which branch and parenthash we are committing</span>
    <span class="ruby-comment"># to, and setup worktree:</span>

    <span class="ruby-comment"># should always come from entries:</span>
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fileStickyInfo</span> = <span class="ruby-identifier">resolveStickyInfo</span>(<span class="ruby-identifier">$filename</span>);
    <span class="ruby-keyword">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$branchRef</span>) )
    {
        <span class="ruby-identifier">$stickyInfo</span> = <span class="ruby-identifier">$fileStickyInfo</span>;
        <span class="ruby-keyword">if</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span>) <span class="ruby-operator">&amp;&amp;</span>
            ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">date</span>}) <span class="ruby-operator">||</span>
              <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tag</span>}) ) )
        {
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 cannot commit with sticky date for file `$filename&#39;\n&quot;</span>;
            <span class="ruby-identifier">cleanupWorkTree</span>();
            <span class="ruby-identifier">exit</span>;
        }

        <span class="ruby-identifier">$branchRef</span> = <span class="ruby-string">&quot;refs/heads/$state-&gt;{module}&quot;</span>;
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tag</span>}) )
        {
            <span class="ruby-identifier">$branchRef</span> = <span class="ruby-string">&quot;refs/heads/$stickyInfo-&gt;{tag}&quot;</span>;
        }

        <span class="ruby-identifier">$parenthash</span> = <span class="ruby-value">%xgit show-ref -s $branchRef`</span>;
        <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$parenthash</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$parenthash</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/^[0-9a-f]{40}$/</span>)
        {
            <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyInfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tag</span>}) )
            {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 sticky tag `$stickyInfo-&gt;{tag}&#39; for file `$filename&#39; is not a branch\n&quot;</span>;
            }
            <span class="ruby-keyword">else</span>
            {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 pserver cannot find the current HEAD of module&quot;</span>;
            }
            <span class="ruby-identifier">cleanupWorkTree</span>();
            <span class="ruby-identifier">exit</span>;
        }

        <span class="ruby-identifier">setupWorkTree</span>(<span class="ruby-identifier">$parenthash</span>);

        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Lockless commit start, basing commit on &#39;$work-&gt;{workDir}&#39;, index file is &#39;$work-&gt;{index}&#39;&quot;</span>);

        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Created index &#39;$work-&gt;{index}&#39; for head $state-&gt;{module} - exit status $?&quot;</span>);
    }
    <span class="ruby-keyword">elsif</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">refHashEqual</span>(<span class="ruby-identifier">$stickyInfo</span>,<span class="ruby-identifier">$fileStickyInfo</span>) )
    {
        <span class="ruby-comment">#TODO: We could split the cvs commit into multiple</span>
        <span class="ruby-comment">#  git commits by distinct stickyTag values, but that</span>
        <span class="ruby-comment">#  is lowish priority.</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 Committing different files to different&quot;</span>
              . <span class="ruby-string">&quot; branches is not currently supported\n&quot;</span>;
        <span class="ruby-identifier">cleanupWorkTree</span>();
        <span class="ruby-identifier">exit</span>;
    }

    <span class="ruby-comment">#####</span>
    <span class="ruby-comment"># Process this file:</span>

    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$meta</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getmeta</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-identifier">$stickyInfo</span>);
    <span class="ruby-identifier">$oldmeta</span>{<span class="ruby-identifier">$filename</span>} = <span class="ruby-identifier">$meta</span>;

    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$wrev</span> = <span class="ruby-identifier">revparse</span>(<span class="ruby-identifier">$filename</span>);

    <span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$filepart</span>, <span class="ruby-identifier">$dirpart</span> ) = <span class="ruby-identifier">filenamesplit</span>(<span class="ruby-identifier">$filename</span>);

    <span class="ruby-comment"># do a checkout of the file if it is part of this tree</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$wrev</span>) {
        <span class="ruby-identifier">system</span>(<span class="ruby-string">&#39;git&#39;</span>, <span class="ruby-string">&#39;checkout-index&#39;</span>, <span class="ruby-string">&#39;-f&#39;</span>, <span class="ruby-string">&#39;-u&#39;</span>, <span class="ruby-identifier">$filename</span>);
        <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$?</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>) {
            <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Error running git-checkout-index -f -u $filename : $!&quot;</span>;
        }
    }

    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$addflag</span> = <span class="ruby-value">0</span>;
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$rmflag</span> = <span class="ruby-value">0</span>;
    <span class="ruby-identifier">$rmflag</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$wrev</span>) <span class="ruby-keyword">and</span> (<span class="ruby-identifier">$wrev</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^-/</span>) );
    <span class="ruby-identifier">$addflag</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">unless</span> ( <span class="ruby-operator">-</span><span class="ruby-identifier">e</span> <span class="ruby-identifier">$filename</span> );

    <span class="ruby-comment"># Do up to date checking</span>
    <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$addflag</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} <span class="ruby-keyword">or</span>
             ( <span class="ruby-identifier">$rmflag</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;-$meta-&gt;{revision}&quot;</span> ) )
    {
        <span class="ruby-comment"># fail everything if an up to date check fails</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 Up to date check failed for $filename\n&quot;</span>;
        <span class="ruby-identifier">cleanupWorkTree</span>();
        <span class="ruby-identifier">exit</span>;
    }

    <span class="ruby-identifier">push</span> <span class="ruby-ivar">@committedfiles</span>, <span class="ruby-identifier">$committedfile</span>;
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Committing $filename&quot;</span>);

    <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;mkdir&quot;</span>,<span class="ruby-string">&quot;-p&quot;</span>,<span class="ruby-identifier">$dirpart</span>) <span class="ruby-keyword">unless</span> ( <span class="ruby-operator">-</span><span class="ruby-identifier">d</span> <span class="ruby-identifier">$dirpart</span> );

    <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$rmflag</span> )
    {
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;rename $state-&gt;{entries}{$filename}{modified_filename} $filename&quot;</span>);
        <span class="ruby-identifier">rename</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_filename</span>},<span class="ruby-identifier">$filename</span>;

        <span class="ruby-comment"># Calculate modes to remove</span>
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$invmode</span> = <span class="ruby-string">&quot;&quot;</span>;
        <span class="ruby-identifier">foreach</span> ( <span class="ruby-identifier">qw</span> (<span class="ruby-identifier">r</span> <span class="ruby-identifier">w</span> <span class="ruby-identifier">x</span>) ) { <span class="ruby-identifier">$invmode</span> .= <span class="ruby-identifier">$_</span> <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_mode</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/$_/</span> ); }

        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;chmod u+&quot;</span> . <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_mode</span>} . <span class="ruby-string">&quot;-&quot;</span> . <span class="ruby-identifier">$invmode</span> . <span class="ruby-string">&quot; $filename&quot;</span>);
        <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;chmod&quot;</span>,<span class="ruby-string">&quot;u+&quot;</span> .  <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_mode</span>} . <span class="ruby-string">&quot;-&quot;</span> . <span class="ruby-identifier">$invmode</span>, <span class="ruby-identifier">$filename</span>);
    }

    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$rmflag</span> )
    {
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Removing file &#39;$filename&#39;&quot;</span>);
        <span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">$filename</span>);
        <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;update-index&quot;</span>, <span class="ruby-string">&quot;--remove&quot;</span>, <span class="ruby-identifier">$filename</span>);
    }
    <span class="ruby-keyword">elsif</span> ( <span class="ruby-identifier">$addflag</span> )
    {
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Adding file &#39;$filename&#39;&quot;</span>);
        <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;update-index&quot;</span>, <span class="ruby-string">&quot;--add&quot;</span>, <span class="ruby-identifier">$filename</span>);
    } <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;UpdatingX2 file &#39;$filename&#39;&quot;</span>);
        <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-string">&quot;update-index&quot;</span>, <span class="ruby-identifier">$filename</span>);
    }
}

<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">scalar</span>(<span class="ruby-ivar">@committedfiles</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
{
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E No files to commit\n&quot;</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ok\n&quot;</span>;
    <span class="ruby-identifier">cleanupWorkTree</span>();
    <span class="ruby-keyword">return</span>;
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$treehash</span> = <span class="ruby-value">%xgit write-tree`</span>;
<span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$treehash</span>;

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Treehash : $treehash, Parenthash : $parenthash&quot;</span>);

<span class="ruby-comment"># write our commit message out if we have one ...</span>
<span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$msg_fh</span>, <span class="ruby-identifier">$msg_filename</span> ) = <span class="ruby-identifier">tempfile</span>( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span> );
<span class="ruby-identifier">print</span> <span class="ruby-identifier">$msg_fh</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">m</span>};<span class="ruby-comment"># if ( exists ( $state-&gt;{opt}{m} ) );</span>
<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">commitmsgannotation</span>} ) ) {
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">commitmsgannotation</span>} <span class="ruby-operator">!~</span> <span class="ruby-regexp">/^\s*$/</span> ) {
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$msg_fh</span> <span class="ruby-string">&quot;\n\n&quot;</span>.<span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">commitmsgannotation</span>}.<span class="ruby-string">&quot;\n&quot;</span>
    }
} <span class="ruby-keyword">else</span> {
    <span class="ruby-identifier">print</span> <span class="ruby-identifier">$msg_fh</span> <span class="ruby-string">&quot;\n\nvia git-CVS emulator\n&quot;</span>;
}
<span class="ruby-identifier">close</span> <span class="ruby-identifier">$msg_fh</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$commithash</span> = <span class="ruby-value">%xgit commit-tree $treehash -p $parenthash &lt; $msg_filename`</span>;
<span class="ruby-identifier">chomp</span>(<span class="ruby-identifier">$commithash</span>);
<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Commit hash : $commithash&quot;</span>);

<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$commithash</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[a-zA-Z0-9]{40}/</span> )
{
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Commit failed (Invalid commit hash)&quot;</span>);
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 Commit failed (unknown reason)\n&quot;</span>;
    <span class="ruby-identifier">cleanupWorkTree</span>();
    <span class="ruby-identifier">exit</span>;
}

    <span class="ruby-comment">### Emulate git-receive-pack by running hooks/update</span>
    <span class="ruby-identifier">my</span> <span class="ruby-ivar">@hook</span> = ( <span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_DIR</span>}.<span class="ruby-string">&#39;hooks/update&#39;</span>, <span class="ruby-identifier">$branchRef</span>,
                    <span class="ruby-identifier">$parenthash</span>, <span class="ruby-identifier">$commithash</span> );
    <span class="ruby-keyword">if</span>( <span class="ruby-operator">-</span><span class="ruby-identifier">x</span> <span class="ruby-identifier">$hook</span>[<span class="ruby-value">0</span>] ) {
            <span class="ruby-keyword">unless</span>( <span class="ruby-identifier">system</span>( <span class="ruby-ivar">@hook</span> ) <span class="ruby-operator">==</span> <span class="ruby-value">0</span> )
            {
                    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Commit failed (update hook declined to update ref)&quot;</span>);
                    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 Commit failed (update hook declined)\n&quot;</span>;
                    <span class="ruby-identifier">cleanupWorkTree</span>();
                    <span class="ruby-identifier">exit</span>;
            }
    }

    <span class="ruby-comment">### Update the ref</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">system</span>(<span class="ruby-identifier">qw</span>(<span class="ruby-identifier">git</span> <span class="ruby-identifier">update</span><span class="ruby-operator">-</span><span class="ruby-identifier">ref</span> <span class="ruby-operator">-</span><span class="ruby-identifier">m</span>), <span class="ruby-string">&quot;cvsserver ci&quot;</span>,
                    <span class="ruby-identifier">$branchRef</span>, <span class="ruby-identifier">$commithash</span>, <span class="ruby-identifier">$parenthash</span>)) {
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;update-ref for $state-&gt;{module} failed.&quot;</span>);
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 Cannot commit -- update first\n&quot;</span>;
            <span class="ruby-identifier">cleanupWorkTree</span>();
            <span class="ruby-identifier">exit</span>;
    }

    <span class="ruby-comment">### Emulate git-receive-pack by running hooks/post-receive</span>
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$hook</span> = <span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_DIR</span>}.<span class="ruby-string">&#39;hooks/post-receive&#39;</span>;
    <span class="ruby-keyword">if</span>( <span class="ruby-operator">-</span><span class="ruby-identifier">x</span> <span class="ruby-identifier">$hook</span> ) {
            <span class="ruby-identifier">open</span>(<span class="ruby-identifier">my</span> <span class="ruby-identifier">$pipe</span>, <span class="ruby-string">&quot;| $hook&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;can&#39;t fork $!&quot;</span>;

            <span class="ruby-identifier">local</span> <span class="ruby-identifier">$SIG</span>{<span class="ruby-constant">PIPE</span>} = <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">die</span> <span class="ruby-string">&#39;pipe broke&#39;</span> };

            <span class="ruby-identifier">print</span> <span class="ruby-identifier">$pipe</span> <span class="ruby-string">&quot;$parenthash $commithash $branchRef\n&quot;</span>;

            <span class="ruby-identifier">close</span> <span class="ruby-identifier">$pipe</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;bad pipe: $! $?&quot;</span>;
    }

<span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">update</span>();

    <span class="ruby-comment">### Then hooks/post-update</span>
    <span class="ruby-identifier">$hook</span> = <span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_DIR</span>}.<span class="ruby-string">&#39;hooks/post-update&#39;</span>;
    <span class="ruby-keyword">if</span> (<span class="ruby-operator">-</span><span class="ruby-identifier">x</span> <span class="ruby-identifier">$hook</span>) {
            <span class="ruby-identifier">system</span>(<span class="ruby-identifier">$hook</span>, <span class="ruby-identifier">$branchRef</span>);
    }

<span class="ruby-comment"># foreach file specified on the command line ...</span>
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filename</span> ( <span class="ruby-ivar">@committedfiles</span> )
{
    <span class="ruby-identifier">$filename</span> = <span class="ruby-identifier">filecleanup</span>(<span class="ruby-identifier">$filename</span>);

    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$meta</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getmeta</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-identifier">$stickyInfo</span>);
    <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>}) {
      <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} = <span class="ruby-string">&quot;1.1&quot;</span>;
    }

    <span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$filepart</span>, <span class="ruby-identifier">$dirpart</span> ) = <span class="ruby-identifier">filenamesplit</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-value">1</span>);

    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Checked-in $dirpart : $filename&quot;</span>);

    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M $state-&gt;{CVSROOT}/$state-&gt;{module}/$filename,v  &lt;--  $dirpart$filepart\n&quot;</span>;
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;deleted&quot;</span> )
    {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M new revision: delete; previous revision: $oldmeta{$filename}{revision}\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Remove-entry $dirpart\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$filename\n&quot;</span>;
    } <span class="ruby-keyword">else</span> {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;1.1&quot;</span>) {
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M initial revision: 1.1\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M new revision: $meta-&gt;{revision}; previous revision: $oldmeta{$filename}{revision}\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Checked-in $dirpart\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$filename\n&quot;</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$kopts</span> = <span class="ruby-identifier">kopts_from_path</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-string">&quot;sha1&quot;</span>,<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>});
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;/$filepart/$meta-&gt;{revision}//$kopts/&quot;</span> .
              <span class="ruby-identifier">getStickyTagOrDate</span>(<span class="ruby-identifier">$stickyInfo</span>) . <span class="ruby-string">&quot;\n&quot;</span>;
    }
}

<span class="ruby-identifier">cleanupWorkTree</span>();
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ok\n&quot;</span>;
</pre>

<p>}</p>

<p>sub req_status {</p>

<pre>my ( $cmd, $data ) = @_;

argsplit(&quot;status&quot;);

$log-&gt;info(&quot;req_status : &quot; . ( defined($data) ? $data : &quot;[NULL]&quot; ));
#$log-&gt;debug(&quot;status state : &quot; . Dumper($state));

# Grab a handle to the SQLite db and do any necessary updates
my $updater;
$updater = GITCVS::updater-&gt;new($state-&gt;{CVSROOT}, $state-&gt;{module}, $log);
$updater-&gt;update();

# if no files were specified, we need to work out what files we should
# be providing status on ...
argsfromdir($updater);

# foreach file specified on the command line ...
foreach my $filename ( @{$state-&gt;{args}} )
{
    $filename = filecleanup($filename);

    if ( exists($state-&gt;{opt}{l}) &amp;&amp;
         index($filename, &#39;/&#39;, length($state-&gt;{prependdir})) &gt;= 0 )
    {
       next;
    }

    my $wrev = revparse($filename);

    my $stickyInfo = resolveStickyInfo($filename);
    my $meta = $updater-&gt;getmeta($filename,$stickyInfo);
    my $oldmeta = $meta;

    # If the working copy is an old revision, lets get that
    # version too for comparison.
    if ( defined($wrev) and $wrev ne $meta-&gt;{revision} )
    {
        my($rmRev)=$wrev;
        $rmRev=~s/^-//;
        $oldmeta = $updater-&gt;getmeta($filename, $rmRev);
    }

    # TODO : All possible statuses aren&#39;t yet implemented
    my $status;
    # Files are up to date if the working copy and repo copy have
    # the same revision, and the working copy is unmodified
    if ( defined ( $wrev ) and defined($meta-&gt;{revision}) and
         $wrev eq $meta-&gt;{revision} and
         ( ( $state-&gt;{entries}{$filename}{unchanged} and
             ( not defined ( $state-&gt;{entries}{$filename}{conflict} ) or
               $state-&gt;{entries}{$filename}{conflict} !~ /^\+=/ ) ) or
           ( defined($state-&gt;{entries}{$filename}{modified_hash}) and
             $state-&gt;{entries}{$filename}{modified_hash} eq
                    $meta-&gt;{filehash} ) ) )
    {
        $status = &quot;Up-to-date&quot;
    }

    # Need checkout if the working copy has a different (usually
    # older) revision than the repo copy, and the working copy is
    # unmodified
    if ( defined ( $wrev ) and defined ( $meta-&gt;{revision} ) and
         $meta-&gt;{revision} ne $wrev and
         ( $state-&gt;{entries}{$filename}{unchanged} or
           ( defined($state-&gt;{entries}{$filename}{modified_hash}) and
             $state-&gt;{entries}{$filename}{modified_hash} eq
                            $oldmeta-&gt;{filehash} ) ) )
    {
        $status ||= &quot;Needs Checkout&quot;;
    }

    # Need checkout if it exists in the repo but doesn&#39;t have a working
    # copy
    if ( not defined ( $wrev ) and defined ( $meta-&gt;{revision} ) )
    {
        $status ||= &quot;Needs Checkout&quot;;
    }

    # Locally modified if working copy and repo copy have the
    # same revision but there are local changes
    if ( defined ( $wrev ) and defined($meta-&gt;{revision}) and
         $wrev eq $meta-&gt;{revision} and
         $wrev ne &quot;0&quot; and
         $state-&gt;{entries}{$filename}{modified_filename} )
    {
        $status ||= &quot;Locally Modified&quot;;
    }

    # Needs Merge if working copy revision is different
    # (usually older) than repo copy and there are local changes
    if ( defined ( $wrev ) and defined ( $meta-&gt;{revision} ) and
         $meta-&gt;{revision} ne $wrev and
         $state-&gt;{entries}{$filename}{modified_filename} )
    {
        $status ||= &quot;Needs Merge&quot;;
    }

    if ( defined ( $state-&gt;{entries}{$filename}{revision} ) and
         ( !defined($meta-&gt;{revision}) ||
           $meta-&gt;{revision} eq &quot;0&quot; ) )
    {
        $status ||= &quot;Locally Added&quot;;
    }
    if ( defined ( $wrev ) and defined ( $meta-&gt;{revision} ) and
         $wrev eq &quot;-$meta-&gt;{revision}&quot; )
    {
        $status ||= &quot;Locally Removed&quot;;
    }
    if ( defined ( $state-&gt;{entries}{$filename}{conflict} ) and
         $state-&gt;{entries}{$filename}{conflict} =~ /^\+=/ )
    {
        $status ||= &quot;Unresolved Conflict&quot;;
    }
    if ( 0 )
    {
        $status ||= &quot;File had conflicts on merge&quot;;
    }

    $status ||= &quot;Unknown&quot;;

    my ($filepart) = filenamesplit($filename);

    print &quot;M =======&quot; . ( &quot;=&quot; x 60 ) . &quot;\n&quot;;
    print &quot;M File: $filepart\tStatus: $status\n&quot;;
    if ( defined($state-&gt;{entries}{$filename}{revision}) )
    {
        print &quot;M Working revision:\t&quot; .
              $state-&gt;{entries}{$filename}{revision} . &quot;\n&quot;;
    } else {
        print &quot;M Working revision:\tNo entry for $filename\n&quot;;
    }
    if ( defined($meta-&gt;{revision}) )
    {
        print &quot;M Repository revision:\t&quot; .
               $meta-&gt;{revision} .
               &quot;\t$state-&gt;{CVSROOT}/$state-&gt;{module}/$filename,v\n&quot;;
        my($tagOrDate)=$state-&gt;{entries}{$filename}{tag_or_date};
        my($tag)=($tagOrDate=~m/^T(.+)$/);
        if( !defined($tag) )
        {
            $tag=&quot;(none)&quot;;
        }
        print &quot;M Sticky Tag:\t\t$tag\n&quot;;
        my($date)=($tagOrDate=~m/^D(.+)$/);
        if( !defined($date) )
        {
            $date=&quot;(none)&quot;;
        }
        print &quot;M Sticky Date:\t\t$date\n&quot;;
        my($options)=$state-&gt;{entries}{$filename}{options};
        if( $options eq &quot;&quot; )
        {
            $options=&quot;(none)&quot;;
        }
        print &quot;M Sticky Options:\t\t$options\n&quot;;
    } else {
        print &quot;M Repository revision:\tNo revision control file\n&quot;;
    }
    print &quot;M\n&quot;;
}

print &quot;ok\n&quot;;</pre>

<p>}</p>

<p>sub req_diff {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$cmd</span>, <span class="ruby-identifier">$data</span> ) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">argsplit</span>(<span class="ruby-string">&quot;diff&quot;</span>);

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;req_diff : &quot;</span> . ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$data</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">$data</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;[NULL]&quot;</span> ));
<span class="ruby-comment">#$log-&gt;debug(&quot;status state : &quot; . Dumper($state));</span>

<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$revision1</span>, <span class="ruby-identifier">$revision2</span>);
<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>} ) <span class="ruby-keyword">and</span> <span class="ruby-identifier">ref</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;ARRAY&quot;</span> )
{
    <span class="ruby-identifier">$revision1</span> = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>}[<span class="ruby-value">0</span>];
    <span class="ruby-identifier">$revision2</span> = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>}[<span class="ruby-value">1</span>];
} <span class="ruby-keyword">else</span> {
    <span class="ruby-identifier">$revision1</span> = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">r</span>};
}

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Diffing revisions &quot;</span> .
            ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$revision1</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">$revision1</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;[NULL]&quot;</span> ) .
            <span class="ruby-string">&quot; and &quot;</span> . ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$revision2</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">$revision2</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;[NULL]&quot;</span> ) );

<span class="ruby-comment"># Grab a handle to the SQLite db and do any necessary updates</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$updater</span>;
<span class="ruby-identifier">$updater</span> = <span class="ruby-constant">GITCVS</span><span class="ruby-operator">::</span><span class="ruby-identifier">updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">new</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-constant">CVSROOT</span>}, <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-keyword">module</span>}, <span class="ruby-identifier">$log</span>);
<span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">update</span>();

<span class="ruby-comment"># if no files were specified, we need to work out what files we should</span>
<span class="ruby-comment"># be providing status on ...</span>
<span class="ruby-identifier">argsfromdir</span>(<span class="ruby-identifier">$updater</span>);

<span class="ruby-identifier">my</span>(<span class="ruby-identifier">$foundDiff</span>);

<span class="ruby-comment"># foreach file specified on the command line ...</span>
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$argFilename</span> ( @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>}} )
{
    <span class="ruby-identifier">my</span>(<span class="ruby-identifier">$filename</span>) = <span class="ruby-identifier">filecleanup</span>(<span class="ruby-identifier">$argFilename</span>);

    <span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$fh</span>, <span class="ruby-identifier">$file1</span>, <span class="ruby-identifier">$file2</span>, <span class="ruby-identifier">$meta1</span>, <span class="ruby-identifier">$meta2</span>, <span class="ruby-identifier">$filediff</span> );

    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$wrev</span> = <span class="ruby-identifier">revparse</span>(<span class="ruby-identifier">$filename</span>);

    <span class="ruby-comment"># Priority for revision1:</span>
    <span class="ruby-comment">#  1. First -r (missing file: check -N)</span>
    <span class="ruby-comment">#  2. wrev from client&#39;s Entry line</span>
    <span class="ruby-comment">#      - missing line/file: check -N</span>
    <span class="ruby-comment">#      - &quot;0&quot;: added file not committed (empty contents for rev1)</span>
    <span class="ruby-comment">#      - Prefixed with dash (to be removed): check -N</span>

    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$revision1</span> ) )
    {
        <span class="ruby-identifier">$meta1</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getmeta</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-identifier">$revision1</span>);
    }
    <span class="ruby-keyword">elsif</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$wrev</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$wrev</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;0&quot;</span> )
    {
        <span class="ruby-identifier">my</span>(<span class="ruby-identifier">$rmRev</span>)=<span class="ruby-identifier">$wrev</span>;
        <span class="ruby-identifier">$rmRev</span><span class="ruby-operator">=~</span><span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-operator">-</span><span class="ruby-regexp">//</span>;
        <span class="ruby-identifier">$meta1</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getmeta</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-identifier">$rmRev</span>);
    }
    <span class="ruby-keyword">if</span> ( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$meta1</span>) <span class="ruby-operator">||</span>
         <span class="ruby-identifier">$meta1</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;deleted&quot;</span> )
    {
        <span class="ruby-keyword">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">N</span>}) )
        {
            <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$revision1</span>))
            {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E File $filename at revision $revision1 doesn&#39;t exist\n&quot;</span>;
            }
            <span class="ruby-keyword">next</span>;
        }
        <span class="ruby-keyword">elsif</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$meta1</span>) )
        {
            <span class="ruby-identifier">$meta1</span> = {
                <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$filename</span>,
                <span class="ruby-identifier">revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;0&#39;</span>,
                <span class="ruby-identifier">filehash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;deleted&#39;</span>
            };
        }
    }

    <span class="ruby-comment"># Priority for revision2:</span>
    <span class="ruby-comment">#  1. Second -r (missing file: check -N)</span>
    <span class="ruby-comment">#  2. Modified file contents from client</span>
    <span class="ruby-comment">#  3. wrev from client&#39;s Entry line</span>
    <span class="ruby-comment">#      - missing line/file: check -N</span>
    <span class="ruby-comment">#      - Prefixed with dash (to be removed): check -N</span>

    <span class="ruby-comment"># if we have a second -r switch, use it too</span>
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$revision2</span> ) )
    {
        <span class="ruby-identifier">$meta2</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getmeta</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-identifier">$revision2</span>);
    }
    <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_filename</span>}))
    {
        <span class="ruby-identifier">$file2</span> = <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">modified_filename</span>};
        <span class="ruby-identifier">$meta2</span> = {
            <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$filename</span>,
            <span class="ruby-identifier">revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;0&#39;</span>,
            <span class="ruby-identifier">filehash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;modified&#39;</span>
        };
    }
    <span class="ruby-keyword">elsif</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$wrev</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">$wrev</span><span class="ruby-operator">!~</span><span class="ruby-regexp">/^-/</span>) )
    {
        <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$revision1</span>))  <span class="ruby-comment"># no revision and no modifications:</span>
        {
            <span class="ruby-keyword">next</span>;
        }
        <span class="ruby-identifier">$meta2</span> = <span class="ruby-identifier">$updater</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getmeta</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-identifier">$wrev</span>);
    }
    <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$file2</span>))
    {
        <span class="ruby-keyword">if</span> ( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$meta2</span>) <span class="ruby-operator">||</span>
             <span class="ruby-identifier">$meta2</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;deleted&quot;</span> )
        {
            <span class="ruby-keyword">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">N</span>}) )
            {
                <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$revision2</span>))
                {
                    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E File $filename at revision $revision2 doesn&#39;t exist\n&quot;</span>;
                }
                <span class="ruby-keyword">next</span>;
            }
            <span class="ruby-keyword">elsif</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$meta2</span>) )
            {
                <span class="ruby-identifier">$meta2</span> = {
                    <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$filename</span>,
                    <span class="ruby-identifier">revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;0&#39;</span>,
                    <span class="ruby-identifier">filehash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;deleted&#39;</span>
                };
            }
        }
    }

    <span class="ruby-keyword">if</span>( <span class="ruby-identifier">$meta1</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$meta2</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} )
    {
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;unchanged $filename&quot;</span>);
        <span class="ruby-keyword">next</span>;
    }

    <span class="ruby-comment"># Retrieve revision contents:</span>
    ( <span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$file1</span> ) = <span class="ruby-identifier">tempfile</span>( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span>, <span class="ruby-constant">OPEN</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> );
    <span class="ruby-identifier">transmitfile</span>(<span class="ruby-identifier">$meta1</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>}, { <span class="ruby-identifier">targetfile</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$file1</span> });

    <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$file2</span>))
    {
        ( <span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$file2</span> ) = <span class="ruby-identifier">tempfile</span>( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span>, <span class="ruby-constant">OPEN</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> );
        <span class="ruby-identifier">transmitfile</span>(<span class="ruby-identifier">$meta2</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>}, { <span class="ruby-identifier">targetfile</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$file2</span> });
    }

    <span class="ruby-comment"># Generate the actual diff:</span>
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M Index: $argFilename\n&quot;</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M =======&quot;</span> . ( <span class="ruby-string">&quot;=&quot;</span> <span class="ruby-identifier">x</span> <span class="ruby-value">60</span> ) . <span class="ruby-string">&quot;\n&quot;</span>;
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M RCS file: $state-&gt;{CVSROOT}/$state-&gt;{module}/$filename,v\n&quot;</span>;
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$meta1</span> ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$meta1</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;0&quot;</span> )
    {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M retrieving revision $meta1-&gt;{revision}\n&quot;</span>
    }
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$meta2</span> ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$meta2</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;0&quot;</span> )
    {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M retrieving revision $meta2-&gt;{revision}\n&quot;</span>
    }
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M diff &quot;</span>;
    <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$opt</span> ( <span class="ruby-identifier">keys</span> <span class="ruby-string">%Q{$state-&gt;{opt}}</span> )
    {
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">ref</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">$opt</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;ARRAY&quot;</span> )
        {
            <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$value</span> ( @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">$opt</span>}} )
            {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;-$opt $value &quot;</span>;
            }
        } <span class="ruby-keyword">else</span> {
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;-$opt &quot;</span>;
            <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">$opt</span>} ) )
            {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$state-&gt;{opt}{$opt} &quot;</span>
            }
        }
    }
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$argFilename\n&quot;</span>;

    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Diffing $filename -r $meta1-&gt;{revision} -r &quot;</span> .
               ( <span class="ruby-identifier">$meta2</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} <span class="ruby-keyword">or</span> <span class="ruby-string">&quot;workingcopy&quot;</span> ));

    <span class="ruby-comment"># TODO: Use --label instead of -L because -L is no longer</span>
    <span class="ruby-comment">#  documented and may go away someday.  Not sure if there there are</span>
    <span class="ruby-comment">#  versions that only support -L, which would make this change risky?</span>
    <span class="ruby-comment">#  http://osdir.com/ml/bug-gnu-utils-gnu/2010-12/msg00060.html</span>
    <span class="ruby-comment">#    (&quot;man diff&quot; should actually document the best migration strategy,</span>
    <span class="ruby-comment">#  [current behavior, future changes, old compatibility issues</span>
    <span class="ruby-comment">#  or lack thereof, etc], not just stop mentioning the option...)</span>
    <span class="ruby-comment"># TODO: Real CVS seems to include a date in the label, before</span>
    <span class="ruby-comment">#  the revision part, without the keyword &quot;revision&quot;.  The following</span>
    <span class="ruby-comment">#  has minimal changes compared to original versions of</span>
    <span class="ruby-comment">#  git-cvsserver.perl.  (Mostly tab vs space after filename.)</span>

    <span class="ruby-identifier">my</span> (<span class="ruby-ivar">@diffCmd</span>) = ( <span class="ruby-string">&#39;diff&#39;</span> );
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-constant">N</span>}) )
    {
        <span class="ruby-identifier">push</span> <span class="ruby-ivar">@diffCmd</span>,<span class="ruby-string">&quot;-N&quot;</span>;
    }
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">exists</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-identifier">u</span>} )
    {
        <span class="ruby-identifier">push</span> <span class="ruby-ivar">@diffCmd</span>,(<span class="ruby-string">&quot;-u&quot;</span>,<span class="ruby-string">&quot;-L&quot;</span>);
        <span class="ruby-keyword">if</span>( <span class="ruby-identifier">$meta1</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;deleted&quot;</span> )
        {
            <span class="ruby-identifier">push</span> <span class="ruby-ivar">@diffCmd</span>,<span class="ruby-string">&quot;/dev/null&quot;</span>;
        } <span class="ruby-keyword">else</span> {
            <span class="ruby-identifier">push</span> <span class="ruby-ivar">@diffCmd</span>,(<span class="ruby-string">&quot;$argFilename\trevision $meta1-&gt;{revision}&quot;</span>);
        }

        <span class="ruby-keyword">if</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$meta2</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>}) )
        {
            <span class="ruby-keyword">if</span>( <span class="ruby-identifier">$meta2</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;deleted&quot;</span> )
            {
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@diffCmd</span>,(<span class="ruby-string">&quot;-L&quot;</span>,<span class="ruby-string">&quot;/dev/null&quot;</span>);
            } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@diffCmd</span>,(<span class="ruby-string">&quot;-L&quot;</span>,
                               <span class="ruby-string">&quot;$argFilename\trevision $meta2-&gt;{revision}&quot;</span>);
            }
        } <span class="ruby-keyword">else</span> {
            <span class="ruby-identifier">push</span> <span class="ruby-ivar">@diffCmd</span>,(<span class="ruby-string">&quot;-L&quot;</span>,<span class="ruby-string">&quot;$argFilename\tworking copy&quot;</span>);
        }
    }
    <span class="ruby-identifier">push</span> <span class="ruby-ivar">@diffCmd</span>,(<span class="ruby-identifier">$file1</span>,<span class="ruby-identifier">$file2</span>);
    <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">open</span>(<span class="ruby-constant">DIFF</span>,<span class="ruby-string">&quot;-|&quot;</span>,<span class="ruby-ivar">@diffCmd</span>))
    {
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Unable to run diff: $!&quot;</span>);
    }
    <span class="ruby-identifier">my</span>(<span class="ruby-identifier">$diffLine</span>);
    <span class="ruby-keyword">while</span>(<span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$diffLine</span>=<span class="ruby-operator">&lt;</span><span class="ruby-constant">DIFF</span><span class="ruby-operator">&gt;</span>))
    {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;M $diffLine&quot;</span>;
        <span class="ruby-identifier">$foundDiff</span>=<span class="ruby-value">1</span>;
    }
    <span class="ruby-identifier">close</span>(<span class="ruby-constant">DIFF</span>);
}

<span class="ruby-keyword">if</span>(<span class="ruby-identifier">$foundDiff</span>)
{
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error  \n&quot;</span>;
}
<span class="ruby-keyword">else</span>
{
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ok\n&quot;</span>;
}
</pre>

<p>}</p>

<p>sub req_log {</p>

<pre>my ( $cmd, $data ) = @_;

argsplit(&quot;log&quot;);

$log-&gt;debug(&quot;req_log : &quot; . ( defined($data) ? $data : &quot;[NULL]&quot; ));
#$log-&gt;debug(&quot;log state : &quot; . Dumper($state));

my ( $revFilter );
if ( defined ( $state-&gt;{opt}{r} ) )
{
    $revFilter = $state-&gt;{opt}{r};
}

# Grab a handle to the SQLite db and do any necessary updates
my $updater;
$updater = GITCVS::updater-&gt;new($state-&gt;{CVSROOT}, $state-&gt;{module}, $log);
$updater-&gt;update();

# if no files were specified, we need to work out what files we
# should be providing status on ...
argsfromdir($updater);

# foreach file specified on the command line ...
foreach my $filename ( @{$state-&gt;{args}} )
{
    $filename = filecleanup($filename);

    my $headmeta = $updater-&gt;getmeta($filename);

    my ($revisions,$totalrevisions) = $updater-&gt;getlog($filename,
                                                       $revFilter);

    next unless ( scalar(@$revisions) );

    print &quot;M \n&quot;;
    print &quot;M RCS file: $state-&gt;{CVSROOT}/$state-&gt;{module}/$filename,v\n&quot;;
    print &quot;M Working file: $filename\n&quot;;
    print &quot;M head: $headmeta-&gt;{revision}\n&quot;;
    print &quot;M branch:\n&quot;;
    print &quot;M locks: strict\n&quot;;
    print &quot;M access list:\n&quot;;
    print &quot;M symbolic names:\n&quot;;
    print &quot;M keyword substitution: kv\n&quot;;
    print &quot;M total revisions: $totalrevisions;\tselected revisions: &quot; .
          scalar(@$revisions) . &quot;\n&quot;;
    print &quot;M description:\n&quot;;

    foreach my $revision ( @$revisions )
    {
        print &quot;M ----------------------------\n&quot;;
        print &quot;M revision $revision-&gt;{revision}\n&quot;;
        # reformat the date for log output
        if ( $revision-&gt;{modified} =~ /(\d+)\s+(\w+)\s+(\d+)\s+(\S+)/ and
             defined($DATE_LIST-&gt;{$2}) )
        {
            $revision-&gt;{modified} = sprintf(&#39;%04d/%02d/%02d %s&#39;,
                                        $3, $DATE_LIST-&gt;{$2}, $1, $4 );
        }
        $revision-&gt;{author} = cvs_author($revision-&gt;{author});
        print &quot;M date: $revision-&gt;{modified};&quot; .
              &quot;  author: $revision-&gt;{author};  state: &quot; .
              ( $revision-&gt;{filehash} eq &quot;deleted&quot; ? &quot;dead&quot; : &quot;Exp&quot; ) .
              &quot;;  lines: +2 -3\n&quot;;
        my $commitmessage;
        $commitmessage = $updater-&gt;commitmessage($revision-&gt;{commithash});
        $commitmessage =~ s/^/M /mg;
        print $commitmessage . &quot;\n&quot;;
    }
    print &quot;M =======&quot; . ( &quot;=&quot; x 70 ) . &quot;\n&quot;;
}

print &quot;ok\n&quot;;</pre>

<p>}</p>

<p>sub req_annotate {</p>

<pre>my ( $cmd, $data ) = @_;

argsplit(&quot;annotate&quot;);

$log-&gt;info(&quot;req_annotate : &quot; . ( defined($data) ? $data : &quot;[NULL]&quot; ));
#$log-&gt;debug(&quot;status state : &quot; . Dumper($state));

# Grab a handle to the SQLite db and do any necessary updates
my $updater = GITCVS::updater-&gt;new($state-&gt;{CVSROOT}, $state-&gt;{module}, $log);
$updater-&gt;update();

# if no files were specified, we need to work out what files we should be providing annotate on ...
argsfromdir($updater);

# we&#39;ll need a temporary checkout dir
setupWorkTree();

$log-&gt;info(&quot;Temp checkoutdir creation successful, basing annotate session work on &#39;$work-&gt;{workDir}&#39;, index file is &#39;$ENV{GIT_INDEX_FILE}&#39;&quot;);

# foreach file specified on the command line ...
foreach my $filename ( @{$state-&gt;{args}} )
{
    $filename = filecleanup($filename);

    my $meta = $updater-&gt;getmeta($filename);

    next unless ( $meta-&gt;{revision} );

    # get all the commits that this file was in
    # in dense format -- aka skip dead revisions
    my $revisions   = $updater-&gt;gethistorydense($filename);
    my $lastseenin  = $revisions-&gt;[0][2];

    # populate the temporary index based on the latest commit were we saw
    # the file -- but do it cheaply without checking out any files
    # TODO: if we got a revision from the client, use that instead
    # to look up the commithash in sqlite (still good to default to
    # the current head as we do now)
    system(&quot;git&quot;, &quot;read-tree&quot;, $lastseenin);
    unless ($? == 0)
    {
        print &quot;E error running git-read-tree $lastseenin $ENV{GIT_INDEX_FILE} $!\n&quot;;
        return;
    }
    $log-&gt;info(&quot;Created index &#39;$ENV{GIT_INDEX_FILE}&#39; with commit $lastseenin - exit status $?&quot;);

    # do a checkout of the file
    system(&#39;git&#39;, &#39;checkout-index&#39;, &#39;-f&#39;, &#39;-u&#39;, $filename);
    unless ($? == 0) {
        print &quot;E error running git-checkout-index -f -u $filename : $!\n&quot;;
        return;
    }

    $log-&gt;info(&quot;Annotate $filename&quot;);

    # Prepare a file with the commits from the linearized
    # history that annotate should know about. This prevents
    # git-jsannotate telling us about commits we are hiding
    # from the client.

    my $a_hints = &quot;$work-&gt;{workDir}/.annotate_hints&quot;;
    if (!open(ANNOTATEHINTS, &#39;&gt;&#39;, $a_hints)) {
        print &quot;E failed to open &#39;$a_hints&#39; for writing: $!\n&quot;;
        return;
    }
    for (my $i=0; $i &lt; @$revisions; $i++)
    {
        print ANNOTATEHINTS $revisions-&gt;[$i][2];
        if ($i+1 &lt; @$revisions) { # have we got a parent?
            print ANNOTATEHINTS &#39; &#39; . $revisions-&gt;[$i+1][2];
        }
        print ANNOTATEHINTS &quot;\n&quot;;
    }

    print ANNOTATEHINTS &quot;\n&quot;;
    close ANNOTATEHINTS
        or (print &quot;E failed to write $a_hints: $!\n&quot;), return;

    my @cmd = (qw(git annotate -l -S), $a_hints, $filename);
    if (!open(ANNOTATE, &quot;-|&quot;, @cmd)) {
        print &quot;E error invoking &quot;. join(&#39; &#39;,@cmd) .&quot;: $!\n&quot;;
        return;
    }
    my $metadata = {};
    print &quot;E Annotations for $filename\n&quot;;
    print &quot;E ***************\n&quot;;
    while ( &lt;ANNOTATE&gt; )
    {
        if (m/^([a-zA-Z0-9]{40})\t\([^\)]*\)(.*)$/i)
        {
            my $commithash = $1;
            my $data = $2;
            unless ( defined ( $metadata-&gt;{$commithash} ) )
            {
                $metadata-&gt;{$commithash} = $updater-&gt;getmeta($filename, $commithash);
                $metadata-&gt;{$commithash}{author} = cvs_author($metadata-&gt;{$commithash}{author});
                $metadata-&gt;{$commithash}{modified} = sprintf(&quot;%02d-%s-%02d&quot;, $1, $2, $3) if ( $metadata-&gt;{$commithash}{modified} =~ /^(\d+)\s(\w+)\s\d\d(\d\d)/ );
            }
            printf(&quot;M %-7s      (%-8s %10s): %s\n&quot;,
                $metadata-&gt;{$commithash}{revision},
                $metadata-&gt;{$commithash}{author},
                $metadata-&gt;{$commithash}{modified},
                $data
            );
        } else {
            $log-&gt;warn(&quot;Error in annotate output! LINE: $_&quot;);
            print &quot;E Annotate error \n&quot;;
            next;
        }
    }
    close ANNOTATE;
}

# done; get out of the tempdir
cleanupWorkTree();

print &quot;ok\n&quot;;</pre>

<p>}</p>

<p># This method takes the state-&gt;{arguments} array and produces two new
arrays. # The first is $state-&gt;{args} which is everything before the
&#39;–&#39; argument, and # the second is $state-&gt;{files} which is
everything after it. sub argsplit {</p>

<pre class="ruby"><span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>} = [];
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">files</span>} = [];
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>} = {};

<span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>}) <span class="ruby-keyword">and</span> <span class="ruby-identifier">ref</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;ARRAY&quot;</span> );

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$type</span> = <span class="ruby-identifier">shift</span>;

<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$type</span>) )
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$opt</span> = {};
    <span class="ruby-identifier">$opt</span> = { <span class="ruby-constant">A</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">N</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">P</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">R</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">c</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">f</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">l</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">n</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">p</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">s</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">r</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-constant">D</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">k</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">j</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, } <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;co&quot;</span> );
    <span class="ruby-identifier">$opt</span> = { <span class="ruby-identifier">v</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">l</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">R</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> } <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;status&quot;</span> );
    <span class="ruby-identifier">$opt</span> = { <span class="ruby-constant">A</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">P</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">C</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">f</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">l</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">R</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">p</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">k</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">r</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-constant">D</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">j</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-constant">I</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-constant">W</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> } <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;update&quot;</span> );
    <span class="ruby-identifier">$opt</span> = { <span class="ruby-identifier">l</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">R</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">k</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-constant">D</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-constant">D</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">r</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>, <span class="ruby-constant">N</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> } <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;diff&quot;</span> );
    <span class="ruby-identifier">$opt</span> = { <span class="ruby-identifier">c</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">R</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">l</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">f</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">F</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">m</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">r</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> } <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;ci&quot;</span> );
    <span class="ruby-identifier">$opt</span> = { <span class="ruby-identifier">k</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">m</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> } <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;add&quot;</span> );
    <span class="ruby-identifier">$opt</span> = { <span class="ruby-identifier">f</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">l</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">R</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> } <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;remove&quot;</span> );
    <span class="ruby-identifier">$opt</span> = { <span class="ruby-identifier">l</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">b</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">h</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">R</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">t</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">N</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-constant">S</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">r</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">s</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">w</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> } <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;log&quot;</span> );

    <span class="ruby-keyword">while</span> ( <span class="ruby-identifier">scalar</span> ( @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>}} ) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
    {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$arg</span> = <span class="ruby-identifier">shift</span> @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>}};

        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$arg</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;--&quot;</span> );
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$arg</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\S/</span> );

        <span class="ruby-comment"># if the argument looks like a switch</span>
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$arg</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^-(\w)(.*)/</span> )
        {
            <span class="ruby-comment"># if it&#39;s a switch that takes an argument</span>
            <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$opt</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-node">$1</span>} )
            {
                <span class="ruby-comment"># If this switch has already been provided</span>
                <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$opt</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-node">$1</span>} <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">exists</span> ( <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-node">$1</span>} ) )
                {
                    <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-node">$1</span>} = [ <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-node">$1</span>} ];
                    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">length</span>(<span class="ruby-node">$2</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
                    {
                        <span class="ruby-identifier">push</span> @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-node">$1</span>}},<span class="ruby-node">$2</span>;
                    } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">push</span> @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-node">$1</span>}}, <span class="ruby-identifier">shift</span> @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>}};
                    }
                } <span class="ruby-keyword">else</span> {
                    <span class="ruby-comment"># if there&#39;s extra data in the arg, use that as the argument for the switch</span>
                    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">length</span>(<span class="ruby-node">$2</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
                    {
                        <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-node">$1</span>} = <span class="ruby-node">$2</span>;
                    } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-node">$1</span>} = <span class="ruby-identifier">shift</span> @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>}};
                    }
                }
            } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">opt</span>}{<span class="ruby-node">$1</span>} = <span class="ruby-keyword">undef</span>;
            }
        }
        <span class="ruby-keyword">else</span>
        {
            <span class="ruby-identifier">push</span> @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>}}, <span class="ruby-identifier">$arg</span>;
        }
    }
}
<span class="ruby-keyword">else</span>
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$mode</span> = <span class="ruby-value">0</span>;

    <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$value</span> ( @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">arguments</span>}} )
    {
        <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$value</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;--&quot;</span> )
        {
            <span class="ruby-identifier">$mode</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
            <span class="ruby-keyword">next</span>;
        }
        <span class="ruby-identifier">push</span> @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>}}, <span class="ruby-identifier">$value</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$mode</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> );
        <span class="ruby-identifier">push</span> @{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">files</span>}}, <span class="ruby-identifier">$value</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$mode</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> );
    }
}
</pre>

<p>}</p>

<p># Used by argsfromdir sub expandArg {</p>

<pre>my ($updater,$outNameMap,$outDirMap,$path,$isDir) = @_;

my $fullPath = filecleanup($path);

  # Is it a directory?
if( defined($state-&gt;{dirMap}{$fullPath}) ||
    defined($state-&gt;{dirMap}{&quot;$fullPath/&quot;}) )
{
      # It is a directory in the user&#39;s sandbox.
    $isDir=1;

    if(defined($state-&gt;{entries}{$fullPath}))
    {
        $log-&gt;fatal(&quot;Inconsistent file/dir type&quot;);
        die &quot;Inconsistent file/dir type&quot;;
    }
}
elsif(defined($state-&gt;{entries}{$fullPath}))
{
      # It is a file in the user&#39;s sandbox.
    $isDir=0;
}
my($revDirMap,$otherRevDirMap);
if(!defined($isDir) || $isDir)
{
      # Resolve version tree for sticky tag:
      # (for now we only want list of files for the version, not
      # particular versions of those files: assume it is a directory
      # for the moment; ignore Entry&#39;s stick tag)

      # Order of precedence of sticky tags:
      #    -A       [head]
      #    -r /tag/
      #    [file entry sticky tag, but that is only relevant to files]
      #    [the tag specified in dir req_Sticky]
      #    [the tag specified in a parent dir req_Sticky]
      #    [head]
      # Also, -r may appear twice (for diff).
      #
      # FUTURE: When/if -j (merges) are supported, we also
      #  need to add relevant files from one or two
      #  versions specified with -j.

    if(exists($state-&gt;{opt}{A}))
    {
        $revDirMap=$updater-&gt;getRevisionDirMap();
    }
    elsif( defined($state-&gt;{opt}{r}) and
           ref $state-&gt;{opt}{r} eq &quot;ARRAY&quot; )
    {
        $revDirMap=$updater-&gt;getRevisionDirMap($state-&gt;{opt}{r}[0]);
        $otherRevDirMap=$updater-&gt;getRevisionDirMap($state-&gt;{opt}{r}[1]);
    }
    elsif(defined($state-&gt;{opt}{r}))
    {
        $revDirMap=$updater-&gt;getRevisionDirMap($state-&gt;{opt}{r});
    }
    else
    {
        my($sticky)=getDirStickyInfo($fullPath);
        $revDirMap=$updater-&gt;getRevisionDirMap($sticky-&gt;{tag});
    }

      # Is it a directory?
    if( defined($revDirMap-&gt;{$fullPath}) ||
        defined($otherRevDirMap-&gt;{$fullPath}) )
    {
        $isDir=1;
    }
}

  # What to do with it?
if(!$isDir)
{
    $outNameMap-&gt;{$fullPath}=1;
}
else
{
    $outDirMap-&gt;{$fullPath}=1;

    if(defined($revDirMap-&gt;{$fullPath}))
    {
        addDirMapFiles($updater,$outNameMap,$outDirMap,
                       $revDirMap-&gt;{$fullPath});
    }
    if( defined($otherRevDirMap) &amp;&amp;
        defined($otherRevDirMap-&gt;{$fullPath}) )
    {
        addDirMapFiles($updater,$outNameMap,$outDirMap,
                       $otherRevDirMap-&gt;{$fullPath});
    }
}</pre>

<p>}</p>

<p># Used by argsfromdir # Add entries from dirMap to outNameMap.  Also
recurse into entries # that are subdirectories. sub addDirMapFiles {</p>

<pre>my($updater,$outNameMap,$outDirMap,$dirMap)=@_;

my($fullName);
foreach $fullName (keys(%$dirMap))
{
    my $cleanName=$fullName;
    if(defined($state-&gt;{prependdir}))
    {
        if(!($cleanName=~s/^\Q$state-&gt;{prependdir}\E//))
        {
            $log-&gt;fatal(&quot;internal error stripping prependdir&quot;);
            die &quot;internal error stripping prependdir&quot;;
        }
    }

    if($dirMap-&gt;{$fullName} eq &quot;F&quot;)
    {
        $outNameMap-&gt;{$cleanName}=1;
    }
    elsif($dirMap-&gt;{$fullName} eq &quot;D&quot;)
    {
        if(!$state-&gt;{opt}{l})
        {
            expandArg($updater,$outNameMap,$outDirMap,$cleanName,1);
        }
    }
    else
    {
        $log-&gt;fatal(&quot;internal error in addDirMapFiles&quot;);
        die &quot;internal error in addDirMapFiles&quot;;
    }
}</pre>

<p>}</p>

<p># This method replaces $state-&gt;{args} with a directory-expanded # list
of all relevant filenames (recursively unless -d), based # on
$state-&gt;{entries}, and the “current” list of files in # each directory. 
“Current” files as determined by # either the requested (-r/-A) or
“req_Sticky” version of # that directory. #    Both the input args and the
new output args are relative # to the cvs-client&#39;s CWD, although some
of the internal # computations are relative to the top of the project. sub
argsfromdir {</p>

<pre>my $updater = shift;

# Notes about requirements for specific callers:
#   update # &quot;standard&quot; case (entries; a single -r/-A/default; -l)
#          # Special case: -d for create missing directories.
#   diff # 0 or 1 -r&#39;s: &quot;standard&quot; case.
#        # 2 -r&#39;s: We could ignore entries (just use the two -r&#39;s),
#        # but it doesn&#39;t really matter.
#   annotate # &quot;standard&quot; case
#   log # Punting: log -r has a more complex non-&quot;standard&quot;
#       # meaning, and we don&#39;t currently try to support log&#39;ing
#       # branches at all (need a lot of work to
#       # support CVS-consistent branch relative version
#       # numbering).</pre>

<p>#HERE: But we still want to expand directories.  Maybe we should # 
essentially force “-A”.</p>

<pre class="ruby"><span class="ruby-comment">#   status # &quot;standard&quot;, except that -r/-A/default are not possible.</span>
<span class="ruby-comment">#          # Mostly only used to expand entries only)</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># Don&#39;t use argsfromdir at all:</span>
<span class="ruby-comment">#   add # Explicit arguments required.  Directory args imply add</span>
<span class="ruby-comment">#       # the directory itself, not the files in it.</span>
<span class="ruby-comment">#   co  # Obtain list directly.</span>
<span class="ruby-comment">#   remove # HERE: TEST: MAYBE client does the recursion for us,</span>
<span class="ruby-comment">#          # since it only makes sense to remove stuff already in</span>
<span class="ruby-comment">#          # the sandobx?</span>
<span class="ruby-comment">#   ci # HERE: Similar to remove...</span>
<span class="ruby-comment">#      # Don&#39;t try to implement the confusing/weird</span>
<span class="ruby-comment">#      # ci -r bug er..&quot;feature&quot;.</span>

<span class="ruby-keyword">if</span>(<span class="ruby-identifier">scalar</span>(@{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>}})<span class="ruby-operator">==</span><span class="ruby-value">0</span>)
{
    <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>} = [ <span class="ruby-string">&quot;.&quot;</span> ];
}
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">llArgs</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">llDirs</span>;
<span class="ruby-keyword">for</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file</span> (@{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>}})
{
    <span class="ruby-identifier">expandArg</span>(<span class="ruby-identifier">$updater</span>,\<span class="ruby-operator">%</span><span class="ruby-identifier">llArgs</span>,\<span class="ruby-operator">%</span><span class="ruby-identifier">llDirs</span>,<span class="ruby-identifier">$file</span>);
}

<span class="ruby-comment"># Include any entries from sandbox.  Generally client won&#39;t</span>
<span class="ruby-comment"># send entries that shouldn&#39;t be used.</span>
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file</span> (<span class="ruby-identifier">keys</span> <span class="ruby-string">%Q{$state-&gt;{entries}}</span>)
{
    <span class="ruby-identifier">$allArgs</span>{<span class="ruby-identifier">remove_prependdir</span>(<span class="ruby-identifier">$file</span>)} = <span class="ruby-value">1</span>;
}

<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dirArgs</span>} = \<span class="ruby-operator">%</span><span class="ruby-identifier">llDirs</span>;
<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">args</span>} = [
    <span class="ruby-identifier">sort</span> {
            <span class="ruby-comment"># Sort priority: by directory depth, then actual file name:</span>
        <span class="ruby-identifier">my</span> <span class="ruby-ivar">@piecesA</span>=<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>,<span class="ruby-identifier">$a</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-ivar">@piecesB</span>=<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>,<span class="ruby-identifier">$b</span>);

        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$count</span>=<span class="ruby-identifier">scalar</span>(<span class="ruby-ivar">@piecesA</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$tmp</span>=<span class="ruby-identifier">scalar</span>(<span class="ruby-ivar">@piecesB</span>);
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$count</span><span class="ruby-operator">&lt;=&gt;</span><span class="ruby-identifier">$tmp</span> <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$count</span><span class="ruby-operator">!=</span><span class="ruby-identifier">$tmp</span>);

        <span class="ruby-keyword">for</span>(<span class="ruby-identifier">$tmp</span>=<span class="ruby-value">0</span>;<span class="ruby-identifier">$tmp</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">$count</span>;<span class="ruby-identifier">$tmp</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>)
        {
            <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$piecesA</span>[<span class="ruby-identifier">$tmp</span>] <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$piecesB</span>[<span class="ruby-identifier">$tmp</span>])
            {
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">$piecesA</span>[<span class="ruby-identifier">$tmp</span>] <span class="ruby-identifier">cmp</span> <span class="ruby-identifier">$piecesB</span>[<span class="ruby-identifier">$tmp</span>]
            }
        }
        <span class="ruby-keyword">return</span> <span class="ruby-value">0</span>;
    } <span class="ruby-identifier">keys</span>(<span class="ruby-operator">%</span><span class="ruby-identifier">llArgs</span>) ];
</pre>

<p>}</p>

<p>## look up directory sticky tag, of either fullPath or a parent: sub
getDirStickyInfo {</p>

<pre>my($fullPath)=@_;

$fullPath=~s%/+$%%;
while($fullPath ne &quot;&quot; &amp;&amp; !defined($state-&gt;{dirMap}{&quot;$fullPath/&quot;}))
{
    $fullPath=~s%/?[^/]*$%%;
}

if( !defined($state-&gt;{dirMap}{&quot;$fullPath/&quot;}) &amp;&amp;
    ( $fullPath eq &quot;&quot; ||
      $fullPath eq &quot;.&quot; ) )
{
    return $state-&gt;{dirMap}{&quot;&quot;}{stickyInfo};
}
else
{
    return $state-&gt;{dirMap}{&quot;$fullPath/&quot;}{stickyInfo};
}</pre>

<p>}</p>

<p># Resolve precedence of various ways of specifying which version of # a
file you want.  Returns undef (for default head), or a ref to a hash # that
contains “tag” and/or “date” keys. sub resolveStickyInfo {</p>

<pre class="ruby"><span class="ruby-identifier">my</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-identifier">$stickyTag</span>,<span class="ruby-identifier">$stickyDate</span>,<span class="ruby-identifier">$reset</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-comment"># Order of precedence of sticky tags:</span>
<span class="ruby-comment">#    -A       [head]</span>
<span class="ruby-comment">#    -r /tag/</span>
<span class="ruby-comment">#    [file entry sticky tag]</span>
<span class="ruby-comment">#    [the tag specified in dir req_Sticky]</span>
<span class="ruby-comment">#    [the tag specified in a parent dir req_Sticky]</span>
<span class="ruby-comment">#    [head]</span>

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$result</span>;
<span class="ruby-keyword">if</span>(<span class="ruby-identifier">$reset</span>)
{
    <span class="ruby-comment"># $result=undef;</span>
}
<span class="ruby-keyword">elsif</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyTag</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$stickyTag</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;&quot;</span> )
       <span class="ruby-comment"># || ( defined($stickyDate) &amp;&amp; $stickyDate ne &quot;&quot; )   # TODO</span>
{
    <span class="ruby-identifier">$result</span>={ <span class="ruby-string">&#39;tag&#39;</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$stickyTag</span>)<span class="ruby-operator">?</span><span class="ruby-identifier">$stickyTag</span><span class="ruby-operator">:</span><span class="ruby-keyword">undef</span>) };

    <span class="ruby-comment"># TODO: Convert -D value into the form 2011.04.10.04.46.57,</span>
    <span class="ruby-comment">#   similar to an entry line&#39;s sticky date, without the D prefix.</span>
    <span class="ruby-comment">#   It sometimes (always?) arrives as something more like</span>
    <span class="ruby-comment">#   &#39;10 Apr 2011 04:46:57 -0000&#39;...</span>
    <span class="ruby-comment"># $result={ &#39;date&#39; =&gt; (defined($stickyDate)?$stickyDate:undef) };</span>
}
<span class="ruby-keyword">elsif</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}) <span class="ruby-operator">&amp;&amp;</span>
       <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">tag_or_date</span>}) <span class="ruby-operator">&amp;&amp;</span>
       <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">tag_or_date</span>} <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;&quot;</span> )
{
    <span class="ruby-identifier">my</span>(<span class="ruby-identifier">$tagOrDate</span>)=<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">entries</span>}{<span class="ruby-identifier">$filename</span>}{<span class="ruby-identifier">tag_or_date</span>};
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$tagOrDate</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^T([^ ]+)\s*$/</span>)
    {
        <span class="ruby-identifier">$result</span> = { <span class="ruby-string">&#39;tag&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span> };
    }
    <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">$tagOrDate</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^D([0-9.]+)\s*$/</span>)
    {
        <span class="ruby-identifier">$result</span>= { <span class="ruby-string">&#39;date&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span> };
    }
    <span class="ruby-keyword">else</span>
    {
        <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Unknown tag_or_date format\n&quot;</span>;
    }
}
<span class="ruby-keyword">else</span>
{
    <span class="ruby-identifier">$result</span>=<span class="ruby-identifier">getDirStickyInfo</span>(<span class="ruby-identifier">$filename</span>);
}

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$result</span>;
</pre>

<p>}</p>

<p># Convert a stickyInfo (ref to a hash) as returned by resolveStickyInfo
into # a form appropriate for the sticky tag field of an Entries # line
(field index 5, 0-based). sub getStickyTagOrDate {</p>

<pre>my($stickyInfo)=@_;

my $result;
if(defined($stickyInfo) &amp;&amp; defined($stickyInfo-&gt;{tag}))
{
    $result=&quot;T$stickyInfo-&gt;{tag}&quot;;
}
# TODO: When/if we actually pick versions by {date} properly,
#   also handle it here:
#   &quot;D$stickyInfo-&gt;{date}&quot; (example: &quot;D2011.04.13.20.37.07&quot;).
else
{
    $result=&quot;&quot;;
}

return $result;</pre>

<p>}</p>

<p># This method cleans up the $state variable after a command that uses
arguments has run sub statecleanup {</p>

<pre>$state-&gt;{files} = [];
$state-&gt;{dirArgs} = {};
$state-&gt;{args} = [];
$state-&gt;{arguments} = [];
$state-&gt;{entries} = {};
$state-&gt;{dirMap} = {};</pre>

<p>}</p>

<p># Return working directory CVS revision “1.X” out # of the the working
directory “entries” state, for the given filename. # This is prefixed with
a dash if the file is scheduled for removal # when it is committed. sub
revparse {</p>

<pre>my $filename = shift;

return $state-&gt;{entries}{$filename}{revision};</pre>

<p>}</p>

<p># This method takes a file hash and does a CVS “file transfer”.  Its #
exact behaviour depends on a second, optional hash table argument: # - If
$options-&gt;{targetfile}, dump the contents to that file; # - If
$options-&gt;{print}, use M/MT to transmit the contents one line #   at a
time; # - Otherwise, transmit the size of the file, followed by the file # 
contents. sub transmitfile {</p>

<pre>my $filehash = shift;
my $options = shift;

if ( defined ( $filehash ) and $filehash eq &quot;deleted&quot; )
{
    $log-&gt;warn(&quot;filehash is &#39;deleted&#39;&quot;);
    return;
}

die &quot;Need filehash&quot; unless ( defined ( $filehash ) and $filehash =~ /^[a-zA-Z0-9]{40}$/ );

my $type = `git cat-file -t $filehash`;
chomp $type;

die ( &quot;Invalid type &#39;$type&#39; (expected &#39;blob&#39;)&quot; ) unless ( defined ( $type ) and $type eq &quot;blob&quot; );

my $size = `git cat-file -s $filehash`;
chomp $size;

$log-&gt;debug(&quot;transmitfile($filehash) size=$size, type=$type&quot;);

if ( open my $fh, &#39;-|&#39;, &quot;git&quot;, &quot;cat-file&quot;, &quot;blob&quot;, $filehash )
{
    if ( defined ( $options-&gt;{targetfile} ) )
    {
        my $targetfile = $options-&gt;{targetfile};
        open NEWFILE, &quot;&gt;&quot;, $targetfile or die(&quot;Couldn&#39;t open &#39;$targetfile&#39; for writing : $!&quot;);
        print NEWFILE $_ while ( &lt;$fh&gt; );
        close NEWFILE or die(&quot;Failed to write &#39;$targetfile&#39;: $!&quot;);
    } elsif ( defined ( $options-&gt;{print} ) &amp;&amp; $options-&gt;{print} ) {
        while ( &lt;$fh&gt; ) {
            if( /\n\z/ ) {
                print &#39;M &#39;, $_;
            } else {
                print &#39;MT text &#39;, $_, &quot;\n&quot;;
            }
        }
    } else {
        print &quot;$size\n&quot;;
        print while ( &lt;$fh&gt; );
    }
    close $fh or die (&quot;Couldn&#39;t close filehandle for transmitfile(): $!&quot;);
} else {
    die(&quot;Couldn&#39;t execute git-cat-file&quot;);
}</pre>

<p>}</p>

<p># This method takes a file name, and returns ( $dirpart, $filepart ) which
# refers to the directory portion and the file portion of the filename #
respectively sub filenamesplit {</p>

<pre>my $filename = shift;
my $fixforlocaldir = shift;

my ( $filepart, $dirpart ) = ( $filename, &quot;.&quot; );
( $filepart, $dirpart ) = ( $2, $1 ) if ( $filename =~ /(.*)\/(.*)/ );
$dirpart .= &quot;/&quot;;

if ( $fixforlocaldir )
{
    $dirpart =~ s/^$state-&gt;{prependdir}//;
}

return ( $filepart, $dirpart );</pre>

<p>}</p>

<p># Cleanup various junk in filename (try to canonicalize it), and # add
prependdir to accommodate running CVS client from a # subdirectory (so the
output is relative to top directory of the project). sub filecleanup {</p>

<pre>my $filename = shift;

return undef unless(defined($filename));
if ( $filename =~ /^\// )
{
    print &quot;E absolute filenames &#39;$filename&#39; not supported by server\n&quot;;
    return undef;
}

if($filename eq &quot;.&quot;)
{
    $filename=&quot;&quot;;
}
$filename =~ s/^\.\///g;
$filename =~ s%/+%/%g;
$filename = $state-&gt;{prependdir} . $filename;
$filename =~ s%/$%%;
return $filename;</pre>

<p>}</p>

<p># Remove prependdir from the path, so that is is relative to the directory
# the CVS client was started from, rather than the top of the project. #
Essentially the inverse of filecleanup(). sub remove_prependdir {</p>

<pre>my($path) = @_;
if(defined($state-&gt;{prependdir}) &amp;&amp; $state-&gt;{prependdir} ne &quot;&quot;)
{
    my($pre)=$state-&gt;{prependdir};
    $pre=~s%/$%%;
    if(!($path=~s%^\Q$pre\E/?%%))
    {
        $log-&gt;fatal(&quot;internal error missing prependdir&quot;);
        die(&quot;internal error missing prependdir&quot;);
    }
}
return $path;</pre>

<p>}</p>

<p>sub validateGitDir {</p>

<pre>if( !defined($state-&gt;{CVSROOT}) )
{
    print &quot;error 1 CVSROOT not specified\n&quot;;
    cleanupWorkTree();
    exit;
}
if( $ENV{GIT_DIR} ne ($state-&gt;{CVSROOT} . &#39;/&#39;) )
{
    print &quot;error 1 Internally inconsistent CVSROOT\n&quot;;
    cleanupWorkTree();
    exit;
}</pre>

<p>}</p>

<p># Setup working directory in a work tree with the requested version #
loaded in the index. sub setupWorkTree {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$ver</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">validateGitDir</span>();

<span class="ruby-keyword">if</span>( ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">state</span>}) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">state</span>} <span class="ruby-operator">!=</span> <span class="ruby-value">1</span> ) <span class="ruby-operator">||</span>
    <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tmpDir</span>}) )
{
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Bad work tree state management&quot;</span>);
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 Internal setup multiple work trees without cleanup\n&quot;</span>;
    <span class="ruby-identifier">cleanupWorkTree</span>();
    <span class="ruby-identifier">exit</span>;
}

<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">workDir</span>} = <span class="ruby-identifier">tempdir</span> ( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span> );

<span class="ruby-keyword">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">index</span>}) )
{
    (<span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">index</span>}) = <span class="ruby-identifier">tempfile</span> ( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span>, <span class="ruby-constant">OPEN</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> );
}

<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">workDir</span>} <span class="ruby-keyword">or</span>
    <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Unable to chdir to $work-&gt;{workDir}\n&quot;</span>;

<span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">info</span>(<span class="ruby-string">&quot;Setting up GIT_WORK_TREE as &#39;.&#39; in &#39;$work-&gt;{workDir}&#39;, index file is &#39;$work-&gt;{index}&#39;&quot;</span>);

<span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_WORK_TREE</span>} = <span class="ruby-string">&quot;.&quot;</span>;
<span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_INDEX_FILE</span>} = <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">index</span>};
<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">state</span>} = <span class="ruby-value">2</span>;

<span class="ruby-keyword">if</span>(<span class="ruby-identifier">$ver</span>)
{
    <span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git&quot;</span>,<span class="ruby-string">&quot;read-tree&quot;</span>,<span class="ruby-identifier">$ver</span>);
    <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$?</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
    {
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Error running git-read-tree&quot;</span>);
        <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Error running git-read-tree $ver in $work-&gt;{workDir} $!\n&quot;</span>;
    }
}
<span class="ruby-comment"># else # req_annotate reads tree for each file</span>
</pre>

<p>}</p>

<p># Ensure current directory is in some kind of working directory, # with a
recent version loaded in the index. sub ensureWorkTree {</p>

<pre class="ruby"><span class="ruby-keyword">if</span>( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tmpDir</span>}) )
{
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Bad work tree state management [ensureWorkTree()]&quot;</span>);
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 Internal setup multiple dirs without cleanup\n&quot;</span>;
    <span class="ruby-identifier">cleanupWorkTree</span>();
    <span class="ruby-identifier">exit</span>;
}
<span class="ruby-keyword">if</span>( <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">state</span>} )
{
    <span class="ruby-keyword">return</span>;
}

<span class="ruby-identifier">validateGitDir</span>();

<span class="ruby-keyword">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">emptyDir</span>}) )
{
    <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">emptyDir</span>} = <span class="ruby-identifier">tempdir</span> ( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span>, <span class="ruby-constant">OPEN</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>);
}
<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">emptyDir</span>} <span class="ruby-keyword">or</span>
    <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Unable to chdir to $work-&gt;{emptyDir}\n&quot;</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$ver</span> = <span class="ruby-value">%xgit show-ref -s refs/heads/$state-&gt;{module}`</span>;
<span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$ver</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$ver</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/^[0-9a-f]{40}$/</span>)
{
    <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Error from git show-ref -s refs/head$state-&gt;{module}&quot;</span>);
    <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;error 1 cannot find the current HEAD of module&quot;</span>;
    <span class="ruby-identifier">cleanupWorkTree</span>();
    <span class="ruby-identifier">exit</span>;
}

<span class="ruby-keyword">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">index</span>}) )
{
    (<span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">index</span>}) = <span class="ruby-identifier">tempfile</span> ( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span>, <span class="ruby-constant">OPEN</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> );
}

<span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_WORK_TREE</span>} = <span class="ruby-string">&quot;.&quot;</span>;
<span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_INDEX_FILE</span>} = <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">index</span>};
<span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">state</span>} = <span class="ruby-value">1</span>;

<span class="ruby-identifier">system</span>(<span class="ruby-string">&quot;git&quot;</span>,<span class="ruby-string">&quot;read-tree&quot;</span>,<span class="ruby-identifier">$ver</span>);
<span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$?</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
{
    <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Error running git-read-tree $ver $!\n&quot;</span>;
}
</pre>

<p>}</p>

<p># Cleanup working directory that is not needed any longer. sub
cleanupWorkTree {</p>

<pre>if( ! $work-&gt;{state} )
{
    return;
}

chdir &quot;/&quot; or die &quot;Unable to chdir &#39;/&#39;\n&quot;;

if( defined($work-&gt;{workDir}) )
{
    rmtree( $work-&gt;{workDir} );
    undef $work-&gt;{workDir};
}
undef $work-&gt;{state};</pre>

<p>}</p>

<p># Setup a temporary directory (not a working tree), typically for # merging
dirty state as in req_update. sub setupTmpDir {</p>

<pre class="ruby"><span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tmpDir</span>} = <span class="ruby-identifier">tempdir</span> ( <span class="ruby-constant">DIR</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$TEMP_DIR</span> );
<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tmpDir</span>} <span class="ruby-keyword">or</span> <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Unable to chdir $work-&gt;{tmpDir}\n&quot;</span>;

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$work</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tmpDir</span>};
</pre>

<p>}</p>

<p># Clean up a previously setupTmpDir.  Restore previous work tree if #
appropriate. sub cleanupTmpDir {</p>

<pre>if ( !defined($work-&gt;{tmpDir}) )
{
    $log-&gt;warn(&quot;cleanup tmpdir that has not been setup&quot;);
    die &quot;Cleanup tmpDir that has not been setup\n&quot;;
}
if( defined($work-&gt;{state}) )
{
    if( $work-&gt;{state} == 1 )
    {
        chdir $work-&gt;{emptyDir} or
            die &quot;Unable to chdir to $work-&gt;{emptyDir}\n&quot;;
    }
    elsif( $work-&gt;{state} == 2 )
    {
        chdir $work-&gt;{workDir} or
            die &quot;Unable to chdir to $work-&gt;{emptyDir}\n&quot;;
    }
    else
    {
        $log-&gt;warn(&quot;Inconsistent work dir state&quot;);
        die &quot;Inconsistent work dir state\n&quot;;
    }
}
else
{
    chdir &quot;/&quot; or die &quot;Unable to chdir &#39;/&#39;\n&quot;;
}</pre>

<p>}</p>

<p># Given a path, this function returns a string containing the kopts # that
should go into that path&#39;s Entries line.  For example, a binary # file
should get -kb. sub kopts_from_path {</p>

<pre>my ($path, $srcType, $name) = @_;

if ( defined ( $cfg-&gt;{gitcvs}{usecrlfattr} ) and
     $cfg-&gt;{gitcvs}{usecrlfattr} =~ /\s*(1|true|yes)\s*$/i )
{
    my ($val) = check_attr( &quot;text&quot;, $path );
    if ( $val eq &quot;unspecified&quot; )
    {
        $val = check_attr( &quot;crlf&quot;, $path );
    }
    if ( $val eq &quot;unset&quot; )
    {
        return &quot;-kb&quot;
    }
    elsif ( check_attr( &quot;eol&quot;, $path ) ne &quot;unspecified&quot; ||
            $val eq &quot;set&quot; || $val eq &quot;input&quot; )
    {
        return &quot;&quot;;
    }
    else
    {
        $log-&gt;info(&quot;Unrecognized check_attr crlf $path : $val&quot;);
    }
}

if ( defined ( $cfg-&gt;{gitcvs}{allbinary} ) )
{
    if( ($cfg-&gt;{gitcvs}{allbinary} =~ /^\s*(1|true|yes)\s*$/i) )
    {
        return &quot;-kb&quot;;
    }
    elsif( ($cfg-&gt;{gitcvs}{allbinary} =~ /^\s*guess\s*$/i) )
    {
        if( is_binary($srcType,$name) )
        {
            $log-&gt;debug(&quot;... as binary&quot;);
            return &quot;-kb&quot;;
        }
        else
        {
            $log-&gt;debug(&quot;... as text&quot;);
        }
    }
}
# Return &quot;&quot; to give no special treatment to any path
return &quot;&quot;;</pre>

<p>}</p>

<p>sub check_attr {</p>

<pre>my ($attr,$path) = @_;
ensureWorkTree();
if ( open my $fh, &#39;-|&#39;, &quot;git&quot;, &quot;check-attr&quot;, $attr, &quot;--&quot;, $path )
{
    my $val = &lt;$fh&gt;;
    close $fh;
    $val =~ s/.*: ([^:\r\n]*)\s*$/$1/;
    return $val;
}
else
{
    return undef;
}</pre>

<p>}</p>

<p># This should have the same heuristics as convert.c:is_binary() and
related. # Note that the bare CR test is done by callers in convert.c. sub
is_binary {</p>

<pre>my ($srcType,$name) = @_;
$log-&gt;debug(&quot;is_binary($srcType,$name)&quot;);

# Minimize amount of interpreted code run in the inner per-character
# loop for large files, by totalling each character value and
# then analyzing the totals.
my @counts;
my $i;
for($i=0;$i&lt;256;$i++)
{
    $counts[$i]=0;
}

my $fh = open_blob_or_die($srcType,$name);
my $line;
while( defined($line=&lt;$fh&gt;) )
{
    # Any &#39;\0&#39; and bare CR are considered binary.
    if( $line =~ /\0|(\r[^\n])/ )
    {
        close($fh);
        return 1;
    }

    # Count up each character in the line:
    my $len=length($line);
    for($i=0;$i&lt;$len;$i++)
    {
        $counts[ord(substr($line,$i,1))]++;
    }
}
close $fh;

# Don&#39;t count CR and LF as either printable/nonprintable
$counts[ord(&quot;\n&quot;)]=0;
$counts[ord(&quot;\r&quot;)]=0;

# Categorize individual character count into printable and nonprintable:
my $printable=0;
my $nonprintable=0;
for($i=0;$i&lt;256;$i++)
{
    if( $i &lt; 32 &amp;&amp;
        $i != ord(&quot;\b&quot;) &amp;&amp;
        $i != ord(&quot;\t&quot;) &amp;&amp;
        $i != 033 &amp;&amp;       # ESC
        $i != 014 )        # FF
    {
        $nonprintable+=$counts[$i];
    }
    elsif( $i==127 )  # DEL
    {
        $nonprintable+=$counts[$i];
    }
    else
    {
        $printable+=$counts[$i];
    }
}

return ($printable &gt;&gt; 7) &lt; $nonprintable;</pre>

<p>}</p>

<p># Returns open file handle.  Possible invocations: #  -
open_blob_or_die(“file”,$filename); #  -
open_blob_or_die(“sha1”,$filehash); sub open_blob_or_die {</p>

<pre>my ($srcType,$name) = @_;
my ($fh);
if( $srcType eq &quot;file&quot; )
{
    if( !open $fh,&quot;&lt;&quot;,$name )
    {
        $log-&gt;warn(&quot;Unable to open file $name: $!&quot;);
        die &quot;Unable to open file $name: $!\n&quot;;
    }
}
elsif( $srcType eq &quot;sha1&quot; )
{
    unless ( defined ( $name ) and $name =~ /^[a-zA-Z0-9]{40}$/ )
    {
        $log-&gt;warn(&quot;Need filehash&quot;);
        die &quot;Need filehash\n&quot;;
    }

    my $type = `git cat-file -t $name`;
    chomp $type;

    unless ( defined ( $type ) and $type eq &quot;blob&quot; )
    {
        $log-&gt;warn(&quot;Invalid type &#39;$type&#39; for &#39;$name&#39;&quot;);
        die ( &quot;Invalid type &#39;$type&#39; (expected &#39;blob&#39;)&quot; )
    }

    my $size = `git cat-file -s $name`;
    chomp $size;

    $log-&gt;debug(&quot;open_blob_or_die($name) size=$size, type=$type&quot;);

    unless( open $fh, &#39;-|&#39;, &quot;git&quot;, &quot;cat-file&quot;, &quot;blob&quot;, $name )
    {
        $log-&gt;warn(&quot;Unable to open sha1 $name&quot;);
        die &quot;Unable to open sha1 $name\n&quot;;
    }
}
else
{
    $log-&gt;warn(&quot;Unknown type of blob source: $srcType&quot;);
    die &quot;Unknown type of blob source: $srcType\n&quot;;
}
return $fh;</pre>

<p>}</p>

<p># Generate a CVS author name from Git author information, by taking the
local # part of the email address and replacing characters not in the
Portable # Filename Character Set (see IEEE Std 1003.1-2001, 3.276) by
underscores. CVS # Login names are Unix login names, which should be
restricted to this # character set. sub cvs_author {</p>

<pre>my $author_line = shift;
(my $author) = $author_line =~ /&lt;([^@&gt;]*)/;

$author =~ s/[^-a-zA-Z0-9_.]/_/g;
$author =~ s/^-/_/;

$author;</pre>

<p>}</p>

<p>sub descramble {</p>

<pre># This table is from src/scramble.c in the CVS source
my @SHIFTS = (
    0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15,
    16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
    114,120, 53, 79, 96,109, 72,108, 70, 64, 76, 67,116, 74, 68, 87,
    111, 52, 75,119, 49, 34, 82, 81, 95, 65,112, 86,118,110,122,105,
    41, 57, 83, 43, 46,102, 40, 89, 38,103, 45, 50, 42,123, 91, 35,
    125, 55, 54, 66,124,126, 59, 47, 92, 71,115, 78, 88,107,106, 56,
    36,121,117,104,101,100, 69, 73, 99, 63, 94, 93, 39, 37, 61, 48,
    58,113, 32, 90, 44, 98, 60, 51, 33, 97, 62, 77, 84, 80, 85,223,
    225,216,187,166,229,189,222,188,141,249,148,200,184,136,248,190,
    199,170,181,204,138,232,218,183,255,234,220,247,213,203,226,193,
    174,172,228,252,217,201,131,230,197,211,145,238,161,179,160,212,
    207,221,254,173,202,146,224,151,140,196,205,130,135,133,143,246,
    192,159,244,239,185,168,215,144,139,165,180,157,147,186,214,176,
    227,231,219,169,175,156,206,198,129,164,150,210,154,177,134,127,
    182,128,158,208,162,132,167,209,149,241,153,251,237,236,171,195,
    243,233,253,240,194,250,191,155,142,137,245,235,163,242,178,152
);
my ($str) = @_;

# This should never happen, the same password format (A) has been
# used by CVS since the beginning of time
{
    my $fmt = substr($str, 0, 1);
    die &quot;invalid password format `$fmt&#39;&quot; unless $fmt eq &#39;A&#39;;
}

my @str = unpack &quot;C*&quot;, substr($str, 1);
my $ret = join &#39;&#39;, map { chr $SHIFTS[$_] } @str;
return $ret;</pre>

<p>}</p>

<p># Test if the (deep) values of two references to a hash are the same. sub
refHashEqual {</p>

<pre>my($v1,$v2) = @_;

my $out;
if(!defined($v1))
{
    if(!defined($v2))
    {
        $out=1;
    }
}
elsif( !defined($v2) ||
       scalar(keys(%{$v1})) != scalar(keys(%{$v2})) )
{
    # $out=undef;
}
else
{
    $out=1;

    my $key;
    foreach $key (keys(%{$v1}))
    {
        if( !exists($v2-&gt;{$key}) ||
            defined($v1-&gt;{$key}) ne defined($v2-&gt;{$key}) ||
            ( defined($v1-&gt;{$key}) &amp;&amp;
              $v1-&gt;{$key} ne $v2-&gt;{$key} ) )
        {
           $out=undef;
           last;
        }
    }
}

return $out;</pre>

<p>}</p>

<p>package GITCVS::log;</p>

<p>#### #### Copyright The Open University UK - 2006. #### #### Authors:
Martyn Smith    &lt;martyn@catalyst.net.nz&gt; ####          Martin
Langhoff &lt;martin@laptop.org&gt; #### ####</p>

<p>use strict; use warnings;</p>

<h1 id="label-head1+NAME">head1 NAME<span><a href="#label-head1+NAME">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>GITCVS::log</p>

<h1 id="label-head1+DESCRIPTION">head1 DESCRIPTION<span><a href="#label-head1+DESCRIPTION">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>This module provides very crude logging with a similar interface to
Log::Log4perl</p>

<h1 id="label-head1+METHODS">head1 METHODS<span><a href="#label-head1+METHODS">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<h1 id="label-head2+new">head2 new<span><a href="#label-head2+new">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Creates a new log object, optionally you can specify a filename here to
indicate the file to log to. If no log file is specified, you can specify
one later with method setfile, or indicate you no longer want logging with
method nofile.</p>

<p>Until one of these methods is called, all log calls will buffer messages
ready to write out.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub new {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$class</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$filename</span> = <span class="ruby-identifier">shift</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$self</span> = {};

<span class="ruby-identifier">bless</span> <span class="ruby-identifier">$self</span>, <span class="ruby-identifier">$class</span>;

<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$filename</span> ) )
{
    <span class="ruby-identifier">open</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">fh</span>}, <span class="ruby-string">&quot;&gt;&gt;&quot;</span>, <span class="ruby-identifier">$filename</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Couldn&#39;t open &#39;$filename&#39; for writing : $!&quot;</span>);
}

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$self</span>;
</pre>

<p>}</p>

<h1 id="label-head2+setfile">head2 setfile<span><a href="#label-head2+setfile">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>This methods takes a filename, and attempts to open that file as the log
file. If successful, all buffered data is written out to the file, and any
further logging is written directly to the file.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub setfile {</p>

<pre>my $self = shift;
my $filename = shift;

if ( defined ( $filename ) )
{
    open $self-&gt;{fh}, &quot;&gt;&gt;&quot;, $filename or die(&quot;Couldn&#39;t open &#39;$filename&#39; for writing : $!&quot;);
}

return unless ( defined ( $self-&gt;{buffer} ) and ref $self-&gt;{buffer} eq &quot;ARRAY&quot; );

while ( my $line = shift @{$self-&gt;{buffer}} )
{
    print {$self-&gt;{fh}} $line;
}</pre>

<p>}</p>

<h1 id="label-head2+nofile">head2 nofile<span><a href="#label-head2+nofile">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>This method indicates no logging is going to be used. It flushes any
entries in the internal buffer, and sets a flag to ensure no further data
is put there.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub nofile {</p>

<pre>my $self = shift;

$self-&gt;{nolog} = 1;

return unless ( defined ( $self-&gt;{buffer} ) and ref $self-&gt;{buffer} eq &quot;ARRAY&quot; );

$self-&gt;{buffer} = [];</pre>

<p>}</p>

<h1 id="label-head2+_logopen">head2 _logopen<span><a href="#label-head2+_logopen">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Internal method. Returns true if the log file is open, false otherwise.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub _logopen {</p>

<pre>my $self = shift;

return 1 if ( defined ( $self-&gt;{fh} ) and ref $self-&gt;{fh} eq &quot;GLOB&quot; );
return 0;</pre>

<p>}</p>

<h1 id="label-head2+debug+info+warn+fatal">head2 debug info warn fatal<span><a href="#label-head2+debug+info+warn+fatal">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>These four methods are wrappers to _log. They provide the actual interface
for logging data.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub debug { my $self = shift; $self-&gt;_log(“debug”, @_); } sub info  { my
$self = shift; $self-&gt;_log(“info” , @_); } sub warn  { my $self = shift;
$self-&gt;_log(“warn” , @_); } sub fatal { my $self = shift;
$self-&gt;_log(“fatal”, @_); }</p>

<h1 id="label-head2+_log">head2 _log<span><a href="#label-head2+_log">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>This is an internal method called by the logging functions. It generates a
timestamp and pushes the logged line either to file, or internal buffer.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub _log {</p>

<pre>my $self = shift;
my $level = shift;

return if ( $self-&gt;{nolog} );

my @time = localtime;
my $timestring = sprintf(&quot;%4d-%02d-%02d %02d:%02d:%02d : %-5s&quot;,
    $time[5] + 1900,
    $time[4] + 1,
    $time[3],
    $time[2],
    $time[1],
    $time[0],
    uc $level,
);

if ( $self-&gt;_logopen )
{
    print {$self-&gt;{fh}} $timestring . &quot; - &quot; . join(&quot; &quot;,@_) . &quot;\n&quot;;
} else {
    push @{$self-&gt;{buffer}}, $timestring . &quot; - &quot; . join(&quot; &quot;,@_) . &quot;\n&quot;;
}</pre>

<p>}</p>

<h1 id="label-head2+DESTROY">head2 DESTROY<span><a href="#label-head2+DESTROY">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>This method simply closes the file handle if one is open</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub DESTROY {</p>

<pre>my $self = shift;

if ( $self-&gt;_logopen )
{
    close $self-&gt;{fh};
}</pre>

<p>}</p>

<p>package GITCVS::updater;</p>

<p>#### #### Copyright The Open University UK - 2006. #### #### Authors:
Martyn Smith    &lt;martyn@catalyst.net.nz&gt; ####          Martin
Langhoff &lt;martin@laptop.org&gt; #### ####</p>

<p>use strict; use warnings; use DBI;</p>

<h1 id="label-head1+METHODS">head1 METHODS<span><a href="#label-head1+METHODS">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<h1 id="label-head2+new">head2 new<span><a href="#label-head2+new">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub new {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$class</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$config</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$module</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$log</span> = <span class="ruby-identifier">shift</span>;

<span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Need to specify a git repository&quot;</span> <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$config</span>) <span class="ruby-keyword">and</span> <span class="ruby-operator">-</span><span class="ruby-identifier">d</span> <span class="ruby-identifier">$config</span> );
<span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Need to specify a module&quot;</span> <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$module</span>) );

<span class="ruby-identifier">$class</span> = <span class="ruby-identifier">ref</span>(<span class="ruby-identifier">$class</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">$class</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$self</span> = {};

<span class="ruby-identifier">bless</span> <span class="ruby-identifier">$self</span>, <span class="ruby-identifier">$class</span>;

<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">valid_tables</span>} = {<span class="ruby-string">&#39;revision&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
                         <span class="ruby-string">&#39;revision_ix1&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
                         <span class="ruby-string">&#39;revision_ix2&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
                         <span class="ruby-string">&#39;head&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
                         <span class="ruby-string">&#39;head_ix1&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
                         <span class="ruby-string">&#39;properties&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
                         <span class="ruby-string">&#39;commitmsgs&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>};

<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-keyword">module</span>} = <span class="ruby-identifier">$module</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">git_path</span>} = <span class="ruby-identifier">$config</span> . <span class="ruby-string">&quot;/&quot;</span>;

<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">log</span>} = <span class="ruby-identifier">$log</span>;

<span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Git repo &#39;$self-&gt;{git_path}&#39; doesn&#39;t exist&quot;</span> <span class="ruby-keyword">unless</span> ( <span class="ruby-operator">-</span><span class="ruby-identifier">d</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">git_path</span>} );

<span class="ruby-comment"># Stores full sha1&#39;s for various branch/tag names, abbreviations, etc:</span>
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">commitRefCache</span>} = {};

<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbdriver</span>} = <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">method</span>}}{<span class="ruby-identifier">dbdriver</span>} <span class="ruby-operator">||</span>
    <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">dbdriver</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&quot;SQLite&quot;</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbname</span>} = <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">method</span>}}{<span class="ruby-identifier">dbname</span>} <span class="ruby-operator">||</span>
    <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">dbname</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&quot;%Ggitcvs.%m.sqlite&quot;</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbuser</span>} = <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">method</span>}}{<span class="ruby-identifier">dbuser</span>} <span class="ruby-operator">||</span>
    <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">dbuser</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbpass</span>} = <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">method</span>}}{<span class="ruby-identifier">dbpass</span>} <span class="ruby-operator">||</span>
    <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">dbpass</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbtablenameprefix</span>} = <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">method</span>}}{<span class="ruby-identifier">dbtablenameprefix</span>} <span class="ruby-operator">||</span>
    <span class="ruby-identifier">$cfg</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">gitcvs</span>}{<span class="ruby-identifier">dbtablenameprefix</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">apping</span> = ( <span class="ruby-identifier">m</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$module</span>,
                <span class="ruby-identifier">a</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$state</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">method</span>},
                <span class="ruby-identifier">u</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">getlogin</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">getpwuid</span>(<span class="ruby-identifier">$&lt;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">$&lt;</span>,
                <span class="ruby-constant">G</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">git_path</span>},
                <span class="ruby-identifier">g</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mangle_dirname</span>(<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">git_path</span>}),
                );
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbname</span>} <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-string">%Q([mauGg])</span><span class="ruby-operator">/</span><span class="ruby-identifier">$mapping</span>{<span class="ruby-node">$1</span>}<span class="ruby-operator">/</span><span class="ruby-identifier">eg</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbuser</span>} <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-string">%Q([mauGg])</span><span class="ruby-operator">/</span><span class="ruby-identifier">$mapping</span>{<span class="ruby-node">$1</span>}<span class="ruby-operator">/</span><span class="ruby-identifier">eg</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbtablenameprefix</span>} <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-string">%Q([mauGg])</span><span class="ruby-operator">/</span><span class="ruby-identifier">$mapping</span>{<span class="ruby-node">$1</span>}<span class="ruby-operator">/</span><span class="ruby-identifier">eg</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbtablenameprefix</span>} = <span class="ruby-identifier">mangle_tablename</span>(<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbtablenameprefix</span>});

<span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Invalid char &#39;:&#39; in dbdriver&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbdriver</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/:/</span>;
<span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Invalid char &#39;;&#39; in dbname&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbname</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/;/</span>;
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>} = <span class="ruby-constant">DBI</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">connect</span>(<span class="ruby-string">&quot;dbi:$self-&gt;{dbdriver}:dbname=$self-&gt;{dbname}&quot;</span>,
                            <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbuser</span>},
                            <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbpass</span>});
<span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Error connecting to database\n&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>};

<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tables</span>} = {};
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$table</span> ( <span class="ruby-identifier">keys</span> <span class="ruby-string">%Q{$self-&gt;{dbh}-&gt;table_info(undef,undef,undef,&#39;TABLE&#39;)-&gt;fetchall_hashref(&#39;TABLE_NAME&#39;)}</span> )
{
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tables</span>}{<span class="ruby-identifier">$table</span>} = <span class="ruby-value">1</span>;
}

<span class="ruby-comment"># Construct the revision table if required</span>
<span class="ruby-comment"># The revision table stores an entry for each file, each time that file</span>
<span class="ruby-comment"># changes.</span>
<span class="ruby-comment">#   numberOfRecords = O( numCommits * averageNumChangedFilesPerCommit )</span>
<span class="ruby-comment"># This is not sufficient to support &quot;-r {commithash}&quot; for any</span>
<span class="ruby-comment"># files except files that were modified by that commit (also,</span>
<span class="ruby-comment"># some places in the code ignore/effectively strip out -r in</span>
<span class="ruby-comment"># some cases, before it gets passed to getmeta()).</span>
<span class="ruby-comment"># The &quot;filehash&quot; field typically has a git blob hash, but can also</span>
<span class="ruby-comment"># be set to &quot;dead&quot; to indicate that the given version of the file</span>
<span class="ruby-comment"># should not exist in the sandbox.</span>
<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tables</span>}{<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;revision&quot;</span>)} )
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$tablename</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;revision&quot;</span>);
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ix1name</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;revision_ix1&quot;</span>);
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ix2name</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;revision_ix2&quot;</span>);
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">do</span>(<span class="ruby-string">&quot;
        CREATE TABLE $tablename (
            name       TEXT NOT NULL,
            revision   INTEGER NOT NULL,
            filehash   TEXT NOT NULL,
            commithash TEXT NOT NULL,
            author     TEXT NOT NULL,
            modified   TEXT NOT NULL,
            mode       TEXT NOT NULL
        )
    &quot;</span>);
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">do</span>(<span class="ruby-string">&quot;
        CREATE INDEX $ix1name
        ON $tablename (name,revision)
    &quot;</span>);
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">do</span>(<span class="ruby-string">&quot;
        CREATE INDEX $ix2name
        ON $tablename (name,commithash)
    &quot;</span>);
}

<span class="ruby-comment"># Construct the head table if required</span>
<span class="ruby-comment"># The head table (along with the &quot;last_commit&quot; entry in the property</span>
<span class="ruby-comment"># table) is the persisted working state of the &quot;sub update&quot; subroutine.</span>
<span class="ruby-comment"># All of it&#39;s data is read entirely first, and completely recreated</span>
<span class="ruby-comment"># last, every time &quot;sub update&quot; runs.</span>
<span class="ruby-comment"># This is also used by &quot;sub getmeta&quot; when it is asked for the latest</span>
<span class="ruby-comment"># version of a file (as opposed to some specific version).</span>
<span class="ruby-comment"># Another way of thinking about it is as a single slice out of</span>
<span class="ruby-comment"># &quot;revisions&quot;, giving just the most recent revision information for</span>
<span class="ruby-comment"># each file.</span>
<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tables</span>}{<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;head&quot;</span>)} )
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$tablename</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;head&quot;</span>);
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ix1name</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;head_ix1&quot;</span>);
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">do</span>(<span class="ruby-string">&quot;
        CREATE TABLE $tablename (
            name       TEXT NOT NULL,
            revision   INTEGER NOT NULL,
            filehash   TEXT NOT NULL,
            commithash TEXT NOT NULL,
            author     TEXT NOT NULL,
            modified   TEXT NOT NULL,
            mode       TEXT NOT NULL
        )
    &quot;</span>);
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">do</span>(<span class="ruby-string">&quot;
        CREATE INDEX $ix1name
        ON $tablename (name)
    &quot;</span>);
}

<span class="ruby-comment"># Construct the properties table if required</span>
<span class="ruby-comment">#  - &quot;last_commit&quot; - Used by &quot;sub update&quot;.</span>
<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tables</span>}{<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;properties&quot;</span>)} )
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$tablename</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;properties&quot;</span>);
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">do</span>(<span class="ruby-string">&quot;
        CREATE TABLE $tablename (
            key        TEXT NOT NULL PRIMARY KEY,
            value      TEXT
        )
    &quot;</span>);
}

<span class="ruby-comment"># Construct the commitmsgs table if required</span>
<span class="ruby-comment"># The commitmsgs table is only used for merge commits, since</span>
<span class="ruby-comment"># &quot;sub update&quot; will only keep one branch of parents.  Shortlogs</span>
<span class="ruby-comment"># for ignored commits (i.e. not on the chosen branch) will be used</span>
<span class="ruby-comment"># to construct a replacement &quot;collapsed&quot; merge commit message,</span>
<span class="ruby-comment"># which will be stored in this table.  See also &quot;sub commitmessage&quot;.</span>
<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tables</span>}{<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;commitmsgs&quot;</span>)} )
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$tablename</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;commitmsgs&quot;</span>);
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">do</span>(<span class="ruby-string">&quot;
        CREATE TABLE $tablename (
            key        TEXT NOT NULL PRIMARY KEY,
            value      TEXT
        )
    &quot;</span>);
}

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$self</span>;
</pre>

<p>}</p>

<h1 id="label-head2+tablename">head2 tablename<span><a href="#label-head2+tablename">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub tablename {</p>

<pre>my $self = shift;
my $name = shift;

if (exists $self-&gt;{valid_tables}{$name}) {
    return $self-&gt;{dbtablenameprefix} . $name;
} else {
    return undef;
}</pre>

<p>}</p>

<h1 id="label-head2+update">head2 update<span><a href="#label-head2+update">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Bring the database up to date with the latest changes from the git
repository.</p>

<p>Internal working state is read out of the “head” table and the
“last_commit” property, then it updates “revisions” based on that, and
finally it writes the new internal state back to the “head” table so it can
be used as a starting point the next time update is called.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub update {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$self</span> = <span class="ruby-identifier">shift</span>;

<span class="ruby-comment"># first lets get the commit list</span>
<span class="ruby-identifier">$ENV</span>{<span class="ruby-constant">GIT_DIR</span>} = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">git_path</span>};

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$commitsha1</span> = <span class="ruby-value">%xgit rev-parse $self-&gt;{module}`</span>;
<span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$commitsha1</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$commitinfo</span> = <span class="ruby-value">%xgit cat-file commit $self-&gt;{module} 2&gt;&amp;1`</span>;
<span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">$commitinfo</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/tree\s+[a-zA-Z0-9]{40}/</span> )
{
    <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Invalid module &#39;$self-&gt;{module}&#39;&quot;</span>);
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$git_log</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$lastcommit</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">_get_prop</span>(<span class="ruby-string">&quot;last_commit&quot;</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$lastcommit</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$lastcommit</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$commitsha1</span>) { <span class="ruby-comment"># up-to-date</span>
     <span class="ruby-comment"># invalidate the gethead cache</span>
     <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">clearCommitRefCaches</span>();
     <span class="ruby-keyword">return</span> <span class="ruby-value">1</span>;
}

<span class="ruby-comment"># Start exclusive lock here...</span>
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">begin_work</span>() <span class="ruby-keyword">or</span> <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Cannot lock database for BEGIN&quot;</span>;

<span class="ruby-comment"># TODO: log processing is memory bound</span>
<span class="ruby-comment"># if we can parse into a 2nd file that is in reverse order</span>
<span class="ruby-comment"># we can probably do something really efficient</span>
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@git_log_params</span> = (<span class="ruby-string">&#39;--pretty&#39;</span>, <span class="ruby-string">&#39;--parents&#39;</span>, <span class="ruby-string">&#39;--topo-order&#39;</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$lastcommit</span>) {
    <span class="ruby-identifier">push</span> <span class="ruby-ivar">@git_log_params</span>, <span class="ruby-string">&quot;$lastcommit..$self-&gt;{module}&quot;</span>;
} <span class="ruby-keyword">else</span> {
    <span class="ruby-identifier">push</span> <span class="ruby-ivar">@git_log_params</span>, <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-keyword">module</span>};
}
<span class="ruby-comment"># git-rev-list is the backend / plumbing version of git-log</span>
<span class="ruby-identifier">open</span>(<span class="ruby-identifier">my</span> <span class="ruby-identifier">$gitLogPipe</span>, <span class="ruby-string">&#39;-|&#39;</span>, <span class="ruby-string">&#39;git&#39;</span>, <span class="ruby-string">&#39;rev-list&#39;</span>, <span class="ruby-ivar">@git_log_params</span>)
            <span class="ruby-keyword">or</span> <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Cannot call git-rev-list: $!&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@commits</span>=<span class="ruby-identifier">readCommits</span>(<span class="ruby-identifier">$gitLogPipe</span>);
<span class="ruby-identifier">close</span> <span class="ruby-identifier">$gitLogPipe</span>;

<span class="ruby-comment"># Now all the commits are in the @commits bucket</span>
<span class="ruby-comment"># ordered by time DESC. for each commit that needs processing,</span>
<span class="ruby-comment"># determine whether it&#39;s following the last head we&#39;ve seen or if</span>
<span class="ruby-comment"># it&#39;s on its own branch, grab a file list, and add whatever&#39;s changed</span>
<span class="ruby-comment"># NOTE: $lastcommit refers to the last commit from previous run</span>
<span class="ruby-comment">#       $lastpicked is the last commit we picked in this run</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$lastpicked</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$head</span> = {};
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$lastcommit</span>) {
    <span class="ruby-identifier">$lastpicked</span> = <span class="ruby-identifier">$lastcommit</span>;
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$committotal</span> = <span class="ruby-identifier">scalar</span>(<span class="ruby-ivar">@commits</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$commitcount</span> = <span class="ruby-value">0</span>;

<span class="ruby-comment"># Load the head table into $head (for cached lookups during the update process)</span>
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file</span> ( @{<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">gethead</span>(<span class="ruby-value">1</span>)} )
{
    <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">name</span>}} = <span class="ruby-identifier">$file</span>;
}

<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$commit</span> ( <span class="ruby-ivar">@commits</span> )
{
    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">log</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;GITCVS::updater - Processing commit $commit-&gt;{hash} (&quot;</span> . (<span class="ruby-operator">+</span><span class="ruby-operator">+</span><span class="ruby-identifier">$commitcount</span>) . <span class="ruby-string">&quot; of $committotal)&quot;</span>);
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$lastpicked</span>)
    {
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">in_array</span>(<span class="ruby-identifier">$lastpicked</span>, @{<span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">parents</span>}}))
        {
            <span class="ruby-comment"># skip, we&#39;ll see this delta</span>
            <span class="ruby-comment"># as part of a merge later</span>
            <span class="ruby-comment"># warn &quot;skipping off-track  $commit-&gt;{hash}\n&quot;;</span>
            <span class="ruby-keyword">next</span>;
        } <span class="ruby-keyword">elsif</span> (@{<span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">parents</span>}} <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) {
            <span class="ruby-comment"># it is a merge commit, for each parent that is</span>
            <span class="ruby-comment"># not $lastpicked (not given a CVS revision number),</span>
            <span class="ruby-comment"># see if we can get a log</span>
            <span class="ruby-comment"># from the merge-base to that parent to put it</span>
            <span class="ruby-comment"># in the message as a merge summary.</span>
            <span class="ruby-identifier">my</span> <span class="ruby-ivar">@parents</span> = @{<span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">parents</span>}};
            <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$parent</span> (<span class="ruby-ivar">@parents</span>) {
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$parent</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$lastpicked</span>) {
                    <span class="ruby-keyword">next</span>;
                }
                <span class="ruby-comment"># git-merge-base can potentially (but rarely) throw</span>
                <span class="ruby-comment"># several candidate merge bases. let&#39;s assume</span>
                <span class="ruby-comment"># that the first one is the best one.</span>
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$base</span> = <span class="ruby-identifier">eval</span> {
                        <span class="ruby-identifier">safe_pipe_capture</span>(<span class="ruby-string">&#39;git&#39;</span>, <span class="ruby-string">&#39;merge-base&#39;</span>,
                                             <span class="ruby-identifier">$lastpicked</span>, <span class="ruby-identifier">$parent</span>);
                };
                <span class="ruby-comment"># The two branches may not be related at all,</span>
                <span class="ruby-comment"># in which case merge base simply fails to find</span>
                <span class="ruby-comment"># any, but that&#39;s Ok.</span>
                <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$@</span>);

                <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$base</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$base</span>) {
                    <span class="ruby-identifier">my</span> <span class="ruby-ivar">@merged</span>;
                    <span class="ruby-comment"># print &quot;want to log between  $base $parent \n&quot;;</span>
                    <span class="ruby-identifier">open</span>(<span class="ruby-constant">GITLOG</span>, <span class="ruby-string">&#39;-|&#39;</span>, <span class="ruby-string">&#39;git&#39;</span>, <span class="ruby-string">&#39;log&#39;</span>, <span class="ruby-string">&#39;--pretty=medium&#39;</span>, <span class="ruby-string">&quot;$base..$parent&quot;</span>)
                      <span class="ruby-keyword">or</span> <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Cannot call git-log: $!&quot;</span>;
                    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$mergedhash</span>;
                    <span class="ruby-keyword">while</span> (<span class="ruby-operator">&lt;</span><span class="ruby-constant">GITLOG</span><span class="ruby-operator">&gt;</span>) {
                        <span class="ruby-identifier">chomp</span>;
                        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$mergedhash</span>) {
                            <span class="ruby-keyword">if</span> (<span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-identifier">commit</span>\<span class="ruby-identifier">s</span><span class="ruby-operator">+</span>(.<span class="ruby-operator">+</span>)<span class="ruby-identifier">$/</span>) {
                                <span class="ruby-identifier">$mergedhash</span> = <span class="ruby-node">$1</span>;
                            } <span class="ruby-keyword">else</span> {
                                <span class="ruby-keyword">next</span>;
                            }
                        } <span class="ruby-keyword">else</span> {
                            <span class="ruby-comment"># grab the first line that looks non-rfc822</span>
                            <span class="ruby-comment"># aka has content after leading space</span>
                            <span class="ruby-keyword">if</span> (<span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>\<span class="ruby-identifier">s</span><span class="ruby-operator">+</span>(\<span class="ruby-constant">S</span>.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$/</span>) {
                                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$title</span> = <span class="ruby-node">$1</span>;
                                <span class="ruby-identifier">$title</span> = <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$title</span>,<span class="ruby-value">0</span>,<span class="ruby-value">100</span>); <span class="ruby-comment"># truncate</span>
                                <span class="ruby-identifier">unshift</span> <span class="ruby-ivar">@merged</span>, <span class="ruby-string">&quot;$mergedhash $title&quot;</span>;
                                <span class="ruby-keyword">undef</span> <span class="ruby-identifier">$mergedhash</span>;
                            }
                        }
                    }
                    <span class="ruby-identifier">close</span> <span class="ruby-constant">GITLOG</span>;
                    <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@merged</span>) {
                        <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mergemsg</span>} = <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">message</span>};
                        <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mergemsg</span>} .= <span class="ruby-string">&quot;\nSummary of merged commits:\n\n&quot;</span>;
                        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$summary</span> (<span class="ruby-ivar">@merged</span>) {
                            <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mergemsg</span>} .= <span class="ruby-string">&quot;\t$summary\n&quot;</span>;
                        }
                        <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mergemsg</span>} .= <span class="ruby-string">&quot;\n\n&quot;</span>;
                        <span class="ruby-comment"># print &quot;Message for $commit-&gt;{hash} \n$commit-&gt;{mergemsg}&quot;;</span>
                    }
                }
            }
        }
    }

    <span class="ruby-comment"># convert the date to CVS-happy format</span>
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$cvsDate</span> = <span class="ruby-identifier">convertToCvsDate</span>(<span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">date</span>});

    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span> ( <span class="ruby-identifier">$lastpicked</span> ) )
    {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filepipe</span> = <span class="ruby-identifier">open</span>(<span class="ruby-constant">FILELIST</span>, <span class="ruby-string">&#39;-|&#39;</span>, <span class="ruby-string">&#39;git&#39;</span>, <span class="ruby-string">&#39;diff-tree&#39;</span>, <span class="ruby-string">&#39;-z&#39;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-identifier">$lastpicked</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>}) <span class="ruby-keyword">or</span> <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Cannot call git-diff-tree : $!&quot;</span>);
        <span class="ruby-identifier">local</span> (<span class="ruby-identifier">$/</span>) = <span class="ruby-string">&quot;\0&quot;</span>;
        <span class="ruby-keyword">while</span> ( <span class="ruby-operator">&lt;</span><span class="ruby-constant">FILELIST</span><span class="ruby-operator">&gt;</span> )
        {
            <span class="ruby-identifier">chomp</span>;
            <span class="ruby-keyword">unless</span> ( <span class="ruby-regexp">/^:\d{6}\s+([0-7]{6})\s+[a-f0-9]{40}\s+([a-f0-9]{40})\s+(\w)$/o</span> )
            {
                <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Couldn&#39;t process git-diff-tree line : $_&quot;</span>);
            }
            <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$mode</span>, <span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$change</span>) = (<span class="ruby-node">$1</span>, <span class="ruby-node">$2</span>, <span class="ruby-node">$3</span>);
            <span class="ruby-identifier">my</span> <span class="ruby-identifier">$name</span> = <span class="ruby-operator">&lt;</span><span class="ruby-constant">FILELIST</span><span class="ruby-operator">&gt;</span>;
            <span class="ruby-identifier">chomp</span>(<span class="ruby-identifier">$name</span>);

            <span class="ruby-comment"># $log-&gt;debug(&quot;File mode=$mode, hash=$hash, change=$change, name=$name&quot;);</span>

            <span class="ruby-identifier">my</span> <span class="ruby-identifier">$dbMode</span> = <span class="ruby-identifier">convertToDbMode</span>(<span class="ruby-identifier">$mode</span>);

            <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$change</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;D&quot;</span> )
            {
                <span class="ruby-comment">#$log-&gt;debug(&quot;DELETE   $name&quot;);</span>
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>} = {
                    <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$name</span>,
                    <span class="ruby-identifier">revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>}{<span class="ruby-identifier">revision</span>} <span class="ruby-operator">+</span> <span class="ruby-value">1</span>,
                    <span class="ruby-identifier">filehash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;deleted&quot;</span>,
                    <span class="ruby-identifier">commithash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>},
                    <span class="ruby-identifier">modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$cvsDate</span>,
                    <span class="ruby-identifier">author</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>},
                    <span class="ruby-identifier">mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$dbMode</span>,
                };
                <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">insert_rev</span>(<span class="ruby-identifier">$name</span>, <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>}{<span class="ruby-identifier">revision</span>}, <span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>}, <span class="ruby-identifier">$cvsDate</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>}, <span class="ruby-identifier">$dbMode</span>);
            }
            <span class="ruby-keyword">elsif</span> ( <span class="ruby-identifier">$change</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;M&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$change</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;T&quot;</span> )
            {
                <span class="ruby-comment">#$log-&gt;debug(&quot;MODIFIED $name&quot;);</span>
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>} = {
                    <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$name</span>,
                    <span class="ruby-identifier">revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>}{<span class="ruby-identifier">revision</span>} <span class="ruby-operator">+</span> <span class="ruby-value">1</span>,
                    <span class="ruby-identifier">filehash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$hash</span>,
                    <span class="ruby-identifier">commithash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>},
                    <span class="ruby-identifier">modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$cvsDate</span>,
                    <span class="ruby-identifier">author</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>},
                    <span class="ruby-identifier">mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$dbMode</span>,
                };
                <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">insert_rev</span>(<span class="ruby-identifier">$name</span>, <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>}{<span class="ruby-identifier">revision</span>}, <span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>}, <span class="ruby-identifier">$cvsDate</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>}, <span class="ruby-identifier">$dbMode</span>);
            }
            <span class="ruby-keyword">elsif</span> ( <span class="ruby-identifier">$change</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;A&quot;</span> )
            {
                <span class="ruby-comment">#$log-&gt;debug(&quot;ADDED    $name&quot;);</span>
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>} = {
                    <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$name</span>,
                    <span class="ruby-identifier">revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>}{<span class="ruby-identifier">revision</span>} <span class="ruby-operator">?</span> <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>}{<span class="ruby-identifier">revision</span>}<span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>,
                    <span class="ruby-identifier">filehash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$hash</span>,
                    <span class="ruby-identifier">commithash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>},
                    <span class="ruby-identifier">modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$cvsDate</span>,
                    <span class="ruby-identifier">author</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>},
                    <span class="ruby-identifier">mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$dbMode</span>,
                };
                <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">insert_rev</span>(<span class="ruby-identifier">$name</span>, <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$name</span>}{<span class="ruby-identifier">revision</span>}, <span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>}, <span class="ruby-identifier">$cvsDate</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>}, <span class="ruby-identifier">$dbMode</span>);
            }
            <span class="ruby-keyword">else</span>
            {
                <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;UNKNOWN FILE CHANGE mode=$mode, hash=$hash, change=$change, name=$name&quot;</span>);
                <span class="ruby-identifier">die</span>;
            }
        }
        <span class="ruby-identifier">close</span> <span class="ruby-constant">FILELIST</span>;
    } <span class="ruby-keyword">else</span> {
        <span class="ruby-comment"># this is used to detect files removed from the repo</span>
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$seen_files</span> = {};

        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filepipe</span> = <span class="ruby-identifier">open</span>(<span class="ruby-constant">FILELIST</span>, <span class="ruby-string">&#39;-|&#39;</span>, <span class="ruby-string">&#39;git&#39;</span>, <span class="ruby-string">&#39;ls-tree&#39;</span>, <span class="ruby-string">&#39;-z&#39;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>}) <span class="ruby-keyword">or</span> <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Cannot call git-ls-tree : $!&quot;</span>);
        <span class="ruby-identifier">local</span> <span class="ruby-identifier">$/</span> = <span class="ruby-string">&quot;\0&quot;</span>;
        <span class="ruby-keyword">while</span> ( <span class="ruby-operator">&lt;</span><span class="ruby-constant">FILELIST</span><span class="ruby-operator">&gt;</span> )
        {
            <span class="ruby-identifier">chomp</span>;
            <span class="ruby-keyword">unless</span> ( <span class="ruby-regexp">/^(\d+)\s+(\w+)\s+([a-zA-Z0-9]+)\t(.*)$/o</span> )
            {
                <span class="ruby-identifier">die</span>(<span class="ruby-string">&quot;Couldn&#39;t process git-ls-tree line : $_&quot;</span>);
            }

            <span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$mode</span>, <span class="ruby-identifier">$git_type</span>, <span class="ruby-identifier">$git_hash</span>, <span class="ruby-identifier">$git_filename</span> ) = ( <span class="ruby-node">$1</span>, <span class="ruby-node">$2</span>, <span class="ruby-node">$3</span>, <span class="ruby-node">$4</span> );

            <span class="ruby-identifier">$seen_files</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$git_filename</span>} = <span class="ruby-value">1</span>;

            <span class="ruby-identifier">my</span> ( <span class="ruby-identifier">$oldhash</span>, <span class="ruby-identifier">$oldrevision</span>, <span class="ruby-identifier">$oldmode</span> ) = (
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$git_filename</span>}{<span class="ruby-identifier">filehash</span>},
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$git_filename</span>}{<span class="ruby-identifier">revision</span>},
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$git_filename</span>}{<span class="ruby-identifier">mode</span>}
            );

            <span class="ruby-identifier">my</span> <span class="ruby-identifier">$dbMode</span> = <span class="ruby-identifier">convertToDbMode</span>(<span class="ruby-identifier">$mode</span>);

            <span class="ruby-comment"># unless the file exists with the same hash, we need to update it ...</span>
            <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$oldhash</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">$oldhash</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$git_hash</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$oldmode</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">$oldmode</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$dbMode</span> )
            {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$newrevision</span> = ( <span class="ruby-identifier">$oldrevision</span> <span class="ruby-keyword">or</span> <span class="ruby-value">0</span> ) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>;

                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$git_filename</span>} = {
                    <span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$git_filename</span>,
                    <span class="ruby-identifier">revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$newrevision</span>,
                    <span class="ruby-identifier">filehash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$git_hash</span>,
                    <span class="ruby-identifier">commithash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>},
                    <span class="ruby-identifier">modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$cvsDate</span>,
                    <span class="ruby-identifier">author</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>},
                    <span class="ruby-identifier">mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$dbMode</span>,
                };

                <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">insert_rev</span>(<span class="ruby-identifier">$git_filename</span>, <span class="ruby-identifier">$newrevision</span>, <span class="ruby-identifier">$git_hash</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>}, <span class="ruby-identifier">$cvsDate</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>}, <span class="ruby-identifier">$dbMode</span>);
            }
        }
        <span class="ruby-identifier">close</span> <span class="ruby-constant">FILELIST</span>;

        <span class="ruby-comment"># Detect deleted files</span>
        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file</span> ( <span class="ruby-identifier">keys</span> <span class="ruby-string">%Qhead )
        {
            unless ( exists $</span><span class="ruby-identifier">seen_files</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>} <span class="ruby-keyword">or</span> <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">filehash</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;deleted&quot;</span> )
            {
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">revision</span>}<span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">filehash</span>} = <span class="ruby-string">&quot;deleted&quot;</span>;
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">commithash</span>} = <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>};
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">modified</span>} = <span class="ruby-identifier">$cvsDate</span>;
                <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">author</span>} = <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>};

                <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">insert_rev</span>(<span class="ruby-identifier">$file</span>, <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">revision</span>}, <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">filehash</span>}, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>}, <span class="ruby-identifier">$cvsDate</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">author</span>}, <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">mode</span>});
            }
        }
        <span class="ruby-comment"># END : &quot;Detect deleted files&quot;</span>
    }

    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">exists</span> <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mergemsg</span>})
    {
        <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">insert_mergelog</span>(<span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>}, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">mergemsg</span>});
    }

    <span class="ruby-identifier">$lastpicked</span> = <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>};

    <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">_set_prop</span>(<span class="ruby-string">&quot;last_commit&quot;</span>, <span class="ruby-identifier">$commit</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">hash</span>});
}

<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">delete_head</span>();
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file</span> ( <span class="ruby-identifier">keys</span> <span class="ruby-string">%Qhead )
{
    $</span><span class="ruby-keyword">self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">insert_head</span>(
        <span class="ruby-identifier">$file</span>,
        <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">revision</span>},
        <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">filehash</span>},
        <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">commithash</span>},
        <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">modified</span>},
        <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">author</span>},
        <span class="ruby-identifier">$head</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$file</span>}{<span class="ruby-identifier">mode</span>},
    );
}
<span class="ruby-comment"># invalidate the gethead cache</span>
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">clearCommitRefCaches</span>();

<span class="ruby-comment"># Ending exclusive lock here</span>
<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">commit</span>() <span class="ruby-keyword">or</span> <span class="ruby-identifier">die</span> <span class="ruby-string">&quot;Failed to commit changes to SQLite&quot;</span>;
</pre>

<p>}</p>

<p>sub readCommits {</p>

<pre>my $pipeHandle = shift;
my @commits;

my %commit = ();

while ( &lt;$pipeHandle&gt; )
{
    chomp;
    if (m/^commit\s+(.*)$/) {
        # on ^commit lines put the just seen commit in the stack
        # and prime things for the next one
        if (keys %commit) {
            my %copy = %commit;
            unshift @commits, \%copy;
            %commit = ();
        }
        my @parents = split(m/\s+/, $1);
        $commit{hash} = shift @parents;
        $commit{parents} = \@parents;
    } elsif (m/^(\w+?):\s+(.*)$/ &amp;&amp; !exists($commit{message})) {
        # on rfc822-like lines seen before we see any message,
        # lowercase the entry and put it in the hash as key-value
        $commit{lc($1)} = $2;
    } else {
        # message lines - skip initial empty line
        # and trim whitespace
        if (!exists($commit{message}) &amp;&amp; m/^\s*$/) {
            # define it to mark the end of headers
            $commit{message} = &#39;&#39;;
            next;
        }
        s/^\s+//; s/\s+$//; # trim ws
        $commit{message} .= $_ . &quot;\n&quot;;
    }
}

unshift @commits, \%commit if ( keys %commit );

return @commits;</pre>

<p>}</p>

<p>sub convertToCvsDate {</p>

<pre>my $date = shift;
# Convert from: &quot;git rev-list --pretty&quot; formatted date
# Convert to: &quot;the format specified by RFC822 as modified by RFC1123.&quot;
# Example: 26 May 1997 13:01:40 -0400
if( $date =~ /^\w+\s+(\w+)\s+(\d+)\s+(\d+:\d+:\d+)\s+(\d+)\s+([+-]\d+)$/ )
{
    $date = &quot;$2 $1 $4 $3 $5&quot;;
}

return $date;</pre>

<p>}</p>

<p>sub convertToDbMode {</p>

<pre>my $mode = shift;

# NOTE: The CVS protocol uses a string similar &quot;u=rw,g=rw,o=rw&quot;,
#  but the database &quot;mode&quot; column historically (and currently)
#  only stores the &quot;rw&quot; (for user) part of the string.
#    FUTURE: It might make more sense to persist the raw
#  octal mode (or perhaps the final full CVS form) instead of
#  this half-converted form, but it isn&#39;t currently worth the
#  backwards compatibility headaches.

$mode=~/^\d{3}(\d)\d\d$/;
my $userBits=$1;

my $dbMode = &quot;&quot;;
$dbMode .= &quot;r&quot; if ( $userBits &amp; 4 );
$dbMode .= &quot;w&quot; if ( $userBits &amp; 2 );
$dbMode .= &quot;x&quot; if ( $userBits &amp; 1 );
$dbMode = &quot;rw&quot; if ( $dbMode eq &quot;&quot; );

return $dbMode;</pre>

<p>}</p>

<p>sub insert_rev {</p>

<pre>my $self = shift;
my $name = shift;
my $revision = shift;
my $filehash = shift;
my $commithash = shift;
my $modified = shift;
my $author = shift;
my $mode = shift;
my $tablename = $self-&gt;tablename(&quot;revision&quot;);

my $insert_rev = $self-&gt;{dbh}-&gt;prepare_cached(&quot;INSERT INTO $tablename (name, revision, filehash, commithash, modified, author, mode) VALUES (?,?,?,?,?,?,?)&quot;,{},1);
$insert_rev-&gt;execute($name, $revision, $filehash, $commithash, $modified, $author, $mode);</pre>

<p>}</p>

<p>sub insert_mergelog {</p>

<pre>my $self = shift;
my $key = shift;
my $value = shift;
my $tablename = $self-&gt;tablename(&quot;commitmsgs&quot;);

my $insert_mergelog = $self-&gt;{dbh}-&gt;prepare_cached(&quot;INSERT INTO $tablename (key, value) VALUES (?,?)&quot;,{},1);
$insert_mergelog-&gt;execute($key, $value);</pre>

<p>}</p>

<p>sub delete_head {</p>

<pre>my $self = shift;
my $tablename = $self-&gt;tablename(&quot;head&quot;);

my $delete_head = $self-&gt;{dbh}-&gt;prepare_cached(&quot;DELETE FROM $tablename&quot;,{},1);
$delete_head-&gt;execute();</pre>

<p>}</p>

<p>sub insert_head {</p>

<pre>my $self = shift;
my $name = shift;
my $revision = shift;
my $filehash = shift;
my $commithash = shift;
my $modified = shift;
my $author = shift;
my $mode = shift;
my $tablename = $self-&gt;tablename(&quot;head&quot;);

my $insert_head = $self-&gt;{dbh}-&gt;prepare_cached(&quot;INSERT INTO $tablename (name, revision, filehash, commithash, modified, author, mode) VALUES (?,?,?,?,?,?,?)&quot;,{},1);
$insert_head-&gt;execute($name, $revision, $filehash, $commithash, $modified, $author, $mode);</pre>

<p>}</p>

<p>sub _get_prop {</p>

<pre>my $self = shift;
my $key = shift;
my $tablename = $self-&gt;tablename(&quot;properties&quot;);

my $db_query = $self-&gt;{dbh}-&gt;prepare_cached(&quot;SELECT value FROM $tablename WHERE key=?&quot;,{},1);
$db_query-&gt;execute($key);
my ( $value ) = $db_query-&gt;fetchrow_array;

return $value;</pre>

<p>}</p>

<p>sub _set_prop {</p>

<pre>my $self = shift;
my $key = shift;
my $value = shift;
my $tablename = $self-&gt;tablename(&quot;properties&quot;);

my $db_query = $self-&gt;{dbh}-&gt;prepare_cached(&quot;UPDATE $tablename SET value=? WHERE key=?&quot;,{},1);
$db_query-&gt;execute($value, $key);

unless ( $db_query-&gt;rows )
{
    $db_query = $self-&gt;{dbh}-&gt;prepare_cached(&quot;INSERT INTO $tablename (key, value) VALUES (?,?)&quot;,{},1);
    $db_query-&gt;execute($key, $value);
}

return $value;</pre>

<p>}</p>

<h1 id="label-head2+gethead">head2 gethead<span><a href="#label-head2+gethead">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub gethead {</p>

<pre>my $self = shift;
my $intRev = shift;
my $tablename = $self-&gt;tablename(&quot;head&quot;);

return $self-&gt;{gethead_cache} if ( defined ( $self-&gt;{gethead_cache} ) );

my $db_query = $self-&gt;{dbh}-&gt;prepare_cached(&quot;SELECT name, filehash, mode, revision, modified, commithash, author FROM $tablename ORDER BY name ASC&quot;,{},1);
$db_query-&gt;execute();

my $tree = [];
while ( my $file = $db_query-&gt;fetchrow_hashref )
{
    if(!$intRev)
    {
        $file-&gt;{revision} = &quot;1.$file-&gt;{revision}&quot;
    }
    push @$tree, $file;
}

$self-&gt;{gethead_cache} = $tree;

return $tree;</pre>

<p>}</p>

<h1 id="label-head2+getAnyHead">head2 getAnyHead<span><a href="#label-head2+getAnyHead">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Returns a reference to an array of getmeta structures, one per file in the
specified tree hash.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub getAnyHead {</p>

<pre>my ($self,$hash) = @_;

if(!defined($hash))
{
    return $self-&gt;gethead();
}

my @files;
{
    open(my $filePipe, &#39;-|&#39;, &#39;git&#39;, &#39;ls-tree&#39;, &#39;-z&#39;, &#39;-r&#39;, $hash)
            or die(&quot;Cannot call git-ls-tree : $!&quot;);
    local $/ = &quot;\0&quot;;
    @files=&lt;$filePipe&gt;;
    close $filePipe;
}

my $tree=[];
my($line);
foreach $line (@files)
{
    $line=~s/\0$//;
    unless ( $line=~/^(\d+)\s+(\w+)\s+([a-zA-Z0-9]+)\t(.*)$/o )
    {
        die(&quot;Couldn&#39;t process git-ls-tree line : $_&quot;);
    }

    my($mode, $git_type, $git_hash, $git_filename) = ($1, $2, $3, $4);
    push @$tree, $self-&gt;getMetaFromCommithash($git_filename,$hash);
}

return $tree;</pre>

<p>}</p>

<h1 id="label-head2+getRevisionDirMap">head2 getRevisionDirMap<span><a href="#label-head2+getRevisionDirMap">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>A “revision dir map” contains all the plain-file filenames associated with
a particular revision (tree-ish), organized by directory:</p>

<pre>$type = $out-&gt;{$dir}{$fullName}</pre>

<p>The type of each is “F” (for ordinary file) or “D” (for directory, for
which the map $out-&gt;{$fullName} will also exist).</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub getRevisionDirMap {</p>

<pre>my ($self,$ver)=@_;

if(!defined($self-&gt;{revisionDirMapCache}))
{
    $self-&gt;{revisionDirMapCache}={};
}

    # Get file list (previously cached results are dependent on HEAD,
    # but are early in each case):
my $cacheKey;
my (@fileList);
if( !defined($ver) || $ver eq &quot;&quot; )
{
    $cacheKey=&quot;&quot;;
    if( defined($self-&gt;{revisionDirMapCache}{$cacheKey}) )
    {
        return $self-&gt;{revisionDirMapCache}{$cacheKey};
    }

    my @head = @{$self-&gt;gethead()};
    foreach my $file ( @head )
    {
        next if ( $file-&gt;{filehash} eq &quot;deleted&quot; );

        push @fileList,$file-&gt;{name};
    }
}
else
{
    my ($hash)=$self-&gt;lookupCommitRef($ver);
    if( !defined($hash) )
    {
        return undef;
    }

    $cacheKey=$hash;
    if( defined($self-&gt;{revisionDirMapCache}{$cacheKey}) )
    {
        return $self-&gt;{revisionDirMapCache}{$cacheKey};
    }

    open(my $filePipe, &#39;-|&#39;, &#39;git&#39;, &#39;ls-tree&#39;, &#39;-z&#39;, &#39;-r&#39;, $hash)
            or die(&quot;Cannot call git-ls-tree : $!&quot;);
    local $/ = &quot;\0&quot;;
    while ( &lt;$filePipe&gt; )
    {
        chomp;
        unless ( /^(\d+)\s+(\w+)\s+([a-zA-Z0-9]+)\t(.*)$/o )
        {
            die(&quot;Couldn&#39;t process git-ls-tree line : $_&quot;);
        }

        my($mode, $git_type, $git_hash, $git_filename) = ($1, $2, $3, $4);

        push @fileList, $git_filename;
    }
    close $filePipe;
}

    # Convert to normalized form:
my %revMap;
my $file;
foreach $file (@fileList)
{
    my($dir) = ($file=~m%^(?:(.*)/)?([^/]*)$%);
    $dir=&#39;&#39; if(!defined($dir));

        # parent directories:
        # ... create empty dir maps for parent dirs:
    my($td)=$dir;
    while(!defined($revMap{$td}))
    {
        $revMap{$td}={};

        my($tp)=($td=~m%^(?:(.*)/)?([^/]*)$%);
        $tp=&#39;&#39; if(!defined($tp));
        $td=$tp;
    }
        # ... add children to parent maps (now that they exist):
    $td=$dir;
    while($td ne &quot;&quot;)
    {
        my($tp)=($td=~m%^(?:(.*)/)?([^/]*)$%);
        $tp=&#39;&#39; if(!defined($tp));

        if(defined($revMap{$tp}{$td}))
        {
            if($revMap{$tp}{$td} ne &#39;D&#39;)
            {
                die &quot;Weird file/directory inconsistency in $cacheKey&quot;;
            }
            last;   # loop exit
        }
        $revMap{$tp}{$td}=&#39;D&#39;;

        $td=$tp;
    }

        # file
    $revMap{$dir}{$file}=&#39;F&#39;;
}

    # Save in cache:
$self-&gt;{revisionDirMapCache}{$cacheKey}=\%revMap;
return $self-&gt;{revisionDirMapCache}{$cacheKey};</pre>

<p>}</p>

<h1 id="label-head2+getlog">head2 getlog<span><a href="#label-head2+getlog">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>See also gethistorydense().</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub getlog {</p>

<pre>my $self = shift;
my $filename = shift;
my $revFilter = shift;

my $tablename = $self-&gt;tablename(&quot;revision&quot;);

# Filters:
# TODO: date, state, or by specific logins filters?
# TODO: Handle comma-separated list of revFilter items, each item
#   can be a range [only case currently handled] or individual
#   rev or branch or &quot;branch.&quot;.
# TODO: Adjust $db_query WHERE clause based on revFilter, instead of
#   manually filtering the results of the query?
my ( $minrev, $maxrev );
if( defined($revFilter) and
    $state-&gt;{opt}{r} =~ /^(1.(\d+))?(::?)(1.(\d.+))?$/ )
{
    my $control = $3;
    $minrev = $2;
    $maxrev = $5;
    $minrev++ if ( defined($minrev) and $control eq &quot;::&quot; );
}

my $db_query = $self-&gt;{dbh}-&gt;prepare_cached(&quot;SELECT name, filehash, author, mode, revision, modified, commithash FROM $tablename WHERE name=? ORDER BY revision DESC&quot;,{},1);
$db_query-&gt;execute($filename);

my $totalRevs=0;
my $tree = [];
while ( my $file = $db_query-&gt;fetchrow_hashref )
{
    $totalRevs++;
    if( defined($minrev) and $file-&gt;{revision} &lt; $minrev )
    {
        next;
    }
    if( defined($maxrev) and $file-&gt;{revision} &gt; $maxrev )
    {
        next;
    }

    $file-&gt;{revision} = &quot;1.&quot; . $file-&gt;{revision};
    push @$tree, $file;
}

return ($tree,$totalRevs);</pre>

<p>}</p>

<h1 id="label-head2+getmeta">head2 getmeta<span><a href="#label-head2+getmeta">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>This function takes a filename (with path) argument and returns a hashref
of metadata for that file.</p>

<p>There are several ways $revision can be specified:</p>

<pre>- A reference to hash that contains a &quot;tag&quot; that is the
  actual revision (one of the below).  TODO: Also allow it to
  specify a &quot;date&quot; in the hash.
- undef, to refer to the latest version on the main branch.
- Full CVS client revision number (mapped to integer in DB, without the
  &quot;1.&quot; prefix),
- Complex CVS-compatible &quot;special&quot; revision number for
  non-linear history (see comment below)
- git commit sha1 hash
- branch or tag name</pre>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub getmeta {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$self</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$filename</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$revision</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$tablename_rev</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;revision&quot;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$tablename_head</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">tablename</span>(<span class="ruby-string">&quot;head&quot;</span>);

<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">ref</span>(<span class="ruby-identifier">$revision</span>) <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;HASH&quot;</span> )
{
    <span class="ruby-identifier">$revision</span> = <span class="ruby-identifier">$revision</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">tag</span>};
}

<span class="ruby-comment"># Overview of CVS revision numbers:</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># General CVS numbering scheme:</span>
<span class="ruby-comment">#   - Basic mainline branch numbers: &quot;1.1&quot;, &quot;1.2&quot;, &quot;1.3&quot;, etc.</span>
<span class="ruby-comment">#   - Result of &quot;cvs checkin -r&quot; (possible, but not really</span>
<span class="ruby-comment">#     recommended): &quot;2.1&quot;, &quot;2.2&quot;, etc</span>
<span class="ruby-comment">#   - Branch tag: &quot;1.2.0.n&quot;, where &quot;1.2&quot; is revision it was branched</span>
<span class="ruby-comment">#     from, &quot;0&quot; is a magic placeholder that identifies it as a</span>
<span class="ruby-comment">#     branch tag instead of a version tag, and n is 2 times the</span>
<span class="ruby-comment">#     branch number off of &quot;1.2&quot;, starting with &quot;2&quot;.</span>
<span class="ruby-comment">#   - Version on a branch: &quot;1.2.n.x&quot;, where &quot;1.2&quot; is branch-from, &quot;n&quot;</span>
<span class="ruby-comment">#     is branch number off of &quot;1.2&quot; (like n above), and &quot;x&quot; is</span>
<span class="ruby-comment">#     the version number on the branch.</span>
<span class="ruby-comment">#   - Branches can branch off of branches: &quot;1.3.2.7.4.1&quot; (even number</span>
<span class="ruby-comment">#     of components).</span>
<span class="ruby-comment">#   - Odd &quot;n&quot;s are used by &quot;vendor branches&quot; that result</span>
<span class="ruby-comment">#     from &quot;cvs import&quot;.  Vendor branches have additional</span>
<span class="ruby-comment">#     strangeness in the sense that the main rcs &quot;head&quot; of the main</span>
<span class="ruby-comment">#     branch will (temporarily until first normal commit) point</span>
<span class="ruby-comment">#     to the version on the vendor branch, rather than the actual</span>
<span class="ruby-comment">#     main branch.  (FUTURE: This may provide an opportunity</span>
<span class="ruby-comment">#     to use &quot;strange&quot; revision numbers for fast-forward-merged</span>
<span class="ruby-comment">#     branch tip when CVS client is asking for the main branch.)</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># git-cvsserver CVS-compatible special numbering schemes:</span>
<span class="ruby-comment">#   - Currently git-cvsserver only tries to be identical to CVS for</span>
<span class="ruby-comment">#     simple &quot;1.x&quot; numbers on the &quot;main&quot; branch (as identified</span>
<span class="ruby-comment">#     by the module name that was originally cvs checkout&#39;ed).</span>
<span class="ruby-comment">#   - The database only stores the &quot;x&quot; part, for historical reasons.</span>
<span class="ruby-comment">#     But most of the rest of the cvsserver preserves</span>
<span class="ruby-comment">#     and thinks using the full revision number.</span>
<span class="ruby-comment">#   - To handle non-linear history, it uses a version of the form</span>
<span class="ruby-comment">#     &quot;2.1.1.2000.b.b.b.&quot;..., where the 2.1.1.2000 is to help uniquely</span>
<span class="ruby-comment">#     identify this as a special revision number, and there are</span>
<span class="ruby-comment">#     20 b&#39;s that together encode the sha1 git commit from which</span>
<span class="ruby-comment">#     this version of this file originated.  Each b is</span>
<span class="ruby-comment">#     the numerical value of the corresponding byte plus</span>
<span class="ruby-comment">#     100.</span>
<span class="ruby-comment">#      - &quot;plus 100&quot; avoids &quot;0&quot;s, and also reduces the</span>
<span class="ruby-comment">#        likelihood of a collision in the case that someone someday</span>
<span class="ruby-comment">#        writes an import tool that tries to preserve original</span>
<span class="ruby-comment">#        CVS revision numbers, and the original CVS data had done</span>
<span class="ruby-comment">#        lots of branches off of branches and other strangeness to</span>
<span class="ruby-comment">#        end up with a real version number that just happens to look</span>
<span class="ruby-comment">#        like this special revision number form.  Also, if needed</span>
<span class="ruby-comment">#        there are several ways to extend/identify alternative encodings</span>
<span class="ruby-comment">#        within the &quot;2.1.1.2000&quot; part if necessary.</span>
<span class="ruby-comment">#      - Unlike real CVS revisions, you can&#39;t really reconstruct what</span>
<span class="ruby-comment">#        relation a revision of this form has to other revisions.</span>
<span class="ruby-comment">#   - FUTURE: TODO: Rework database somehow to make up and remember</span>
<span class="ruby-comment">#     fully-CVS-compatible branches and branch version numbers.</span>

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$meta</span>;
<span class="ruby-keyword">if</span> ( <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$revision</span>) )
{
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">$revision</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^1\.(\d+)$/</span> )
    {
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$intRev</span>) = <span class="ruby-node">$1</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$db_query</span>;
        <span class="ruby-identifier">$db_query</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">prepare_cached</span>(
            <span class="ruby-string">&quot;SELECT * FROM $tablename_rev WHERE name=? AND revision=?&quot;</span>,
            {},<span class="ruby-value">1</span>);
        <span class="ruby-identifier">$db_query</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">execute</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-identifier">$intRev</span>);
        <span class="ruby-identifier">$meta</span> = <span class="ruby-identifier">$db_query</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">fetchrow_hashref</span>;
    }
    <span class="ruby-keyword">elsif</span> ( <span class="ruby-identifier">$revision</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^2\.1\.1\.2000(\.[1-3][0-9][0-9]){20}$/</span> )
    {
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$commitHash</span>)=(<span class="ruby-identifier">$revision</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^2\.1\.1\.2000(.*)$/</span>);
        <span class="ruby-identifier">$commitHash</span><span class="ruby-operator">=~</span><span class="ruby-identifier">s</span><span class="ruby-operator">/</span>\.([<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span>]<span class="ruby-operator">+</span>)<span class="ruby-operator">/</span><span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;%02x&quot;</span>,<span class="ruby-node">$1</span><span class="ruby-operator">-</span><span class="ruby-value">100</span>)<span class="ruby-operator">/</span><span class="ruby-identifier">eg</span>;
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$commitHash</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^[0-9a-f]{40}$/</span>)
        {
            <span class="ruby-keyword">return</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getMetaFromCommithash</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-identifier">$commitHash</span>);
        }

        <span class="ruby-comment"># error recovery: fall back on head version below</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E Failed to find $filename version=$revision or commit=$commitHash\n&quot;</span>;
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;failed get $revision with commithash=$commitHash&quot;</span>);
        <span class="ruby-keyword">undef</span> <span class="ruby-identifier">$revision</span>;
    }
    <span class="ruby-keyword">elsif</span> ( <span class="ruby-identifier">$revision</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^[0-9a-f]{40}$/</span> )
    {
        <span class="ruby-comment"># Try DB first.  This is mostly only useful for req_annotate(),</span>
        <span class="ruby-comment"># which only calls this for stuff that should already be in</span>
        <span class="ruby-comment"># the DB.  It is fairly likely to be a waste of time</span>
        <span class="ruby-comment"># in most other cases [unless the file happened to be</span>
        <span class="ruby-comment"># modified in $revision specifically], but</span>
        <span class="ruby-comment"># it is probably in the noise compared to how long</span>
        <span class="ruby-comment"># getMetaFromCommithash() will take.</span>
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$db_query</span>;
        <span class="ruby-identifier">$db_query</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">prepare_cached</span>(
            <span class="ruby-string">&quot;SELECT * FROM $tablename_rev WHERE name=? AND commithash=?&quot;</span>,
            {},<span class="ruby-value">1</span>);
        <span class="ruby-identifier">$db_query</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">execute</span>(<span class="ruby-identifier">$filename</span>, <span class="ruby-identifier">$revision</span>);
        <span class="ruby-identifier">$meta</span> = <span class="ruby-identifier">$db_query</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">fetchrow_hashref</span>;

        <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span> <span class="ruby-identifier">$meta</span>)
        {
            <span class="ruby-identifier">my</span>(<span class="ruby-identifier">$revCommit</span>)=<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">lookupCommitRef</span>(<span class="ruby-identifier">$revision</span>);
            <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$revCommit</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^[0-9a-f]{40}$/</span>)
            {
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getMetaFromCommithash</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-identifier">$revCommit</span>);
            }

            <span class="ruby-comment"># error recovery: nothing found:</span>
            <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E Failed to find $filename version=$revision\n&quot;</span>;
            <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;failed get $revision&quot;</span>);
            <span class="ruby-keyword">return</span> <span class="ruby-identifier">$meta</span>;
        }
    }
    <span class="ruby-keyword">else</span>
    {
        <span class="ruby-identifier">my</span>(<span class="ruby-identifier">$revCommit</span>)=<span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">lookupCommitRef</span>(<span class="ruby-identifier">$revision</span>);
        <span class="ruby-keyword">if</span>(<span class="ruby-identifier">$revCommit</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/^[0-9a-f]{40}$/</span>)
        {
            <span class="ruby-keyword">return</span> <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">getMetaFromCommithash</span>(<span class="ruby-identifier">$filename</span>,<span class="ruby-identifier">$revCommit</span>);
        }

        <span class="ruby-comment"># error recovery: fall back on head version below</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;E Failed to find $filename version=$revision\n&quot;</span>;
        <span class="ruby-identifier">$log</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;failed get $revision&quot;</span>);
        <span class="ruby-keyword">undef</span> <span class="ruby-identifier">$revision</span>;  <span class="ruby-comment"># Allow fallback</span>
    }
}

<span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$revision</span>))
{
    <span class="ruby-identifier">my</span> <span class="ruby-identifier">$db_query</span>;
    <span class="ruby-identifier">$db_query</span> = <span class="ruby-identifier">$self</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">dbh</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">prepare_cached</span>(
            <span class="ruby-string">&quot;SELECT * FROM $tablename_head WHERE name=?&quot;</span>,{},<span class="ruby-value">1</span>);
    <span class="ruby-identifier">$db_query</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">execute</span>(<span class="ruby-identifier">$filename</span>);
    <span class="ruby-identifier">$meta</span> = <span class="ruby-identifier">$db_query</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">fetchrow_hashref</span>;
}

<span class="ruby-keyword">if</span>(<span class="ruby-identifier">$meta</span>)
{
    <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">revision</span>} = <span class="ruby-string">&quot;1.$meta-&gt;{revision}&quot;</span>;
}
<span class="ruby-keyword">return</span> <span class="ruby-identifier">$meta</span>;
</pre>

<p>}</p>

<p>sub getMetaFromCommithash {</p>

<pre>my $self = shift;
my $filename = shift;
my $revCommit = shift;

# NOTE: This function doesn&#39;t scale well (lots of forks), especially
#   if you have many files that have not been modified for many commits
#   (each git-rev-parse redoes a lot of work for each file
#   that theoretically could be done in parallel by smarter
#   graph traversal).
#
# TODO: Possible optimization strategies:
#   - Solve the issue of assigning and remembering &quot;real&quot; CVS
#     revision numbers for branches, and ensure the
#     data structure can do this efficiently.  Perhaps something
#     similar to &quot;git notes&quot;, and carefully structured to take
#     advantage same-sha1-is-same-contents, to roll the same
#     unmodified subdirectory data onto multiple commits?
#   - Write and use a C tool that is like git-blame, but
#     operates on multiple files with file granularity, instead
#     of one file with line granularity.  Cache
#     most-recently-modified in $self-&gt;{commitRefCache}{$revCommit}.
#     Try to be intelligent about how many files we do with
#     one fork (perhaps one directory at a time, without recursion,
#     and/or include directory as one line item, recurse from here
#     instead of in C tool?).
#   - Perhaps we could ask the DB for (filename,fileHash),
#     and just guess that it is correct (that the file hadn&#39;t
#     changed between $revCommit and the found commit, then
#     changed back, confusing anything trying to interpret
#     history).  Probably need to add another index to revisions
#     DB table for this.
#   - NOTE: Trying to store all (commit,file) keys in DB [to
#     find &quot;lastModfiedCommit] (instead of
#     just files that changed in each commit as we do now) is
#     probably not practical from a disk space perspective.

    # Does the file exist in $revCommit?
# TODO: Include file hash in dirmap cache.
my($dirMap)=$self-&gt;getRevisionDirMap($revCommit);
my($dir,$file)=($filename=~m%^(?:(.*)/)?([^/]*$)%);
if(!defined($dir))
{
    $dir=&quot;&quot;;
}
if( !defined($dirMap-&gt;{$dir}) ||
    !defined($dirMap-&gt;{$dir}{$filename}) )
{
    my($fileHash)=&quot;deleted&quot;;

    my($retVal)={};
    $retVal-&gt;{name}=$filename;
    $retVal-&gt;{filehash}=$fileHash;

        # not needed and difficult to compute:
    $retVal-&gt;{revision}=&quot;0&quot;;  # $revision;
    $retVal-&gt;{commithash}=$revCommit;
    #$retVal-&gt;{author}=$commit-&gt;{author};
    #$retVal-&gt;{modified}=convertToCvsDate($commit-&gt;{date});
    #$retVal-&gt;{mode}=convertToDbMode($mode);

    return $retVal;
}

my($fileHash)=safe_pipe_capture(&quot;git&quot;,&quot;rev-parse&quot;,&quot;$revCommit:$filename&quot;);
chomp $fileHash;
if(!($fileHash=~/^[0-9a-f]{40}$/))
{
    die &quot;Invalid fileHash &#39;$fileHash&#39; looking up&quot;
                .&quot; &#39;$revCommit:$filename&#39;\n&quot;;
}

# information about most recent commit to modify $filename:
open(my $gitLogPipe, &#39;-|&#39;, &#39;git&#39;, &#39;rev-list&#39;,
     &#39;--max-count=1&#39;, &#39;--pretty&#39;, &#39;--parents&#39;,
     $revCommit, &#39;--&#39;, $filename)
            or die &quot;Cannot call git-rev-list: $!&quot;;
my @commits=readCommits($gitLogPipe);
close $gitLogPipe;
if(scalar(@commits)!=1)
{
    die &quot;Can&#39;t find most recent commit changing $filename\n&quot;;
}
my($commit)=$commits[0];
if( !defined($commit) || !defined($commit-&gt;{hash}) )
{
    return undef;
}

# does this (commit,file) have a real assigned CVS revision number?
my $tablename_rev = $self-&gt;tablename(&quot;revision&quot;);
my $db_query;
$db_query = $self-&gt;{dbh}-&gt;prepare_cached(
    &quot;SELECT * FROM $tablename_rev WHERE name=? AND commithash=?&quot;,
    {},1);
$db_query-&gt;execute($filename, $commit-&gt;{hash});
my($meta)=$db_query-&gt;fetchrow_hashref;
if($meta)
{
    $meta-&gt;{revision} = &quot;1.$meta-&gt;{revision}&quot;;
    return $meta;
}

# fall back on special revision number
my($revision)=$commit-&gt;{hash};
$revision=~s/(..)/&#39;.&#39; . (hex($1)+100)/eg;
$revision=&quot;2.1.1.2000$revision&quot;;

# meta data about $filename:
open(my $filePipe, &#39;-|&#39;, &#39;git&#39;, &#39;ls-tree&#39;, &#39;-z&#39;,
            $commit-&gt;{hash}, &#39;--&#39;, $filename)
        or die(&quot;Cannot call git-ls-tree : $!&quot;);
local $/ = &quot;\0&quot;;
my $line;
$line=&lt;$filePipe&gt;;
if(defined(&lt;$filePipe&gt;))
{
    die &quot;Expected only a single file for git-ls-tree $filename\n&quot;;
}
close $filePipe;

chomp $line;
unless ( $line=~m/^(\d+)\s+(\w+)\s+([a-zA-Z0-9]+)\t(.*)$/o )
{
    die(&quot;Couldn&#39;t process git-ls-tree line : $line\n&quot;);
}
my ( $mode, $git_type, $git_hash, $git_filename ) = ( $1, $2, $3, $4 );

# save result:
my($retVal)={};
$retVal-&gt;{name}=$filename;
$retVal-&gt;{revision}=$revision;
$retVal-&gt;{filehash}=$fileHash;
$retVal-&gt;{commithash}=$revCommit;
$retVal-&gt;{author}=$commit-&gt;{author};
$retVal-&gt;{modified}=convertToCvsDate($commit-&gt;{date});
$retVal-&gt;{mode}=convertToDbMode($mode);

return $retVal;</pre>

<p>}</p>

<h1 id="label-head2+lookupCommitRef">head2 lookupCommitRef<span><a href="#label-head2+lookupCommitRef">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Convert tag/branch/abbreviation/etc into a commit sha1 hash.  Caches the
result so looking it up again is fast.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub lookupCommitRef {</p>

<pre>my $self = shift;
my $ref = shift;

my $commitHash = $self-&gt;{commitRefCache}{$ref};
if(defined($commitHash))
{
    return $commitHash;
}

$commitHash=safe_pipe_capture(&quot;git&quot;,&quot;rev-parse&quot;,&quot;--verify&quot;,&quot;--quiet&quot;,
                              $self-&gt;unescapeRefName($ref));
$commitHash=~s/\s*$//;
if(!($commitHash=~/^[0-9a-f]{40}$/))
{
    $commitHash=undef;
}

if( defined($commitHash) )
{
    my $type=safe_pipe_capture(&quot;git&quot;,&quot;cat-file&quot;,&quot;-t&quot;,$commitHash);
    if( ! ($type=~/^commit\s*$/ ) )
    {
        $commitHash=undef;
    }
}
if(defined($commitHash))
{
    $self-&gt;{commitRefCache}{$ref}=$commitHash;
}
return $commitHash;</pre>

<p>}</p>

<h1 id="label-head2+clearCommitRefCaches">head2 clearCommitRefCaches<span><a href="#label-head2+clearCommitRefCaches">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Clears cached commit cache (sha1&#39;s for various tags/abbeviations/etc),
and related caches.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub clearCommitRefCaches {</p>

<pre>my $self = shift;
$self-&gt;{commitRefCache} = {};
$self-&gt;{revisionDirMapCache} = undef;
$self-&gt;{gethead_cache} = undef;</pre>

<p>}</p>

<h1 id="label-head2+commitmessage">head2 commitmessage<span><a href="#label-head2+commitmessage">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>this function takes a commithash and returns the commit message for that
commit</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub commitmessage {</p>

<pre>my $self = shift;
my $commithash = shift;
my $tablename = $self-&gt;tablename(&quot;commitmsgs&quot;);

die(&quot;Need commithash&quot;) unless ( defined($commithash) and $commithash =~ /^[a-zA-Z0-9]{40}$/ );

my $db_query;
$db_query = $self-&gt;{dbh}-&gt;prepare_cached(&quot;SELECT value FROM $tablename WHERE key=?&quot;,{},1);
$db_query-&gt;execute($commithash);

my ( $message ) = $db_query-&gt;fetchrow_array;

if ( defined ( $message ) )
{
    $message .= &quot; &quot; if ( $message =~ /\n$/ );
    return $message;
}

my @lines = safe_pipe_capture(&quot;git&quot;, &quot;cat-file&quot;, &quot;commit&quot;, $commithash);
shift @lines while ( $lines[0] =~ /\S/ );
$message = join(&quot;&quot;,@lines);
$message .= &quot; &quot; if ( $message =~ /\n$/ );
return $message;</pre>

<p>}</p>

<h1 id="label-head2+gethistorydense">head2 gethistorydense<span><a href="#label-head2+gethistorydense">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>This function takes a filename (with path) argument and returns an
arrayofarrays containing revision,filehash,commithash ordered by revision
descending.</p>

<p>This version of gethistory skips deleted entries – so it is useful for
annotate. The &#39;dense&#39; part is a reference to a &#39;–dense&#39;
option available for git-rev-list and other git tools that depend on it.</p>

<p>See also getlog().</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub gethistorydense {</p>

<pre>my $self = shift;
my $filename = shift;
my $tablename = $self-&gt;tablename(&quot;revision&quot;);

my $db_query;
$db_query = $self-&gt;{dbh}-&gt;prepare_cached(&quot;SELECT revision, filehash, commithash FROM $tablename WHERE name=? AND filehash!=&#39;deleted&#39; ORDER BY revision DESC&quot;,{},1);
$db_query-&gt;execute($filename);

my $result = $db_query-&gt;fetchall_arrayref;

my $i;
for($i=0 ; $i&lt;scalar(@$result) ; $i++)
{
    $result-&gt;[$i][0]=&quot;1.&quot; . $result-&gt;[$i][0];
}

return $result;</pre>

<p>}</p>

<h1 id="label-head2+escapeRefName">head2 escapeRefName<span><a href="#label-head2+escapeRefName">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Apply an escape mechanism to compensate for characters that git ref names
can have that CVS tags can not.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub escapeRefName {</p>

<pre>my($self,$refName)=@_;

# CVS officially only allows [-_A-Za-z0-9] in tag names (or in
# many contexts it can also be a CVS revision number).
#
# Git tags commonly use &#39;/&#39; and &#39;.&#39; as well, but also handle
# anything else just in case:
#
#   = &quot;_-s-&quot;  For &#39;/&#39;.
#   = &quot;_-p-&quot;  For &#39;.&#39;.
#   = &quot;_-u-&quot;  For underscore, in case someone wants a literal &quot;_-&quot; in
#     a tag name.
#   = &quot;_-xx-&quot; Where &quot;xx&quot; is the hexadecimal representation of the
#     desired ASCII character byte. (for anything else)

if(! $refName=~/^[1-9][0-9]*(\.[1-9][0-9]*)*$/)
{
    $refName=~s/_-/_-u--/g;
    $refName=~s/\./_-p-/g;
    $refName=~s%/%_-s-%g;
    $refName=~s/[^-_a-zA-Z0-9]/sprintf(&quot;_-%02x-&quot;,$1)/eg;
}</pre>

<p>}</p>

<h1 id="label-head2+unescapeRefName">head2 unescapeRefName<span><a href="#label-head2+unescapeRefName">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Undo an escape mechanism to compensate for characters that git ref names
can have that CVS tags can not.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub unescapeRefName {</p>

<pre>my($self,$refName)=@_;

# see escapeRefName() for description of escape mechanism.

$refName=~s/_-([spu]|[0-9a-f][0-9a-f])-/unescapeRefNameChar($1)/eg;

# allowed tag names
# TODO: Perhaps use git check-ref-format, with an in-process cache of
#  validated names?
if( !( $refName=~m%^[^-][-a-zA-Z0-9_/.]*$% ) ||
    ( $refName=~m%[/.]$% ) ||
    ( $refName=~/\.lock$/ ) ||
    ( $refName=~m%\.\.|/\.|[[\\:?*~]|\@\{% ) )  # matching }
{
    # Error:
    $log-&gt;warn(&quot;illegal refName: $refName&quot;);
    $refName=undef;
}
return $refName;</pre>

<p>}</p>

<p>sub unescapeRefNameChar {</p>

<pre>my($char)=@_;

if($char eq &quot;s&quot;)
{
    $char=&quot;/&quot;;
}
elsif($char eq &quot;p&quot;)
{
    $char=&quot;.&quot;;
}
elsif($char eq &quot;u&quot;)
{
    $char=&quot;_&quot;;
}
elsif($char=~/^[0-9a-f][0-9a-f]$/)
{
    $char=chr(hex($char));
}
else
{
    # Error case: Maybe it has come straight from user, and
    # wasn&#39;t supposed to be escaped?  Restore it the way we got it:
    $char=&quot;_-$char-&quot;;
}

return $char;</pre>

<p>}</p>

<h1 id="label-head2+in_array%28%29">head2 in_array()<span><a href="#label-head2+in_array%28%29">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>from Array::PAT - mimics the in_array() function found in PHP. Yuck but
works for small arrays.</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub in_array {</p>

<pre>my ($check, @array) = @_;
my $retval = 0;
foreach my $test (@array){
    if($check eq $test){
        $retval =  1;
    }
}
return $retval;</pre>

<p>}</p>

<h1 id="label-head2+safe_pipe_capture">head2 safe_pipe_capture<span><a href="#label-head2+safe_pipe_capture">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>an alternative to `command` that allows input to be passed as an array to
work around shell problems with weird characters in arguments</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub safe_pipe_capture {</p>

<pre>my @output;

if (my $pid = open my $child, &#39;-|&#39;) {
    @output = (&lt;$child&gt;);
    close $child or die join(&#39; &#39;,@_).&quot;: $! $?&quot;;
} else {
    exec(@_) or die &quot;$! $?&quot;; # exec() can fail the executable can&#39;t be found
}
return wantarray ? @output : join(&#39;&#39;,@output);</pre>

<p>}</p>

<h1 id="label-head2+mangle_dirname">head2 mangle_dirname<span><a href="#label-head2+mangle_dirname">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>create a string from a directory name that is suitable to use as part of a
filename, mainly by converting all chars except w.- to _</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub mangle_dirname {</p>

<pre>my $dirname = shift;
return unless defined $dirname;

$dirname =~ s/[^\w.-]/_/g;

return $dirname;</pre>

<p>}</p>

<h1 id="label-head2+mangle_tablename">head2 mangle_tablename<span><a href="#label-head2+mangle_tablename">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>create a string from a that is suitable to use as part of an SQL table
name, mainly by converting all chars except w to _</p>

<h1 id="label-cut">cut<span><a href="#label-cut">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>sub mangle_tablename {</p>

<pre>my $tablename = shift;
return unless defined $tablename;

$tablename =~ s/[^\w_]/_/g;

return $tablename;</pre>

<p>}</p>

<p>1;</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

