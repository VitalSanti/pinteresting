<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>gitweb.perl - RDoc Documentation</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../README_md.html">README</a>
  
    <li><a href="../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../app/assets/javascripts/pages_js_coffee.html">pages.js.coffee</a>
  
    <li><a href="../../app/assets/javascripts/pins_js_coffee.html">pins.js.coffee</a>
  
    <li><a href="../../app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="../../app/assets/stylesheets/bootstrap_and_customization_css_scss.html">bootstrap_and_customization.css.scss</a>
  
    <li><a href="../../app/assets/stylesheets/pages_css_scss.html">pages.css.scss</a>
  
    <li><a href="../../app/assets/stylesheets/pins_css_scss.html">pins.css.scss</a>
  
    <li><a href="../../config_ru.html">config.ru</a>
  
    <li><a href="../../git/COPYING.html">COPYING</a>
  
    <li><a href="../../git/Documentation/CodingGuidelines.html">CodingGuidelines</a>
  
    <li><a href="../../git/Documentation/Makefile.html">Makefile</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_0_1_txt.html">1.5.0.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_0_2_txt.html">1.5.0.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_0_3_txt.html">1.5.0.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_0_4_txt.html">1.5.0.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_0_5_txt.html">1.5.0.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_0_6_txt.html">1.5.0.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_0_7_txt.html">1.5.0.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_0_txt.html">1.5.0</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_1_1_txt.html">1.5.1.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_1_2_txt.html">1.5.1.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_1_3_txt.html">1.5.1.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_1_4_txt.html">1.5.1.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_1_5_txt.html">1.5.1.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_1_6_txt.html">1.5.1.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_1_txt.html">1.5.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_2_1_txt.html">1.5.2.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_2_2_txt.html">1.5.2.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_2_3_txt.html">1.5.2.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_2_4_txt.html">1.5.2.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_2_5_txt.html">1.5.2.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_2_txt.html">1.5.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_1_txt.html">1.5.3.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_2_txt.html">1.5.3.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_3_txt.html">1.5.3.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_4_txt.html">1.5.3.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_5_txt.html">1.5.3.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_6_txt.html">1.5.3.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_7_txt.html">1.5.3.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_8_txt.html">1.5.3.8</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_3_txt.html">1.5.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_4_1_txt.html">1.5.4.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_4_2_txt.html">1.5.4.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_4_3_txt.html">1.5.4.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_4_4_txt.html">1.5.4.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_4_5_txt.html">1.5.4.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_4_6_txt.html">1.5.4.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_4_7_txt.html">1.5.4.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_4_txt.html">1.5.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_5_1_txt.html">1.5.5.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_5_2_txt.html">1.5.5.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_5_3_txt.html">1.5.5.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_5_4_txt.html">1.5.5.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_5_5_txt.html">1.5.5.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_5_6_txt.html">1.5.5.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_5_txt.html">1.5.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_6_1_txt.html">1.5.6.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_6_2_txt.html">1.5.6.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_6_3_txt.html">1.5.6.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_6_4_txt.html">1.5.6.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_6_5_txt.html">1.5.6.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_6_6_txt.html">1.5.6.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_5_6_txt.html">1.5.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_0_1_txt.html">1.6.0.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_0_2_txt.html">1.6.0.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_0_3_txt.html">1.6.0.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_0_4_txt.html">1.6.0.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_0_5_txt.html">1.6.0.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_0_6_txt.html">1.6.0.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_0_txt.html">1.6.0</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_1_1_txt.html">1.6.1.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_1_2_txt.html">1.6.1.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_1_3_txt.html">1.6.1.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_1_4_txt.html">1.6.1.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_1_txt.html">1.6.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_2_1_txt.html">1.6.2.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_2_2_txt.html">1.6.2.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_2_3_txt.html">1.6.2.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_2_4_txt.html">1.6.2.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_2_5_txt.html">1.6.2.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_2_txt.html">1.6.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_3_1_txt.html">1.6.3.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_3_2_txt.html">1.6.3.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_3_3_txt.html">1.6.3.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_3_4_txt.html">1.6.3.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_3_txt.html">1.6.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_4_1_txt.html">1.6.4.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_4_2_txt.html">1.6.4.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_4_3_txt.html">1.6.4.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_4_4_txt.html">1.6.4.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_4_5_txt.html">1.6.4.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_4_txt.html">1.6.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_1_txt.html">1.6.5.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_2_txt.html">1.6.5.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_3_txt.html">1.6.5.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_4_txt.html">1.6.5.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_5_txt.html">1.6.5.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_6_txt.html">1.6.5.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_7_txt.html">1.6.5.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_8_txt.html">1.6.5.8</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_9_txt.html">1.6.5.9</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_5_txt.html">1.6.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_6_1_txt.html">1.6.6.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_6_2_txt.html">1.6.6.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_6_3_txt.html">1.6.6.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_6_6_txt.html">1.6.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_1_txt.html">1.7.0.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_2_txt.html">1.7.0.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_3_txt.html">1.7.0.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_4_txt.html">1.7.0.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_5_txt.html">1.7.0.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_6_txt.html">1.7.0.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_7_txt.html">1.7.0.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_8_txt.html">1.7.0.8</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_9_txt.html">1.7.0.9</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_0_txt.html">1.7.0</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_1_1_txt.html">1.7.1.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_1_2_txt.html">1.7.1.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_1_3_txt.html">1.7.1.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_1_4_txt.html">1.7.1.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_1_txt.html">1.7.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_10_1_txt.html">1.7.10.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_10_2_txt.html">1.7.10.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_10_3_txt.html">1.7.10.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_10_4_txt.html">1.7.10.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_10_5_txt.html">1.7.10.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_10_txt.html">1.7.10</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_11_1_txt.html">1.7.11.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_11_2_txt.html">1.7.11.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_11_3_txt.html">1.7.11.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_11_4_txt.html">1.7.11.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_11_5_txt.html">1.7.11.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_11_6_txt.html">1.7.11.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_11_7_txt.html">1.7.11.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_11_txt.html">1.7.11</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_12_1_txt.html">1.7.12.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_12_2_txt.html">1.7.12.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_12_3_txt.html">1.7.12.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_12_4_txt.html">1.7.12.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_12_txt.html">1.7.12</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_2_1_txt.html">1.7.2.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_2_2_txt.html">1.7.2.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_2_3_txt.html">1.7.2.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_2_4_txt.html">1.7.2.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_2_5_txt.html">1.7.2.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_2_txt.html">1.7.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_3_1_txt.html">1.7.3.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_3_2_txt.html">1.7.3.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_3_3_txt.html">1.7.3.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_3_4_txt.html">1.7.3.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_3_5_txt.html">1.7.3.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_3_txt.html">1.7.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_4_1_txt.html">1.7.4.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_4_2_txt.html">1.7.4.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_4_3_txt.html">1.7.4.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_4_4_txt.html">1.7.4.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_4_5_txt.html">1.7.4.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_4_txt.html">1.7.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_5_1_txt.html">1.7.5.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_5_2_txt.html">1.7.5.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_5_3_txt.html">1.7.5.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_5_4_txt.html">1.7.5.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_5_txt.html">1.7.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_6_1_txt.html">1.7.6.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_6_2_txt.html">1.7.6.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_6_3_txt.html">1.7.6.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_6_4_txt.html">1.7.6.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_6_5_txt.html">1.7.6.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_6_6_txt.html">1.7.6.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_6_txt.html">1.7.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_7_1_txt.html">1.7.7.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_7_2_txt.html">1.7.7.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_7_3_txt.html">1.7.7.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_7_4_txt.html">1.7.7.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_7_5_txt.html">1.7.7.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_7_6_txt.html">1.7.7.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_7_7_txt.html">1.7.7.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_7_txt.html">1.7.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_8_1_txt.html">1.7.8.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_8_2_txt.html">1.7.8.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_8_3_txt.html">1.7.8.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_8_4_txt.html">1.7.8.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_8_5_txt.html">1.7.8.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_8_6_txt.html">1.7.8.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_8_txt.html">1.7.8</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_9_1_txt.html">1.7.9.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_9_2_txt.html">1.7.9.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_9_3_txt.html">1.7.9.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_9_4_txt.html">1.7.9.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_9_5_txt.html">1.7.9.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_9_6_txt.html">1.7.9.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_9_7_txt.html">1.7.9.7</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_7_9_txt.html">1.7.9</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_0_1_txt.html">1.8.0.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_0_2_txt.html">1.8.0.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_0_3_txt.html">1.8.0.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_0_txt.html">1.8.0</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_1_1_txt.html">1.8.1.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_1_2_txt.html">1.8.1.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_1_3_txt.html">1.8.1.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_1_4_txt.html">1.8.1.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_1_5_txt.html">1.8.1.5</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_1_6_txt.html">1.8.1.6</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_1_txt.html">1.8.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_2_1_txt.html">1.8.2.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_2_2_txt.html">1.8.2.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_2_3_txt.html">1.8.2.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_2_txt.html">1.8.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_3_1_txt.html">1.8.3.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_3_2_txt.html">1.8.3.2</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_3_3_txt.html">1.8.3.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_3_4_txt.html">1.8.3.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_3_txt.html">1.8.3</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_4_1_txt.html">1.8.4.1</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_4_txt.html">1.8.4</a>
  
    <li><a href="../../git/Documentation/RelNotes/1_8_5_txt.html">1.8.5</a>
  
    <li><a href="../../git/Documentation/SubmittingPatches.html">SubmittingPatches</a>
  
    <li><a href="../../git/Documentation/asciidoc_conf.html">asciidoc.conf</a>
  
    <li><a href="../../git/Documentation/blame-options_txt.html">blame-options</a>
  
    <li><a href="../../git/Documentation/build-docdep_perl.html">build-docdep.perl</a>
  
    <li><a href="../../git/Documentation/cat-texi_perl.html">cat-texi.perl</a>
  
    <li><a href="../../git/Documentation/cmd-list_perl.html">cmd-list.perl</a>
  
    <li><a href="../../git/Documentation/config_txt.html">config</a>
  
    <li><a href="../../git/Documentation/date-formats_txt.html">date-formats</a>
  
    <li><a href="../../git/Documentation/diff-config_txt.html">diff-config</a>
  
    <li><a href="../../git/Documentation/diff-format_txt.html">diff-format</a>
  
    <li><a href="../../git/Documentation/diff-generate-patch_txt.html">diff-generate-patch</a>
  
    <li><a href="../../git/Documentation/diff-options_txt.html">diff-options</a>
  
    <li><a href="../../git/Documentation/docbook-xsl_css.html">docbook-xsl.css</a>
  
    <li><a href="../../git/Documentation/docbook_xsl.html">docbook.xsl</a>
  
    <li><a href="../../git/Documentation/everyday_txt.html">everyday</a>
  
    <li><a href="../../git/Documentation/fetch-options_txt.html">fetch-options</a>
  
    <li><a href="../../git/Documentation/fix-texi_perl.html">fix-texi.perl</a>
  
    <li><a href="../../git/Documentation/git-add_txt.html">git-add</a>
  
    <li><a href="../../git/Documentation/git-am_txt.html">git-am</a>
  
    <li><a href="../../git/Documentation/git-annotate_txt.html">git-annotate</a>
  
    <li><a href="../../git/Documentation/git-apply_txt.html">git-apply</a>
  
    <li><a href="../../git/Documentation/git-archimport_txt.html">git-archimport</a>
  
    <li><a href="../../git/Documentation/git-archive_txt.html">git-archive</a>
  
    <li><a href="../../git/Documentation/git-bisect-lk2009_txt.html">git-bisect-lk2009</a>
  
    <li><a href="../../git/Documentation/git-bisect_txt.html">git-bisect</a>
  
    <li><a href="../../git/Documentation/git-blame_txt.html">git-blame</a>
  
    <li><a href="../../git/Documentation/git-branch_txt.html">git-branch</a>
  
    <li><a href="../../git/Documentation/git-bundle_txt.html">git-bundle</a>
  
    <li><a href="../../git/Documentation/git-cat-file_txt.html">git-cat-file</a>
  
    <li><a href="../../git/Documentation/git-check-attr_txt.html">git-check-attr</a>
  
    <li><a href="../../git/Documentation/git-check-ignore_txt.html">git-check-ignore</a>
  
    <li><a href="../../git/Documentation/git-check-mailmap_txt.html">git-check-mailmap</a>
  
    <li><a href="../../git/Documentation/git-check-ref-format_txt.html">git-check-ref-format</a>
  
    <li><a href="../../git/Documentation/git-checkout-index_txt.html">git-checkout-index</a>
  
    <li><a href="../../git/Documentation/git-checkout_txt.html">git-checkout</a>
  
    <li><a href="../../git/Documentation/git-cherry-pick_txt.html">git-cherry-pick</a>
  
    <li><a href="../../git/Documentation/git-cherry_txt.html">git-cherry</a>
  
    <li><a href="../../git/Documentation/git-citool_txt.html">git-citool</a>
  
    <li><a href="../../git/Documentation/git-clean_txt.html">git-clean</a>
  
    <li><a href="../../git/Documentation/git-clone_txt.html">git-clone</a>
  
    <li><a href="../../git/Documentation/git-column_txt.html">git-column</a>
  
    <li><a href="../../git/Documentation/git-commit-tree_txt.html">git-commit-tree</a>
  
    <li><a href="../../git/Documentation/git-commit_txt.html">git-commit</a>
  
    <li><a href="../../git/Documentation/git-config_txt.html">git-config</a>
  
    <li><a href="../../git/Documentation/git-count-objects_txt.html">git-count-objects</a>
  
    <li><a href="../../git/Documentation/git-credential-cache--daemon_txt.html">git-credential-cache--daemon</a>
  
    <li><a href="../../git/Documentation/git-credential-cache_txt.html">git-credential-cache</a>
  
    <li><a href="../../git/Documentation/git-credential-store_txt.html">git-credential-store</a>
  
    <li><a href="../../git/Documentation/git-credential_txt.html">git-credential</a>
  
    <li><a href="../../git/Documentation/git-cvsexportcommit_txt.html">git-cvsexportcommit</a>
  
    <li><a href="../../git/Documentation/git-cvsimport_txt.html">git-cvsimport</a>
  
    <li><a href="../../git/Documentation/git-cvsserver_txt.html">git-cvsserver</a>
  
    <li><a href="../../git/Documentation/git-daemon_txt.html">git-daemon</a>
  
    <li><a href="../../git/Documentation/git-describe_txt.html">git-describe</a>
  
    <li><a href="../../git/Documentation/git-diff-files_txt.html">git-diff-files</a>
  
    <li><a href="../../git/Documentation/git-diff-index_txt.html">git-diff-index</a>
  
    <li><a href="../../git/Documentation/git-diff-tree_txt.html">git-diff-tree</a>
  
    <li><a href="../../git/Documentation/git-diff_txt.html">git-diff</a>
  
    <li><a href="../../git/Documentation/git-difftool_txt.html">git-difftool</a>
  
    <li><a href="../../git/Documentation/git-fast-export_txt.html">git-fast-export</a>
  
    <li><a href="../../git/Documentation/git-fast-import_txt.html">git-fast-import</a>
  
    <li><a href="../../git/Documentation/git-fetch-pack_txt.html">git-fetch-pack</a>
  
    <li><a href="../../git/Documentation/git-fetch_txt.html">git-fetch</a>
  
    <li><a href="../../git/Documentation/git-filter-branch_txt.html">git-filter-branch</a>
  
    <li><a href="../../git/Documentation/git-fmt-merge-msg_txt.html">git-fmt-merge-msg</a>
  
    <li><a href="../../git/Documentation/git-for-each-ref_txt.html">git-for-each-ref</a>
  
    <li><a href="../../git/Documentation/git-format-patch_txt.html">git-format-patch</a>
  
    <li><a href="../../git/Documentation/git-fsck-objects_txt.html">git-fsck-objects</a>
  
    <li><a href="../../git/Documentation/git-fsck_txt.html">git-fsck</a>
  
    <li><a href="../../git/Documentation/git-gc_txt.html">git-gc</a>
  
    <li><a href="../../git/Documentation/git-get-tar-commit-id_txt.html">git-get-tar-commit-id</a>
  
    <li><a href="../../git/Documentation/git-grep_txt.html">git-grep</a>
  
    <li><a href="../../git/Documentation/git-gui_txt.html">git-gui</a>
  
    <li><a href="../../git/Documentation/git-hash-object_txt.html">git-hash-object</a>
  
    <li><a href="../../git/Documentation/git-help_txt.html">git-help</a>
  
    <li><a href="../../git/Documentation/git-http-backend_txt.html">git-http-backend</a>
  
    <li><a href="../../git/Documentation/git-http-fetch_txt.html">git-http-fetch</a>
  
    <li><a href="../../git/Documentation/git-http-push_txt.html">git-http-push</a>
  
    <li><a href="../../git/Documentation/git-imap-send_txt.html">git-imap-send</a>
  
    <li><a href="../../git/Documentation/git-index-pack_txt.html">git-index-pack</a>
  
    <li><a href="../../git/Documentation/git-init-db_txt.html">git-init-db</a>
  
    <li><a href="../../git/Documentation/git-init_txt.html">git-init</a>
  
    <li><a href="../../git/Documentation/git-instaweb_txt.html">git-instaweb</a>
  
    <li><a href="../../git/Documentation/git-log_txt.html">git-log</a>
  
    <li><a href="../../git/Documentation/git-lost-found_txt.html">git-lost-found</a>
  
    <li><a href="../../git/Documentation/git-ls-files_txt.html">git-ls-files</a>
  
    <li><a href="../../git/Documentation/git-ls-remote_txt.html">git-ls-remote</a>
  
    <li><a href="../../git/Documentation/git-ls-tree_txt.html">git-ls-tree</a>
  
    <li><a href="../../git/Documentation/git-mailinfo_txt.html">git-mailinfo</a>
  
    <li><a href="../../git/Documentation/git-mailsplit_txt.html">git-mailsplit</a>
  
    <li><a href="../../git/Documentation/git-merge-base_txt.html">git-merge-base</a>
  
    <li><a href="../../git/Documentation/git-merge-file_txt.html">git-merge-file</a>
  
    <li><a href="../../git/Documentation/git-merge-index_txt.html">git-merge-index</a>
  
    <li><a href="../../git/Documentation/git-merge-one-file_txt.html">git-merge-one-file</a>
  
    <li><a href="../../git/Documentation/git-merge-tree_txt.html">git-merge-tree</a>
  
    <li><a href="../../git/Documentation/git-merge_txt.html">git-merge</a>
  
    <li><a href="../../git/Documentation/git-mergetool--lib_txt.html">git-mergetool--lib</a>
  
    <li><a href="../../git/Documentation/git-mergetool_txt.html">git-mergetool</a>
  
    <li><a href="../../git/Documentation/git-mktag_txt.html">git-mktag</a>
  
    <li><a href="../../git/Documentation/git-mktree_txt.html">git-mktree</a>
  
    <li><a href="../../git/Documentation/git-mv_txt.html">git-mv</a>
  
    <li><a href="../../git/Documentation/git-name-rev_txt.html">git-name-rev</a>
  
    <li><a href="../../git/Documentation/git-notes_txt.html">git-notes</a>
  
    <li><a href="../../git/Documentation/git-p4_txt.html">git-p4</a>
  
    <li><a href="../../git/Documentation/git-pack-objects_txt.html">git-pack-objects</a>
  
    <li><a href="../../git/Documentation/git-pack-redundant_txt.html">git-pack-redundant</a>
  
    <li><a href="../../git/Documentation/git-pack-refs_txt.html">git-pack-refs</a>
  
    <li><a href="../../git/Documentation/git-parse-remote_txt.html">git-parse-remote</a>
  
    <li><a href="../../git/Documentation/git-patch-id_txt.html">git-patch-id</a>
  
    <li><a href="../../git/Documentation/git-peek-remote_txt.html">git-peek-remote</a>
  
    <li><a href="../../git/Documentation/git-prune-packed_txt.html">git-prune-packed</a>
  
    <li><a href="../../git/Documentation/git-prune_txt.html">git-prune</a>
  
    <li><a href="../../git/Documentation/git-pull_txt.html">git-pull</a>
  
    <li><a href="../../git/Documentation/git-push_txt.html">git-push</a>
  
    <li><a href="../../git/Documentation/git-quiltimport_txt.html">git-quiltimport</a>
  
    <li><a href="../../git/Documentation/git-read-tree_txt.html">git-read-tree</a>
  
    <li><a href="../../git/Documentation/git-rebase_txt.html">git-rebase</a>
  
    <li><a href="../../git/Documentation/git-receive-pack_txt.html">git-receive-pack</a>
  
    <li><a href="../../git/Documentation/git-reflog_txt.html">git-reflog</a>
  
    <li><a href="../../git/Documentation/git-relink_txt.html">git-relink</a>
  
    <li><a href="../../git/Documentation/git-remote-ext_txt.html">git-remote-ext</a>
  
    <li><a href="../../git/Documentation/git-remote-fd_txt.html">git-remote-fd</a>
  
    <li><a href="../../git/Documentation/git-remote-helpers_txto.html">git-remote-helpers.txto</a>
  
    <li><a href="../../git/Documentation/git-remote-testgit_txt.html">git-remote-testgit</a>
  
    <li><a href="../../git/Documentation/git-remote_txt.html">git-remote</a>
  
    <li><a href="../../git/Documentation/git-repack_txt.html">git-repack</a>
  
    <li><a href="../../git/Documentation/git-replace_txt.html">git-replace</a>
  
    <li><a href="../../git/Documentation/git-repo-config_txt.html">git-repo-config</a>
  
    <li><a href="../../git/Documentation/git-request-pull_txt.html">git-request-pull</a>
  
    <li><a href="../../git/Documentation/git-rerere_txt.html">git-rerere</a>
  
    <li><a href="../../git/Documentation/git-reset_txt.html">git-reset</a>
  
    <li><a href="../../git/Documentation/git-rev-list_txt.html">git-rev-list</a>
  
    <li><a href="../../git/Documentation/git-rev-parse_txt.html">git-rev-parse</a>
  
    <li><a href="../../git/Documentation/git-revert_txt.html">git-revert</a>
  
    <li><a href="../../git/Documentation/git-rm_txt.html">git-rm</a>
  
    <li><a href="../../git/Documentation/git-send-email_txt.html">git-send-email</a>
  
    <li><a href="../../git/Documentation/git-send-pack_txt.html">git-send-pack</a>
  
    <li><a href="../../git/Documentation/git-sh-i18n--envsubst_txt.html">git-sh-i18n--envsubst</a>
  
    <li><a href="../../git/Documentation/git-sh-i18n_txt.html">git-sh-i18n</a>
  
    <li><a href="../../git/Documentation/git-sh-setup_txt.html">git-sh-setup</a>
  
    <li><a href="../../git/Documentation/git-shell_txt.html">git-shell</a>
  
    <li><a href="../../git/Documentation/git-shortlog_txt.html">git-shortlog</a>
  
    <li><a href="../../git/Documentation/git-show-branch_txt.html">git-show-branch</a>
  
    <li><a href="../../git/Documentation/git-show-index_txt.html">git-show-index</a>
  
    <li><a href="../../git/Documentation/git-show-ref_txt.html">git-show-ref</a>
  
    <li><a href="../../git/Documentation/git-show_txt.html">git-show</a>
  
    <li><a href="../../git/Documentation/git-stage_txt.html">git-stage</a>
  
    <li><a href="../../git/Documentation/git-stash_txt.html">git-stash</a>
  
    <li><a href="../../git/Documentation/git-status_txt.html">git-status</a>
  
    <li><a href="../../git/Documentation/git-stripspace_txt.html">git-stripspace</a>
  
    <li><a href="../../git/Documentation/git-submodule_txt.html">git-submodule</a>
  
    <li><a href="../../git/Documentation/git-svn_txt.html">git-svn</a>
  
    <li><a href="../../git/Documentation/git-symbolic-ref_txt.html">git-symbolic-ref</a>
  
    <li><a href="../../git/Documentation/git-tag_txt.html">git-tag</a>
  
    <li><a href="../../git/Documentation/git-tar-tree_txt.html">git-tar-tree</a>
  
    <li><a href="../../git/Documentation/git-tools_txt.html">git-tools</a>
  
    <li><a href="../../git/Documentation/git-unpack-file_txt.html">git-unpack-file</a>
  
    <li><a href="../../git/Documentation/git-unpack-objects_txt.html">git-unpack-objects</a>
  
    <li><a href="../../git/Documentation/git-update-index_txt.html">git-update-index</a>
  
    <li><a href="../../git/Documentation/git-update-ref_txt.html">git-update-ref</a>
  
    <li><a href="../../git/Documentation/git-update-server-info_txt.html">git-update-server-info</a>
  
    <li><a href="../../git/Documentation/git-upload-archive_txt.html">git-upload-archive</a>
  
    <li><a href="../../git/Documentation/git-upload-pack_txt.html">git-upload-pack</a>
  
    <li><a href="../../git/Documentation/git-var_txt.html">git-var</a>
  
    <li><a href="../../git/Documentation/git-verify-pack_txt.html">git-verify-pack</a>
  
    <li><a href="../../git/Documentation/git-verify-tag_txt.html">git-verify-tag</a>
  
    <li><a href="../../git/Documentation/git-web--browse_txt.html">git-web--browse</a>
  
    <li><a href="../../git/Documentation/git-whatchanged_txt.html">git-whatchanged</a>
  
    <li><a href="../../git/Documentation/git-write-tree_txt.html">git-write-tree</a>
  
    <li><a href="../../git/Documentation/git_txt.html">git</a>
  
    <li><a href="../../git/Documentation/gitattributes_txt.html">gitattributes</a>
  
    <li><a href="../../git/Documentation/gitcli_txt.html">gitcli</a>
  
    <li><a href="../../git/Documentation/gitcore-tutorial_txt.html">gitcore-tutorial</a>
  
    <li><a href="../../git/Documentation/gitcredentials_txt.html">gitcredentials</a>
  
    <li><a href="../../git/Documentation/gitcvs-migration_txt.html">gitcvs-migration</a>
  
    <li><a href="../../git/Documentation/gitdiffcore_txt.html">gitdiffcore</a>
  
    <li><a href="../../git/Documentation/gitglossary_txt.html">gitglossary</a>
  
    <li><a href="../../git/Documentation/githooks_txt.html">githooks</a>
  
    <li><a href="../../git/Documentation/gitignore_txt.html">gitignore</a>
  
    <li><a href="../../git/Documentation/gitk_txt.html">gitk</a>
  
    <li><a href="../../git/Documentation/gitmodules_txt.html">gitmodules</a>
  
    <li><a href="../../git/Documentation/gitnamespaces_txt.html">gitnamespaces</a>
  
    <li><a href="../../git/Documentation/gitremote-helpers_txt.html">gitremote-helpers</a>
  
    <li><a href="../../git/Documentation/gitrepository-layout_txt.html">gitrepository-layout</a>
  
    <li><a href="../../git/Documentation/gitrevisions_txt.html">gitrevisions</a>
  
    <li><a href="../../git/Documentation/gittutorial-2_txt.html">gittutorial-2</a>
  
    <li><a href="../../git/Documentation/gittutorial_txt.html">gittutorial</a>
  
    <li><a href="../../git/Documentation/gitweb_conf_txt.html">gitweb.conf</a>
  
    <li><a href="../../git/Documentation/gitweb_txt.html">gitweb</a>
  
    <li><a href="../../git/Documentation/gitworkflows_txt.html">gitworkflows</a>
  
    <li><a href="../../git/Documentation/glossary-content_txt.html">glossary-content</a>
  
    <li><a href="../../git/Documentation/howto-index_sh.html">howto-index.sh</a>
  
    <li><a href="../../git/Documentation/howto/maintain-git_txt.html">maintain-git</a>
  
    <li><a href="../../git/Documentation/howto/new-command_txt.html">new-command</a>
  
    <li><a href="../../git/Documentation/howto/rebase-from-internal-branch_txt.html">rebase-from-internal-branch</a>
  
    <li><a href="../../git/Documentation/howto/rebuild-from-update-hook_txt.html">rebuild-from-update-hook</a>
  
    <li><a href="../../git/Documentation/howto/recover-corrupted-blob-object_txt.html">recover-corrupted-blob-object</a>
  
    <li><a href="../../git/Documentation/howto/revert-a-faulty-merge_txt.html">revert-a-faulty-merge</a>
  
    <li><a href="../../git/Documentation/howto/revert-branch-rebase_txt.html">revert-branch-rebase</a>
  
    <li><a href="../../git/Documentation/howto/separating-topic-branches_txt.html">separating-topic-branches</a>
  
    <li><a href="../../git/Documentation/howto/setup-git-server-over-http_txt.html">setup-git-server-over-http</a>
  
    <li><a href="../../git/Documentation/howto/update-hook-example_txt.html">update-hook-example</a>
  
    <li><a href="../../git/Documentation/howto/use-git-daemon_txt.html">use-git-daemon</a>
  
    <li><a href="../../git/Documentation/howto/using-merge-subtree_txt.html">using-merge-subtree</a>
  
    <li><a href="../../git/Documentation/howto/using-signed-tag-in-pull-request_txt.html">using-signed-tag-in-pull-request</a>
  
    <li><a href="../../git/Documentation/i18n_txt.html">i18n</a>
  
    <li><a href="../../git/Documentation/install-doc-quick_sh.html">install-doc-quick.sh</a>
  
    <li><a href="../../git/Documentation/install-webdoc_sh.html">install-webdoc.sh</a>
  
    <li><a href="../../git/Documentation/line-range-format_txt.html">line-range-format</a>
  
    <li><a href="../../git/Documentation/mailmap_txt.html">mailmap</a>
  
    <li><a href="../../git/Documentation/manpage-1_72_xsl.html">manpage-1.72.xsl</a>
  
    <li><a href="../../git/Documentation/manpage-base-url_xsl_in.html">manpage-base-url.xsl.in</a>
  
    <li><a href="../../git/Documentation/manpage-base_xsl.html">manpage-base.xsl</a>
  
    <li><a href="../../git/Documentation/manpage-bold-literal_xsl.html">manpage-bold-literal.xsl</a>
  
    <li><a href="../../git/Documentation/manpage-normal_xsl.html">manpage-normal.xsl</a>
  
    <li><a href="../../git/Documentation/manpage-quote-apos_xsl.html">manpage-quote-apos.xsl</a>
  
    <li><a href="../../git/Documentation/manpage-suppress-sp_xsl.html">manpage-suppress-sp.xsl</a>
  
    <li><a href="../../git/Documentation/merge-config_txt.html">merge-config</a>
  
    <li><a href="../../git/Documentation/merge-options_txt.html">merge-options</a>
  
    <li><a href="../../git/Documentation/merge-strategies_txt.html">merge-strategies</a>
  
    <li><a href="../../git/Documentation/pretty-formats_txt.html">pretty-formats</a>
  
    <li><a href="../../git/Documentation/pretty-options_txt.html">pretty-options</a>
  
    <li><a href="../../git/Documentation/pull-fetch-param_txt.html">pull-fetch-param</a>
  
    <li><a href="../../git/Documentation/rev-list-options_txt.html">rev-list-options</a>
  
    <li><a href="../../git/Documentation/revisions_txt.html">revisions</a>
  
    <li><a href="../../git/Documentation/sequencer_txt.html">sequencer</a>
  
    <li><a href="../../git/Documentation/technical/api-allocation-growing_txt.html">api-allocation-growing</a>
  
    <li><a href="../../git/Documentation/technical/api-argv-array_txt.html">api-argv-array</a>
  
    <li><a href="../../git/Documentation/technical/api-builtin_txt.html">api-builtin</a>
  
    <li><a href="../../git/Documentation/technical/api-config_txt.html">api-config</a>
  
    <li><a href="../../git/Documentation/technical/api-credentials_txt.html">api-credentials</a>
  
    <li><a href="../../git/Documentation/technical/api-decorate_txt.html">api-decorate</a>
  
    <li><a href="../../git/Documentation/technical/api-diff_txt.html">api-diff</a>
  
    <li><a href="../../git/Documentation/technical/api-directory-listing_txt.html">api-directory-listing</a>
  
    <li><a href="../../git/Documentation/technical/api-gitattributes_txt.html">api-gitattributes</a>
  
    <li><a href="../../git/Documentation/technical/api-grep_txt.html">api-grep</a>
  
    <li><a href="../../git/Documentation/technical/api-hash_txt.html">api-hash</a>
  
    <li><a href="../../git/Documentation/technical/api-history-graph_txt.html">api-history-graph</a>
  
    <li><a href="../../git/Documentation/technical/api-in-core-index_txt.html">api-in-core-index</a>
  
    <li><a href="../../git/Documentation/technical/api-index-skel_txt.html">api-index-skel</a>
  
    <li><a href="../../git/Documentation/technical/api-index_sh.html">api-index.sh</a>
  
    <li><a href="../../git/Documentation/technical/api-lockfile_txt.html">api-lockfile</a>
  
    <li><a href="../../git/Documentation/technical/api-merge_txt.html">api-merge</a>
  
    <li><a href="../../git/Documentation/technical/api-object-access_txt.html">api-object-access</a>
  
    <li><a href="../../git/Documentation/technical/api-parse-options_txt.html">api-parse-options</a>
  
    <li><a href="../../git/Documentation/technical/api-quote_txt.html">api-quote</a>
  
    <li><a href="../../git/Documentation/technical/api-ref-iteration_txt.html">api-ref-iteration</a>
  
    <li><a href="../../git/Documentation/technical/api-remote_txt.html">api-remote</a>
  
    <li><a href="../../git/Documentation/technical/api-revision-walking_txt.html">api-revision-walking</a>
  
    <li><a href="../../git/Documentation/technical/api-run-command_txt.html">api-run-command</a>
  
    <li><a href="../../git/Documentation/technical/api-setup_txt.html">api-setup</a>
  
    <li><a href="../../git/Documentation/technical/api-sha1-array_txt.html">api-sha1-array</a>
  
    <li><a href="../../git/Documentation/technical/api-sigchain_txt.html">api-sigchain</a>
  
    <li><a href="../../git/Documentation/technical/api-strbuf_txt.html">api-strbuf</a>
  
    <li><a href="../../git/Documentation/technical/api-string-list_txt.html">api-string-list</a>
  
    <li><a href="../../git/Documentation/technical/api-tree-walking_txt.html">api-tree-walking</a>
  
    <li><a href="../../git/Documentation/technical/api-xdiff-interface_txt.html">api-xdiff-interface</a>
  
    <li><a href="../../git/Documentation/technical/http-protocol_txt.html">http-protocol</a>
  
    <li><a href="../../git/Documentation/technical/index-format_txt.html">index-format</a>
  
    <li><a href="../../git/Documentation/technical/pack-format_txt.html">pack-format</a>
  
    <li><a href="../../git/Documentation/technical/pack-heuristics_txt.html">pack-heuristics</a>
  
    <li><a href="../../git/Documentation/technical/pack-protocol_txt.html">pack-protocol</a>
  
    <li><a href="../../git/Documentation/technical/protocol-capabilities_txt.html">protocol-capabilities</a>
  
    <li><a href="../../git/Documentation/technical/protocol-common_txt.html">protocol-common</a>
  
    <li><a href="../../git/Documentation/technical/racy-git_txt.html">racy-git</a>
  
    <li><a href="../../git/Documentation/technical/send-pack-pipeline_txt.html">send-pack-pipeline</a>
  
    <li><a href="../../git/Documentation/technical/shallow_txt.html">shallow</a>
  
    <li><a href="../../git/Documentation/technical/trivial-merge_txt.html">trivial-merge</a>
  
    <li><a href="../../git/Documentation/urls-remotes_txt.html">urls-remotes</a>
  
    <li><a href="../../git/Documentation/urls_txt.html">urls</a>
  
    <li><a href="../../git/Documentation/user-manual_conf.html">user-manual.conf</a>
  
    <li><a href="../../git/Documentation/user-manual_txt.html">user-manual</a>
  
    <li><a href="../../git/GIT-CFLAGS.html">GIT-CFLAGS</a>
  
    <li><a href="../../git/GIT-VERSION-FILE.html">GIT-VERSION-FILE</a>
  
    <li><a href="../../git/GIT-VERSION-GEN.html">GIT-VERSION-GEN</a>
  
    <li><a href="../../git/INSTALL.html">INSTALL</a>
  
    <li><a href="../../git/LGPL-2_1.html">LGPL-2.1</a>
  
    <li><a href="../../git/Makefile.html">Makefile</a>
  
    <li><a href="../../git/README.html">README</a>
  
    <li><a href="../../git/RelNotes.html">RelNotes</a>
  
    <li><a href="../../git/aclocal_m4.html">aclocal.m4</a>
  
    <li><a href="../../git/check-builtins_sh.html">check-builtins.sh</a>
  
    <li><a href="../../git/check_bindir.html">check_bindir</a>
  
    <li><a href="../../git/command-list_txt.html">command-list</a>
  
    <li><a href="../../git/compat/nedmalloc/License_txt.html">License</a>
  
    <li><a href="../../git/compat/nedmalloc/Readme_txt.html">Readme</a>
  
    <li><a href="../../git/compat/vcbuild/README.html">README</a>
  
    <li><a href="../../git/compat/vcbuild/scripts/clink_pl.html">clink.pl</a>
  
    <li><a href="../../git/compat/vcbuild/scripts/lib_pl.html">lib.pl</a>
  
    <li><a href="../../git/config_mak_in.html">config.mak.in</a>
  
    <li><a href="../../git/config_mak_uname.html">config.mak.uname</a>
  
    <li><a href="../../git/contrib/README.html">README</a>
  
    <li><a href="../../git/contrib/buildsystems/Generators_pm.html">Generators.pm</a>
  
    <li><a href="../../git/contrib/buildsystems/Generators/QMake_pm.html">QMake.pm</a>
  
    <li><a href="../../git/contrib/buildsystems/Generators/Vcproj_pm.html">Vcproj.pm</a>
  
    <li><a href="../../git/contrib/buildsystems/engine_pl.html">engine.pl</a>
  
    <li><a href="../../git/contrib/buildsystems/generate.html">generate</a>
  
    <li><a href="../../git/contrib/buildsystems/parse_pl.html">parse.pl</a>
  
    <li><a href="../../git/contrib/ciabot/INSTALL.html">INSTALL</a>
  
    <li><a href="../../git/contrib/ciabot/README.html">README</a>
  
    <li><a href="../../git/contrib/ciabot/ciabot_py.html">ciabot.py</a>
  
    <li><a href="../../git/contrib/ciabot/ciabot_sh.html">ciabot.sh</a>
  
    <li><a href="../../git/contrib/completion/git-completion_bash.html">git-completion.bash</a>
  
    <li><a href="../../git/contrib/completion/git-completion_tcsh.html">git-completion.tcsh</a>
  
    <li><a href="../../git/contrib/completion/git-completion_zsh.html">git-completion.zsh</a>
  
    <li><a href="../../git/contrib/completion/git-prompt_sh.html">git-prompt.sh</a>
  
    <li><a href="../../git/contrib/contacts/git-contacts.html">git-contacts</a>
  
    <li><a href="../../git/contrib/contacts/git-contacts_txt.html">git-contacts</a>
  
    <li><a href="../../git/contrib/convert-objects/git-convert-objects_txt.html">git-convert-objects</a>
  
    <li><a href="../../git/contrib/credential/gnome-keyring/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/credential/netrc/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/credential/netrc/git-credential-netrc.html">git-credential-netrc</a>
  
    <li><a href="../../git/contrib/credential/netrc/test_netrc.html">test.netrc</a>
  
    <li><a href="../../git/contrib/credential/netrc/test_pl.html">test.pl</a>
  
    <li><a href="../../git/contrib/credential/osxkeychain/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/credential/wincred/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/diff-highlight/README.html">README</a>
  
    <li><a href="../../git/contrib/diff-highlight/diff-highlight.html">diff-highlight</a>
  
    <li><a href="../../git/contrib/diffall/README.html">README</a>
  
    <li><a href="../../git/contrib/diffall/git-diffall.html">git-diffall</a>
  
    <li><a href="../../git/contrib/emacs/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/emacs/README.html">README</a>
  
    <li><a href="../../git/contrib/emacs/git-blame_el.html">git-blame.el</a>
  
    <li><a href="../../git/contrib/emacs/git_el.html">git.el</a>
  
    <li><a href="../../git/contrib/examples/README.html">README</a>
  
    <li><a href="../../git/contrib/examples/git-checkout_sh.html">git-checkout.sh</a>
  
    <li><a href="../../git/contrib/examples/git-clean_sh.html">git-clean.sh</a>
  
    <li><a href="../../git/contrib/examples/git-clone_sh.html">git-clone.sh</a>
  
    <li><a href="../../git/contrib/examples/git-commit_sh.html">git-commit.sh</a>
  
    <li><a href="../../git/contrib/examples/git-fetch_sh.html">git-fetch.sh</a>
  
    <li><a href="../../git/contrib/examples/git-gc_sh.html">git-gc.sh</a>
  
    <li><a href="../../git/contrib/examples/git-log_sh.html">git-log.sh</a>
  
    <li><a href="../../git/contrib/examples/git-ls-remote_sh.html">git-ls-remote.sh</a>
  
    <li><a href="../../git/contrib/examples/git-merge-ours_sh.html">git-merge-ours.sh</a>
  
    <li><a href="../../git/contrib/examples/git-merge_sh.html">git-merge.sh</a>
  
    <li><a href="../../git/contrib/examples/git-notes_sh.html">git-notes.sh</a>
  
    <li><a href="../../git/contrib/examples/git-remote_perl.html">git-remote.perl</a>
  
    <li><a href="../../git/contrib/examples/git-rerere_perl.html">git-rerere.perl</a>
  
    <li><a href="../../git/contrib/examples/git-reset_sh.html">git-reset.sh</a>
  
    <li><a href="../../git/contrib/examples/git-resolve_sh.html">git-resolve.sh</a>
  
    <li><a href="../../git/contrib/examples/git-revert_sh.html">git-revert.sh</a>
  
    <li><a href="../../git/contrib/examples/git-svnimport_perl.html">git-svnimport.perl</a>
  
    <li><a href="../../git/contrib/examples/git-svnimport_txt.html">git-svnimport</a>
  
    <li><a href="../../git/contrib/examples/git-tag_sh.html">git-tag.sh</a>
  
    <li><a href="../../git/contrib/examples/git-verify-tag_sh.html">git-verify-tag.sh</a>
  
    <li><a href="../../git/contrib/examples/git-whatchanged_sh.html">git-whatchanged.sh</a>
  
    <li><a href="../../git/contrib/fast-import/git-import_perl.html">git-import.perl</a>
  
    <li><a href="../../git/contrib/fast-import/git-import_sh.html">git-import.sh</a>
  
    <li><a href="../../git/contrib/fast-import/git-p4_README.html">git-p4.README</a>
  
    <li><a href="../../git/contrib/fast-import/import-directories_perl.html">import-directories.perl</a>
  
    <li><a href="../../git/contrib/fast-import/import-tars_perl.html">import-tars.perl</a>
  
    <li><a href="../../git/contrib/fast-import/import-zips_py.html">import-zips.py</a>
  
    <li><a href="../../git/contrib/git-jump/README.html">README</a>
  
    <li><a href="../../git/contrib/git-jump/git-jump.html">git-jump</a>
  
    <li><a href="../../git/contrib/git-resurrect_sh.html">git-resurrect.sh</a>
  
    <li><a href="../../git/contrib/git-shell-commands/README.html">README</a>
  
    <li><a href="../../git/contrib/git-shell-commands/help.html">help</a>
  
    <li><a href="../../git/contrib/git-shell-commands/list.html">list</a>
  
    <li><a href="../../git/contrib/gitview/gitview.html">gitview</a>
  
    <li><a href="../../git/contrib/gitview/gitview_txt.html">gitview</a>
  
    <li><a href="../../git/contrib/hg-to-git/hg-to-git_py.html">hg-to-git.py</a>
  
    <li><a href="../../git/contrib/hg-to-git/hg-to-git_txt.html">hg-to-git</a>
  
    <li><a href="../../git/contrib/hooks/multimail/README.html">README</a>
  
    <li><a href="../../git/contrib/hooks/multimail/README_Git.html">README.Git</a>
  
    <li><a href="../../git/contrib/hooks/multimail/README_migrate-from-post-receive-email.html">README.migrate-from-post-receive-email</a>
  
    <li><a href="../../git/contrib/hooks/multimail/git_multimail_py.html">git_multimail.py</a>
  
    <li><a href="../../git/contrib/hooks/multimail/migrate-mailhook-config.html">migrate-mailhook-config</a>
  
    <li><a href="../../git/contrib/hooks/multimail/post-receive.html">post-receive</a>
  
    <li><a href="../../git/contrib/hooks/post-receive-email.html">post-receive-email</a>
  
    <li><a href="../../git/contrib/hooks/pre-auto-gc-battery.html">pre-auto-gc-battery</a>
  
    <li><a href="../../git/contrib/hooks/setgitperms_perl.html">setgitperms.perl</a>
  
    <li><a href="../../git/contrib/hooks/update-paranoid.html">update-paranoid</a>
  
    <li><a href="../../git/contrib/mw-to-git/Git/Mediawiki_pm.html">Mediawiki.pm</a>
  
    <li><a href="../../git/contrib/mw-to-git/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/mw-to-git/bin-wrapper/git.html">git</a>
  
    <li><a href="../../git/contrib/mw-to-git/git-mw_perl.html">git-mw.perl</a>
  
    <li><a href="../../git/contrib/mw-to-git/git-remote-mediawiki_perl.html">git-remote-mediawiki.perl</a>
  
    <li><a href="../../git/contrib/mw-to-git/git-remote-mediawiki_txt.html">git-remote-mediawiki</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/README.html">README</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/install-wiki_sh.html">install-wiki.sh</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/install-wiki/LocalSettings_php.html">LocalSettings.php</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/install-wiki/db_install_php.html">db_install.php</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/push-pull-tests_sh.html">push-pull-tests.sh</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/t9360-mw-to-git-clone_sh.html">t9360-mw-to-git-clone.sh</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/t9361-mw-to-git-push-pull_sh.html">t9361-mw-to-git-push-pull.sh</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/t9362-mw-to-git-utf8_sh.html">t9362-mw-to-git-utf8.sh</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/t9363-mw-to-git-export-import_sh.html">t9363-mw-to-git-export-import.sh</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/t9364-pull-by-rev_sh.html">t9364-pull-by-rev.sh</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/test-gitmw-lib_sh.html">test-gitmw-lib.sh</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/test-gitmw_pl.html">test-gitmw.pl</a>
  
    <li><a href="../../git/contrib/mw-to-git/t/test_config.html">test.config</a>
  
    <li><a href="../../git/contrib/p4import/README.html">README</a>
  
    <li><a href="../../git/contrib/p4import/git-p4import_py.html">git-p4import.py</a>
  
    <li><a href="../../git/contrib/p4import/git-p4import_txt.html">git-p4import</a>
  
    <li><a href="../../git/contrib/persistent-https/LICENSE.html">LICENSE</a>
  
    <li><a href="../../git/contrib/persistent-https/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/persistent-https/README.html">README</a>
  
    <li><a href="../../git/contrib/persistent-https/client_go.html">client.go</a>
  
    <li><a href="../../git/contrib/persistent-https/main_go.html">main.go</a>
  
    <li><a href="../../git/contrib/persistent-https/proxy_go.html">proxy.go</a>
  
    <li><a href="../../git/contrib/persistent-https/socket_go.html">socket.go</a>
  
    <li><a href="../../git/contrib/remote-helpers/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/remote-helpers/git-remote-bzr.html">git-remote-bzr</a>
  
    <li><a href="../../git/contrib/remote-helpers/git-remote-hg.html">git-remote-hg</a>
  
    <li><a href="../../git/contrib/remote-helpers/test-bzr_sh.html">test-bzr.sh</a>
  
    <li><a href="../../git/contrib/remote-helpers/test-hg-bidi_sh.html">test-hg-bidi.sh</a>
  
    <li><a href="../../git/contrib/remote-helpers/test-hg-hg-git_sh.html">test-hg-hg-git.sh</a>
  
    <li><a href="../../git/contrib/remote-helpers/test-hg_sh.html">test-hg.sh</a>
  
    <li><a href="../../git/contrib/remotes2config_sh.html">remotes2config.sh</a>
  
    <li><a href="../../git/contrib/rerere-train_sh.html">rerere-train.sh</a>
  
    <li><a href="../../git/contrib/stats/git-common-hash.html">git-common-hash</a>
  
    <li><a href="../../git/contrib/stats/mailmap_pl.html">mailmap.pl</a>
  
    <li><a href="../../git/contrib/stats/packinfo_pl.html">packinfo.pl</a>
  
    <li><a href="../../git/contrib/subtree/COPYING.html">COPYING</a>
  
    <li><a href="../../git/contrib/subtree/INSTALL.html">INSTALL</a>
  
    <li><a href="../../git/contrib/subtree/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/subtree/README.html">README</a>
  
    <li><a href="../../git/contrib/subtree/git-subtree_sh.html">git-subtree.sh</a>
  
    <li><a href="../../git/contrib/subtree/git-subtree_txt.html">git-subtree</a>
  
    <li><a href="../../git/contrib/subtree/t/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/subtree/t/t7900-subtree_sh.html">t7900-subtree.sh</a>
  
    <li><a href="../../git/contrib/subtree/todo.html">todo</a>
  
    <li><a href="../../git/contrib/svn-fe/Makefile.html">Makefile</a>
  
    <li><a href="../../git/contrib/svn-fe/svn-fe_txt.html">svn-fe</a>
  
    <li><a href="../../git/contrib/svn-fe/svnrdump_sim_py.html">svnrdump_sim.py</a>
  
    <li><a href="../../git/contrib/thunderbird-patch-inline/README.html">README</a>
  
    <li><a href="../../git/contrib/thunderbird-patch-inline/appp_sh.html">appp.sh</a>
  
    <li><a href="../../git/contrib/vim/README.html">README</a>
  
    <li><a href="../../git/contrib/workdir/git-new-workdir.html">git-new-workdir</a>
  
    <li><a href="../../git/generate-cmdlist_sh.html">generate-cmdlist.sh</a>
  
    <li><a href="../../git/git-add--interactive_perl.html">git-add--interactive.perl</a>
  
    <li><a href="../../git/git-am_sh.html">git-am.sh</a>
  
    <li><a href="../../git/git-archimport_perl.html">git-archimport.perl</a>
  
    <li><a href="../../git/git-bisect_sh.html">git-bisect.sh</a>
  
    <li><a href="../../git/git-cvsexportcommit_perl.html">git-cvsexportcommit.perl</a>
  
    <li><a href="../../git/git-cvsimport_perl.html">git-cvsimport.perl</a>
  
    <li><a href="../../git/git-cvsserver_perl.html">git-cvsserver.perl</a>
  
    <li><a href="../../git/git-difftool--helper_sh.html">git-difftool--helper.sh</a>
  
    <li><a href="../../git/git-difftool_perl.html">git-difftool.perl</a>
  
    <li><a href="../../git/git-filter-branch_sh.html">git-filter-branch.sh</a>
  
    <li><a href="../../git/git-gui/GIT-VERSION-GEN.html">GIT-VERSION-GEN</a>
  
    <li><a href="../../git/git-gui/Makefile.html">Makefile</a>
  
    <li><a href="../../git/git-gui/git-gui--askpass.html">git-gui--askpass</a>
  
    <li><a href="../../git/git-gui/git-gui_sh.html">git-gui.sh</a>
  
    <li><a href="../../git/git-gui/lib/about_tcl.html">about.tcl</a>
  
    <li><a href="../../git/git-gui/lib/blame_tcl.html">blame.tcl</a>
  
    <li><a href="../../git/git-gui/lib/branch_tcl.html">branch.tcl</a>
  
    <li><a href="../../git/git-gui/lib/branch_checkout_tcl.html">branch_checkout.tcl</a>
  
    <li><a href="../../git/git-gui/lib/branch_create_tcl.html">branch_create.tcl</a>
  
    <li><a href="../../git/git-gui/lib/branch_delete_tcl.html">branch_delete.tcl</a>
  
    <li><a href="../../git/git-gui/lib/branch_rename_tcl.html">branch_rename.tcl</a>
  
    <li><a href="../../git/git-gui/lib/browser_tcl.html">browser.tcl</a>
  
    <li><a href="../../git/git-gui/lib/checkout_op_tcl.html">checkout_op.tcl</a>
  
    <li><a href="../../git/git-gui/lib/choose_font_tcl.html">choose_font.tcl</a>
  
    <li><a href="../../git/git-gui/lib/choose_repository_tcl.html">choose_repository.tcl</a>
  
    <li><a href="../../git/git-gui/lib/choose_rev_tcl.html">choose_rev.tcl</a>
  
    <li><a href="../../git/git-gui/lib/class_tcl.html">class.tcl</a>
  
    <li><a href="../../git/git-gui/lib/commit_tcl.html">commit.tcl</a>
  
    <li><a href="../../git/git-gui/lib/console_tcl.html">console.tcl</a>
  
    <li><a href="../../git/git-gui/lib/database_tcl.html">database.tcl</a>
  
    <li><a href="../../git/git-gui/lib/date_tcl.html">date.tcl</a>
  
    <li><a href="../../git/git-gui/lib/diff_tcl.html">diff.tcl</a>
  
    <li><a href="../../git/git-gui/lib/encoding_tcl.html">encoding.tcl</a>
  
    <li><a href="../../git/git-gui/lib/error_tcl.html">error.tcl</a>
  
    <li><a href="../../git/git-gui/lib/index_tcl.html">index.tcl</a>
  
    <li><a href="../../git/git-gui/lib/line_tcl.html">line.tcl</a>
  
    <li><a href="../../git/git-gui/lib/logo_tcl.html">logo.tcl</a>
  
    <li><a href="../../git/git-gui/lib/merge_tcl.html">merge.tcl</a>
  
    <li><a href="../../git/git-gui/lib/mergetool_tcl.html">mergetool.tcl</a>
  
    <li><a href="../../git/git-gui/lib/option_tcl.html">option.tcl</a>
  
    <li><a href="../../git/git-gui/lib/remote_tcl.html">remote.tcl</a>
  
    <li><a href="../../git/git-gui/lib/remote_add_tcl.html">remote_add.tcl</a>
  
    <li><a href="../../git/git-gui/lib/remote_branch_delete_tcl.html">remote_branch_delete.tcl</a>
  
    <li><a href="../../git/git-gui/lib/search_tcl.html">search.tcl</a>
  
    <li><a href="../../git/git-gui/lib/shortcut_tcl.html">shortcut.tcl</a>
  
    <li><a href="../../git/git-gui/lib/spellcheck_tcl.html">spellcheck.tcl</a>
  
    <li><a href="../../git/git-gui/lib/sshkey_tcl.html">sshkey.tcl</a>
  
    <li><a href="../../git/git-gui/lib/status_bar_tcl.html">status_bar.tcl</a>
  
    <li><a href="../../git/git-gui/lib/themed_tcl.html">themed.tcl</a>
  
    <li><a href="../../git/git-gui/lib/tools_tcl.html">tools.tcl</a>
  
    <li><a href="../../git/git-gui/lib/tools_dlg_tcl.html">tools_dlg.tcl</a>
  
    <li><a href="../../git/git-gui/lib/transport_tcl.html">transport.tcl</a>
  
    <li><a href="../../git/git-gui/lib/win32_tcl.html">win32.tcl</a>
  
    <li><a href="../../git/git-gui/lib/win32_shortcut_js.html">win32_shortcut.js</a>
  
    <li><a href="../../git/git-gui/macosx/AppMain_tcl.html">AppMain.tcl</a>
  
    <li><a href="../../git/git-gui/macosx/Info_plist.html">Info.plist</a>
  
    <li><a href="../../git/git-gui/po/README.html">README</a>
  
    <li><a href="../../git/git-gui/po/de_po.html">de.po</a>
  
    <li><a href="../../git/git-gui/po/el_po.html">el.po</a>
  
    <li><a href="../../git/git-gui/po/fr_po.html">fr.po</a>
  
    <li><a href="../../git/git-gui/po/git-gui_pot.html">git-gui.pot</a>
  
    <li><a href="../../git/git-gui/po/glossary/Makefile.html">Makefile</a>
  
    <li><a href="../../git/git-gui/po/glossary/de_po.html">de.po</a>
  
    <li><a href="../../git/git-gui/po/glossary/el_po.html">el.po</a>
  
    <li><a href="../../git/git-gui/po/glossary/fr_po.html">fr.po</a>
  
    <li><a href="../../git/git-gui/po/glossary/git-gui-glossary_pot.html">git-gui-glossary.pot</a>
  
    <li><a href="../../git/git-gui/po/glossary/git-gui-glossary_txt.html">git-gui-glossary</a>
  
    <li><a href="../../git/git-gui/po/glossary/it_po.html">it.po</a>
  
    <li><a href="../../git/git-gui/po/glossary/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../../git/git-gui/po/glossary/txt-to-pot_sh.html">txt-to-pot.sh</a>
  
    <li><a href="../../git/git-gui/po/glossary/zh_cn_po.html">zh_cn.po</a>
  
    <li><a href="../../git/git-gui/po/hu_po.html">hu.po</a>
  
    <li><a href="../../git/git-gui/po/it_po.html">it.po</a>
  
    <li><a href="../../git/git-gui/po/ja_po.html">ja.po</a>
  
    <li><a href="../../git/git-gui/po/nb_po.html">nb.po</a>
  
    <li><a href="../../git/git-gui/po/po2msg_sh.html">po2msg.sh</a>
  
    <li><a href="../../git/git-gui/po/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../../git/git-gui/po/ru_po.html">ru.po</a>
  
    <li><a href="../../git/git-gui/po/sv_po.html">sv.po</a>
  
    <li><a href="../../git/git-gui/po/zh_cn_po.html">zh_cn.po</a>
  
    <li><a href="../../git/git-gui/windows/git-gui_sh.html">git-gui.sh</a>
  
    <li><a href="../../git/git-instaweb_sh.html">git-instaweb.sh</a>
  
    <li><a href="../../git/git-lost-found_sh.html">git-lost-found.sh</a>
  
    <li><a href="../../git/git-merge-octopus_sh.html">git-merge-octopus.sh</a>
  
    <li><a href="../../git/git-merge-one-file_sh.html">git-merge-one-file.sh</a>
  
    <li><a href="../../git/git-merge-resolve_sh.html">git-merge-resolve.sh</a>
  
    <li><a href="../../git/git-mergetool--lib_sh.html">git-mergetool--lib.sh</a>
  
    <li><a href="../../git/git-mergetool_sh.html">git-mergetool.sh</a>
  
    <li><a href="../../git/git-p4_py.html">git-p4.py</a>
  
    <li><a href="../../git/git-parse-remote_sh.html">git-parse-remote.sh</a>
  
    <li><a href="../../git/git-pull_sh.html">git-pull.sh</a>
  
    <li><a href="../../git/git-quiltimport_sh.html">git-quiltimport.sh</a>
  
    <li><a href="../../git/git-rebase--am_sh.html">git-rebase--am.sh</a>
  
    <li><a href="../../git/git-rebase--interactive_sh.html">git-rebase--interactive.sh</a>
  
    <li><a href="../../git/git-rebase--merge_sh.html">git-rebase--merge.sh</a>
  
    <li><a href="../../git/git-rebase_sh.html">git-rebase.sh</a>
  
    <li><a href="../../git/git-relink_perl.html">git-relink.perl</a>
  
    <li><a href="../../git/git-remote-testgit_sh.html">git-remote-testgit.sh</a>
  
    <li><a href="../../git/git-repack_sh.html">git-repack.sh</a>
  
    <li><a href="../../git/git-request-pull_sh.html">git-request-pull.sh</a>
  
    <li><a href="../../git/git-send-email_perl.html">git-send-email.perl</a>
  
    <li><a href="../../git/git-sh-i18n_sh.html">git-sh-i18n.sh</a>
  
    <li><a href="../../git/git-sh-setup_sh.html">git-sh-setup.sh</a>
  
    <li><a href="../../git/git-stash_sh.html">git-stash.sh</a>
  
    <li><a href="../../git/git-submodule_sh.html">git-submodule.sh</a>
  
    <li><a href="../../git/git-svn_perl.html">git-svn.perl</a>
  
    <li><a href="../../git/git-web--browse_sh.html">git-web--browse.sh</a>
  
    <li><a href="../../git/git_rc.html">git.rc</a>
  
    <li><a href="../../git/git_spec_in.html">git.spec.in</a>
  
    <li><a href="../../git/gitk-git/Makefile.html">Makefile</a>
  
    <li><a href="../../git/gitk-git/gitk.html">gitk</a>
  
    <li><a href="../../git/gitk-git/po/de_po.html">de.po</a>
  
    <li><a href="../../git/gitk-git/po/es_po.html">es.po</a>
  
    <li><a href="../../git/gitk-git/po/fr_po.html">fr.po</a>
  
    <li><a href="../../git/gitk-git/po/hu_po.html">hu.po</a>
  
    <li><a href="../../git/gitk-git/po/it_po.html">it.po</a>
  
    <li><a href="../../git/gitk-git/po/ja_po.html">ja.po</a>
  
    <li><a href="../../git/gitk-git/po/po2msg_sh.html">po2msg.sh</a>
  
    <li><a href="../../git/gitk-git/po/pt_br_po.html">pt_br.po</a>
  
    <li><a href="../../git/gitk-git/po/ru_po.html">ru.po</a>
  
    <li><a href="../../git/gitk-git/po/sv_po.html">sv.po</a>
  
    <li><a href="../../git/gitweb/INSTALL.html">INSTALL</a>
  
    <li><a href="../../git/gitweb/Makefile.html">Makefile</a>
  
    <li><a href="../../git/gitweb/README.html">README</a>
  
    <li><a href="../../git/gitweb/gitweb_perl.html">gitweb.perl</a>
  
    <li><a href="../../git/gitweb/static/gitweb_css.html">gitweb.css</a>
  
    <li><a href="../../git/gitweb/static/js/README.html">README</a>
  
    <li><a href="../../git/gitweb/static/js/adjust-timezone_js.html">adjust-timezone.js</a>
  
    <li><a href="../../git/gitweb/static/js/blame_incremental_js.html">blame_incremental.js</a>
  
    <li><a href="../../git/gitweb/static/js/javascript-detection_js.html">javascript-detection.js</a>
  
    <li><a href="../../git/gitweb/static/js/lib/common-lib_js.html">common-lib.js</a>
  
    <li><a href="../../git/gitweb/static/js/lib/cookies_js.html">cookies.js</a>
  
    <li><a href="../../git/gitweb/static/js/lib/datetime_js.html">datetime.js</a>
  
    <li><a href="../../git/mergetools/araxis.html">araxis</a>
  
    <li><a href="../../git/mergetools/bc3.html">bc3</a>
  
    <li><a href="../../git/mergetools/codecompare.html">codecompare</a>
  
    <li><a href="../../git/mergetools/deltawalker.html">deltawalker</a>
  
    <li><a href="../../git/mergetools/diffuse.html">diffuse</a>
  
    <li><a href="../../git/mergetools/ecmerge.html">ecmerge</a>
  
    <li><a href="../../git/mergetools/emerge.html">emerge</a>
  
    <li><a href="../../git/mergetools/gvimdiff.html">gvimdiff</a>
  
    <li><a href="../../git/mergetools/gvimdiff2.html">gvimdiff2</a>
  
    <li><a href="../../git/mergetools/kdiff3.html">kdiff3</a>
  
    <li><a href="../../git/mergetools/kompare.html">kompare</a>
  
    <li><a href="../../git/mergetools/meld.html">meld</a>
  
    <li><a href="../../git/mergetools/opendiff.html">opendiff</a>
  
    <li><a href="../../git/mergetools/p4merge.html">p4merge</a>
  
    <li><a href="../../git/mergetools/tkdiff.html">tkdiff</a>
  
    <li><a href="../../git/mergetools/tortoisemerge.html">tortoisemerge</a>
  
    <li><a href="../../git/mergetools/vimdiff.html">vimdiff</a>
  
    <li><a href="../../git/mergetools/vimdiff2.html">vimdiff2</a>
  
    <li><a href="../../git/mergetools/xxdiff.html">xxdiff</a>
  
    <li><a href="../../git/perl/Git_pm.html">Git.pm</a>
  
    <li><a href="../../git/perl/Git/I18N_pm.html">I18N.pm</a>
  
    <li><a href="../../git/perl/Git/IndexInfo_pm.html">IndexInfo.pm</a>
  
    <li><a href="../../git/perl/Git/SVN_pm.html">SVN.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/Editor_pm.html">Editor.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/Fetcher_pm.html">Fetcher.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/GlobSpec_pm.html">GlobSpec.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/Log_pm.html">Log.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/Memoize/YAML_pm.html">YAML.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/Migration_pm.html">Migration.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/Prompt_pm.html">Prompt.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/Ra_pm.html">Ra.pm</a>
  
    <li><a href="../../git/perl/Git/SVN/Utils_pm.html">Utils.pm</a>
  
    <li><a href="../../git/perl/Makefile.html">Makefile</a>
  
    <li><a href="../../git/perl/Makefile_PL.html">Makefile.PL</a>
  
    <li><a href="../../git/perl/private-Error_pm.html">private-Error.pm</a>
  
    <li><a href="../../git/po/README.html">README</a>
  
    <li><a href="../../git/po/TEAMS.html">TEAMS</a>
  
    <li><a href="../../git/po/da_po.html">da.po</a>
  
    <li><a href="../../git/po/de_po.html">de.po</a>
  
    <li><a href="../../git/po/fr_po.html">fr.po</a>
  
    <li><a href="../../git/po/git_pot.html">git.pot</a>
  
    <li><a href="../../git/po/is_po.html">is.po</a>
  
    <li><a href="../../git/po/it_po.html">it.po</a>
  
    <li><a href="../../git/po/nl_po.html">nl.po</a>
  
    <li><a href="../../git/po/pt_PT_po.html">pt_PT.po</a>
  
    <li><a href="../../git/po/sv_po.html">sv.po</a>
  
    <li><a href="../../git/po/vi_po.html">vi.po</a>
  
    <li><a href="../../git/po/zh_CN_po.html">zh_CN.po</a>
  
    <li><a href="../../git/ppc/sha1ppc_S.html">sha1ppc.S</a>
  
    <li><a href="../../git/t/Git-SVN/00compile_t.html">00compile.t</a>
  
    <li><a href="../../git/t/Git-SVN/Utils/add_path_to_url_t.html">add_path_to_url.t</a>
  
    <li><a href="../../git/t/Git-SVN/Utils/can_compress_t.html">can_compress.t</a>
  
    <li><a href="../../git/t/Git-SVN/Utils/canonicalize_url_t.html">canonicalize_url.t</a>
  
    <li><a href="../../git/t/Git-SVN/Utils/collapse_dotdot_t.html">collapse_dotdot.t</a>
  
    <li><a href="../../git/t/Git-SVN/Utils/fatal_t.html">fatal.t</a>
  
    <li><a href="../../git/t/Git-SVN/Utils/join_paths_t.html">join_paths.t</a>
  
    <li><a href="../../git/t/Makefile.html">Makefile</a>
  
    <li><a href="../../git/t/README.html">README</a>
  
    <li><a href="../../git/t/aggregate-results_sh.html">aggregate-results.sh</a>
  
    <li><a href="../../git/t/annotate-tests_sh.html">annotate-tests.sh</a>
  
    <li><a href="../../git/t/check-non-portable-shell_pl.html">check-non-portable-shell.pl</a>
  
    <li><a href="../../git/t/diff-lib_sh.html">diff-lib.sh</a>
  
    <li><a href="../../git/t/gitweb-lib_sh.html">gitweb-lib.sh</a>
  
    <li><a href="../../git/t/lib-bash_sh.html">lib-bash.sh</a>
  
    <li><a href="../../git/t/lib-credential_sh.html">lib-credential.sh</a>
  
    <li><a href="../../git/t/lib-cvs_sh.html">lib-cvs.sh</a>
  
    <li><a href="../../git/t/lib-diff-alternative_sh.html">lib-diff-alternative.sh</a>
  
    <li><a href="../../git/t/lib-gettext_sh.html">lib-gettext.sh</a>
  
    <li><a href="../../git/t/lib-git-daemon_sh.html">lib-git-daemon.sh</a>
  
    <li><a href="../../git/t/lib-git-p4_sh.html">lib-git-p4.sh</a>
  
    <li><a href="../../git/t/lib-git-svn_sh.html">lib-git-svn.sh</a>
  
    <li><a href="../../git/t/lib-gpg_sh.html">lib-gpg.sh</a>
  
    <li><a href="../../git/t/lib-httpd_sh.html">lib-httpd.sh</a>
  
    <li><a href="../../git/t/lib-httpd/apache_conf.html">apache.conf</a>
  
    <li><a href="../../git/t/lib-httpd/broken-smart-http_sh.html">broken-smart-http.sh</a>
  
    <li><a href="../../git/t/lib-httpd/passwd.html">passwd</a>
  
    <li><a href="../../git/t/lib-httpd/ssl_cnf.html">ssl.cnf</a>
  
    <li><a href="../../git/t/lib-pack_sh.html">lib-pack.sh</a>
  
    <li><a href="../../git/t/lib-pager_sh.html">lib-pager.sh</a>
  
    <li><a href="../../git/t/lib-patch-mode_sh.html">lib-patch-mode.sh</a>
  
    <li><a href="../../git/t/lib-prereq-FILEMODE_sh.html">lib-prereq-FILEMODE.sh</a>
  
    <li><a href="../../git/t/lib-read-tree-m-3way_sh.html">lib-read-tree-m-3way.sh</a>
  
    <li><a href="../../git/t/lib-read-tree_sh.html">lib-read-tree.sh</a>
  
    <li><a href="../../git/t/lib-rebase_sh.html">lib-rebase.sh</a>
  
    <li><a href="../../git/t/lib-t6000_sh.html">lib-t6000.sh</a>
  
    <li><a href="../../git/t/lib-terminal_sh.html">lib-terminal.sh</a>
  
    <li><a href="../../git/t/perf/Makefile.html">Makefile</a>
  
    <li><a href="../../git/t/perf/README.html">README</a>
  
    <li><a href="../../git/t/perf/aggregate_perl.html">aggregate.perl</a>
  
    <li><a href="../../git/t/perf/min_time_perl.html">min_time.perl</a>
  
    <li><a href="../../git/t/perf/p0000-perf-lib-sanity_sh.html">p0000-perf-lib-sanity.sh</a>
  
    <li><a href="../../git/t/perf/p0001-rev-list_sh.html">p0001-rev-list.sh</a>
  
    <li><a href="../../git/t/perf/p0002-read-cache_sh.html">p0002-read-cache.sh</a>
  
    <li><a href="../../git/t/perf/p4000-diff-algorithms_sh.html">p4000-diff-algorithms.sh</a>
  
    <li><a href="../../git/t/perf/p4211-line-log_sh.html">p4211-line-log.sh</a>
  
    <li><a href="../../git/t/perf/p5302-pack-index_sh.html">p5302-pack-index.sh</a>
  
    <li><a href="../../git/t/perf/p7810-grep_sh.html">p7810-grep.sh</a>
  
    <li><a href="../../git/t/perf/perf-lib_sh.html">perf-lib.sh</a>
  
    <li><a href="../../git/t/perf/run.html">run</a>
  
    <li><a href="../../git/t/t0000-basic_sh.html">t0000-basic.sh</a>
  
    <li><a href="../../git/t/t0001-init_sh.html">t0001-init.sh</a>
  
    <li><a href="../../git/t/t0002-gitfile_sh.html">t0002-gitfile.sh</a>
  
    <li><a href="../../git/t/t0003-attributes_sh.html">t0003-attributes.sh</a>
  
    <li><a href="../../git/t/t0004-unwritable_sh.html">t0004-unwritable.sh</a>
  
    <li><a href="../../git/t/t0005-signals_sh.html">t0005-signals.sh</a>
  
    <li><a href="../../git/t/t0006-date_sh.html">t0006-date.sh</a>
  
    <li><a href="../../git/t/t0007-git-var_sh.html">t0007-git-var.sh</a>
  
    <li><a href="../../git/t/t0008-ignores_sh.html">t0008-ignores.sh</a>
  
    <li><a href="../../git/t/t0009-prio-queue_sh.html">t0009-prio-queue.sh</a>
  
    <li><a href="../../git/t/t0010-racy-git_sh.html">t0010-racy-git.sh</a>
  
    <li><a href="../../git/t/t0020-crlf_sh.html">t0020-crlf.sh</a>
  
    <li><a href="../../git/t/t0021-conversion_sh.html">t0021-conversion.sh</a>
  
    <li><a href="../../git/t/t0022-crlf-rename_sh.html">t0022-crlf-rename.sh</a>
  
    <li><a href="../../git/t/t0023-crlf-am_sh.html">t0023-crlf-am.sh</a>
  
    <li><a href="../../git/t/t0024-crlf-archive_sh.html">t0024-crlf-archive.sh</a>
  
    <li><a href="../../git/t/t0025-crlf-auto_sh.html">t0025-crlf-auto.sh</a>
  
    <li><a href="../../git/t/t0026-eol-config_sh.html">t0026-eol-config.sh</a>
  
    <li><a href="../../git/t/t0030-stripspace_sh.html">t0030-stripspace.sh</a>
  
    <li><a href="../../git/t/t0040-parse-options_sh.html">t0040-parse-options.sh</a>
  
    <li><a href="../../git/t/t0050-filesystem_sh.html">t0050-filesystem.sh</a>
  
    <li><a href="../../git/t/t0055-beyond-symlinks_sh.html">t0055-beyond-symlinks.sh</a>
  
    <li><a href="../../git/t/t0056-git-C_sh.html">t0056-git-C.sh</a>
  
    <li><a href="../../git/t/t0060-path-utils_sh.html">t0060-path-utils.sh</a>
  
    <li><a href="../../git/t/t0061-run-command_sh.html">t0061-run-command.sh</a>
  
    <li><a href="../../git/t/t0062-revision-walking_sh.html">t0062-revision-walking.sh</a>
  
    <li><a href="../../git/t/t0063-string-list_sh.html">t0063-string-list.sh</a>
  
    <li><a href="../../git/t/t0070-fundamental_sh.html">t0070-fundamental.sh</a>
  
    <li><a href="../../git/t/t0081-line-buffer_sh.html">t0081-line-buffer.sh</a>
  
    <li><a href="../../git/t/t0090-cache-tree_sh.html">t0090-cache-tree.sh</a>
  
    <li><a href="../../git/t/t0100-previous_sh.html">t0100-previous.sh</a>
  
    <li><a href="../../git/t/t0101-at-syntax_sh.html">t0101-at-syntax.sh</a>
  
    <li><a href="../../git/t/t0110-urlmatch-normalization_sh.html">t0110-urlmatch-normalization.sh</a>
  
    <li><a href="../../git/t/t0110/README.html">README</a>
  
    <li><a href="../../git/t/t0110/url-1.html">url-1</a>
  
    <li><a href="../../git/t/t0110/url-11.html">url-11</a>
  
    <li><a href="../../git/t/t0110/url-2.html">url-2</a>
  
    <li><a href="../../git/t/t0200-gettext-basic_sh.html">t0200-gettext-basic.sh</a>
  
    <li><a href="../../git/t/t0200/test_perl.html">test.perl</a>
  
    <li><a href="../../git/t/t0200/test_sh.html">test.sh</a>
  
    <li><a href="../../git/t/t0201-gettext-fallbacks_sh.html">t0201-gettext-fallbacks.sh</a>
  
    <li><a href="../../git/t/t0202-gettext-perl_sh.html">t0202-gettext-perl.sh</a>
  
    <li><a href="../../git/t/t0202/test_pl.html">test.pl</a>
  
    <li><a href="../../git/t/t0203-gettext-setlocale-sanity_sh.html">t0203-gettext-setlocale-sanity.sh</a>
  
    <li><a href="../../git/t/t0204-gettext-reencode-sanity_sh.html">t0204-gettext-reencode-sanity.sh</a>
  
    <li><a href="../../git/t/t0205-gettext-poison_sh.html">t0205-gettext-poison.sh</a>
  
    <li><a href="../../git/t/t0300-credentials_sh.html">t0300-credentials.sh</a>
  
    <li><a href="../../git/t/t0301-credential-cache_sh.html">t0301-credential-cache.sh</a>
  
    <li><a href="../../git/t/t0302-credential-store_sh.html">t0302-credential-store.sh</a>
  
    <li><a href="../../git/t/t0303-credential-external_sh.html">t0303-credential-external.sh</a>
  
    <li><a href="../../git/t/t1000-read-tree-m-3way_sh.html">t1000-read-tree-m-3way.sh</a>
  
    <li><a href="../../git/t/t1001-read-tree-m-2way_sh.html">t1001-read-tree-m-2way.sh</a>
  
    <li><a href="../../git/t/t1002-read-tree-m-u-2way_sh.html">t1002-read-tree-m-u-2way.sh</a>
  
    <li><a href="../../git/t/t1003-read-tree-prefix_sh.html">t1003-read-tree-prefix.sh</a>
  
    <li><a href="../../git/t/t1004-read-tree-m-u-wf_sh.html">t1004-read-tree-m-u-wf.sh</a>
  
    <li><a href="../../git/t/t1005-read-tree-reset_sh.html">t1005-read-tree-reset.sh</a>
  
    <li><a href="../../git/t/t1006-cat-file_sh.html">t1006-cat-file.sh</a>
  
    <li><a href="../../git/t/t1007-hash-object_sh.html">t1007-hash-object.sh</a>
  
    <li><a href="../../git/t/t1008-read-tree-overlay_sh.html">t1008-read-tree-overlay.sh</a>
  
    <li><a href="../../git/t/t1009-read-tree-new-index_sh.html">t1009-read-tree-new-index.sh</a>
  
    <li><a href="../../git/t/t1010-mktree_sh.html">t1010-mktree.sh</a>
  
    <li><a href="../../git/t/t1011-read-tree-sparse-checkout_sh.html">t1011-read-tree-sparse-checkout.sh</a>
  
    <li><a href="../../git/t/t1012-read-tree-df_sh.html">t1012-read-tree-df.sh</a>
  
    <li><a href="../../git/t/t1013-loose-object-format_sh.html">t1013-loose-object-format.sh</a>
  
    <li><a href="../../git/t/t1020-subdirectory_sh.html">t1020-subdirectory.sh</a>
  
    <li><a href="../../git/t/t1021-rerere-in-workdir_sh.html">t1021-rerere-in-workdir.sh</a>
  
    <li><a href="../../git/t/t1050-large_sh.html">t1050-large.sh</a>
  
    <li><a href="../../git/t/t1051-large-conversion_sh.html">t1051-large-conversion.sh</a>
  
    <li><a href="../../git/t/t1060-object-corruption_sh.html">t1060-object-corruption.sh</a>
  
    <li><a href="../../git/t/t1100-commit-tree-options_sh.html">t1100-commit-tree-options.sh</a>
  
    <li><a href="../../git/t/t1200-tutorial_sh.html">t1200-tutorial.sh</a>
  
    <li><a href="../../git/t/t1300-repo-config_sh.html">t1300-repo-config.sh</a>
  
    <li><a href="../../git/t/t1301-shared-repo_sh.html">t1301-shared-repo.sh</a>
  
    <li><a href="../../git/t/t1302-repo-version_sh.html">t1302-repo-version.sh</a>
  
    <li><a href="../../git/t/t1303-wacky-config_sh.html">t1303-wacky-config.sh</a>
  
    <li><a href="../../git/t/t1304-default-acl_sh.html">t1304-default-acl.sh</a>
  
    <li><a href="../../git/t/t1305-config-include_sh.html">t1305-config-include.sh</a>
  
    <li><a href="../../git/t/t1306-xdg-files_sh.html">t1306-xdg-files.sh</a>
  
    <li><a href="../../git/t/t1307-config-blob_sh.html">t1307-config-blob.sh</a>
  
    <li><a href="../../git/t/t1400-update-ref_sh.html">t1400-update-ref.sh</a>
  
    <li><a href="../../git/t/t1401-symbolic-ref_sh.html">t1401-symbolic-ref.sh</a>
  
    <li><a href="../../git/t/t1402-check-ref-format_sh.html">t1402-check-ref-format.sh</a>
  
    <li><a href="../../git/t/t1403-show-ref_sh.html">t1403-show-ref.sh</a>
  
    <li><a href="../../git/t/t1410-reflog_sh.html">t1410-reflog.sh</a>
  
    <li><a href="../../git/t/t1411-reflog-show_sh.html">t1411-reflog-show.sh</a>
  
    <li><a href="../../git/t/t1412-reflog-loop_sh.html">t1412-reflog-loop.sh</a>
  
    <li><a href="../../git/t/t1420-lost-found_sh.html">t1420-lost-found.sh</a>
  
    <li><a href="../../git/t/t1450-fsck_sh.html">t1450-fsck.sh</a>
  
    <li><a href="../../git/t/t1500-rev-parse_sh.html">t1500-rev-parse.sh</a>
  
    <li><a href="../../git/t/t1501-worktree_sh.html">t1501-worktree.sh</a>
  
    <li><a href="../../git/t/t1502-rev-parse-parseopt_sh.html">t1502-rev-parse-parseopt.sh</a>
  
    <li><a href="../../git/t/t1503-rev-parse-verify_sh.html">t1503-rev-parse-verify.sh</a>
  
    <li><a href="../../git/t/t1504-ceiling-dirs_sh.html">t1504-ceiling-dirs.sh</a>
  
    <li><a href="../../git/t/t1505-rev-parse-last_sh.html">t1505-rev-parse-last.sh</a>
  
    <li><a href="../../git/t/t1506-rev-parse-diagnosis_sh.html">t1506-rev-parse-diagnosis.sh</a>
  
    <li><a href="../../git/t/t1507-rev-parse-upstream_sh.html">t1507-rev-parse-upstream.sh</a>
  
    <li><a href="../../git/t/t1508-at-combinations_sh.html">t1508-at-combinations.sh</a>
  
    <li><a href="../../git/t/t1509-root-worktree_sh.html">t1509-root-worktree.sh</a>
  
    <li><a href="../../git/t/t1509/excludes.html">excludes</a>
  
    <li><a href="../../git/t/t1509/prepare-chroot_sh.html">prepare-chroot.sh</a>
  
    <li><a href="../../git/t/t1510-repo-setup_sh.html">t1510-repo-setup.sh</a>
  
    <li><a href="../../git/t/t1511-rev-parse-caret_sh.html">t1511-rev-parse-caret.sh</a>
  
    <li><a href="../../git/t/t1512-rev-parse-disambiguation_sh.html">t1512-rev-parse-disambiguation.sh</a>
  
    <li><a href="../../git/t/t1513-rev-parse-prefix_sh.html">t1513-rev-parse-prefix.sh</a>
  
    <li><a href="../../git/t/t2000-checkout-cache-clash_sh.html">t2000-checkout-cache-clash.sh</a>
  
    <li><a href="../../git/t/t2001-checkout-cache-clash_sh.html">t2001-checkout-cache-clash.sh</a>
  
    <li><a href="../../git/t/t2002-checkout-cache-u_sh.html">t2002-checkout-cache-u.sh</a>
  
    <li><a href="../../git/t/t2003-checkout-cache-mkdir_sh.html">t2003-checkout-cache-mkdir.sh</a>
  
    <li><a href="../../git/t/t2004-checkout-cache-temp_sh.html">t2004-checkout-cache-temp.sh</a>
  
    <li><a href="../../git/t/t2005-checkout-index-symlinks_sh.html">t2005-checkout-index-symlinks.sh</a>
  
    <li><a href="../../git/t/t2006-checkout-index-basic_sh.html">t2006-checkout-index-basic.sh</a>
  
    <li><a href="../../git/t/t2007-checkout-symlink_sh.html">t2007-checkout-symlink.sh</a>
  
    <li><a href="../../git/t/t2008-checkout-subdir_sh.html">t2008-checkout-subdir.sh</a>
  
    <li><a href="../../git/t/t2009-checkout-statinfo_sh.html">t2009-checkout-statinfo.sh</a>
  
    <li><a href="../../git/t/t2010-checkout-ambiguous_sh.html">t2010-checkout-ambiguous.sh</a>
  
    <li><a href="../../git/t/t2011-checkout-invalid-head_sh.html">t2011-checkout-invalid-head.sh</a>
  
    <li><a href="../../git/t/t2012-checkout-last_sh.html">t2012-checkout-last.sh</a>
  
    <li><a href="../../git/t/t2013-checkout-submodule_sh.html">t2013-checkout-submodule.sh</a>
  
    <li><a href="../../git/t/t2014-switch_sh.html">t2014-switch.sh</a>
  
    <li><a href="../../git/t/t2015-checkout-unborn_sh.html">t2015-checkout-unborn.sh</a>
  
    <li><a href="../../git/t/t2016-checkout-patch_sh.html">t2016-checkout-patch.sh</a>
  
    <li><a href="../../git/t/t2017-checkout-orphan_sh.html">t2017-checkout-orphan.sh</a>
  
    <li><a href="../../git/t/t2018-checkout-branch_sh.html">t2018-checkout-branch.sh</a>
  
    <li><a href="../../git/t/t2019-checkout-ambiguous-ref_sh.html">t2019-checkout-ambiguous-ref.sh</a>
  
    <li><a href="../../git/t/t2020-checkout-detach_sh.html">t2020-checkout-detach.sh</a>
  
    <li><a href="../../git/t/t2021-checkout-overwrite_sh.html">t2021-checkout-overwrite.sh</a>
  
    <li><a href="../../git/t/t2022-checkout-paths_sh.html">t2022-checkout-paths.sh</a>
  
    <li><a href="../../git/t/t2023-checkout-m_sh.html">t2023-checkout-m.sh</a>
  
    <li><a href="../../git/t/t2024-checkout-dwim_sh.html">t2024-checkout-dwim.sh</a>
  
    <li><a href="../../git/t/t2030-unresolve-info_sh.html">t2030-unresolve-info.sh</a>
  
    <li><a href="../../git/t/t2050-git-dir-relative_sh.html">t2050-git-dir-relative.sh</a>
  
    <li><a href="../../git/t/t2100-update-cache-badpath_sh.html">t2100-update-cache-badpath.sh</a>
  
    <li><a href="../../git/t/t2101-update-index-reupdate_sh.html">t2101-update-index-reupdate.sh</a>
  
    <li><a href="../../git/t/t2102-update-index-symlinks_sh.html">t2102-update-index-symlinks.sh</a>
  
    <li><a href="../../git/t/t2103-update-index-ignore-missing_sh.html">t2103-update-index-ignore-missing.sh</a>
  
    <li><a href="../../git/t/t2104-update-index-skip-worktree_sh.html">t2104-update-index-skip-worktree.sh</a>
  
    <li><a href="../../git/t/t2105-update-index-gitfile_sh.html">t2105-update-index-gitfile.sh</a>
  
    <li><a href="../../git/t/t2106-update-index-assume-unchanged_sh.html">t2106-update-index-assume-unchanged.sh</a>
  
    <li><a href="../../git/t/t2107-update-index-basic_sh.html">t2107-update-index-basic.sh</a>
  
    <li><a href="../../git/t/t2200-add-update_sh.html">t2200-add-update.sh</a>
  
    <li><a href="../../git/t/t2201-add-update-typechange_sh.html">t2201-add-update-typechange.sh</a>
  
    <li><a href="../../git/t/t2202-add-addremove_sh.html">t2202-add-addremove.sh</a>
  
    <li><a href="../../git/t/t2203-add-intent_sh.html">t2203-add-intent.sh</a>
  
    <li><a href="../../git/t/t2204-add-ignored_sh.html">t2204-add-ignored.sh</a>
  
    <li><a href="../../git/t/t2300-cd-to-toplevel_sh.html">t2300-cd-to-toplevel.sh</a>
  
    <li><a href="../../git/t/t3000-ls-files-others_sh.html">t3000-ls-files-others.sh</a>
  
    <li><a href="../../git/t/t3001-ls-files-others-exclude_sh.html">t3001-ls-files-others-exclude.sh</a>
  
    <li><a href="../../git/t/t3002-ls-files-dashpath_sh.html">t3002-ls-files-dashpath.sh</a>
  
    <li><a href="../../git/t/t3003-ls-files-exclude_sh.html">t3003-ls-files-exclude.sh</a>
  
    <li><a href="../../git/t/t3004-ls-files-basic_sh.html">t3004-ls-files-basic.sh</a>
  
    <li><a href="../../git/t/t3005-ls-files-relative_sh.html">t3005-ls-files-relative.sh</a>
  
    <li><a href="../../git/t/t3006-ls-files-long_sh.html">t3006-ls-files-long.sh</a>
  
    <li><a href="../../git/t/t3010-ls-files-killed-modified_sh.html">t3010-ls-files-killed-modified.sh</a>
  
    <li><a href="../../git/t/t3020-ls-files-error-unmatch_sh.html">t3020-ls-files-error-unmatch.sh</a>
  
    <li><a href="../../git/t/t3030-merge-recursive_sh.html">t3030-merge-recursive.sh</a>
  
    <li><a href="../../git/t/t3031-merge-criscross_sh.html">t3031-merge-criscross.sh</a>
  
    <li><a href="../../git/t/t3032-merge-recursive-options_sh.html">t3032-merge-recursive-options.sh</a>
  
    <li><a href="../../git/t/t3040-subprojects-basic_sh.html">t3040-subprojects-basic.sh</a>
  
    <li><a href="../../git/t/t3050-subprojects-fetch_sh.html">t3050-subprojects-fetch.sh</a>
  
    <li><a href="../../git/t/t3060-ls-files-with-tree_sh.html">t3060-ls-files-with-tree.sh</a>
  
    <li><a href="../../git/t/t3070-wildmatch_sh.html">t3070-wildmatch.sh</a>
  
    <li><a href="../../git/t/t3100-ls-tree-restrict_sh.html">t3100-ls-tree-restrict.sh</a>
  
    <li><a href="../../git/t/t3101-ls-tree-dirname_sh.html">t3101-ls-tree-dirname.sh</a>
  
    <li><a href="../../git/t/t3102-ls-tree-wildcards_sh.html">t3102-ls-tree-wildcards.sh</a>
  
    <li><a href="../../git/t/t3103-ls-tree-misc_sh.html">t3103-ls-tree-misc.sh</a>
  
    <li><a href="../../git/t/t3200-branch_sh.html">t3200-branch.sh</a>
  
    <li><a href="../../git/t/t3201-branch-contains_sh.html">t3201-branch-contains.sh</a>
  
    <li><a href="../../git/t/t3202-show-branch-octopus_sh.html">t3202-show-branch-octopus.sh</a>
  
    <li><a href="../../git/t/t3203-branch-output_sh.html">t3203-branch-output.sh</a>
  
    <li><a href="../../git/t/t3210-pack-refs_sh.html">t3210-pack-refs.sh</a>
  
    <li><a href="../../git/t/t3211-peel-ref_sh.html">t3211-peel-ref.sh</a>
  
    <li><a href="../../git/t/t3300-funny-names_sh.html">t3300-funny-names.sh</a>
  
    <li><a href="../../git/t/t3301-notes_sh.html">t3301-notes.sh</a>
  
    <li><a href="../../git/t/t3302-notes-index-expensive_sh.html">t3302-notes-index-expensive.sh</a>
  
    <li><a href="../../git/t/t3303-notes-subtrees_sh.html">t3303-notes-subtrees.sh</a>
  
    <li><a href="../../git/t/t3304-notes-mixed_sh.html">t3304-notes-mixed.sh</a>
  
    <li><a href="../../git/t/t3305-notes-fanout_sh.html">t3305-notes-fanout.sh</a>
  
    <li><a href="../../git/t/t3306-notes-prune_sh.html">t3306-notes-prune.sh</a>
  
    <li><a href="../../git/t/t3307-notes-man_sh.html">t3307-notes-man.sh</a>
  
    <li><a href="../../git/t/t3308-notes-merge_sh.html">t3308-notes-merge.sh</a>
  
    <li><a href="../../git/t/t3309-notes-merge-auto-resolve_sh.html">t3309-notes-merge-auto-resolve.sh</a>
  
    <li><a href="../../git/t/t3310-notes-merge-manual-resolve_sh.html">t3310-notes-merge-manual-resolve.sh</a>
  
    <li><a href="../../git/t/t3311-notes-merge-fanout_sh.html">t3311-notes-merge-fanout.sh</a>
  
    <li><a href="../../git/t/t3400-rebase_sh.html">t3400-rebase.sh</a>
  
    <li><a href="../../git/t/t3402-rebase-merge_sh.html">t3402-rebase-merge.sh</a>
  
    <li><a href="../../git/t/t3403-rebase-skip_sh.html">t3403-rebase-skip.sh</a>
  
    <li><a href="../../git/t/t3404-rebase-interactive_sh.html">t3404-rebase-interactive.sh</a>
  
    <li><a href="../../git/t/t3405-rebase-malformed_sh.html">t3405-rebase-malformed.sh</a>
  
    <li><a href="../../git/t/t3406-rebase-message_sh.html">t3406-rebase-message.sh</a>
  
    <li><a href="../../git/t/t3407-rebase-abort_sh.html">t3407-rebase-abort.sh</a>
  
    <li><a href="../../git/t/t3408-rebase-multi-line_sh.html">t3408-rebase-multi-line.sh</a>
  
    <li><a href="../../git/t/t3409-rebase-preserve-merges_sh.html">t3409-rebase-preserve-merges.sh</a>
  
    <li><a href="../../git/t/t3410-rebase-preserve-dropped-merges_sh.html">t3410-rebase-preserve-dropped-merges.sh</a>
  
    <li><a href="../../git/t/t3411-rebase-preserve-around-merges_sh.html">t3411-rebase-preserve-around-merges.sh</a>
  
    <li><a href="../../git/t/t3412-rebase-root_sh.html">t3412-rebase-root.sh</a>
  
    <li><a href="../../git/t/t3413-rebase-hook_sh.html">t3413-rebase-hook.sh</a>
  
    <li><a href="../../git/t/t3414-rebase-preserve-onto_sh.html">t3414-rebase-preserve-onto.sh</a>
  
    <li><a href="../../git/t/t3415-rebase-autosquash_sh.html">t3415-rebase-autosquash.sh</a>
  
    <li><a href="../../git/t/t3416-rebase-onto-threedots_sh.html">t3416-rebase-onto-threedots.sh</a>
  
    <li><a href="../../git/t/t3417-rebase-whitespace-fix_sh.html">t3417-rebase-whitespace-fix.sh</a>
  
    <li><a href="../../git/t/t3418-rebase-continue_sh.html">t3418-rebase-continue.sh</a>
  
    <li><a href="../../git/t/t3419-rebase-patch-id_sh.html">t3419-rebase-patch-id.sh</a>
  
    <li><a href="../../git/t/t3420-rebase-autostash_sh.html">t3420-rebase-autostash.sh</a>
  
    <li><a href="../../git/t/t3421-rebase-topology-linear_sh.html">t3421-rebase-topology-linear.sh</a>
  
    <li><a href="../../git/t/t3425-rebase-topology-merges_sh.html">t3425-rebase-topology-merges.sh</a>
  
    <li><a href="../../git/t/t3500-cherry_sh.html">t3500-cherry.sh</a>
  
    <li><a href="../../git/t/t3501-revert-cherry-pick_sh.html">t3501-revert-cherry-pick.sh</a>
  
    <li><a href="../../git/t/t3502-cherry-pick-merge_sh.html">t3502-cherry-pick-merge.sh</a>
  
    <li><a href="../../git/t/t3503-cherry-pick-root_sh.html">t3503-cherry-pick-root.sh</a>
  
    <li><a href="../../git/t/t3504-cherry-pick-rerere_sh.html">t3504-cherry-pick-rerere.sh</a>
  
    <li><a href="../../git/t/t3505-cherry-pick-empty_sh.html">t3505-cherry-pick-empty.sh</a>
  
    <li><a href="../../git/t/t3506-cherry-pick-ff_sh.html">t3506-cherry-pick-ff.sh</a>
  
    <li><a href="../../git/t/t3507-cherry-pick-conflict_sh.html">t3507-cherry-pick-conflict.sh</a>
  
    <li><a href="../../git/t/t3508-cherry-pick-many-commits_sh.html">t3508-cherry-pick-many-commits.sh</a>
  
    <li><a href="../../git/t/t3509-cherry-pick-merge-df_sh.html">t3509-cherry-pick-merge-df.sh</a>
  
    <li><a href="../../git/t/t3510-cherry-pick-sequence_sh.html">t3510-cherry-pick-sequence.sh</a>
  
    <li><a href="../../git/t/t3511-cherry-pick-x_sh.html">t3511-cherry-pick-x.sh</a>
  
    <li><a href="../../git/t/t3600-rm_sh.html">t3600-rm.sh</a>
  
    <li><a href="../../git/t/t3700-add_sh.html">t3700-add.sh</a>
  
    <li><a href="../../git/t/t3701-add-interactive_sh.html">t3701-add-interactive.sh</a>
  
    <li><a href="../../git/t/t3702-add-edit_sh.html">t3702-add-edit.sh</a>
  
    <li><a href="../../git/t/t3703-add-magic-pathspec_sh.html">t3703-add-magic-pathspec.sh</a>
  
    <li><a href="../../git/t/t3800-mktag_sh.html">t3800-mktag.sh</a>
  
    <li><a href="../../git/t/t3900-i18n-commit_sh.html">t3900-i18n-commit.sh</a>
  
    <li><a href="../../git/t/t3900/1-UTF-8_txt.html">1-UTF-8</a>
  
    <li><a href="../../git/t/t3900/2-UTF-8_txt.html">2-UTF-8</a>
  
    <li><a href="../../git/t/t3900/ISO-2022-JP_txt.html">ISO-2022-JP</a>
  
    <li><a href="../../git/t/t3901-i18n-patch_sh.html">t3901-i18n-patch.sh</a>
  
    <li><a href="../../git/t/t3901-utf8_txt.html">t3901-utf8</a>
  
    <li><a href="../../git/t/t3902-quoted_sh.html">t3902-quoted.sh</a>
  
    <li><a href="../../git/t/t3903-stash_sh.html">t3903-stash.sh</a>
  
    <li><a href="../../git/t/t3904-stash-patch_sh.html">t3904-stash-patch.sh</a>
  
    <li><a href="../../git/t/t3905-stash-include-untracked_sh.html">t3905-stash-include-untracked.sh</a>
  
    <li><a href="../../git/t/t3910-mac-os-precompose_sh.html">t3910-mac-os-precompose.sh</a>
  
    <li><a href="../../git/t/t4000-diff-format_sh.html">t4000-diff-format.sh</a>
  
    <li><a href="../../git/t/t4001-diff-rename_sh.html">t4001-diff-rename.sh</a>
  
    <li><a href="../../git/t/t4002-diff-basic_sh.html">t4002-diff-basic.sh</a>
  
    <li><a href="../../git/t/t4003-diff-rename-1_sh.html">t4003-diff-rename-1.sh</a>
  
    <li><a href="../../git/t/t4004-diff-rename-symlink_sh.html">t4004-diff-rename-symlink.sh</a>
  
    <li><a href="../../git/t/t4005-diff-rename-2_sh.html">t4005-diff-rename-2.sh</a>
  
    <li><a href="../../git/t/t4006-diff-mode_sh.html">t4006-diff-mode.sh</a>
  
    <li><a href="../../git/t/t4007-rename-3_sh.html">t4007-rename-3.sh</a>
  
    <li><a href="../../git/t/t4008-diff-break-rewrite_sh.html">t4008-diff-break-rewrite.sh</a>
  
    <li><a href="../../git/t/t4009-diff-rename-4_sh.html">t4009-diff-rename-4.sh</a>
  
    <li><a href="../../git/t/t4010-diff-pathspec_sh.html">t4010-diff-pathspec.sh</a>
  
    <li><a href="../../git/t/t4011-diff-symlink_sh.html">t4011-diff-symlink.sh</a>
  
    <li><a href="../../git/t/t4012-diff-binary_sh.html">t4012-diff-binary.sh</a>
  
    <li><a href="../../git/t/t4013-diff-various_sh.html">t4013-diff-various.sh</a>
  
    <li><a href="../../git/t/t4013/diff_config_format_subjectprefix_DIFFERENT_PREFIX.html">diff.config_format.subjectprefix_DIFFERENT_PREFIX</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_--summary_master.html">diff.diff-tree_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_--summary_side.html">diff.diff-tree_--cc_--patch-with-stat_--summary_side</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--cc_--patch-with-stat_master.html">diff.diff-tree_--cc_--patch-with-stat_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--cc_--stat_--summary_master.html">diff.diff-tree_--cc_--stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--cc_--stat_--summary_side.html">diff.diff-tree_--cc_--stat_--summary_side</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--cc_--stat_master.html">diff.diff-tree_--cc_--stat_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--cc_master.html">diff.diff-tree_--cc_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--patch-with-raw_initial.html">diff.diff-tree_--patch-with-raw_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--patch-with-stat_initial.html">diff.diff-tree_--patch-with-stat_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty=oneline_--patch-with-raw_initial.html">diff.diff-tree_--pretty=oneline_--patch-with-raw_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty=oneline_--patch-with-stat_initial.html">diff.diff-tree_--pretty=oneline_--patch-with-stat_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_--patch-with-raw_initial.html">diff.diff-tree_--pretty=oneline_--root_--patch-with-raw_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_--patch-with-stat_initial.html">diff.diff-tree_--pretty=oneline_--root_--patch-with-stat_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_-p_initial.html">diff.diff-tree_--pretty=oneline_--root_-p_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty=oneline_--root_initial.html">diff.diff-tree_--pretty=oneline_--root_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty=oneline_-p_initial.html">diff.diff-tree_--pretty=oneline_-p_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty=oneline_initial.html">diff.diff-tree_--pretty=oneline_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--patch-with-raw_initial.html">diff.diff-tree_--pretty_--patch-with-raw_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--patch-with-stat_initial.html">diff.diff-tree_--pretty_--patch-with-stat_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--patch-with-stat_side.html">diff.diff-tree_--pretty_--patch-with-stat_side</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--root_--patch-with-raw_initial.html">diff.diff-tree_--pretty_--root_--patch-with-raw_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--root_--patch-with-stat_initial.html">diff.diff-tree_--pretty_--root_--patch-with-stat_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--root_--stat_--summary_initial.html">diff.diff-tree_--pretty_--root_--stat_--summary_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--root_--stat_initial.html">diff.diff-tree_--pretty_--root_--stat_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--root_--summary_-r_initial.html">diff.diff-tree_--pretty_--root_--summary_-r_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--root_--summary_initial.html">diff.diff-tree_--pretty_--root_--summary_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--root_-p_initial.html">diff.diff-tree_--pretty_--root_-p_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--root_initial.html">diff.diff-tree_--pretty_--root_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--stat_--summary_initial.html">diff.diff-tree_--pretty_--stat_--summary_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--stat_initial.html">diff.diff-tree_--pretty_--stat_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_--summary_initial.html">diff.diff-tree_--pretty_--summary_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_-p_initial.html">diff.diff-tree_--pretty_-p_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_-p_side.html">diff.diff-tree_--pretty_-p_side</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_initial.html">diff.diff-tree_--pretty_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--pretty_side.html">diff.diff-tree_--pretty_side</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--root_--abbrev_initial.html">diff.diff-tree_--root_--abbrev_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--root_--patch-with-raw_initial.html">diff.diff-tree_--root_--patch-with-raw_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--root_--patch-with-stat_initial.html">diff.diff-tree_--root_--patch-with-stat_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--root_-p_initial.html">diff.diff-tree_--root_-p_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--root_-r_--abbrev=4_initial.html">diff.diff-tree_--root_-r_--abbrev=4_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--root_-r_--abbrev_initial.html">diff.diff-tree_--root_-r_--abbrev_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--root_-r_initial.html">diff.diff-tree_--root_-r_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_--root_initial.html">diff.diff-tree_--root_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-c_--abbrev_master.html">diff.diff-tree_-c_--abbrev_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-c_--stat_--summary_master.html">diff.diff-tree_-c_--stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-c_--stat_--summary_side.html">diff.diff-tree_-c_--stat_--summary_side</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-c_--stat_master.html">diff.diff-tree_-c_--stat_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-c_master.html">diff.diff-tree_-c_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-p_-m_master.html">diff.diff-tree_-p_-m_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-p_initial.html">diff.diff-tree_-p_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-p_master.html">diff.diff-tree_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-r_--abbrev=4_initial.html">diff.diff-tree_-r_--abbrev=4_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-r_--abbrev_initial.html">diff.diff-tree_-r_--abbrev_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_-r_initial.html">diff.diff-tree_-r_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_initial.html">diff.diff-tree_initial</a>
  
    <li><a href="../../git/t/t4013/diff_diff-tree_master.html">diff.diff-tree_master</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--abbrev_initial__side.html">diff.diff_--abbrev_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--cached.html">diff.diff_--cached</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--cached_--_file0.html">diff.diff_--cached_--_file0</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--dirstat-by-file_initial_rearrange.html">diff.diff_--dirstat-by-file_initial_rearrange</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--dirstat_initial_rearrange.html">diff.diff_--dirstat_initial_rearrange</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--dirstat_master~1_master~2.html">diff.diff_--dirstat_master~1_master~2</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--name-status_dir2_dir.html">diff.diff_--name-status_dir2_dir</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--no-index_--name-status_--_dir2_dir.html">diff.diff_--no-index_--name-status_--_dir2_dir</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--no-index_--name-status_dir2_dir.html">diff.diff_--no-index_--name-status_dir2_dir</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--no-index_dir_dir3.html">diff.diff_--no-index_dir_dir3</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--patch-with-raw_-r_initial__side.html">diff.diff_--patch-with-raw_-r_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--patch-with-raw_initial__side.html">diff.diff_--patch-with-raw_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--patch-with-stat_-r_initial__side.html">diff.diff_--patch-with-stat_-r_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--patch-with-stat_initial__side.html">diff.diff_--patch-with-stat_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_--stat_initial__side.html">diff.diff_--stat_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_-r_--stat_initial__side.html">diff.diff_-r_--stat_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_-r_initial__side.html">diff.diff_-r_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_initial__side.html">diff.diff_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_diff_master_master^_side.html">diff.diff_master_master^_side</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--attach_--stdout_--suffix=_diff_initial__side.html">diff.format-patch_--attach_--stdout_--suffix=.diff_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--attach_--stdout_initial__master.html">diff.format-patch_--attach_--stdout_initial..master</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--attach_--stdout_initial__master^.html">diff.format-patch_--attach_--stdout_initial..master^</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--attach_--stdout_initial__side.html">diff.format-patch_--attach_--stdout_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--inline_--stdout_--numbered-files_initial__master.html">diff.format-patch_--inline_--stdout_--numbered-files_initial..master</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--inline_--stdout_--subject-prefix=TESTCASE_initial__master.html">diff.format-patch_--inline_--stdout_--subject-prefix=TESTCASE_initial..master</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master.html">diff.format-patch_--inline_--stdout_initial..master</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master^.html">diff.format-patch_--inline_--stdout_initial..master^</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--inline_--stdout_initial__master^^.html">diff.format-patch_--inline_--stdout_initial..master^^</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--inline_--stdout_initial__side.html">diff.format-patch_--inline_--stdout_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--stdout_--cover-letter_-n_initial__master^.html">diff.format-patch_--stdout_--cover-letter_-n_initial..master^</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--stdout_--no-numbered_initial__master.html">diff.format-patch_--stdout_--no-numbered_initial..master</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--stdout_--numbered_initial__master.html">diff.format-patch_--stdout_--numbered_initial..master</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--stdout_initial__master.html">diff.format-patch_--stdout_initial..master</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--stdout_initial__master^.html">diff.format-patch_--stdout_initial..master^</a>
  
    <li><a href="../../git/t/t4013/diff_format-patch_--stdout_initial__side.html">diff.format-patch_--stdout_initial..side</a>
  
    <li><a href="../../git/t/t4013/diff_log_--decorate=full_--all.html">diff.log_--decorate=full_--all</a>
  
    <li><a href="../../git/t/t4013/diff_log_--decorate_--all.html">diff.log_--decorate_--all</a>
  
    <li><a href="../../git/t/t4013/diff_log_--patch-with-stat_--summary_master_--_dir_.html">diff.log_--patch-with-stat_--summary_master_--_dir_</a>
  
    <li><a href="../../git/t/t4013/diff_log_--patch-with-stat_master.html">diff.log_--patch-with-stat_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_--patch-with-stat_master_--_dir_.html">diff.log_--patch-with-stat_master_--_dir_</a>
  
    <li><a href="../../git/t/t4013/diff_log_--root_--cc_--patch-with-stat_--summary_master.html">diff.log_--root_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_--root_--patch-with-stat_--summary_master.html">diff.log_--root_--patch-with-stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_--root_--patch-with-stat_master.html">diff.log_--root_--patch-with-stat_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_--root_-c_--patch-with-stat_--summary_master.html">diff.log_--root_-c_--patch-with-stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_--root_-p_master.html">diff.log_--root_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_--root_master.html">diff.log_--root_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-GF_-p_--pickaxe-all_master.html">diff.log_-GF_-p_--pickaxe-all_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-GF_-p_master.html">diff.log_-GF_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-GF_master.html">diff.log_-GF_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-SF_-p_master.html">diff.log_-SF_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-SF_master.html">diff.log_-SF_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-SF_master_--max-count=0.html">diff.log_-SF_master_--max-count=0</a>
  
    <li><a href="../../git/t/t4013/diff_log_-SF_master_--max-count=1.html">diff.log_-SF_master_--max-count=1</a>
  
    <li><a href="../../git/t/t4013/diff_log_-SF_master_--max-count=2.html">diff.log_-SF_master_--max-count=2</a>
  
    <li><a href="../../git/t/t4013/diff_log_-S_F_master.html">diff.log_-S_F_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-m_-p_--first-parent_master.html">diff.log_-m_-p_--first-parent_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-m_-p_master.html">diff.log_-m_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-p_--first-parent_master.html">diff.log_-p_--first-parent_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_-p_master.html">diff.log_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_log_master.html">diff.log_master</a>
  
    <li><a href="../../git/t/t4013/diff_rev-list_--children_HEAD.html">diff.rev-list_--children_HEAD</a>
  
    <li><a href="../../git/t/t4013/diff_rev-list_--parents_HEAD.html">diff.rev-list_--parents_HEAD</a>
  
    <li><a href="../../git/t/t4013/diff_show_--first-parent_master.html">diff.show_--first-parent_master</a>
  
    <li><a href="../../git/t/t4013/diff_show_--patch-with-raw_side.html">diff.show_--patch-with-raw_side</a>
  
    <li><a href="../../git/t/t4013/diff_show_--patch-with-stat_--summary_side.html">diff.show_--patch-with-stat_--summary_side</a>
  
    <li><a href="../../git/t/t4013/diff_show_--patch-with-stat_side.html">diff.show_--patch-with-stat_side</a>
  
    <li><a href="../../git/t/t4013/diff_show_--root_initial.html">diff.show_--root_initial</a>
  
    <li><a href="../../git/t/t4013/diff_show_--stat_--summary_side.html">diff.show_--stat_--summary_side</a>
  
    <li><a href="../../git/t/t4013/diff_show_--stat_side.html">diff.show_--stat_side</a>
  
    <li><a href="../../git/t/t4013/diff_show_-c_master.html">diff.show_-c_master</a>
  
    <li><a href="../../git/t/t4013/diff_show_-m_master.html">diff.show_-m_master</a>
  
    <li><a href="../../git/t/t4013/diff_show_initial.html">diff.show_initial</a>
  
    <li><a href="../../git/t/t4013/diff_show_master.html">diff.show_master</a>
  
    <li><a href="../../git/t/t4013/diff_show_side.html">diff.show_side</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--patch-with-stat_--summary_master_--_dir_.html">diff.whatchanged_--patch-with-stat_--summary_master_--_dir_</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--patch-with-stat_master.html">diff.whatchanged_--patch-with-stat_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--patch-with-stat_master_--_dir_.html">diff.whatchanged_--patch-with-stat_master_--_dir_</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--root_--cc_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_--cc_--patch-with-stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--root_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_--patch-with-stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--root_--patch-with-stat_master.html">diff.whatchanged_--root_--patch-with-stat_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--root_-c_--patch-with-stat_--summary_master.html">diff.whatchanged_--root_-c_--patch-with-stat_--summary_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--root_-p_master.html">diff.whatchanged_--root_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_--root_master.html">diff.whatchanged_--root_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_-SF_-p_master.html">diff.whatchanged_-SF_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_-SF_master.html">diff.whatchanged_-SF_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_-p_master.html">diff.whatchanged_-p_master</a>
  
    <li><a href="../../git/t/t4013/diff_whatchanged_master.html">diff.whatchanged_master</a>
  
    <li><a href="../../git/t/t4014-format-patch_sh.html">t4014-format-patch.sh</a>
  
    <li><a href="../../git/t/t4015-diff-whitespace_sh.html">t4015-diff-whitespace.sh</a>
  
    <li><a href="../../git/t/t4016-diff-quote_sh.html">t4016-diff-quote.sh</a>
  
    <li><a href="../../git/t/t4017-diff-retval_sh.html">t4017-diff-retval.sh</a>
  
    <li><a href="../../git/t/t4018-diff-funcname_sh.html">t4018-diff-funcname.sh</a>
  
    <li><a href="../../git/t/t4019-diff-wserror_sh.html">t4019-diff-wserror.sh</a>
  
    <li><a href="../../git/t/t4020-diff-external_sh.html">t4020-diff-external.sh</a>
  
    <li><a href="../../git/t/t4021-format-patch-numbered_sh.html">t4021-format-patch-numbered.sh</a>
  
    <li><a href="../../git/t/t4022-diff-rewrite_sh.html">t4022-diff-rewrite.sh</a>
  
    <li><a href="../../git/t/t4023-diff-rename-typechange_sh.html">t4023-diff-rename-typechange.sh</a>
  
    <li><a href="../../git/t/t4024-diff-optimize-common_sh.html">t4024-diff-optimize-common.sh</a>
  
    <li><a href="../../git/t/t4025-hunk-header_sh.html">t4025-hunk-header.sh</a>
  
    <li><a href="../../git/t/t4026-color_sh.html">t4026-color.sh</a>
  
    <li><a href="../../git/t/t4027-diff-submodule_sh.html">t4027-diff-submodule.sh</a>
  
    <li><a href="../../git/t/t4028-format-patch-mime-headers_sh.html">t4028-format-patch-mime-headers.sh</a>
  
    <li><a href="../../git/t/t4029-diff-trailing-space_sh.html">t4029-diff-trailing-space.sh</a>
  
    <li><a href="../../git/t/t4030-diff-textconv_sh.html">t4030-diff-textconv.sh</a>
  
    <li><a href="../../git/t/t4031-diff-rewrite-binary_sh.html">t4031-diff-rewrite-binary.sh</a>
  
    <li><a href="../../git/t/t4032-diff-inter-hunk-context_sh.html">t4032-diff-inter-hunk-context.sh</a>
  
    <li><a href="../../git/t/t4033-diff-patience_sh.html">t4033-diff-patience.sh</a>
  
    <li><a href="../../git/t/t4034-diff-words_sh.html">t4034-diff-words.sh</a>
  
    <li><a href="../../git/t/t4034/ada/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/ada/post.html">post</a>
  
    <li><a href="../../git/t/t4034/ada/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/bibtex/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/bibtex/post.html">post</a>
  
    <li><a href="../../git/t/t4034/bibtex/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/cpp/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/cpp/post.html">post</a>
  
    <li><a href="../../git/t/t4034/cpp/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/csharp/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/csharp/post.html">post</a>
  
    <li><a href="../../git/t/t4034/csharp/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/fortran/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/fortran/post.html">post</a>
  
    <li><a href="../../git/t/t4034/fortran/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/html/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/html/post.html">post</a>
  
    <li><a href="../../git/t/t4034/html/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/java/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/java/post.html">post</a>
  
    <li><a href="../../git/t/t4034/java/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/matlab/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/matlab/post.html">post</a>
  
    <li><a href="../../git/t/t4034/matlab/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/objc/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/objc/post.html">post</a>
  
    <li><a href="../../git/t/t4034/objc/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/pascal/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/pascal/post.html">post</a>
  
    <li><a href="../../git/t/t4034/pascal/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/perl/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/perl/post.html">post</a>
  
    <li><a href="../../git/t/t4034/perl/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/php/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/php/post.html">post</a>
  
    <li><a href="../../git/t/t4034/php/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/python/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/python/post.html">post</a>
  
    <li><a href="../../git/t/t4034/python/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/ruby/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/ruby/post.html">post</a>
  
    <li><a href="../../git/t/t4034/ruby/pre.html">pre</a>
  
    <li><a href="../../git/t/t4034/tex/expect.html">expect</a>
  
    <li><a href="../../git/t/t4034/tex/post.html">post</a>
  
    <li><a href="../../git/t/t4034/tex/pre.html">pre</a>
  
    <li><a href="../../git/t/t4035-diff-quiet_sh.html">t4035-diff-quiet.sh</a>
  
    <li><a href="../../git/t/t4036-format-patch-signer-mime_sh.html">t4036-format-patch-signer-mime.sh</a>
  
    <li><a href="../../git/t/t4037-diff-r-t-dirs_sh.html">t4037-diff-r-t-dirs.sh</a>
  
    <li><a href="../../git/t/t4038-diff-combined_sh.html">t4038-diff-combined.sh</a>
  
    <li><a href="../../git/t/t4039-diff-assume-unchanged_sh.html">t4039-diff-assume-unchanged.sh</a>
  
    <li><a href="../../git/t/t4040-whitespace-status_sh.html">t4040-whitespace-status.sh</a>
  
    <li><a href="../../git/t/t4041-diff-submodule-option_sh.html">t4041-diff-submodule-option.sh</a>
  
    <li><a href="../../git/t/t4042-diff-textconv-caching_sh.html">t4042-diff-textconv-caching.sh</a>
  
    <li><a href="../../git/t/t4043-diff-rename-binary_sh.html">t4043-diff-rename-binary.sh</a>
  
    <li><a href="../../git/t/t4044-diff-index-unique-abbrev_sh.html">t4044-diff-index-unique-abbrev.sh</a>
  
    <li><a href="../../git/t/t4045-diff-relative_sh.html">t4045-diff-relative.sh</a>
  
    <li><a href="../../git/t/t4046-diff-unmerged_sh.html">t4046-diff-unmerged.sh</a>
  
    <li><a href="../../git/t/t4047-diff-dirstat_sh.html">t4047-diff-dirstat.sh</a>
  
    <li><a href="../../git/t/t4048-diff-combined-binary_sh.html">t4048-diff-combined-binary.sh</a>
  
    <li><a href="../../git/t/t4049-diff-stat-count_sh.html">t4049-diff-stat-count.sh</a>
  
    <li><a href="../../git/t/t4050-diff-histogram_sh.html">t4050-diff-histogram.sh</a>
  
    <li><a href="../../git/t/t4051-diff-function-context_sh.html">t4051-diff-function-context.sh</a>
  
    <li><a href="../../git/t/t4052-stat-output_sh.html">t4052-stat-output.sh</a>
  
    <li><a href="../../git/t/t4053-diff-no-index_sh.html">t4053-diff-no-index.sh</a>
  
    <li><a href="../../git/t/t4054-diff-bogus-tree_sh.html">t4054-diff-bogus-tree.sh</a>
  
    <li><a href="../../git/t/t4055-diff-context_sh.html">t4055-diff-context.sh</a>
  
    <li><a href="../../git/t/t4100-apply-stat_sh.html">t4100-apply-stat.sh</a>
  
    <li><a href="../../git/t/t4100/t-apply-1_expect.html">t-apply-1.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-1_patch.html">t-apply-1.patch</a>
  
    <li><a href="../../git/t/t4100/t-apply-2_expect.html">t-apply-2.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-2_patch.html">t-apply-2.patch</a>
  
    <li><a href="../../git/t/t4100/t-apply-3_expect.html">t-apply-3.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-3_patch.html">t-apply-3.patch</a>
  
    <li><a href="../../git/t/t4100/t-apply-4_expect.html">t-apply-4.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-4_patch.html">t-apply-4.patch</a>
  
    <li><a href="../../git/t/t4100/t-apply-5_expect.html">t-apply-5.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-5_patch.html">t-apply-5.patch</a>
  
    <li><a href="../../git/t/t4100/t-apply-6_expect.html">t-apply-6.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-6_patch.html">t-apply-6.patch</a>
  
    <li><a href="../../git/t/t4100/t-apply-7_expect.html">t-apply-7.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-7_patch.html">t-apply-7.patch</a>
  
    <li><a href="../../git/t/t4100/t-apply-8_expect.html">t-apply-8.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-8_patch.html">t-apply-8.patch</a>
  
    <li><a href="../../git/t/t4100/t-apply-9_expect.html">t-apply-9.expect</a>
  
    <li><a href="../../git/t/t4100/t-apply-9_patch.html">t-apply-9.patch</a>
  
    <li><a href="../../git/t/t4101-apply-nonl_sh.html">t4101-apply-nonl.sh</a>
  
    <li><a href="../../git/t/t4101/diff_0-1.html">diff.0-1</a>
  
    <li><a href="../../git/t/t4101/diff_0-2.html">diff.0-2</a>
  
    <li><a href="../../git/t/t4101/diff_0-3.html">diff.0-3</a>
  
    <li><a href="../../git/t/t4101/diff_1-0.html">diff.1-0</a>
  
    <li><a href="../../git/t/t4101/diff_1-2.html">diff.1-2</a>
  
    <li><a href="../../git/t/t4101/diff_1-3.html">diff.1-3</a>
  
    <li><a href="../../git/t/t4101/diff_2-0.html">diff.2-0</a>
  
    <li><a href="../../git/t/t4101/diff_2-1.html">diff.2-1</a>
  
    <li><a href="../../git/t/t4101/diff_2-3.html">diff.2-3</a>
  
    <li><a href="../../git/t/t4101/diff_3-0.html">diff.3-0</a>
  
    <li><a href="../../git/t/t4101/diff_3-1.html">diff.3-1</a>
  
    <li><a href="../../git/t/t4101/diff_3-2.html">diff.3-2</a>
  
    <li><a href="../../git/t/t4102-apply-rename_sh.html">t4102-apply-rename.sh</a>
  
    <li><a href="../../git/t/t4103-apply-binary_sh.html">t4103-apply-binary.sh</a>
  
    <li><a href="../../git/t/t4104-apply-boundary_sh.html">t4104-apply-boundary.sh</a>
  
    <li><a href="../../git/t/t4105-apply-fuzz_sh.html">t4105-apply-fuzz.sh</a>
  
    <li><a href="../../git/t/t4106-apply-stdin_sh.html">t4106-apply-stdin.sh</a>
  
    <li><a href="../../git/t/t4107-apply-ignore-whitespace_sh.html">t4107-apply-ignore-whitespace.sh</a>
  
    <li><a href="../../git/t/t4108-apply-threeway_sh.html">t4108-apply-threeway.sh</a>
  
    <li><a href="../../git/t/t4109-apply-multifrag_sh.html">t4109-apply-multifrag.sh</a>
  
    <li><a href="../../git/t/t4109/expect-1.html">expect-1</a>
  
    <li><a href="../../git/t/t4109/expect-2.html">expect-2</a>
  
    <li><a href="../../git/t/t4109/expect-3.html">expect-3</a>
  
    <li><a href="../../git/t/t4109/patch1_patch.html">patch1.patch</a>
  
    <li><a href="../../git/t/t4109/patch2_patch.html">patch2.patch</a>
  
    <li><a href="../../git/t/t4109/patch3_patch.html">patch3.patch</a>
  
    <li><a href="../../git/t/t4109/patch4_patch.html">patch4.patch</a>
  
    <li><a href="../../git/t/t4110-apply-scan_sh.html">t4110-apply-scan.sh</a>
  
    <li><a href="../../git/t/t4110/expect.html">expect</a>
  
    <li><a href="../../git/t/t4110/patch1_patch.html">patch1.patch</a>
  
    <li><a href="../../git/t/t4110/patch2_patch.html">patch2.patch</a>
  
    <li><a href="../../git/t/t4110/patch3_patch.html">patch3.patch</a>
  
    <li><a href="../../git/t/t4110/patch4_patch.html">patch4.patch</a>
  
    <li><a href="../../git/t/t4110/patch5_patch.html">patch5.patch</a>
  
    <li><a href="../../git/t/t4111-apply-subdir_sh.html">t4111-apply-subdir.sh</a>
  
    <li><a href="../../git/t/t4112-apply-renames_sh.html">t4112-apply-renames.sh</a>
  
    <li><a href="../../git/t/t4113-apply-ending_sh.html">t4113-apply-ending.sh</a>
  
    <li><a href="../../git/t/t4114-apply-typechange_sh.html">t4114-apply-typechange.sh</a>
  
    <li><a href="../../git/t/t4115-apply-symlink_sh.html">t4115-apply-symlink.sh</a>
  
    <li><a href="../../git/t/t4116-apply-reverse_sh.html">t4116-apply-reverse.sh</a>
  
    <li><a href="../../git/t/t4117-apply-reject_sh.html">t4117-apply-reject.sh</a>
  
    <li><a href="../../git/t/t4118-apply-empty-context_sh.html">t4118-apply-empty-context.sh</a>
  
    <li><a href="../../git/t/t4119-apply-config_sh.html">t4119-apply-config.sh</a>
  
    <li><a href="../../git/t/t4120-apply-popt_sh.html">t4120-apply-popt.sh</a>
  
    <li><a href="../../git/t/t4121-apply-diffs_sh.html">t4121-apply-diffs.sh</a>
  
    <li><a href="../../git/t/t4122-apply-symlink-inside_sh.html">t4122-apply-symlink-inside.sh</a>
  
    <li><a href="../../git/t/t4123-apply-shrink_sh.html">t4123-apply-shrink.sh</a>
  
    <li><a href="../../git/t/t4124-apply-ws-rule_sh.html">t4124-apply-ws-rule.sh</a>
  
    <li><a href="../../git/t/t4125-apply-ws-fuzz_sh.html">t4125-apply-ws-fuzz.sh</a>
  
    <li><a href="../../git/t/t4126-apply-empty_sh.html">t4126-apply-empty.sh</a>
  
    <li><a href="../../git/t/t4127-apply-same-fn_sh.html">t4127-apply-same-fn.sh</a>
  
    <li><a href="../../git/t/t4128-apply-root_sh.html">t4128-apply-root.sh</a>
  
    <li><a href="../../git/t/t4129-apply-samemode_sh.html">t4129-apply-samemode.sh</a>
  
    <li><a href="../../git/t/t4130-apply-criss-cross-rename_sh.html">t4130-apply-criss-cross-rename.sh</a>
  
    <li><a href="../../git/t/t4131-apply-fake-ancestor_sh.html">t4131-apply-fake-ancestor.sh</a>
  
    <li><a href="../../git/t/t4132-apply-removal_sh.html">t4132-apply-removal.sh</a>
  
    <li><a href="../../git/t/t4133-apply-filenames_sh.html">t4133-apply-filenames.sh</a>
  
    <li><a href="../../git/t/t4134-apply-submodule_sh.html">t4134-apply-submodule.sh</a>
  
    <li><a href="../../git/t/t4135-apply-weird-filenames_sh.html">t4135-apply-weird-filenames.sh</a>
  
    <li><a href="../../git/t/t4135/add-plain_diff.html">add-plain.diff</a>
  
    <li><a href="../../git/t/t4135/add-with backslash_diff.html">add-with backslash.diff</a>
  
    <li><a href="../../git/t/t4135/add-with quote_diff.html">add-with quote.diff</a>
  
    <li><a href="../../git/t/t4135/add-with spaces_diff.html">add-with spaces.diff</a>
  
    <li><a href="../../git/t/t4135/add-with tab_diff.html">add-with tab.diff</a>
  
    <li><a href="../../git/t/t4135/damaged-tz_diff.html">damaged-tz.diff</a>
  
    <li><a href="../../git/t/t4135/damaged_diff.html">damaged.diff</a>
  
    <li><a href="../../git/t/t4135/diff-plain_diff.html">diff-plain.diff</a>
  
    <li><a href="../../git/t/t4135/diff-with backslash_diff.html">diff-with backslash.diff</a>
  
    <li><a href="../../git/t/t4135/diff-with quote_diff.html">diff-with quote.diff</a>
  
    <li><a href="../../git/t/t4135/diff-with spaces_diff.html">diff-with spaces.diff</a>
  
    <li><a href="../../git/t/t4135/diff-with tab_diff.html">diff-with tab.diff</a>
  
    <li><a href="../../git/t/t4135/funny-tz_diff.html">funny-tz.diff</a>
  
    <li><a href="../../git/t/t4135/git-plain_diff.html">git-plain.diff</a>
  
    <li><a href="../../git/t/t4135/git-with backslash_diff.html">git-with backslash.diff</a>
  
    <li><a href="../../git/t/t4135/git-with quote_diff.html">git-with quote.diff</a>
  
    <li><a href="../../git/t/t4135/git-with spaces_diff.html">git-with spaces.diff</a>
  
    <li><a href="../../git/t/t4135/git-with tab_diff.html">git-with tab.diff</a>
  
    <li><a href="../../git/t/t4135/make-patches.html">make-patches</a>
  
    <li><a href="../../git/t/t4136-apply-check_sh.html">t4136-apply-check.sh</a>
  
    <li><a href="../../git/t/t4150-am_sh.html">t4150-am.sh</a>
  
    <li><a href="../../git/t/t4151-am-abort_sh.html">t4151-am-abort.sh</a>
  
    <li><a href="../../git/t/t4152-am-subjects_sh.html">t4152-am-subjects.sh</a>
  
    <li><a href="../../git/t/t4200-rerere_sh.html">t4200-rerere.sh</a>
  
    <li><a href="../../git/t/t4202-log_sh.html">t4202-log.sh</a>
  
    <li><a href="../../git/t/t4203-mailmap_sh.html">t4203-mailmap.sh</a>
  
    <li><a href="../../git/t/t4204-patch-id_sh.html">t4204-patch-id.sh</a>
  
    <li><a href="../../git/t/t4205-log-pretty-formats_sh.html">t4205-log-pretty-formats.sh</a>
  
    <li><a href="../../git/t/t4206-log-follow-harder-copies_sh.html">t4206-log-follow-harder-copies.sh</a>
  
    <li><a href="../../git/t/t4207-log-decoration-colors_sh.html">t4207-log-decoration-colors.sh</a>
  
    <li><a href="../../git/t/t4208-log-magic-pathspec_sh.html">t4208-log-magic-pathspec.sh</a>
  
    <li><a href="../../git/t/t4209-log-pickaxe_sh.html">t4209-log-pickaxe.sh</a>
  
    <li><a href="../../git/t/t4210-log-i18n_sh.html">t4210-log-i18n.sh</a>
  
    <li><a href="../../git/t/t4211-line-log_sh.html">t4211-line-log.sh</a>
  
    <li><a href="../../git/t/t4211/expect_beginning-of-file.html">expect.beginning-of-file</a>
  
    <li><a href="../../git/t/t4211/expect_end-of-file.html">expect.end-of-file</a>
  
    <li><a href="../../git/t/t4211/expect_move-support-f.html">expect.move-support-f</a>
  
    <li><a href="../../git/t/t4211/expect_multiple.html">expect.multiple</a>
  
    <li><a href="../../git/t/t4211/expect_multiple-overlapping.html">expect.multiple-overlapping</a>
  
    <li><a href="../../git/t/t4211/expect_multiple-superset.html">expect.multiple-superset</a>
  
    <li><a href="../../git/t/t4211/expect_parallel-change-f-to-main.html">expect.parallel-change-f-to-main</a>
  
    <li><a href="../../git/t/t4211/expect_simple-f.html">expect.simple-f</a>
  
    <li><a href="../../git/t/t4211/expect_simple-f-to-main.html">expect.simple-f-to-main</a>
  
    <li><a href="../../git/t/t4211/expect_simple-main.html">expect.simple-main</a>
  
    <li><a href="../../git/t/t4211/expect_simple-main-to-end.html">expect.simple-main-to-end</a>
  
    <li><a href="../../git/t/t4211/expect_two-ranges.html">expect.two-ranges</a>
  
    <li><a href="../../git/t/t4211/expect_vanishes-early.html">expect.vanishes-early</a>
  
    <li><a href="../../git/t/t4211/history_export.html">history.export</a>
  
    <li><a href="../../git/t/t4212-log-corrupt_sh.html">t4212-log-corrupt.sh</a>
  
    <li><a href="../../git/t/t4252-am-options_sh.html">t4252-am-options.sh</a>
  
    <li><a href="../../git/t/t4252/am-test-1-1.html">am-test-1-1</a>
  
    <li><a href="../../git/t/t4252/am-test-1-2.html">am-test-1-2</a>
  
    <li><a href="../../git/t/t4252/am-test-2-1.html">am-test-2-1</a>
  
    <li><a href="../../git/t/t4252/am-test-2-2.html">am-test-2-2</a>
  
    <li><a href="../../git/t/t4252/am-test-3-1.html">am-test-3-1</a>
  
    <li><a href="../../git/t/t4252/am-test-3-2.html">am-test-3-2</a>
  
    <li><a href="../../git/t/t4252/am-test-4-1.html">am-test-4-1</a>
  
    <li><a href="../../git/t/t4252/am-test-4-2.html">am-test-4-2</a>
  
    <li><a href="../../git/t/t4252/am-test-5-1.html">am-test-5-1</a>
  
    <li><a href="../../git/t/t4252/am-test-5-2.html">am-test-5-2</a>
  
    <li><a href="../../git/t/t4252/am-test-6-1.html">am-test-6-1</a>
  
    <li><a href="../../git/t/t4252/file-1-0.html">file-1-0</a>
  
    <li><a href="../../git/t/t4252/file-2-0.html">file-2-0</a>
  
    <li><a href="../../git/t/t4253-am-keep-cr-dos_sh.html">t4253-am-keep-cr-dos.sh</a>
  
    <li><a href="../../git/t/t4254-am-corrupt_sh.html">t4254-am-corrupt.sh</a>
  
    <li><a href="../../git/t/t4300-merge-tree_sh.html">t4300-merge-tree.sh</a>
  
    <li><a href="../../git/t/t5000-tar-tree_sh.html">t5000-tar-tree.sh</a>
  
    <li><a href="../../git/t/t5001-archive-attr_sh.html">t5001-archive-attr.sh</a>
  
    <li><a href="../../git/t/t5002-archive-attr-pattern_sh.html">t5002-archive-attr-pattern.sh</a>
  
    <li><a href="../../git/t/t5003-archive-zip_sh.html">t5003-archive-zip.sh</a>
  
    <li><a href="../../git/t/t5004-archive-corner-cases_sh.html">t5004-archive-corner-cases.sh</a>
  
    <li><a href="../../git/t/t5100-mailinfo_sh.html">t5100-mailinfo.sh</a>
  
    <li><a href="../../git/t/t5100/empty.html">empty</a>
  
    <li><a href="../../git/t/t5100/info-from_expect.html">info-from.expect</a>
  
    <li><a href="../../git/t/t5100/info-from_in.html">info-from.in</a>
  
    <li><a href="../../git/t/t5100/info0001.html">info0001</a>
  
    <li><a href="../../git/t/t5100/info0002.html">info0002</a>
  
    <li><a href="../../git/t/t5100/info0003.html">info0003</a>
  
    <li><a href="../../git/t/t5100/info0004.html">info0004</a>
  
    <li><a href="../../git/t/t5100/info0005.html">info0005</a>
  
    <li><a href="../../git/t/t5100/info0006.html">info0006</a>
  
    <li><a href="../../git/t/t5100/info0007.html">info0007</a>
  
    <li><a href="../../git/t/t5100/info0008.html">info0008</a>
  
    <li><a href="../../git/t/t5100/info0009.html">info0009</a>
  
    <li><a href="../../git/t/t5100/info0010.html">info0010</a>
  
    <li><a href="../../git/t/t5100/info0011.html">info0011</a>
  
    <li><a href="../../git/t/t5100/info0012.html">info0012</a>
  
    <li><a href="../../git/t/t5100/info0013.html">info0013</a>
  
    <li><a href="../../git/t/t5100/info0014.html">info0014</a>
  
    <li><a href="../../git/t/t5100/info0014--scissors.html">info0014--scissors</a>
  
    <li><a href="../../git/t/t5100/info0015.html">info0015</a>
  
    <li><a href="../../git/t/t5100/info0015--no-inbody-headers.html">info0015--no-inbody-headers</a>
  
    <li><a href="../../git/t/t5100/info0016.html">info0016</a>
  
    <li><a href="../../git/t/t5100/info0016--no-inbody-headers.html">info0016--no-inbody-headers</a>
  
    <li><a href="../../git/t/t5100/info0017.html">info0017</a>
  
    <li><a href="../../git/t/t5100/msg0001.html">msg0001</a>
  
    <li><a href="../../git/t/t5100/msg0002.html">msg0002</a>
  
    <li><a href="../../git/t/t5100/msg0003.html">msg0003</a>
  
    <li><a href="../../git/t/t5100/msg0004.html">msg0004</a>
  
    <li><a href="../../git/t/t5100/msg0005.html">msg0005</a>
  
    <li><a href="../../git/t/t5100/msg0006.html">msg0006</a>
  
    <li><a href="../../git/t/t5100/msg0007.html">msg0007</a>
  
    <li><a href="../../git/t/t5100/msg0008.html">msg0008</a>
  
    <li><a href="../../git/t/t5100/msg0009.html">msg0009</a>
  
    <li><a href="../../git/t/t5100/msg0010.html">msg0010</a>
  
    <li><a href="../../git/t/t5100/msg0011.html">msg0011</a>
  
    <li><a href="../../git/t/t5100/msg0012.html">msg0012</a>
  
    <li><a href="../../git/t/t5100/msg0013.html">msg0013</a>
  
    <li><a href="../../git/t/t5100/msg0014.html">msg0014</a>
  
    <li><a href="../../git/t/t5100/msg0014--scissors.html">msg0014--scissors</a>
  
    <li><a href="../../git/t/t5100/msg0015.html">msg0015</a>
  
    <li><a href="../../git/t/t5100/msg0015--no-inbody-headers.html">msg0015--no-inbody-headers</a>
  
    <li><a href="../../git/t/t5100/msg0016.html">msg0016</a>
  
    <li><a href="../../git/t/t5100/msg0016--no-inbody-headers.html">msg0016--no-inbody-headers</a>
  
    <li><a href="../../git/t/t5100/msg0017.html">msg0017</a>
  
    <li><a href="../../git/t/t5100/nul-b64_in.html">nul-b64.in</a>
  
    <li><a href="../../git/t/t5100/patch0001.html">patch0001</a>
  
    <li><a href="../../git/t/t5100/patch0002.html">patch0002</a>
  
    <li><a href="../../git/t/t5100/patch0003.html">patch0003</a>
  
    <li><a href="../../git/t/t5100/patch0004.html">patch0004</a>
  
    <li><a href="../../git/t/t5100/patch0006.html">patch0006</a>
  
    <li><a href="../../git/t/t5100/patch0007.html">patch0007</a>
  
    <li><a href="../../git/t/t5100/patch0008.html">patch0008</a>
  
    <li><a href="../../git/t/t5100/patch0009.html">patch0009</a>
  
    <li><a href="../../git/t/t5100/patch0010.html">patch0010</a>
  
    <li><a href="../../git/t/t5100/patch0011.html">patch0011</a>
  
    <li><a href="../../git/t/t5100/patch0012.html">patch0012</a>
  
    <li><a href="../../git/t/t5100/patch0013.html">patch0013</a>
  
    <li><a href="../../git/t/t5100/patch0014.html">patch0014</a>
  
    <li><a href="../../git/t/t5100/patch0014--scissors.html">patch0014--scissors</a>
  
    <li><a href="../../git/t/t5100/patch0015.html">patch0015</a>
  
    <li><a href="../../git/t/t5100/patch0015--no-inbody-headers.html">patch0015--no-inbody-headers</a>
  
    <li><a href="../../git/t/t5100/patch0016.html">patch0016</a>
  
    <li><a href="../../git/t/t5100/patch0016--no-inbody-headers.html">patch0016--no-inbody-headers</a>
  
    <li><a href="../../git/t/t5100/patch0017.html">patch0017</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0001.html">rfc2047-info-0001</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0002.html">rfc2047-info-0002</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0003.html">rfc2047-info-0003</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0004.html">rfc2047-info-0004</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0005.html">rfc2047-info-0005</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0006.html">rfc2047-info-0006</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0007.html">rfc2047-info-0007</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0008.html">rfc2047-info-0008</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0009.html">rfc2047-info-0009</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0010.html">rfc2047-info-0010</a>
  
    <li><a href="../../git/t/t5100/rfc2047-info-0011.html">rfc2047-info-0011</a>
  
    <li><a href="../../git/t/t5100/rfc2047-samples_mbox.html">rfc2047-samples.mbox</a>
  
    <li><a href="../../git/t/t5100/sample_mbox.html">sample.mbox</a>
  
    <li><a href="../../git/t/t5150-request-pull_sh.html">t5150-request-pull.sh</a>
  
    <li><a href="../../git/t/t5300-pack-object_sh.html">t5300-pack-object.sh</a>
  
    <li><a href="../../git/t/t5301-sliding-window_sh.html">t5301-sliding-window.sh</a>
  
    <li><a href="../../git/t/t5302-pack-index_sh.html">t5302-pack-index.sh</a>
  
    <li><a href="../../git/t/t5303-pack-corruption-resilience_sh.html">t5303-pack-corruption-resilience.sh</a>
  
    <li><a href="../../git/t/t5304-prune_sh.html">t5304-prune.sh</a>
  
    <li><a href="../../git/t/t5305-include-tag_sh.html">t5305-include-tag.sh</a>
  
    <li><a href="../../git/t/t5306-pack-nobase_sh.html">t5306-pack-nobase.sh</a>
  
    <li><a href="../../git/t/t5307-pack-missing-commit_sh.html">t5307-pack-missing-commit.sh</a>
  
    <li><a href="../../git/t/t5308-pack-detect-duplicates_sh.html">t5308-pack-detect-duplicates.sh</a>
  
    <li><a href="../../git/t/t5309-pack-delta-cycles_sh.html">t5309-pack-delta-cycles.sh</a>
  
    <li><a href="../../git/t/t5400-send-pack_sh.html">t5400-send-pack.sh</a>
  
    <li><a href="../../git/t/t5401-update-hooks_sh.html">t5401-update-hooks.sh</a>
  
    <li><a href="../../git/t/t5402-post-merge-hook_sh.html">t5402-post-merge-hook.sh</a>
  
    <li><a href="../../git/t/t5403-post-checkout-hook_sh.html">t5403-post-checkout-hook.sh</a>
  
    <li><a href="../../git/t/t5404-tracking-branches_sh.html">t5404-tracking-branches.sh</a>
  
    <li><a href="../../git/t/t5405-send-pack-rewind_sh.html">t5405-send-pack-rewind.sh</a>
  
    <li><a href="../../git/t/t5406-remote-rejects_sh.html">t5406-remote-rejects.sh</a>
  
    <li><a href="../../git/t/t5407-post-rewrite-hook_sh.html">t5407-post-rewrite-hook.sh</a>
  
    <li><a href="../../git/t/t5500-fetch-pack_sh.html">t5500-fetch-pack.sh</a>
  
    <li><a href="../../git/t/t5501-fetch-push-alternates_sh.html">t5501-fetch-push-alternates.sh</a>
  
    <li><a href="../../git/t/t5502-quickfetch_sh.html">t5502-quickfetch.sh</a>
  
    <li><a href="../../git/t/t5503-tagfollow_sh.html">t5503-tagfollow.sh</a>
  
    <li><a href="../../git/t/t5504-fetch-receive-strict_sh.html">t5504-fetch-receive-strict.sh</a>
  
    <li><a href="../../git/t/t5505-remote_sh.html">t5505-remote.sh</a>
  
    <li><a href="../../git/t/t5506-remote-groups_sh.html">t5506-remote-groups.sh</a>
  
    <li><a href="../../git/t/t5509-fetch-push-namespaces_sh.html">t5509-fetch-push-namespaces.sh</a>
  
    <li><a href="../../git/t/t5510-fetch_sh.html">t5510-fetch.sh</a>
  
    <li><a href="../../git/t/t5511-refspec_sh.html">t5511-refspec.sh</a>
  
    <li><a href="../../git/t/t5512-ls-remote_sh.html">t5512-ls-remote.sh</a>
  
    <li><a href="../../git/t/t5513-fetch-track_sh.html">t5513-fetch-track.sh</a>
  
    <li><a href="../../git/t/t5514-fetch-multiple_sh.html">t5514-fetch-multiple.sh</a>
  
    <li><a href="../../git/t/t5515-fetch-merge-logic_sh.html">t5515-fetch-merge-logic.sh</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-default.html">fetch.br-branches-default</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-default-merge.html">fetch.br-branches-default-merge</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-default-merge_branches-default.html">fetch.br-branches-default-merge_branches-default</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-default-octopus.html">fetch.br-branches-default-octopus</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-default-octopus_branches-default.html">fetch.br-branches-default-octopus_branches-default</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-default_branches-default.html">fetch.br-branches-default_branches-default</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-one.html">fetch.br-branches-one</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-one-merge.html">fetch.br-branches-one-merge</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-one-merge_branches-one.html">fetch.br-branches-one-merge_branches-one</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-one-octopus.html">fetch.br-branches-one-octopus</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-one-octopus_branches-one.html">fetch.br-branches-one-octopus_branches-one</a>
  
    <li><a href="../../git/t/t5515/fetch_br-branches-one_branches-one.html">fetch.br-branches-one_branches-one</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-explicit.html">fetch.br-config-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-explicit-merge.html">fetch.br-config-explicit-merge</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-explicit-merge_config-explicit.html">fetch.br-config-explicit-merge_config-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-explicit-octopus.html">fetch.br-config-explicit-octopus</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-explicit-octopus_config-explicit.html">fetch.br-config-explicit-octopus_config-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-explicit_config-explicit.html">fetch.br-config-explicit_config-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-glob.html">fetch.br-config-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-glob-merge.html">fetch.br-config-glob-merge</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-glob-merge_config-glob.html">fetch.br-config-glob-merge_config-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-glob-octopus.html">fetch.br-config-glob-octopus</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-glob-octopus_config-glob.html">fetch.br-config-glob-octopus_config-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-config-glob_config-glob.html">fetch.br-config-glob_config-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-explicit.html">fetch.br-remote-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-explicit-merge.html">fetch.br-remote-explicit-merge</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-explicit-merge_remote-explicit.html">fetch.br-remote-explicit-merge_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-explicit-octopus.html">fetch.br-remote-explicit-octopus</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-explicit-octopus_remote-explicit.html">fetch.br-remote-explicit-octopus_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-explicit_remote-explicit.html">fetch.br-remote-explicit_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-glob.html">fetch.br-remote-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-glob-merge.html">fetch.br-remote-glob-merge</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-glob-merge_remote-glob.html">fetch.br-remote-glob-merge_remote-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-glob-octopus.html">fetch.br-remote-glob-octopus</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-glob-octopus_remote-glob.html">fetch.br-remote-glob-octopus_remote-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-remote-glob_remote-glob.html">fetch.br-remote-glob_remote-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig.html">fetch.br-unconfig</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_--tags_____git.html">fetch.br-unconfig_--tags_.._.git</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_____git.html">fetch.br-unconfig_.._.git</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_____git_one.html">fetch.br-unconfig_.._.git_one</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_____git_one_tag_tag-one_tag_tag-three-file.html">fetch.br-unconfig_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_____git_one_two.html">fetch.br-unconfig_.._.git_one_two</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_____git_tag_tag-one-tree_tag_tag-three-file.html">fetch.br-unconfig_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_____git_tag_tag-one_tag_tag-three.html">fetch.br-unconfig_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_branches-default.html">fetch.br-unconfig_branches-default</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_branches-one.html">fetch.br-unconfig_branches-one</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_config-explicit.html">fetch.br-unconfig_config-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_config-glob.html">fetch.br-unconfig_config-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_remote-explicit.html">fetch.br-unconfig_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_br-unconfig_remote-glob.html">fetch.br-unconfig_remote-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_master.html">fetch.master</a>
  
    <li><a href="../../git/t/t5515/fetch_master_--tags_____git.html">fetch.master_--tags_.._.git</a>
  
    <li><a href="../../git/t/t5515/fetch_master_____git.html">fetch.master_.._.git</a>
  
    <li><a href="../../git/t/t5515/fetch_master_____git_one.html">fetch.master_.._.git_one</a>
  
    <li><a href="../../git/t/t5515/fetch_master_____git_one_tag_tag-one_tag_tag-three-file.html">fetch.master_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../../git/t/t5515/fetch_master_____git_one_two.html">fetch.master_.._.git_one_two</a>
  
    <li><a href="../../git/t/t5515/fetch_master_____git_tag_tag-one-tree_tag_tag-three-file.html">fetch.master_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../../git/t/t5515/fetch_master_____git_tag_tag-one_tag_tag-three.html">fetch.master_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../../git/t/t5515/fetch_master_branches-default.html">fetch.master_branches-default</a>
  
    <li><a href="../../git/t/t5515/fetch_master_branches-one.html">fetch.master_branches-one</a>
  
    <li><a href="../../git/t/t5515/fetch_master_config-explicit.html">fetch.master_config-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_master_config-glob.html">fetch.master_config-glob</a>
  
    <li><a href="../../git/t/t5515/fetch_master_remote-explicit.html">fetch.master_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/fetch_master_remote-glob.html">fetch.master_remote-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-default.html">refs.br-branches-default</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-default-merge.html">refs.br-branches-default-merge</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-default-merge_branches-default.html">refs.br-branches-default-merge_branches-default</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-default-octopus.html">refs.br-branches-default-octopus</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-default-octopus_branches-default.html">refs.br-branches-default-octopus_branches-default</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-default_branches-default.html">refs.br-branches-default_branches-default</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-one.html">refs.br-branches-one</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-one-merge.html">refs.br-branches-one-merge</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-one-merge_branches-one.html">refs.br-branches-one-merge_branches-one</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-one-octopus.html">refs.br-branches-one-octopus</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-one-octopus_branches-one.html">refs.br-branches-one-octopus_branches-one</a>
  
    <li><a href="../../git/t/t5515/refs_br-branches-one_branches-one.html">refs.br-branches-one_branches-one</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-explicit.html">refs.br-config-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-explicit-merge.html">refs.br-config-explicit-merge</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-explicit-merge_config-explicit.html">refs.br-config-explicit-merge_config-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-explicit-octopus.html">refs.br-config-explicit-octopus</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-explicit-octopus_config-explicit.html">refs.br-config-explicit-octopus_config-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-explicit_config-explicit.html">refs.br-config-explicit_config-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-glob.html">refs.br-config-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-glob-merge.html">refs.br-config-glob-merge</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-glob-merge_config-glob.html">refs.br-config-glob-merge_config-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-glob-octopus.html">refs.br-config-glob-octopus</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-glob-octopus_config-glob.html">refs.br-config-glob-octopus_config-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-config-glob_config-glob.html">refs.br-config-glob_config-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-explicit.html">refs.br-remote-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-explicit-merge.html">refs.br-remote-explicit-merge</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-explicit-merge_remote-explicit.html">refs.br-remote-explicit-merge_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-explicit-octopus.html">refs.br-remote-explicit-octopus</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-explicit-octopus_remote-explicit.html">refs.br-remote-explicit-octopus_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-explicit_remote-explicit.html">refs.br-remote-explicit_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-glob.html">refs.br-remote-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-glob-merge.html">refs.br-remote-glob-merge</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-glob-merge_remote-glob.html">refs.br-remote-glob-merge_remote-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-glob-octopus.html">refs.br-remote-glob-octopus</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-glob-octopus_remote-glob.html">refs.br-remote-glob-octopus_remote-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-remote-glob_remote-glob.html">refs.br-remote-glob_remote-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig.html">refs.br-unconfig</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_--tags_____git.html">refs.br-unconfig_--tags_.._.git</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_____git.html">refs.br-unconfig_.._.git</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_____git_one.html">refs.br-unconfig_.._.git_one</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_____git_one_tag_tag-one_tag_tag-three-file.html">refs.br-unconfig_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_____git_one_two.html">refs.br-unconfig_.._.git_one_two</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_____git_tag_tag-one-tree_tag_tag-three-file.html">refs.br-unconfig_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_____git_tag_tag-one_tag_tag-three.html">refs.br-unconfig_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_branches-default.html">refs.br-unconfig_branches-default</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_branches-one.html">refs.br-unconfig_branches-one</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_config-explicit.html">refs.br-unconfig_config-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_config-glob.html">refs.br-unconfig_config-glob</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_remote-explicit.html">refs.br-unconfig_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_br-unconfig_remote-glob.html">refs.br-unconfig_remote-glob</a>
  
    <li><a href="../../git/t/t5515/refs_master.html">refs.master</a>
  
    <li><a href="../../git/t/t5515/refs_master_--tags_____git.html">refs.master_--tags_.._.git</a>
  
    <li><a href="../../git/t/t5515/refs_master_____git.html">refs.master_.._.git</a>
  
    <li><a href="../../git/t/t5515/refs_master_____git_one.html">refs.master_.._.git_one</a>
  
    <li><a href="../../git/t/t5515/refs_master_____git_one_tag_tag-one_tag_tag-three-file.html">refs.master_.._.git_one_tag_tag-one_tag_tag-three-file</a>
  
    <li><a href="../../git/t/t5515/refs_master_____git_one_two.html">refs.master_.._.git_one_two</a>
  
    <li><a href="../../git/t/t5515/refs_master_____git_tag_tag-one-tree_tag_tag-three-file.html">refs.master_.._.git_tag_tag-one-tree_tag_tag-three-file</a>
  
    <li><a href="../../git/t/t5515/refs_master_____git_tag_tag-one_tag_tag-three.html">refs.master_.._.git_tag_tag-one_tag_tag-three</a>
  
    <li><a href="../../git/t/t5515/refs_master_branches-default.html">refs.master_branches-default</a>
  
    <li><a href="../../git/t/t5515/refs_master_branches-one.html">refs.master_branches-one</a>
  
    <li><a href="../../git/t/t5515/refs_master_config-explicit.html">refs.master_config-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_master_config-glob.html">refs.master_config-glob</a>
  
    <li><a href="../../git/t/t5515/refs_master_remote-explicit.html">refs.master_remote-explicit</a>
  
    <li><a href="../../git/t/t5515/refs_master_remote-glob.html">refs.master_remote-glob</a>
  
    <li><a href="../../git/t/t5516-fetch-push_sh.html">t5516-fetch-push.sh</a>
  
    <li><a href="../../git/t/t5517-push-mirror_sh.html">t5517-push-mirror.sh</a>
  
    <li><a href="../../git/t/t5518-fetch-exit-status_sh.html">t5518-fetch-exit-status.sh</a>
  
    <li><a href="../../git/t/t5519-push-alternates_sh.html">t5519-push-alternates.sh</a>
  
    <li><a href="../../git/t/t5520-pull_sh.html">t5520-pull.sh</a>
  
    <li><a href="../../git/t/t5521-pull-options_sh.html">t5521-pull-options.sh</a>
  
    <li><a href="../../git/t/t5522-pull-symlink_sh.html">t5522-pull-symlink.sh</a>
  
    <li><a href="../../git/t/t5523-push-upstream_sh.html">t5523-push-upstream.sh</a>
  
    <li><a href="../../git/t/t5524-pull-msg_sh.html">t5524-pull-msg.sh</a>
  
    <li><a href="../../git/t/t5525-fetch-tagopt_sh.html">t5525-fetch-tagopt.sh</a>
  
    <li><a href="../../git/t/t5526-fetch-submodules_sh.html">t5526-fetch-submodules.sh</a>
  
    <li><a href="../../git/t/t5527-fetch-odd-refs_sh.html">t5527-fetch-odd-refs.sh</a>
  
    <li><a href="../../git/t/t5528-push-default_sh.html">t5528-push-default.sh</a>
  
    <li><a href="../../git/t/t5530-upload-pack-error_sh.html">t5530-upload-pack-error.sh</a>
  
    <li><a href="../../git/t/t5531-deep-submodule-push_sh.html">t5531-deep-submodule-push.sh</a>
  
    <li><a href="../../git/t/t5532-fetch-proxy_sh.html">t5532-fetch-proxy.sh</a>
  
    <li><a href="../../git/t/t5533-push-cas_sh.html">t5533-push-cas.sh</a>
  
    <li><a href="../../git/t/t5535-fetch-push-symref_sh.html">t5535-fetch-push-symref.sh</a>
  
    <li><a href="../../git/t/t5540-http-push_sh.html">t5540-http-push.sh</a>
  
    <li><a href="../../git/t/t5541-http-push_sh.html">t5541-http-push.sh</a>
  
    <li><a href="../../git/t/t5550-http-fetch_sh.html">t5550-http-fetch.sh</a>
  
    <li><a href="../../git/t/t5551-http-fetch_sh.html">t5551-http-fetch.sh</a>
  
    <li><a href="../../git/t/t5560-http-backend-noserver_sh.html">t5560-http-backend-noserver.sh</a>
  
    <li><a href="../../git/t/t5561-http-backend_sh.html">t5561-http-backend.sh</a>
  
    <li><a href="../../git/t/t556x_common.html">t556x_common</a>
  
    <li><a href="../../git/t/t5570-git-daemon_sh.html">t5570-git-daemon.sh</a>
  
    <li><a href="../../git/t/t5571-pre-push-hook_sh.html">t5571-pre-push-hook.sh</a>
  
    <li><a href="../../git/t/t5600-clone-fail-cleanup_sh.html">t5600-clone-fail-cleanup.sh</a>
  
    <li><a href="../../git/t/t5601-clone_sh.html">t5601-clone.sh</a>
  
    <li><a href="../../git/t/t5602-clone-remote-exec_sh.html">t5602-clone-remote-exec.sh</a>
  
    <li><a href="../../git/t/t5700-clone-reference_sh.html">t5700-clone-reference.sh</a>
  
    <li><a href="../../git/t/t5701-clone-local_sh.html">t5701-clone-local.sh</a>
  
    <li><a href="../../git/t/t5702-clone-options_sh.html">t5702-clone-options.sh</a>
  
    <li><a href="../../git/t/t5704-bundle_sh.html">t5704-bundle.sh</a>
  
    <li><a href="../../git/t/t5705-clone-2gb_sh.html">t5705-clone-2gb.sh</a>
  
    <li><a href="../../git/t/t5706-clone-branch_sh.html">t5706-clone-branch.sh</a>
  
    <li><a href="../../git/t/t5707-clone-detached_sh.html">t5707-clone-detached.sh</a>
  
    <li><a href="../../git/t/t5708-clone-config_sh.html">t5708-clone-config.sh</a>
  
    <li><a href="../../git/t/t5709-clone-refspec_sh.html">t5709-clone-refspec.sh</a>
  
    <li><a href="../../git/t/t5710-info-alternate_sh.html">t5710-info-alternate.sh</a>
  
    <li><a href="../../git/t/t5801-remote-helpers_sh.html">t5801-remote-helpers.sh</a>
  
    <li><a href="../../git/t/t5802-connect-helper_sh.html">t5802-connect-helper.sh</a>
  
    <li><a href="../../git/t/t5900-repo-selection_sh.html">t5900-repo-selection.sh</a>
  
    <li><a href="../../git/t/t6000-rev-list-misc_sh.html">t6000-rev-list-misc.sh</a>
  
    <li><a href="../../git/t/t6001-rev-list-graft_sh.html">t6001-rev-list-graft.sh</a>
  
    <li><a href="../../git/t/t6002-rev-list-bisect_sh.html">t6002-rev-list-bisect.sh</a>
  
    <li><a href="../../git/t/t6003-rev-list-topo-order_sh.html">t6003-rev-list-topo-order.sh</a>
  
    <li><a href="../../git/t/t6004-rev-list-path-optim_sh.html">t6004-rev-list-path-optim.sh</a>
  
    <li><a href="../../git/t/t6005-rev-list-count_sh.html">t6005-rev-list-count.sh</a>
  
    <li><a href="../../git/t/t6006-rev-list-format_sh.html">t6006-rev-list-format.sh</a>
  
    <li><a href="../../git/t/t6007-rev-list-cherry-pick-file_sh.html">t6007-rev-list-cherry-pick-file.sh</a>
  
    <li><a href="../../git/t/t6008-rev-list-submodule_sh.html">t6008-rev-list-submodule.sh</a>
  
    <li><a href="../../git/t/t6009-rev-list-parent_sh.html">t6009-rev-list-parent.sh</a>
  
    <li><a href="../../git/t/t6010-merge-base_sh.html">t6010-merge-base.sh</a>
  
    <li><a href="../../git/t/t6011-rev-list-with-bad-commit_sh.html">t6011-rev-list-with-bad-commit.sh</a>
  
    <li><a href="../../git/t/t6012-rev-list-simplify_sh.html">t6012-rev-list-simplify.sh</a>
  
    <li><a href="../../git/t/t6013-rev-list-reverse-parents_sh.html">t6013-rev-list-reverse-parents.sh</a>
  
    <li><a href="../../git/t/t6014-rev-list-all_sh.html">t6014-rev-list-all.sh</a>
  
    <li><a href="../../git/t/t6015-rev-list-show-all-parents_sh.html">t6015-rev-list-show-all-parents.sh</a>
  
    <li><a href="../../git/t/t6016-rev-list-graph-simplify-history_sh.html">t6016-rev-list-graph-simplify-history.sh</a>
  
    <li><a href="../../git/t/t6017-rev-list-stdin_sh.html">t6017-rev-list-stdin.sh</a>
  
    <li><a href="../../git/t/t6018-rev-list-glob_sh.html">t6018-rev-list-glob.sh</a>
  
    <li><a href="../../git/t/t6019-rev-list-ancestry-path_sh.html">t6019-rev-list-ancestry-path.sh</a>
  
    <li><a href="../../git/t/t6020-merge-df_sh.html">t6020-merge-df.sh</a>
  
    <li><a href="../../git/t/t6021-merge-criss-cross_sh.html">t6021-merge-criss-cross.sh</a>
  
    <li><a href="../../git/t/t6022-merge-rename_sh.html">t6022-merge-rename.sh</a>
  
    <li><a href="../../git/t/t6023-merge-file_sh.html">t6023-merge-file.sh</a>
  
    <li><a href="../../git/t/t6024-recursive-merge_sh.html">t6024-recursive-merge.sh</a>
  
    <li><a href="../../git/t/t6025-merge-symlinks_sh.html">t6025-merge-symlinks.sh</a>
  
    <li><a href="../../git/t/t6026-merge-attr_sh.html">t6026-merge-attr.sh</a>
  
    <li><a href="../../git/t/t6027-merge-binary_sh.html">t6027-merge-binary.sh</a>
  
    <li><a href="../../git/t/t6028-merge-up-to-date_sh.html">t6028-merge-up-to-date.sh</a>
  
    <li><a href="../../git/t/t6029-merge-subtree_sh.html">t6029-merge-subtree.sh</a>
  
    <li><a href="../../git/t/t6030-bisect-porcelain_sh.html">t6030-bisect-porcelain.sh</a>
  
    <li><a href="../../git/t/t6031-merge-recursive_sh.html">t6031-merge-recursive.sh</a>
  
    <li><a href="../../git/t/t6032-merge-large-rename_sh.html">t6032-merge-large-rename.sh</a>
  
    <li><a href="../../git/t/t6033-merge-crlf_sh.html">t6033-merge-crlf.sh</a>
  
    <li><a href="../../git/t/t6034-merge-rename-nocruft_sh.html">t6034-merge-rename-nocruft.sh</a>
  
    <li><a href="../../git/t/t6035-merge-dir-to-symlink_sh.html">t6035-merge-dir-to-symlink.sh</a>
  
    <li><a href="../../git/t/t6036-recursive-corner-cases_sh.html">t6036-recursive-corner-cases.sh</a>
  
    <li><a href="../../git/t/t6037-merge-ours-theirs_sh.html">t6037-merge-ours-theirs.sh</a>
  
    <li><a href="../../git/t/t6038-merge-text-auto_sh.html">t6038-merge-text-auto.sh</a>
  
    <li><a href="../../git/t/t6040-tracking-info_sh.html">t6040-tracking-info.sh</a>
  
    <li><a href="../../git/t/t6042-merge-rename-corner-cases_sh.html">t6042-merge-rename-corner-cases.sh</a>
  
    <li><a href="../../git/t/t6050-replace_sh.html">t6050-replace.sh</a>
  
    <li><a href="../../git/t/t6060-merge-index_sh.html">t6060-merge-index.sh</a>
  
    <li><a href="../../git/t/t6101-rev-parse-parents_sh.html">t6101-rev-parse-parents.sh</a>
  
    <li><a href="../../git/t/t6110-rev-list-sparse_sh.html">t6110-rev-list-sparse.sh</a>
  
    <li><a href="../../git/t/t6111-rev-list-treesame_sh.html">t6111-rev-list-treesame.sh</a>
  
    <li><a href="../../git/t/t6120-describe_sh.html">t6120-describe.sh</a>
  
    <li><a href="../../git/t/t6130-pathspec-noglob_sh.html">t6130-pathspec-noglob.sh</a>
  
    <li><a href="../../git/t/t6131-pathspec-icase_sh.html">t6131-pathspec-icase.sh</a>
  
    <li><a href="../../git/t/t6200-fmt-merge-msg_sh.html">t6200-fmt-merge-msg.sh</a>
  
    <li><a href="../../git/t/t6300-for-each-ref_sh.html">t6300-for-each-ref.sh</a>
  
    <li><a href="../../git/t/t6500-gc_sh.html">t6500-gc.sh</a>
  
    <li><a href="../../git/t/t7001-mv_sh.html">t7001-mv.sh</a>
  
    <li><a href="../../git/t/t7003-filter-branch_sh.html">t7003-filter-branch.sh</a>
  
    <li><a href="../../git/t/t7004-tag_sh.html">t7004-tag.sh</a>
  
    <li><a href="../../git/t/t7005-editor_sh.html">t7005-editor.sh</a>
  
    <li><a href="../../git/t/t7006-pager_sh.html">t7006-pager.sh</a>
  
    <li><a href="../../git/t/t7007-show_sh.html">t7007-show.sh</a>
  
    <li><a href="../../git/t/t7008-grep-binary_sh.html">t7008-grep-binary.sh</a>
  
    <li><a href="../../git/t/t7009-filter-branch-null-sha1_sh.html">t7009-filter-branch-null-sha1.sh</a>
  
    <li><a href="../../git/t/t7010-setup_sh.html">t7010-setup.sh</a>
  
    <li><a href="../../git/t/t7011-skip-worktree-reading_sh.html">t7011-skip-worktree-reading.sh</a>
  
    <li><a href="../../git/t/t7012-skip-worktree-writing_sh.html">t7012-skip-worktree-writing.sh</a>
  
    <li><a href="../../git/t/t7060-wtstatus_sh.html">t7060-wtstatus.sh</a>
  
    <li><a href="../../git/t/t7061-wtstatus-ignore_sh.html">t7061-wtstatus-ignore.sh</a>
  
    <li><a href="../../git/t/t7062-wtstatus-ignorecase_sh.html">t7062-wtstatus-ignorecase.sh</a>
  
    <li><a href="../../git/t/t7101-reset_sh.html">t7101-reset.sh</a>
  
    <li><a href="../../git/t/t7102-reset_sh.html">t7102-reset.sh</a>
  
    <li><a href="../../git/t/t7103-reset-bare_sh.html">t7103-reset-bare.sh</a>
  
    <li><a href="../../git/t/t7104-reset_sh.html">t7104-reset.sh</a>
  
    <li><a href="../../git/t/t7105-reset-patch_sh.html">t7105-reset-patch.sh</a>
  
    <li><a href="../../git/t/t7106-reset-unborn-branch_sh.html">t7106-reset-unborn-branch.sh</a>
  
    <li><a href="../../git/t/t7110-reset-merge_sh.html">t7110-reset-merge.sh</a>
  
    <li><a href="../../git/t/t7111-reset-table_sh.html">t7111-reset-table.sh</a>
  
    <li><a href="../../git/t/t7201-co_sh.html">t7201-co.sh</a>
  
    <li><a href="../../git/t/t7300-clean_sh.html">t7300-clean.sh</a>
  
    <li><a href="../../git/t/t7301-clean-interactive_sh.html">t7301-clean-interactive.sh</a>
  
    <li><a href="../../git/t/t7400-submodule-basic_sh.html">t7400-submodule-basic.sh</a>
  
    <li><a href="../../git/t/t7401-submodule-summary_sh.html">t7401-submodule-summary.sh</a>
  
    <li><a href="../../git/t/t7402-submodule-rebase_sh.html">t7402-submodule-rebase.sh</a>
  
    <li><a href="../../git/t/t7403-submodule-sync_sh.html">t7403-submodule-sync.sh</a>
  
    <li><a href="../../git/t/t7405-submodule-merge_sh.html">t7405-submodule-merge.sh</a>
  
    <li><a href="../../git/t/t7406-submodule-update_sh.html">t7406-submodule-update.sh</a>
  
    <li><a href="../../git/t/t7407-submodule-foreach_sh.html">t7407-submodule-foreach.sh</a>
  
    <li><a href="../../git/t/t7408-submodule-reference_sh.html">t7408-submodule-reference.sh</a>
  
    <li><a href="../../git/t/t7409-submodule-detached-worktree_sh.html">t7409-submodule-detached-worktree.sh</a>
  
    <li><a href="../../git/t/t7500-commit_sh.html">t7500-commit.sh</a>
  
    <li><a href="../../git/t/t7500/add-comments.html">add-comments</a>
  
    <li><a href="../../git/t/t7500/add-content.html">add-content</a>
  
    <li><a href="../../git/t/t7500/add-content-and-comment.html">add-content-and-comment</a>
  
    <li><a href="../../git/t/t7500/add-signed-off.html">add-signed-off</a>
  
    <li><a href="../../git/t/t7500/add-whitespaced-content.html">add-whitespaced-content</a>
  
    <li><a href="../../git/t/t7500/edit-content.html">edit-content</a>
  
    <li><a href="../../git/t/t7501-commit_sh.html">t7501-commit.sh</a>
  
    <li><a href="../../git/t/t7502-commit_sh.html">t7502-commit.sh</a>
  
    <li><a href="../../git/t/t7503-pre-commit-hook_sh.html">t7503-pre-commit-hook.sh</a>
  
    <li><a href="../../git/t/t7504-commit-msg-hook_sh.html">t7504-commit-msg-hook.sh</a>
  
    <li><a href="../../git/t/t7505-prepare-commit-msg-hook_sh.html">t7505-prepare-commit-msg-hook.sh</a>
  
    <li><a href="../../git/t/t7506-status-submodule_sh.html">t7506-status-submodule.sh</a>
  
    <li><a href="../../git/t/t7507-commit-verbose_sh.html">t7507-commit-verbose.sh</a>
  
    <li><a href="../../git/t/t7508-status_sh.html">t7508-status.sh</a>
  
    <li><a href="../../git/t/t7509-commit_sh.html">t7509-commit.sh</a>
  
    <li><a href="../../git/t/t7510-signed-commit_sh.html">t7510-signed-commit.sh</a>
  
    <li><a href="../../git/t/t7511-status-index_sh.html">t7511-status-index.sh</a>
  
    <li><a href="../../git/t/t7512-status-help_sh.html">t7512-status-help.sh</a>
  
    <li><a href="../../git/t/t7600-merge_sh.html">t7600-merge.sh</a>
  
    <li><a href="../../git/t/t7601-merge-pull-config_sh.html">t7601-merge-pull-config.sh</a>
  
    <li><a href="../../git/t/t7602-merge-octopus-many_sh.html">t7602-merge-octopus-many.sh</a>
  
    <li><a href="../../git/t/t7603-merge-reduce-heads_sh.html">t7603-merge-reduce-heads.sh</a>
  
    <li><a href="../../git/t/t7604-merge-custom-message_sh.html">t7604-merge-custom-message.sh</a>
  
    <li><a href="../../git/t/t7605-merge-resolve_sh.html">t7605-merge-resolve.sh</a>
  
    <li><a href="../../git/t/t7606-merge-custom_sh.html">t7606-merge-custom.sh</a>
  
    <li><a href="../../git/t/t7607-merge-overwrite_sh.html">t7607-merge-overwrite.sh</a>
  
    <li><a href="../../git/t/t7608-merge-messages_sh.html">t7608-merge-messages.sh</a>
  
    <li><a href="../../git/t/t7609-merge-co-error-msgs_sh.html">t7609-merge-co-error-msgs.sh</a>
  
    <li><a href="../../git/t/t7610-mergetool_sh.html">t7610-mergetool.sh</a>
  
    <li><a href="../../git/t/t7611-merge-abort_sh.html">t7611-merge-abort.sh</a>
  
    <li><a href="../../git/t/t7612-merge-verify-signatures_sh.html">t7612-merge-verify-signatures.sh</a>
  
    <li><a href="../../git/t/t7700-repack_sh.html">t7700-repack.sh</a>
  
    <li><a href="../../git/t/t7701-repack-unpack-unreachable_sh.html">t7701-repack-unpack-unreachable.sh</a>
  
    <li><a href="../../git/t/t7800-difftool_sh.html">t7800-difftool.sh</a>
  
    <li><a href="../../git/t/t7810-grep_sh.html">t7810-grep.sh</a>
  
    <li><a href="../../git/t/t7811-grep-open_sh.html">t7811-grep-open.sh</a>
  
    <li><a href="../../git/t/t8001-annotate_sh.html">t8001-annotate.sh</a>
  
    <li><a href="../../git/t/t8002-blame_sh.html">t8002-blame.sh</a>
  
    <li><a href="../../git/t/t8003-blame-corner-cases_sh.html">t8003-blame-corner-cases.sh</a>
  
    <li><a href="../../git/t/t8004-blame-with-conflicts_sh.html">t8004-blame-with-conflicts.sh</a>
  
    <li><a href="../../git/t/t8005-blame-i18n_sh.html">t8005-blame-i18n.sh</a>
  
    <li><a href="../../git/t/t8005/utf8_txt.html">utf8</a>
  
    <li><a href="../../git/t/t8006-blame-textconv_sh.html">t8006-blame-textconv.sh</a>
  
    <li><a href="../../git/t/t8007-cat-file-textconv_sh.html">t8007-cat-file-textconv.sh</a>
  
    <li><a href="../../git/t/t8008-blame-formats_sh.html">t8008-blame-formats.sh</a>
  
    <li><a href="../../git/t/t9001-send-email_sh.html">t9001-send-email.sh</a>
  
    <li><a href="../../git/t/t9002-column_sh.html">t9002-column.sh</a>
  
    <li><a href="../../git/t/t9010-svn-fe_sh.html">t9010-svn-fe.sh</a>
  
    <li><a href="../../git/t/t9011-svn-da_sh.html">t9011-svn-da.sh</a>
  
    <li><a href="../../git/t/t9020-remote-svn_sh.html">t9020-remote-svn.sh</a>
  
    <li><a href="../../git/t/t9100-git-svn-basic_sh.html">t9100-git-svn-basic.sh</a>
  
    <li><a href="../../git/t/t9101-git-svn-props_sh.html">t9101-git-svn-props.sh</a>
  
    <li><a href="../../git/t/t9102-git-svn-deep-rmdir_sh.html">t9102-git-svn-deep-rmdir.sh</a>
  
    <li><a href="../../git/t/t9103-git-svn-tracked-directory-removed_sh.html">t9103-git-svn-tracked-directory-removed.sh</a>
  
    <li><a href="../../git/t/t9104-git-svn-follow-parent_sh.html">t9104-git-svn-follow-parent.sh</a>
  
    <li><a href="../../git/t/t9105-git-svn-commit-diff_sh.html">t9105-git-svn-commit-diff.sh</a>
  
    <li><a href="../../git/t/t9106-git-svn-commit-diff-clobber_sh.html">t9106-git-svn-commit-diff-clobber.sh</a>
  
    <li><a href="../../git/t/t9107-git-svn-migrate_sh.html">t9107-git-svn-migrate.sh</a>
  
    <li><a href="../../git/t/t9108-git-svn-glob_sh.html">t9108-git-svn-glob.sh</a>
  
    <li><a href="../../git/t/t9109-git-svn-multi-glob_sh.html">t9109-git-svn-multi-glob.sh</a>
  
    <li><a href="../../git/t/t9110-git-svn-use-svm-props_sh.html">t9110-git-svn-use-svm-props.sh</a>
  
    <li><a href="../../git/t/t9110/svm_dump.html">svm.dump</a>
  
    <li><a href="../../git/t/t9111-git-svn-use-svnsync-props_sh.html">t9111-git-svn-use-svnsync-props.sh</a>
  
    <li><a href="../../git/t/t9111/svnsync_dump.html">svnsync.dump</a>
  
    <li><a href="../../git/t/t9112-git-svn-md5less-file_sh.html">t9112-git-svn-md5less-file.sh</a>
  
    <li><a href="../../git/t/t9113-git-svn-dcommit-new-file_sh.html">t9113-git-svn-dcommit-new-file.sh</a>
  
    <li><a href="../../git/t/t9114-git-svn-dcommit-merge_sh.html">t9114-git-svn-dcommit-merge.sh</a>
  
    <li><a href="../../git/t/t9115-git-svn-dcommit-funky-renames_sh.html">t9115-git-svn-dcommit-funky-renames.sh</a>
  
    <li><a href="../../git/t/t9115/funky-names_dump.html">funky-names.dump</a>
  
    <li><a href="../../git/t/t9116-git-svn-log_sh.html">t9116-git-svn-log.sh</a>
  
    <li><a href="../../git/t/t9117-git-svn-init-clone_sh.html">t9117-git-svn-init-clone.sh</a>
  
    <li><a href="../../git/t/t9118-git-svn-funky-branch-names_sh.html">t9118-git-svn-funky-branch-names.sh</a>
  
    <li><a href="../../git/t/t9119-git-svn-info_sh.html">t9119-git-svn-info.sh</a>
  
    <li><a href="../../git/t/t9120-git-svn-clone-with-percent-escapes_sh.html">t9120-git-svn-clone-with-percent-escapes.sh</a>
  
    <li><a href="../../git/t/t9121-git-svn-fetch-renamed-dir_sh.html">t9121-git-svn-fetch-renamed-dir.sh</a>
  
    <li><a href="../../git/t/t9121/renamed-dir_dump.html">renamed-dir.dump</a>
  
    <li><a href="../../git/t/t9122-git-svn-author_sh.html">t9122-git-svn-author.sh</a>
  
    <li><a href="../../git/t/t9123-git-svn-rebuild-with-rewriteroot_sh.html">t9123-git-svn-rebuild-with-rewriteroot.sh</a>
  
    <li><a href="../../git/t/t9124-git-svn-dcommit-auto-props_sh.html">t9124-git-svn-dcommit-auto-props.sh</a>
  
    <li><a href="../../git/t/t9125-git-svn-multi-glob-branch-names_sh.html">t9125-git-svn-multi-glob-branch-names.sh</a>
  
    <li><a href="../../git/t/t9126-git-svn-follow-deleted-readded-directory_sh.html">t9126-git-svn-follow-deleted-readded-directory.sh</a>
  
    <li><a href="../../git/t/t9126/follow-deleted-readded_dump.html">follow-deleted-readded.dump</a>
  
    <li><a href="../../git/t/t9127-git-svn-partial-rebuild_sh.html">t9127-git-svn-partial-rebuild.sh</a>
  
    <li><a href="../../git/t/t9128-git-svn-cmd-branch_sh.html">t9128-git-svn-cmd-branch.sh</a>
  
    <li><a href="../../git/t/t9129-git-svn-i18n-commitencoding_sh.html">t9129-git-svn-i18n-commitencoding.sh</a>
  
    <li><a href="../../git/t/t9130-git-svn-authors-file_sh.html">t9130-git-svn-authors-file.sh</a>
  
    <li><a href="../../git/t/t9131-git-svn-empty-symlink_sh.html">t9131-git-svn-empty-symlink.sh</a>
  
    <li><a href="../../git/t/t9132-git-svn-broken-symlink_sh.html">t9132-git-svn-broken-symlink.sh</a>
  
    <li><a href="../../git/t/t9133-git-svn-nested-git-repo_sh.html">t9133-git-svn-nested-git-repo.sh</a>
  
    <li><a href="../../git/t/t9134-git-svn-ignore-paths_sh.html">t9134-git-svn-ignore-paths.sh</a>
  
    <li><a href="../../git/t/t9135-git-svn-moved-branch-empty-file_sh.html">t9135-git-svn-moved-branch-empty-file.sh</a>
  
    <li><a href="../../git/t/t9135/svn_dump.html">svn.dump</a>
  
    <li><a href="../../git/t/t9136-git-svn-recreated-branch-empty-file_sh.html">t9136-git-svn-recreated-branch-empty-file.sh</a>
  
    <li><a href="../../git/t/t9136/svn_dump.html">svn.dump</a>
  
    <li><a href="../../git/t/t9137-git-svn-dcommit-clobber-series_sh.html">t9137-git-svn-dcommit-clobber-series.sh</a>
  
    <li><a href="../../git/t/t9138-git-svn-authors-prog_sh.html">t9138-git-svn-authors-prog.sh</a>
  
    <li><a href="../../git/t/t9139-git-svn-non-utf8-commitencoding_sh.html">t9139-git-svn-non-utf8-commitencoding.sh</a>
  
    <li><a href="../../git/t/t9140-git-svn-reset_sh.html">t9140-git-svn-reset.sh</a>
  
    <li><a href="../../git/t/t9141-git-svn-multiple-branches_sh.html">t9141-git-svn-multiple-branches.sh</a>
  
    <li><a href="../../git/t/t9142-git-svn-shallow-clone_sh.html">t9142-git-svn-shallow-clone.sh</a>
  
    <li><a href="../../git/t/t9143-git-svn-gc_sh.html">t9143-git-svn-gc.sh</a>
  
    <li><a href="../../git/t/t9144-git-svn-old-rev_map_sh.html">t9144-git-svn-old-rev_map.sh</a>
  
    <li><a href="../../git/t/t9145-git-svn-master-branch_sh.html">t9145-git-svn-master-branch.sh</a>
  
    <li><a href="../../git/t/t9146-git-svn-empty-dirs_sh.html">t9146-git-svn-empty-dirs.sh</a>
  
    <li><a href="../../git/t/t9147-git-svn-include-paths_sh.html">t9147-git-svn-include-paths.sh</a>
  
    <li><a href="../../git/t/t9150-svk-mergetickets_sh.html">t9150-svk-mergetickets.sh</a>
  
    <li><a href="../../git/t/t9150/make-svk-dump.html">make-svk-dump</a>
  
    <li><a href="../../git/t/t9150/svk-merge_dump.html">svk-merge.dump</a>
  
    <li><a href="../../git/t/t9151-svn-mergeinfo_sh.html">t9151-svn-mergeinfo.sh</a>
  
    <li><a href="../../git/t/t9151/make-svnmerge-dump.html">make-svnmerge-dump</a>
  
    <li><a href="../../git/t/t9151/svn-mergeinfo_dump.html">svn-mergeinfo.dump</a>
  
    <li><a href="../../git/t/t9152-svn-empty-dirs-after-gc_sh.html">t9152-svn-empty-dirs-after-gc.sh</a>
  
    <li><a href="../../git/t/t9153-git-svn-rewrite-uuid_sh.html">t9153-git-svn-rewrite-uuid.sh</a>
  
    <li><a href="../../git/t/t9153/svn_dump.html">svn.dump</a>
  
    <li><a href="../../git/t/t9154-git-svn-fancy-glob_sh.html">t9154-git-svn-fancy-glob.sh</a>
  
    <li><a href="../../git/t/t9154/svn_dump.html">svn.dump</a>
  
    <li><a href="../../git/t/t9155-git-svn-fetch-deleted-tag_sh.html">t9155-git-svn-fetch-deleted-tag.sh</a>
  
    <li><a href="../../git/t/t9156-git-svn-fetch-deleted-tag-2_sh.html">t9156-git-svn-fetch-deleted-tag-2.sh</a>
  
    <li><a href="../../git/t/t9157-git-svn-fetch-merge_sh.html">t9157-git-svn-fetch-merge.sh</a>
  
    <li><a href="../../git/t/t9158-git-svn-mergeinfo_sh.html">t9158-git-svn-mergeinfo.sh</a>
  
    <li><a href="../../git/t/t9159-git-svn-no-parent-mergeinfo_sh.html">t9159-git-svn-no-parent-mergeinfo.sh</a>
  
    <li><a href="../../git/t/t9160-git-svn-preserve-empty-dirs_sh.html">t9160-git-svn-preserve-empty-dirs.sh</a>
  
    <li><a href="../../git/t/t9161-git-svn-mergeinfo-push_sh.html">t9161-git-svn-mergeinfo-push.sh</a>
  
    <li><a href="../../git/t/t9161/branches_dump.html">branches.dump</a>
  
    <li><a href="../../git/t/t9162-git-svn-dcommit-interactive_sh.html">t9162-git-svn-dcommit-interactive.sh</a>
  
    <li><a href="../../git/t/t9163-git-svn-reset-clears-caches_sh.html">t9163-git-svn-reset-clears-caches.sh</a>
  
    <li><a href="../../git/t/t9164-git-svn-dcommit-concurrent_sh.html">t9164-git-svn-dcommit-concurrent.sh</a>
  
    <li><a href="../../git/t/t9165-git-svn-fetch-merge-branch-of-branch_sh.html">t9165-git-svn-fetch-merge-branch-of-branch.sh</a>
  
    <li><a href="../../git/t/t9166-git-svn-fetch-merge-branch-of-branch2_sh.html">t9166-git-svn-fetch-merge-branch-of-branch2.sh</a>
  
    <li><a href="../../git/t/t9167-git-svn-cmd-branch-subproject_sh.html">t9167-git-svn-cmd-branch-subproject.sh</a>
  
    <li><a href="../../git/t/t9200-git-cvsexportcommit_sh.html">t9200-git-cvsexportcommit.sh</a>
  
    <li><a href="../../git/t/t9300-fast-import_sh.html">t9300-fast-import.sh</a>
  
    <li><a href="../../git/t/t9301-fast-import-notes_sh.html">t9301-fast-import-notes.sh</a>
  
    <li><a href="../../git/t/t9350-fast-export_sh.html">t9350-fast-export.sh</a>
  
    <li><a href="../../git/t/t9400-git-cvsserver-server_sh.html">t9400-git-cvsserver-server.sh</a>
  
    <li><a href="../../git/t/t9401-git-cvsserver-crlf_sh.html">t9401-git-cvsserver-crlf.sh</a>
  
    <li><a href="../../git/t/t9402-git-cvsserver-refs_sh.html">t9402-git-cvsserver-refs.sh</a>
  
    <li><a href="../../git/t/t9500-gitweb-standalone-no-errors_sh.html">t9500-gitweb-standalone-no-errors.sh</a>
  
    <li><a href="../../git/t/t9501-gitweb-standalone-http-status_sh.html">t9501-gitweb-standalone-http-status.sh</a>
  
    <li><a href="../../git/t/t9502-gitweb-standalone-parse-output_sh.html">t9502-gitweb-standalone-parse-output.sh</a>
  
    <li><a href="../../git/t/t9600-cvsimport_sh.html">t9600-cvsimport.sh</a>
  
    <li><a href="../../git/t/t9601-cvsimport-vendor-branch_sh.html">t9601-cvsimport-vendor-branch.sh</a>
  
    <li><a href="../../git/t/t9601/cvsroot/module/added-imported_txt,v.html">added-imported.txt,v</a>
  
    <li><a href="../../git/t/t9601/cvsroot/module/imported-anonymously_txt,v.html">imported-anonymously.txt,v</a>
  
    <li><a href="../../git/t/t9601/cvsroot/module/imported-modified-imported_txt,v.html">imported-modified-imported.txt,v</a>
  
    <li><a href="../../git/t/t9601/cvsroot/module/imported-modified_txt,v.html">imported-modified.txt,v</a>
  
    <li><a href="../../git/t/t9601/cvsroot/module/imported-once_txt,v.html">imported-once.txt,v</a>
  
    <li><a href="../../git/t/t9601/cvsroot/module/imported-twice_txt,v.html">imported-twice.txt,v</a>
  
    <li><a href="../../git/t/t9602-cvsimport-branches-tags_sh.html">t9602-cvsimport-branches-tags.sh</a>
  
    <li><a href="../../git/t/t9602/README.html">README</a>
  
    <li><a href="../../git/t/t9602/cvsroot/module/default,v.html">default,v</a>
  
    <li><a href="../../git/t/t9602/cvsroot/module/sub1/default,v.html">default,v</a>
  
    <li><a href="../../git/t/t9602/cvsroot/module/sub1/subsubA/default,v.html">default,v</a>
  
    <li><a href="../../git/t/t9602/cvsroot/module/sub1/subsubB/default,v.html">default,v</a>
  
    <li><a href="../../git/t/t9602/cvsroot/module/sub2/Attic/branch_B_MIXED_only,v.html">branch_B_MIXED_only,v</a>
  
    <li><a href="../../git/t/t9602/cvsroot/module/sub2/default,v.html">default,v</a>
  
    <li><a href="../../git/t/t9602/cvsroot/module/sub2/subsubA/default,v.html">default,v</a>
  
    <li><a href="../../git/t/t9602/cvsroot/module/sub3/default,v.html">default,v</a>
  
    <li><a href="../../git/t/t9603-cvsimport-patchsets_sh.html">t9603-cvsimport-patchsets.sh</a>
  
    <li><a href="../../git/t/t9603/cvsroot/module/a,v.html">a,v</a>
  
    <li><a href="../../git/t/t9603/cvsroot/module/b,v.html">b,v</a>
  
    <li><a href="../../git/t/t9604-cvsimport-timestamps_sh.html">t9604-cvsimport-timestamps.sh</a>
  
    <li><a href="../../git/t/t9604/cvsroot/module/a,v.html">a,v</a>
  
    <li><a href="../../git/t/t9700-perl-git_sh.html">t9700-perl-git.sh</a>
  
    <li><a href="../../git/t/t9700/test_pl.html">test.pl</a>
  
    <li><a href="../../git/t/t9800-git-p4-basic_sh.html">t9800-git-p4-basic.sh</a>
  
    <li><a href="../../git/t/t9801-git-p4-branch_sh.html">t9801-git-p4-branch.sh</a>
  
    <li><a href="../../git/t/t9802-git-p4-filetype_sh.html">t9802-git-p4-filetype.sh</a>
  
    <li><a href="../../git/t/t9803-git-p4-shell-metachars_sh.html">t9803-git-p4-shell-metachars.sh</a>
  
    <li><a href="../../git/t/t9804-git-p4-label_sh.html">t9804-git-p4-label.sh</a>
  
    <li><a href="../../git/t/t9805-git-p4-skip-submit-edit_sh.html">t9805-git-p4-skip-submit-edit.sh</a>
  
    <li><a href="../../git/t/t9806-git-p4-options_sh.html">t9806-git-p4-options.sh</a>
  
    <li><a href="../../git/t/t9807-git-p4-submit_sh.html">t9807-git-p4-submit.sh</a>
  
    <li><a href="../../git/t/t9808-git-p4-chdir_sh.html">t9808-git-p4-chdir.sh</a>
  
    <li><a href="../../git/t/t9809-git-p4-client-view_sh.html">t9809-git-p4-client-view.sh</a>
  
    <li><a href="../../git/t/t9810-git-p4-rcs_sh.html">t9810-git-p4-rcs.sh</a>
  
    <li><a href="../../git/t/t9811-git-p4-label-import_sh.html">t9811-git-p4-label-import.sh</a>
  
    <li><a href="../../git/t/t9812-git-p4-wildcards_sh.html">t9812-git-p4-wildcards.sh</a>
  
    <li><a href="../../git/t/t9813-git-p4-preserve-users_sh.html">t9813-git-p4-preserve-users.sh</a>
  
    <li><a href="../../git/t/t9814-git-p4-rename_sh.html">t9814-git-p4-rename.sh</a>
  
    <li><a href="../../git/t/t9815-git-p4-submit-fail_sh.html">t9815-git-p4-submit-fail.sh</a>
  
    <li><a href="../../git/t/t9901-git-web--browse_sh.html">t9901-git-web--browse.sh</a>
  
    <li><a href="../../git/t/t9902-completion_sh.html">t9902-completion.sh</a>
  
    <li><a href="../../git/t/t9903-bash-prompt_sh.html">t9903-bash-prompt.sh</a>
  
    <li><a href="../../git/t/test-lib-functions_sh.html">test-lib-functions.sh</a>
  
    <li><a href="../../git/t/test-lib_sh.html">test-lib.sh</a>
  
    <li><a href="../../git/t/test-terminal_perl.html">test-terminal.perl</a>
  
    <li><a href="../../git/t/valgrind/analyze_sh.html">analyze.sh</a>
  
    <li><a href="../../git/t/valgrind/default_supp.html">default.supp</a>
  
    <li><a href="../../git/t/valgrind/valgrind_sh.html">valgrind.sh</a>
  
    <li><a href="../../git/templates/Makefile.html">Makefile</a>
  
    <li><a href="../../git/templates/branches--.html">branches--</a>
  
    <li><a href="../../git/templates/hooks--applypatch-msg_sample.html">hooks--applypatch-msg.sample</a>
  
    <li><a href="../../git/templates/hooks--commit-msg_sample.html">hooks--commit-msg.sample</a>
  
    <li><a href="../../git/templates/hooks--post-update_sample.html">hooks--post-update.sample</a>
  
    <li><a href="../../git/templates/hooks--pre-applypatch_sample.html">hooks--pre-applypatch.sample</a>
  
    <li><a href="../../git/templates/hooks--pre-commit_sample.html">hooks--pre-commit.sample</a>
  
    <li><a href="../../git/templates/hooks--pre-push_sample.html">hooks--pre-push.sample</a>
  
    <li><a href="../../git/templates/hooks--pre-rebase_sample.html">hooks--pre-rebase.sample</a>
  
    <li><a href="../../git/templates/hooks--prepare-commit-msg_sample.html">hooks--prepare-commit-msg.sample</a>
  
    <li><a href="../../git/templates/hooks--update_sample.html">hooks--update.sample</a>
  
    <li><a href="../../git/templates/info--exclude.html">info--exclude</a>
  
    <li><a href="../../git/templates/this--description.html">this--description</a>
  
    <li><a href="../../git/test-sha1_sh.html">test-sha1.sh</a>
  
    <li><a href="../../git/unimplemented_sh.html">unimplemented.sh</a>
  
    <li><a href="../../git/vcs-svn/LICENSE.html">LICENSE</a>
  
    <li><a href="../../git/vcs-svn/line_buffer_txt.html">line_buffer</a>
  
    <li><a href="../../git/wrap-for-bin_sh.html">wrap-for-bin.sh</a>
  
    <li><a href="../../log/development_log.html">development.log</a>
  
    <li><a href="../../public/404_html.html">404.html</a>
  
    <li><a href="../../public/422_html.html">422.html</a>
  
    <li><a href="../../public/500_html.html">500.html</a>
  
    <li><a href="../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../public/robots_txt.html">robots</a>
  
    <li><a href="../../tmp/pids/server_pid.html">server.pid</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page git/gitweb/gitweb.perl">

<p>#!/usr/bin/perl</p>

<p># gitweb - simple web interface to track changes in git repositories # #
(C) 2005-2006, Kay Sievers &lt;kay.sievers@vrfy.org&gt; # (C) 2005,
Christian Gierke # # This program is licensed under the GPLv2</p>

<p>use 5.008; use strict; use warnings; use CGI qw(:standard :escapeHTML
-nosticky); use CGI::Util qw(unescape); use CGI::Carp qw(fatalsToBrowser
set_message); use Encode; use Fcntl &#39;:mode&#39;; use File::Find qw();
use File::Basename qw(basename); use Time::HiRes qw(gettimeofday
tv_interval); binmode STDOUT, &#39;:utf8&#39;;</p>

<p>our $t0 = [ gettimeofday() ]; our $number_of_git_cmds = 0;</p>

<p>BEGIN {</p>

<pre>CGI-&gt;compile() if $ENV{&#39;MOD_PERL&#39;};</pre>

<p>}</p>

<p>our $version = +<code>GIT_VERSION</code>+;</p>

<p>our ($my_url, $my_uri, $base_url, $path_info, $home_link); sub evaluate_uri
{</p>

<pre class="ruby"><span class="ruby-identifier">our</span> <span class="ruby-identifier">$cgi</span>;

<span class="ruby-identifier">our</span> <span class="ruby-identifier">$my_url</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">url</span>();
<span class="ruby-identifier">our</span> <span class="ruby-identifier">$my_uri</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">url</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">absolute</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);

<span class="ruby-comment"># Base URL for relative URLs in gitweb ($logo, $favicon, ...),</span>
<span class="ruby-comment"># needed and used only for URLs with nonempty PATH_INFO</span>
<span class="ruby-identifier">our</span> <span class="ruby-identifier">$base_url</span> = <span class="ruby-identifier">$my_url</span>;

<span class="ruby-comment"># When the script is used as DirectoryIndex, the URL does not contain the name</span>
<span class="ruby-comment"># of the script file itself, and $cgi-&gt;url() fails to strip PATH_INFO, so we</span>
<span class="ruby-comment"># have to do it ourselves. We make $path_info global because it&#39;s also used</span>
<span class="ruby-comment"># later on.</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># Another issue with the script being the DirectoryIndex is that the resulting</span>
<span class="ruby-comment"># $my_url data is not the full script URL: this is good, because we want</span>
<span class="ruby-comment"># generated links to keep implying the script name if it wasn&#39;t explicitly</span>
<span class="ruby-comment"># indicated in the URL we&#39;re handling, but it means that $my_url cannot be used</span>
<span class="ruby-comment"># as base URL.</span>
<span class="ruby-comment"># Therefore, if we needed to strip PATH_INFO, then we know that we have</span>
<span class="ruby-comment"># to build the base URL ourselves:</span>
<span class="ruby-identifier">our</span> <span class="ruby-identifier">$path_info</span> = <span class="ruby-identifier">decode_utf8</span>(<span class="ruby-identifier">$ENV</span>{<span class="ruby-string">&quot;PATH_INFO&quot;</span>});
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$path_info</span>) {
        <span class="ruby-comment"># $path_info has already been URL-decoded by the web server, but</span>
        <span class="ruby-comment"># $my_url and $my_uri have not. URL-decode them so we can properly</span>
        <span class="ruby-comment"># strip $path_info.</span>
        <span class="ruby-identifier">$my_url</span> = <span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">$my_url</span>);
        <span class="ruby-identifier">$my_uri</span> = <span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">$my_uri</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$my_url</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span>,\<span class="ruby-constant">Q</span><span class="ruby-identifier">$path_info</span>\<span class="ruby-constant">E</span><span class="ruby-identifier">$,</span>, <span class="ruby-operator">&amp;&amp;</span>
            <span class="ruby-identifier">$my_uri</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span>,\<span class="ruby-constant">Q</span><span class="ruby-identifier">$path_info</span>\<span class="ruby-constant">E</span><span class="ruby-identifier">$,</span>, <span class="ruby-operator">&amp;&amp;</span>
            <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$ENV</span>{<span class="ruby-string">&#39;SCRIPT_NAME&#39;</span>}) {
                <span class="ruby-identifier">$base_url</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">url</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">base</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) . <span class="ruby-identifier">$ENV</span>{<span class="ruby-string">&#39;SCRIPT_NAME&#39;</span>};
        }
}

<span class="ruby-comment"># target of the home link on top of all pages</span>
<span class="ruby-identifier">our</span> <span class="ruby-identifier">$home_link</span> = <span class="ruby-identifier">$my_uri</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;/&quot;</span>;
</pre>

<p>}</p>

<p># core git executable to use # this can just be git if your webserver has
a sensible PATH our $GIT = +<code>GIT_BINDIR</code>+/git;</p>

<p># absolute fs-path which will be prepended to the project path our
$projectroot = /pub/scm; our $projectroot =
+<code>GITWEB_PROJECTROOT</code>+;</p>

<p># fs traversing limit for getting project list # the number is relative to
the projectroot our $project_maxdepth =
+<code>GITWEB_PROJECT_MAXDEPTH</code>+;</p>

<p># string of the home link on top of all pages our $home_link_str =
+<code>GITWEB_HOME_LINK_STR</code>+;</p>

<p># extra breadcrumbs preceding the home link our @extra_breadcrumbs = ();</p>

<p># name of your site or organization to appear in page titles # replace this
with something more descriptive for clearer bookmarks our $site_name =
+<code>GITWEB_SITENAME</code>+</p>

<pre>|| ($ENV{&#39;SERVER_NAME&#39;} || &quot;Untitled&quot;) . &quot; Git&quot;;</pre>

<p># html snippet to include in the &lt;head&gt; section of each page our
$site_html_head_string = +<code>GITWEB_SITE_HTML_HEAD_STRING</code>+; #
filename of html text to include at top of each page our $site_header =
+<code>GITWEB_SITE_HEADER</code>+; # html text to include at home page
our $home_text = +<code>GITWEB_HOMETEXT</code>+; # filename of html text
to include at bottom of each page our $site_footer =
+<code>GITWEB_SITE_FOOTER</code>+;</p>

<p># URI of stylesheets our @stylesheets = (+<code>GITWEB_CSS</code>+); #
URI of a single stylesheet, which can be overridden in GITWEB_CONFIG. our
$stylesheet = undef; # URI of GIT logo (72x27 size) our $logo =
+<code>GITWEB_LOGO</code>+; # URI of GIT favicon, assumed to be image/png
type our $favicon = +<code>GITWEB_FAVICON</code>+; # URI of gitweb.js
(JavaScript code for gitweb) our $javascript = +<code>GITWEB_JS</code>+;</p>

<p># URI and label (title) of GIT logo link our $logo_url = <a
href="http://www.kernel.org/pub/software/scm/git/docs">www.kernel.org/pub/software/scm/git/docs</a>/;
our $logo_label = git documentation; our $logo_url = <a
href="http://git-scm.com">git-scm.com</a>/; our $logo_label = git
homepage;</p>

<p># source of projects list our $projects_list =
+<code>GITWEB_LIST</code>+;</p>

<p># the width (in characters) of the projects list Description column our
$projects_list_description_width = 25;</p>

<p># group projects by category on the projects list # (enabled if this
variable evaluates to true) our $projects_list_group_categories = 0;</p>

<p># default category if none specified # (leave the empty string for no
category) our $project_list_default_category = ;</p>

<p># default order of projects list # valid values are none, project, descr,
owner, and age our $default_projects_order = project;</p>

<p># show repository only if this file exists # (only effective if this
variable evaluates to true) our $export_ok =
+<code>GITWEB_EXPORT_OK</code>+;</p>

<p># don&#39;t generate age column on the projects list page our
$omit_age_column = 0;</p>

<p># don&#39;t generate information about owners of repositories our
$omit_owner=0;</p>

<p># show repository only if this subroutine returns true # when given the
path to the project, for example: #    sub { return -e $<a
href="0">_</a>/git-daemon-export-ok; } our $export_auth_hook = undef;</p>

<p># only allow viewing of repositories also shown on the overview page our
$strict_export = +<code>GITWEB_STRICT_EXPORT</code>+;</p>

<p># list of git base URLs used for URL to where fetch project from, # i.e.
full URL is $git_base_url/$project our @git_base_url_list = grep { $_ ne
&#39;&#39; } (+<code>GITWEB_BASE_URL</code>+);</p>

<p># default blob_plain mimetype and default charset for text/plain blob our
$default_blob_plain_mimetype = &#39;text/plain&#39;; our
$default_text_plain_charset  = undef;</p>

<p># file to use for guessing MIME types before trying /etc/mime.types #
(relative to the current git repository) our $mimetypes_file = undef;</p>

<p># assume this charset if line contains non-UTF-8 characters; # it should be
valid encoding (see Encoding::Supported(3pm) for list), # for which
encoding all byte sequences are valid, for example # &#39;iso-8859-1&#39;
aka &#39;latin1&#39; (it is decoded without checking, so it # could be even
&#39;utf-8&#39; for the old behavior) our $fallback_encoding =
&#39;latin1&#39;;</p>

<p># rename detection options for git-diff and git-diff-tree # - default is
&#39;-M&#39;, with the cost proportional to #   (number of removed files) *
(number of new files). # - more costly is &#39;-C&#39; (which implies
&#39;-M&#39;), with the cost proportional to #   (number of changed files +
number of removed files) * (number of new files) # - even more costly is
&#39;-C&#39;, &#39;find-copies-harder&#39; with cost #   (number of files
in the original tree) * (number of new files) # - one might want to include
&#39;-B&#39; option, e.g. &#39;-B&#39;, &#39;-M&#39; our @diff_opts =
(&#39;-M&#39;); # taken from git_commit</p>

<p># Disables features that would allow repository owners to inject script
into # the gitweb domain. our $prevent_xss = 0;</p>

<p># Path to the highlight executable to use (must be the one from # <a
href="http://www.andre-simon.de">www.andre-simon.de</a> due to assumptions
about parameters and output). # Useful if highlight is not installed on
your webserver&#39;s PATH. # [Default: highlight] our $highlight_bin =
+<code>HIGHLIGHT_BIN</code>+;</p>

<p># information about snapshot formats that gitweb is capable of serving our
%known_snapshot_formats = (</p>

<pre class="ruby"><span class="ruby-comment"># name =&gt; {</span>
<span class="ruby-comment">#       &#39;display&#39; =&gt; display name,</span>
<span class="ruby-comment">#       &#39;type&#39; =&gt; mime type,</span>
<span class="ruby-comment">#       &#39;suffix&#39; =&gt; filename suffix,</span>
<span class="ruby-comment">#       &#39;format&#39; =&gt; --format for git-archive,</span>
<span class="ruby-comment">#       &#39;compressor&#39; =&gt; [compressor command and arguments]</span>
<span class="ruby-comment">#                       (array reference, optional)</span>
<span class="ruby-comment">#       &#39;disabled&#39; =&gt; boolean (optional)}</span>
<span class="ruby-comment">#</span>
<span class="ruby-string">&#39;tgz&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;display&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tar.gz&#39;</span>,
        <span class="ruby-string">&#39;type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;application/x-gzip&#39;</span>,
        <span class="ruby-string">&#39;suffix&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;.tar.gz&#39;</span>,
        <span class="ruby-string">&#39;format&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tar&#39;</span>,
        <span class="ruby-string">&#39;compressor&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;gzip&#39;</span>, <span class="ruby-string">&#39;-n&#39;</span>]},

<span class="ruby-string">&#39;tbz2&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;display&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tar.bz2&#39;</span>,
        <span class="ruby-string">&#39;type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;application/x-bzip2&#39;</span>,
        <span class="ruby-string">&#39;suffix&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;.tar.bz2&#39;</span>,
        <span class="ruby-string">&#39;format&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tar&#39;</span>,
        <span class="ruby-string">&#39;compressor&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;bzip2&#39;</span>]},

<span class="ruby-string">&#39;txz&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;display&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tar.xz&#39;</span>,
        <span class="ruby-string">&#39;type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;application/x-xz&#39;</span>,
        <span class="ruby-string">&#39;suffix&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;.tar.xz&#39;</span>,
        <span class="ruby-string">&#39;format&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tar&#39;</span>,
        <span class="ruby-string">&#39;compressor&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;xz&#39;</span>],
        <span class="ruby-string">&#39;disabled&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>},

<span class="ruby-string">&#39;zip&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;display&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;zip&#39;</span>,
        <span class="ruby-string">&#39;type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;application/x-zip&#39;</span>,
        <span class="ruby-string">&#39;suffix&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;.zip&#39;</span>,
        <span class="ruby-string">&#39;format&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;zip&#39;</span>},
</pre>

<p>);</p>

<p># Aliases so we understand old gitweb.snapshot values in repository #
configuration. our %known_snapshot_format_aliases = (</p>

<pre class="ruby"><span class="ruby-string">&#39;gzip&#39;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tgz&#39;</span>,
<span class="ruby-string">&#39;bzip2&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tbz2&#39;</span>,
<span class="ruby-string">&#39;xz&#39;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;txz&#39;</span>,

<span class="ruby-comment"># backward compatibility: legacy gitweb config support</span>
<span class="ruby-string">&#39;x-gzip&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>, <span class="ruby-string">&#39;gz&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,
<span class="ruby-string">&#39;x-bzip2&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>, <span class="ruby-string">&#39;bz2&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,
<span class="ruby-string">&#39;x-zip&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>, <span class="ruby-string">&#39;&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,
</pre>

<p>);</p>

<p># Pixel sizes for icons and avatars. If the default font sizes or
lineheights # are changed, it may be appropriate to change these values too
via # $GITWEB_CONFIG. our %avatar_size = (</p>

<pre class="ruby"><span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">16</span>,
<span class="ruby-string">&#39;double&#39;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-value">32</span>
</pre>

<p>);</p>

<p># Used to set the maximum load that we will still respond to gitweb
queries. # If server load exceed this value then return 503 server busy
error. # If gitweb cannot determined server load, it is taken to be 0. #
Leave it undefined (or set to &#39;undef&#39;) to turn off load checking.
our $maxload = 300;</p>

<p># configuration for &#39;highlight&#39; (<a
href="http://www.andre-simon.de">www.andre-simon.de</a>/) # match by
basename our %highlight_basename = (</p>

<pre class="ruby"><span class="ruby-comment">#&#39;Program&#39; =&gt; &#39;py&#39;,</span>
<span class="ruby-comment">#&#39;Library&#39; =&gt; &#39;py&#39;,</span>
<span class="ruby-string">&#39;SConstruct&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;py&#39;</span>, <span class="ruby-comment"># SCons equivalent of Makefile</span>
<span class="ruby-string">&#39;Makefile&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;make&#39;</span>,
</pre>

<p>); # match by extension our %highlight_ext = (</p>

<pre class="ruby"><span class="ruby-comment"># main extensions, defining name of syntax;</span>
<span class="ruby-comment"># see files in /usr/share/highlight/langDefs/ directory</span>
(<span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$_</span> } <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">py</span> <span class="ruby-identifier">rb</span> <span class="ruby-identifier">java</span> <span class="ruby-identifier">css</span> <span class="ruby-identifier">js</span> <span class="ruby-identifier">tex</span> <span class="ruby-identifier">bib</span> <span class="ruby-identifier">xml</span> <span class="ruby-identifier">awk</span> <span class="ruby-identifier">bat</span> <span class="ruby-identifier">ini</span> <span class="ruby-identifier">spec</span> <span class="ruby-identifier">tcl</span> <span class="ruby-identifier">sql</span>)),
<span class="ruby-comment"># alternate extensions, see /etc/highlight/filetypes.conf</span>
(<span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;c&#39;</span>   } <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">c</span> <span class="ruby-identifier">h</span>)),
(<span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;sh&#39;</span>  } <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">sh</span> <span class="ruby-identifier">bash</span> <span class="ruby-identifier">zsh</span> <span class="ruby-identifier">ksh</span>)),
(<span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;cpp&#39;</span> } <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">cpp</span> <span class="ruby-identifier">cxx</span> <span class="ruby-identifier">c</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span> <span class="ruby-identifier">cc</span>)),
(<span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;php&#39;</span> } <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">php</span> <span class="ruby-identifier">php3</span> <span class="ruby-identifier">php4</span> <span class="ruby-identifier">php5</span> <span class="ruby-identifier">phps</span>)),
(<span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;pl&#39;</span>  } <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">pl</span> <span class="ruby-identifier">perl</span> <span class="ruby-identifier">pm</span>)), <span class="ruby-comment"># perhaps also &#39;cgi&#39;</span>
(<span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;make&#39;</span>} <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">make</span> <span class="ruby-identifier">mak</span> <span class="ruby-identifier">mk</span>)),
(<span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;xml&#39;</span> } <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">xml</span> <span class="ruby-identifier">xhtml</span> <span class="ruby-identifier">html</span> <span class="ruby-identifier">htm</span>)),
</pre>

<p>);</p>

<p># You define site-wide feature defaults here; override them with #
$GITWEB_CONFIG as necessary. our %feature = (</p>

<pre class="ruby"><span class="ruby-comment"># feature =&gt; {</span>
<span class="ruby-comment">#       &#39;sub&#39; =&gt; feature-sub (subroutine),</span>
<span class="ruby-comment">#       &#39;override&#39; =&gt; allow-override (boolean),</span>
<span class="ruby-comment">#       &#39;default&#39; =&gt; [ default options...] (array reference)}</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># if feature is overridable (it means that allow-override has true value),</span>
<span class="ruby-comment"># then feature-sub will be called with default options as parameters;</span>
<span class="ruby-comment"># return value of feature-sub indicates if to enable specified feature</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># if there is no &#39;sub&#39; key (no feature-sub), then feature cannot be</span>
<span class="ruby-comment"># overridden</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># use gitweb_get_feature(&lt;feature&gt;) to retrieve the &lt;feature&gt; value</span>
<span class="ruby-comment"># (an array) or gitweb_check_feature(&lt;feature&gt;) to check if &lt;feature&gt;</span>
<span class="ruby-comment"># is enabled</span>

<span class="ruby-comment"># Enable the &#39;blame&#39; blob view, showing the last commit that modified</span>
<span class="ruby-comment"># each line in the file. This can be very CPU-intensive.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;blame&#39;}{&#39;default&#39;} = [1];</span>
<span class="ruby-comment"># To have project specific config enable override in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;blame&#39;}{&#39;override&#39;} = 1;</span>
<span class="ruby-comment"># and in project config gitweb.blame = 0|1;</span>
<span class="ruby-string">&#39;blame&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">feature_bool</span>(<span class="ruby-string">&#39;blame&#39;</span>, <span class="ruby-ivar">@_</span>) },
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span>]},

<span class="ruby-comment"># Enable the &#39;snapshot&#39; link, providing a compressed archive of any</span>
<span class="ruby-comment"># tree. This can potentially generate high traffic if you have large</span>
<span class="ruby-comment"># project.</span>

<span class="ruby-comment"># Value is a list of formats defined in %known_snapshot_formats that</span>
<span class="ruby-comment"># you wish to offer.</span>
<span class="ruby-comment"># To disable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;snapshot&#39;}{&#39;default&#39;} = [];</span>
<span class="ruby-comment"># To have project specific config enable override in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;snapshot&#39;}{&#39;override&#39;} = 1;</span>
<span class="ruby-comment"># and in project config, a comma-separated list of formats or &quot;none&quot;</span>
<span class="ruby-comment"># to disable.  Example: gitweb.snapshot = tbz2,zip;</span>
<span class="ruby-string">&#39;snapshot&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">feature_snapshot</span>,
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;tgz&#39;</span>]},

<span class="ruby-comment"># Enable text search, which will list the commits which match author,</span>
<span class="ruby-comment"># committer or commit text to a given string.  Enabled by default.</span>
<span class="ruby-comment"># Project specific override is not supported.</span>
<span class="ruby-comment">#</span>
<span class="ruby-comment"># Note that this controls all search features, which means that if</span>
<span class="ruby-comment"># it is disabled, then &#39;grep&#39; and &#39;pickaxe&#39; search would also be</span>
<span class="ruby-comment"># disabled.</span>
<span class="ruby-string">&#39;search&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">1</span>]},

<span class="ruby-comment"># Enable grep search, which will list the files in currently selected</span>
<span class="ruby-comment"># tree containing the given string. Enabled by default. This can be</span>
<span class="ruby-comment"># potentially CPU-intensive, of course.</span>
<span class="ruby-comment"># Note that you need to have &#39;search&#39; feature enabled too.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;grep&#39;}{&#39;default&#39;} = [1];</span>
<span class="ruby-comment"># To have project specific config enable override in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;grep&#39;}{&#39;override&#39;} = 1;</span>
<span class="ruby-comment"># and in project config gitweb.grep = 0|1;</span>
<span class="ruby-string">&#39;grep&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">feature_bool</span>(<span class="ruby-string">&#39;grep&#39;</span>, <span class="ruby-ivar">@_</span>) },
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">1</span>]},

<span class="ruby-comment"># Enable the pickaxe search, which will list the commits that modified</span>
<span class="ruby-comment"># a given string in a file. This can be practical and quite faster</span>
<span class="ruby-comment"># alternative to &#39;blame&#39;, but still potentially CPU-intensive.</span>
<span class="ruby-comment"># Note that you need to have &#39;search&#39; feature enabled too.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;pickaxe&#39;}{&#39;default&#39;} = [1];</span>
<span class="ruby-comment"># To have project specific config enable override in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;pickaxe&#39;}{&#39;override&#39;} = 1;</span>
<span class="ruby-comment"># and in project config gitweb.pickaxe = 0|1;</span>
<span class="ruby-string">&#39;pickaxe&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">feature_bool</span>(<span class="ruby-string">&#39;pickaxe&#39;</span>, <span class="ruby-ivar">@_</span>) },
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">1</span>]},

<span class="ruby-comment"># Enable showing size of blobs in a &#39;tree&#39; view, in a separate</span>
<span class="ruby-comment"># column, similar to what &#39;ls -l&#39; does.  This cost a bit of IO.</span>

<span class="ruby-comment"># To disable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;show-sizes&#39;}{&#39;default&#39;} = [0];</span>
<span class="ruby-comment"># To have project specific config enable override in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;show-sizes&#39;}{&#39;override&#39;} = 1;</span>
<span class="ruby-comment"># and in project config gitweb.showsizes = 0|1;</span>
<span class="ruby-string">&#39;show-sizes&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">feature_bool</span>(<span class="ruby-string">&#39;showsizes&#39;</span>, <span class="ruby-ivar">@_</span>) },
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">1</span>]},

<span class="ruby-comment"># Make gitweb use an alternative format of the URLs which can be</span>
<span class="ruby-comment"># more readable and natural-looking: project name is embedded</span>
<span class="ruby-comment"># directly in the path and the query string contains other</span>
<span class="ruby-comment"># auxiliary information. All gitweb installations recognize</span>
<span class="ruby-comment"># URL in either format; this configures in which formats gitweb</span>
<span class="ruby-comment"># generates links.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;pathinfo&#39;}{&#39;default&#39;} = [1];</span>
<span class="ruby-comment"># Project specific override is not supported.</span>

<span class="ruby-comment"># Note that you will need to change the default location of CSS,</span>
<span class="ruby-comment"># favicon, logo and possibly other files to an absolute URL. Also,</span>
<span class="ruby-comment"># if gitweb.cgi serves as your indexfile, you will need to force</span>
<span class="ruby-comment"># $my_uri to contain the script name in your $GITWEB_CONFIG.</span>
<span class="ruby-string">&#39;pathinfo&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span>]},

<span class="ruby-comment"># Make gitweb consider projects in project root subdirectories</span>
<span class="ruby-comment"># to be forks of existing projects. Given project $projname.git,</span>
<span class="ruby-comment"># projects matching $projname  .git will not be shown in the main</span>
<span class="ruby-comment"># projects list, instead a &#39;+&#39; mark will be added to $projname</span>
<span class="ruby-comment"># there and a &#39;forks&#39; view will be enabled for the project, listing</span>
<span class="ruby-comment"># all the forks. If project list is taken from a file, forks have</span>
<span class="ruby-comment"># to be listed after the main project.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;forks&#39;}{&#39;default&#39;} = [1];</span>
<span class="ruby-comment"># Project specific override is not supported.</span>
<span class="ruby-string">&#39;forks&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span>]},

<span class="ruby-comment"># Insert custom links to the action bar of all project pages.</span>
<span class="ruby-comment"># This enables you mainly to link to third-party scripts integrating</span>
<span class="ruby-comment"># into gitweb; e.g. git-browser for graphical history representation</span>
<span class="ruby-comment"># or custom web-based repository administration interface.</span>

<span class="ruby-comment"># The &#39;default&#39; value consists of a list of triplets in the form</span>
<span class="ruby-comment"># (label, link, position) where position is the label after which</span>
<span class="ruby-comment"># to insert the link and link is a format string where %n expands</span>
<span class="ruby-comment"># to the project name, %f to the project path within the filesystem,</span>
<span class="ruby-comment"># %h to the current hash (h gitweb parameter) and %b to the current</span>
<span class="ruby-comment"># hash base (hb gitweb parameter); %% expands to %.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG e.g.</span>
<span class="ruby-comment"># $feature{&#39;actions&#39;}{&#39;default&#39;} = [(&#39;graphiclog&#39;,</span>
<span class="ruby-comment">#       &#39;/git-browser/by-commit.html?r=%n&#39;, &#39;summary&#39;)];</span>
<span class="ruby-comment"># Project specific override is not supported.</span>
<span class="ruby-string">&#39;actions&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> []},

<span class="ruby-comment"># Allow gitweb scan project content tags of project repository,</span>
<span class="ruby-comment"># and display the popular Web 2.0-ish &quot;tag cloud&quot; near the projects</span>
<span class="ruby-comment"># list.  Note that this is something COMPLETELY different from the</span>
<span class="ruby-comment"># normal Git tags.</span>

<span class="ruby-comment"># gitweb by itself can show existing tags, but it does not handle</span>
<span class="ruby-comment"># tagging itself; you need to do it externally, outside gitweb.</span>
<span class="ruby-comment"># The format is described in git_get_project_ctags() subroutine.</span>
<span class="ruby-comment"># You may want to install the HTML::TagCloud Perl module to get</span>
<span class="ruby-comment"># a pretty tag cloud instead of just a list of tags.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;ctags&#39;}{&#39;default&#39;} = [1];</span>
<span class="ruby-comment"># Project specific override is not supported.</span>

<span class="ruby-comment"># In the future whether ctags editing is enabled might depend</span>
<span class="ruby-comment"># on the value, but using 1 should always mean no editing of ctags.</span>
<span class="ruby-string">&#39;ctags&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span>]},

<span class="ruby-comment"># The maximum number of patches in a patchset generated in patch</span>
<span class="ruby-comment"># view. Set this to 0 or undef to disable patch view, or to a</span>
<span class="ruby-comment"># negative number to remove any limit.</span>

<span class="ruby-comment"># To disable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;patches&#39;}{&#39;default&#39;} = [0];</span>
<span class="ruby-comment"># To have project specific config enable override in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;patches&#39;}{&#39;override&#39;} = 1;</span>
<span class="ruby-comment"># and in project config gitweb.patches = 0|n;</span>
<span class="ruby-comment"># where n is the maximum number of patches allowed in a patchset.</span>
<span class="ruby-string">&#39;patches&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">feature_patches</span>,
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">16</span>]},

<span class="ruby-comment"># Avatar support. When this feature is enabled, views such as</span>
<span class="ruby-comment"># shortlog or commit will display an avatar associated with</span>
<span class="ruby-comment"># the email of the committer(s) and/or author(s).</span>

<span class="ruby-comment"># Currently available providers are gravatar and picon.</span>
<span class="ruby-comment"># If an unknown provider is specified, the feature is disabled.</span>

<span class="ruby-comment"># Gravatar depends on Digest::MD5.</span>
<span class="ruby-comment"># Picon currently relies on the indiana.edu database.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;avatar&#39;}{&#39;default&#39;} = [&#39;&lt;provider&gt;&#39;];</span>
<span class="ruby-comment"># where &lt;provider&gt; is either gravatar or picon.</span>
<span class="ruby-comment"># To have project specific config enable override in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;avatar&#39;}{&#39;override&#39;} = 1;</span>
<span class="ruby-comment"># and in project config gitweb.avatar = &lt;provider&gt;;</span>
<span class="ruby-string">&#39;avatar&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">feature_avatar</span>,
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;&#39;</span>]},

<span class="ruby-comment"># Enable displaying how much time and how many git commands</span>
<span class="ruby-comment"># it took to generate and display page.  Disabled by default.</span>
<span class="ruby-comment"># Project specific override is not supported.</span>
<span class="ruby-string">&#39;timed&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span>]},

<span class="ruby-comment"># Enable turning some links into links to actions which require</span>
<span class="ruby-comment"># JavaScript to run (like &#39;blame_incremental&#39;).  Not enabled by</span>
<span class="ruby-comment"># default.  Project specific override is currently not supported.</span>
<span class="ruby-string">&#39;javascript-actions&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span>]},

<span class="ruby-comment"># Enable and configure ability to change common timezone for dates</span>
<span class="ruby-comment"># in gitweb output via JavaScript.  Enabled by default.</span>
<span class="ruby-comment"># Project specific override is not supported.</span>
<span class="ruby-string">&#39;javascript-timezone&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [
                <span class="ruby-string">&#39;local&#39;</span>,     <span class="ruby-comment"># default timezone: &#39;utc&#39;, &#39;local&#39;, or &#39;(-|+)HHMM&#39; format,</span>
                             <span class="ruby-comment"># or undef to turn off this feature</span>
                <span class="ruby-string">&#39;gitweb_tz&#39;</span>, <span class="ruby-comment"># name of cookie where to store selected timezone</span>
                <span class="ruby-string">&#39;datetime&#39;</span>,  <span class="ruby-comment"># CSS class used to mark up dates for manipulation</span>
        ]},

<span class="ruby-comment"># Syntax highlighting support. This is based on Daniel Svensson&#39;s</span>
<span class="ruby-comment"># and Sham Chukoury&#39;s work in gitweb-xmms2.git.</span>
<span class="ruby-comment"># It requires the &#39;highlight&#39; program present in $PATH,</span>
<span class="ruby-comment"># and therefore is disabled by default.</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;highlight&#39;}{&#39;default&#39;} = [1];</span>

<span class="ruby-string">&#39;highlight&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">feature_bool</span>(<span class="ruby-string">&#39;highlight&#39;</span>, <span class="ruby-ivar">@_</span>) },
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span>]},

<span class="ruby-comment"># Enable displaying of remote heads in the heads list</span>

<span class="ruby-comment"># To enable system wide have in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;remote_heads&#39;}{&#39;default&#39;} = [1];</span>
<span class="ruby-comment"># To have project specific config enable override in $GITWEB_CONFIG</span>
<span class="ruby-comment"># $feature{&#39;remote_heads&#39;}{&#39;override&#39;} = 1;</span>
<span class="ruby-comment"># and in project config gitweb.remoteheads = 0|1;</span>
<span class="ruby-string">&#39;remote_heads&#39;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&#39;sub&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">feature_bool</span>(<span class="ruby-string">&#39;remote_heads&#39;</span>, <span class="ruby-ivar">@_</span>) },
        <span class="ruby-string">&#39;override&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&#39;default&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span>]},
</pre>

<p>);</p>

<p>sub gitweb_get_feature {</p>

<pre>my ($name) = @_;
return unless exists $feature{$name};
my ($sub, $override, @defaults) = (
        $feature{$name}{&#39;sub&#39;},
        $feature{$name}{&#39;override&#39;},
        @{$feature{$name}{&#39;default&#39;}});
# project specific override is possible only if we have project
our $git_dir; # global variable, declared later
if (!$override || !defined $git_dir) {
        return @defaults;
}
if (!defined $sub) {
        warn &quot;feature $name is not overridable&quot;;
        return @defaults;
}
return $sub-&gt;(@defaults);</pre>

<p>}</p>

<p># A wrapper to check if a given feature is enabled. # With this, you can
say # #   my $bool_feat = gitweb_check_feature(&#39;bool_feat&#39;); #  
gitweb_check_feature(&#39;bool_feat&#39;) or somecode; # # instead of # #  
my ($bool_feat) = gitweb_get_feature(&#39;bool_feat&#39;); #   (<a
href="0">gitweb_get_feature(bool_feat))</a> or somecode; # sub
gitweb_check_feature {</p>

<pre>return (gitweb_get_feature(@_))[0];</pre>

<p>}</p>

<p>sub feature_bool {</p>

<pre>my $key = shift;
my ($val) = git_get_project_config($key, &#39;--bool&#39;);

if (!defined $val) {
        return ($_[0]);
} elsif ($val eq &#39;true&#39;) {
        return (1);
} elsif ($val eq &#39;false&#39;) {
        return (0);
}</pre>

<p>}</p>

<p>sub feature_snapshot {</p>

<pre>my (@fmts) = @_;

my ($val) = git_get_project_config(&#39;snapshot&#39;);

if ($val) {
        @fmts = ($val eq &#39;none&#39; ? () : split /\s*[,\s]\s  , $val);
}

return @fmts;</pre>

<p>}</p>

<p>sub feature_patches {</p>

<pre>my @val = (git_get_project_config(&#39;patches&#39;, &#39;--int&#39;));

if (@val) {
        return @val;
}

return ($_[0]);</pre>

<p>}</p>

<p>sub feature_avatar {</p>

<pre>my @val = (git_get_project_config(&#39;avatar&#39;));

return @val ? @val : @_;</pre>

<p>}</p>

<p># checking HEAD file with -e is fragile if the repository was # initialized
long time ago (i.e. symlink HEAD) and was pack-ref&#39;ed # and then
pruned. sub check_head_link {</p>

<pre>my ($dir) = @_;
my $headfile = &quot;$dir/HEAD&quot;;
return ((-e $headfile) ||
        (-l $headfile &amp;&amp; readlink($headfile) =~ /^refs\/heads\//));</pre>

<p>}</p>

<p>sub check_export_ok {</p>

<pre>my ($dir) = @_;
return (check_head_link($dir) &amp;&amp;
        (!$export_ok || -e &quot;$dir/$export_ok&quot;) &amp;&amp;
        (!$export_auth_hook || $export_auth_hook-&gt;($dir)));</pre>

<p>}</p>

<p># process alternate names for backward compatibility # filter out
unsupported (unknown) snapshot formats sub filter_snapshot_fmts {</p>

<pre>my @fmts = @_;

@fmts = map {
        exists $known_snapshot_format_aliases{$_} ?
               $known_snapshot_format_aliases{$_} : $_} @fmts;
@fmts = grep {
        exists $known_snapshot_formats{$_} &amp;&amp;
        !$known_snapshot_formats{$_}{&#39;disabled&#39;}} @fmts;</pre>

<p>}</p>

<p># If it is set to code reference, it is code that it is to be run once per
# request, allowing updating configurations that change with each request,
# while running other code in config file only once. # # Otherwise, if it
is false then gitweb would process config file only once; # if it is true
then gitweb config would be run for each request. our $per_request_config =
1;</p>

<p># read and parse gitweb config file given by its parameter. # returns true
on success, false on recoverable error, allowing # to chain this
subroutine, using first file that exists. # dies on errors during parsing
config file, as it is unrecoverable. sub read_config_file {</p>

<pre>my $filename = shift;
return unless defined $filename;
# die if there are errors parsing config file
if (-e $filename) {
        do $filename;
        die $@ if $@;
        return 1;
}
return;</pre>

<p>}</p>

<p>our ($GITWEB_CONFIG, $GITWEB_CONFIG_SYSTEM, $GITWEB_CONFIG_COMMON); sub
evaluate_gitweb_config {</p>

<pre>our $GITWEB_CONFIG = $ENV{&#39;GITWEB_CONFIG&#39;} || &quot;++GITWEB_CONFIG++&quot;;
our $GITWEB_CONFIG_SYSTEM = $ENV{&#39;GITWEB_CONFIG_SYSTEM&#39;} || &quot;++GITWEB_CONFIG_SYSTEM++&quot;;
our $GITWEB_CONFIG_COMMON = $ENV{&#39;GITWEB_CONFIG_COMMON&#39;} || &quot;++GITWEB_CONFIG_COMMON++&quot;;

# Protect against duplications of file names, to not read config twice.
# Only one of $GITWEB_CONFIG and $GITWEB_CONFIG_SYSTEM is used, so
# there possibility of duplication of filename there doesn&#39;t matter.
$GITWEB_CONFIG = &quot;&quot;        if ($GITWEB_CONFIG eq $GITWEB_CONFIG_COMMON);
$GITWEB_CONFIG_SYSTEM = &quot;&quot; if ($GITWEB_CONFIG_SYSTEM eq $GITWEB_CONFIG_COMMON);

# Common system-wide settings for convenience.
# Those settings can be ovverriden by GITWEB_CONFIG or GITWEB_CONFIG_SYSTEM.
read_config_file($GITWEB_CONFIG_COMMON);

# Use first config file that exists.  This means use the per-instance
# GITWEB_CONFIG if exists, otherwise use GITWEB_SYSTEM_CONFIG.
read_config_file($GITWEB_CONFIG) and return;
read_config_file($GITWEB_CONFIG_SYSTEM);</pre>

<p>}</p>

<p># Get loadavg of system, to compare against $maxload. # Currently it
requires &#39;/proc/loadavg&#39; present to get loadavg; # if it is not
present it returns 0, which means no load checking. sub get_loadavg {</p>

<pre>if( -e &#39;/proc/loadavg&#39; ){
        open my $fd, &#39;&lt;&#39;, &#39;/proc/loadavg&#39;
                or return 0;
        my @load = split(/\s+/, scalar &lt;$fd&gt;);
        close $fd;

        # The first three columns measure CPU and IO utilization of the last one,
        # five, and 10 minute periods.  The fourth column shows the number of
        # currently running processes and the total number of processes in the m/n
        # format.  The last column displays the last process ID used.
        return $load[0] || 0;
}
# additional checks for load average should go here for things that don&#39;t export
# /proc/loadavg

return 0;</pre>

<p>}</p>

<p># version of the core git binary our $git_version; sub evaluate_git_version
{</p>

<pre>our $git_version = qx(&quot;$GIT&quot; --version) =~ m/git version (.*)$/ ? $1 : &quot;unknown&quot;;
$number_of_git_cmds++;</pre>

<p>}</p>

<p>sub check_loadavg {</p>

<pre>if (defined $maxload &amp;&amp; get_loadavg() &gt; $maxload) {
        die_error(503, &quot;The load average on the server is too high&quot;);
}</pre>

<p>}</p>

<p># ====================================================================== #
input validation and dispatch</p>

<p># input parameters can be collected from a variety of sources (presently,
CGI # and PATH_INFO), so we define an %input_params hash that collects them
all # together during validation: this allows subsequent uses (e.g. href())
to be # agnostic of the parameter origin</p>

<p>our %input_params = ();</p>

<p># input parameters are stored with the long parameter name as key. This
will # also be used in the href subroutine to convert parameters to their
CGI # equivalent, and since the href() usage is the most frequent one, we
store # the name -&gt; CGI key mapping here, instead of the reverse. # #
XXX: Warning: If you touch this, check the search form for updating, # too.</p>

<p>our @cgi_param_mapping = (</p>

<pre class="ruby"><span class="ruby-identifier">project</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;p&quot;</span>,
<span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;a&quot;</span>,
<span class="ruby-identifier">file_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;f&quot;</span>,
<span class="ruby-identifier">file_parent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;fp&quot;</span>,
<span class="ruby-identifier">hash</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;h&quot;</span>,
<span class="ruby-identifier">hash_parent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;hp&quot;</span>,
<span class="ruby-identifier">hash_base</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;hb&quot;</span>,
<span class="ruby-identifier">hash_parent_base</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;hpb&quot;</span>,
<span class="ruby-identifier">page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;pg&quot;</span>,
<span class="ruby-identifier">order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;o&quot;</span>,
<span class="ruby-identifier">searchtext</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;s&quot;</span>,
<span class="ruby-identifier">searchtype</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;st&quot;</span>,
<span class="ruby-identifier">snapshot_format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;sf&quot;</span>,
<span class="ruby-identifier">extra_options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;opt&quot;</span>,
<span class="ruby-identifier">search_use_regexp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;sr&quot;</span>,
<span class="ruby-identifier">ctag</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;by_tag&quot;</span>,
<span class="ruby-identifier">diff_style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;ds&quot;</span>,
<span class="ruby-identifier">project_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;pf&quot;</span>,
<span class="ruby-comment"># this must be last entry (for manipulation from JavaScript)</span>
<span class="ruby-identifier">javascript</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;js&quot;</span>
</pre>

<p>); our %cgi_param_mapping = @cgi_param_mapping;</p>

<p># we will also need to know the possible actions, for validation our
%actions = (</p>

<pre class="ruby"><span class="ruby-string">&quot;blame&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_blame</span>,
<span class="ruby-string">&quot;blame_incremental&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_blame_incremental</span>,
<span class="ruby-string">&quot;blame_data&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_blame_data</span>,
<span class="ruby-string">&quot;blobdiff&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_blobdiff</span>,
<span class="ruby-string">&quot;blobdiff_plain&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_blobdiff_plain</span>,
<span class="ruby-string">&quot;blob&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_blob</span>,
<span class="ruby-string">&quot;blob_plain&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_blob_plain</span>,
<span class="ruby-string">&quot;commitdiff&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_commitdiff</span>,
<span class="ruby-string">&quot;commitdiff_plain&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_commitdiff_plain</span>,
<span class="ruby-string">&quot;commit&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_commit</span>,
<span class="ruby-string">&quot;forks&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_forks</span>,
<span class="ruby-string">&quot;heads&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_heads</span>,
<span class="ruby-string">&quot;history&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_history</span>,
<span class="ruby-string">&quot;log&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_log</span>,
<span class="ruby-string">&quot;patch&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_patch</span>,
<span class="ruby-string">&quot;patches&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_patches</span>,
<span class="ruby-string">&quot;remotes&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_remotes</span>,
<span class="ruby-string">&quot;rss&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_rss</span>,
<span class="ruby-string">&quot;atom&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_atom</span>,
<span class="ruby-string">&quot;search&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_search</span>,
<span class="ruby-string">&quot;search_help&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_search_help</span>,
<span class="ruby-string">&quot;shortlog&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_shortlog</span>,
<span class="ruby-string">&quot;summary&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_summary</span>,
<span class="ruby-string">&quot;tag&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_tag</span>,
<span class="ruby-string">&quot;tags&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_tags</span>,
<span class="ruby-string">&quot;tree&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_tree</span>,
<span class="ruby-string">&quot;snapshot&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_snapshot</span>,
<span class="ruby-string">&quot;object&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_object</span>,
<span class="ruby-comment"># those below don&#39;t need $project</span>
<span class="ruby-string">&quot;opml&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_opml</span>,
<span class="ruby-string">&quot;project_list&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_project_list</span>,
<span class="ruby-string">&quot;project_index&quot;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">git_project_index</span>,
</pre>

<p>);</p>

<p># finally, we have the hash of allowed extra_options for the commands that
# allow them our %allowed_options = (</p>

<pre class="ruby"><span class="ruby-string">&quot;--no-merges&quot;</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">rss</span> <span class="ruby-identifier">atom</span> <span class="ruby-identifier">log</span> <span class="ruby-identifier">shortlog</span> <span class="ruby-identifier">history</span>) ],
</pre>

<p>);</p>

<p># fill %input_params with the CGI parameters. All values except for
&#39;opt&#39; # should be single values, but opt can be an array. We should
probably # build an array of parameters that can be multi-valued, but since
for the time # being it&#39;s only this one, we just single it out sub
evaluate_query_params {</p>

<pre>our $cgi;

while (my ($name, $symbol) = each %cgi_param_mapping) {
        if ($symbol eq &#39;opt&#39;) {
                $input_params{$name} = [ map { decode_utf8($_) } $cgi-&gt;param($symbol) ];
        } else {
                $input_params{$name} = decode_utf8($cgi-&gt;param($symbol));
        }
}</pre>

<p>}</p>

<p># now read PATH_INFO and update the parameter list for missing parameters
sub evaluate_path_info {</p>

<pre class="ruby"><span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;project&#39;</span>};
<span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$path_info</span>;
<span class="ruby-identifier">$path_info</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span>,<span class="ruby-operator">^</span><span class="ruby-node">/+,,;
return if !$path_info;

# find which part of PATH_INFO is project
my $project = $path_info;
$project =~ s,/</span><span class="ruby-operator">+</span><span class="ruby-identifier">$,</span>,;
<span class="ruby-keyword">while</span> (<span class="ruby-identifier">$project</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check_head_link</span>(<span class="ruby-string">&quot;$projectroot/$project&quot;</span>)) {
        <span class="ruby-identifier">$project</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span>,  [<span class="ruby-operator">^</span><span class="ruby-node">/]*$,,;
}
return unless $project;
$input_params{&#39;project&#39;} = $project;

# do not change any parameters if an action is given using the query string
return if $input_params{&#39;action&#39;};
$path_info =~ s,^\Q$project\E/</span><span class="ruby-operator">*</span>,,;

<span class="ruby-comment"># next, check if we have an action</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$action</span> = <span class="ruby-identifier">$path_info</span>;
<span class="ruby-identifier">$action</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span>,<span class="ruby-regexp">/.*$,,;
if (exists $actions{$action}) {
        $path_info =~ s,^$action/</span><span class="ruby-operator">*</span>,,;
        <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;action&#39;</span>} = <span class="ruby-identifier">$action</span>;
}

<span class="ruby-comment"># list of actions that want hash_base instead of hash, but can have no</span>
<span class="ruby-comment"># pathname (f) parameter</span>
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@wants_base</span> = (
        <span class="ruby-string">&#39;tree&#39;</span>,
        <span class="ruby-string">&#39;history&#39;</span>,
);

<span class="ruby-comment"># we want to catch, among others</span>
<span class="ruby-comment"># [$hash_parent_base[:$file_parent]..]$hash_parent[:$file_name]</span>
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$parentrefname</span>, <span class="ruby-identifier">$parentpathname</span>, <span class="ruby-identifier">$refname</span>, <span class="ruby-identifier">$pathname</span>) =
        (<span class="ruby-identifier">$path_info</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(?:(.+?)(?::(.+))?\.\.)?([^:]+?)?(?::(.+))?$/</span>);

<span class="ruby-comment"># first, analyze the &#39;current&#39; part</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$pathname</span>) {
        <span class="ruby-comment"># we got &quot;branch:filename&quot; or &quot;branch:dir/&quot;</span>
        <span class="ruby-comment"># we could use git_get_type(branch:pathname), but:</span>
        <span class="ruby-comment"># - it needs $git_dir</span>
        <span class="ruby-comment"># - it does a git() call</span>
        <span class="ruby-comment"># - the convention of terminating directories with a slash</span>
        <span class="ruby-comment">#   makes it superfluous</span>
        <span class="ruby-comment"># - embedding the action in the PATH_INFO would make it even</span>
        <span class="ruby-comment">#   more superfluous</span>
        <span class="ruby-identifier">$pathname</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span>,<span class="ruby-operator">^</span><span class="ruby-regexp">/+,,;
        if (!$pathname || substr($pathname, -1) eq &quot;/</span><span class="ruby-string">&quot;) {
                $input_params{&#39;action&#39;} ||= &quot;</span><span class="ruby-identifier">tree</span><span class="ruby-node">&quot;;
                $pathname =~ s,/$,,;
        } else {
                # the default action depends on whether we had parent info
                # or not
                if ($parentrefname) {
                        $input_params{&#39;action&#39;} ||= &quot;</span><span class="ruby-identifier">blobdiff_plain</span><span class="ruby-string">&quot;;
                } else {
                        $input_params{&#39;action&#39;} ||= &quot;</span><span class="ruby-identifier">blob_plain</span><span class="ruby-node">&quot;;
                }
        }
        $input_params{&#39;hash_base&#39;} ||= $refname;
        $input_params{&#39;file_name&#39;} ||= $pathname;
} elsif (defined $refname) {
        # we got &quot;</span><span class="ruby-identifier">branch</span><span class="ruby-node">&quot;. In this case we have to choose if we have to
        # set hash or hash_base.
        #
        # Most of the actions without a pathname only want hash to be
        # set, except for the ones specified in @wants_base that want
        # hash_base instead. It should also be noted that hand-crafted
        # links having &#39;history&#39; as an action and no pathname or hash
        # set will fail, but that happens regardless of PATH_INFO.
        if (defined $parentrefname) {
                # if there is parent let the default be &#39;shortlog&#39; action
                # (for http://git.example.com/repo.git/A..B links); if there
                # is no parent, dispatch will detect type of object and set
                # action appropriately if required (if action is not set)
                $input_params{&#39;action&#39;} ||= &quot;</span><span class="ruby-identifier">shortlog</span><span class="ruby-node">&quot;;
        }
        if ($input_params{&#39;action&#39;} &amp;&amp;
            grep { $_ eq $input_params{&#39;action&#39;} } @wants_base) {
                $input_params{&#39;hash_base&#39;} ||= $refname;
        } else {
                $input_params{&#39;hash&#39;} ||= $refname;
        }
}

# next, handle the &#39;parent&#39; part, if present
if (defined $parentrefname) {
        # a missing pathspec defaults to the &#39;current&#39; filename, allowing e.g.
        # someproject/blobdiff/oldrev..newrev:/filename
        if ($parentpathname) {
                $parentpathname =~ s,^/+,,;
                $parentpathname =~ s,/$,,;
                $input_params{&#39;file_parent&#39;} ||= $parentpathname;
        } else {
                $input_params{&#39;file_parent&#39;} ||= $input_params{&#39;file_name&#39;};
        }
        # we assume that hash_parent_base is wanted if a path was specified,
        # or if the action wants hash_base instead of hash
        if (defined $input_params{&#39;file_parent&#39;} ||
                grep { $_ eq $input_params{&#39;action&#39;} } @wants_base) {
                $input_params{&#39;hash_parent_base&#39;} ||= $parentrefname;
        } else {
                $input_params{&#39;hash_parent&#39;} ||= $parentrefname;
        }
}

# for the snapshot action, we allow URLs in the form
# $project/snapshot/$hash.ext
# where .ext determines the snapshot and gets removed from the
# passed $refname to provide the $hash.
#
# To be able to tell that $refname includes the format extension, we
# require the following two conditions to be satisfied:
# - the hash input parameter MUST have been set from the $refname part
#   of the URL (i.e. they must be equal)
# - the snapshot format MUST NOT have been defined already (e.g. from
#   CGI parameter sf)
# It&#39;s also useless to try any matching unless $refname has a dot,
# so we check for that too
if (defined $input_params{&#39;action&#39;} &amp;&amp;
        $input_params{&#39;action&#39;} eq &#39;snapshot&#39; &amp;&amp;
        defined $refname &amp;&amp; index($refname, &#39;.&#39;) != -1 &amp;&amp;
        $refname eq $input_params{&#39;hash&#39;} &amp;&amp;
        !defined $input_params{&#39;snapshot_format&#39;}) {
        # We loop over the known snapshot formats, checking for
        # extensions. Allowed extensions are both the defined suffix
        # (which includes the initial dot already) and the snapshot
        # format key itself, with a prepended dot
        while (my ($fmt, $opt) = each %known_snapshot_formats) {
                my $hash = $refname;
                unless ($hash =~ s/(\Q$opt-&gt;{&#39;suffix&#39;}\E|\Q.$fmt\E)$//) {
                        next;
                }
                my $sfx = $1;
                # a valid suffix was found, so set the snapshot format
                # and reset the hash parameter
                $input_params{&#39;snapshot_format&#39;} = $fmt;
                $input_params{&#39;hash&#39;} = $hash;
                # we also set the format suffix to the one requested
                # in the URL: this way a request for e.g. .tgz returns
                # a .tgz instead of a .tar.gz
                $known_snapshot_formats{$fmt}{&#39;suffix&#39;} = $sfx;
                last;
        }
}
</span></pre>

<p>}</p>

<p>our ($action, $project, $file_name, $file_parent, $hash, $hash_parent,
$hash_base,</p>

<pre>$hash_parent_base, @extra_options, $page, $searchtype, $search_use_regexp,
$searchtext, $search_regexp, $project_filter);</pre>

<p>sub evaluate_and_validate_params {</p>

<pre>our $action = $input_params{&#39;action&#39;};
if (defined $action) {
        if (!validate_action($action)) {
                die_error(400, &quot;Invalid action parameter&quot;);
        }
}

# parameters which are pathnames
our $project = $input_params{&#39;project&#39;};
if (defined $project) {
        if (!validate_project($project)) {
                undef $project;
                die_error(404, &quot;No such project&quot;);
        }
}

our $project_filter = $input_params{&#39;project_filter&#39;};
if (defined $project_filter) {
        if (!validate_pathname($project_filter)) {
                die_error(404, &quot;Invalid project_filter parameter&quot;);
        }
}

our $file_name = $input_params{&#39;file_name&#39;};
if (defined $file_name) {
        if (!validate_pathname($file_name)) {
                die_error(400, &quot;Invalid file parameter&quot;);
        }
}

our $file_parent = $input_params{&#39;file_parent&#39;};
if (defined $file_parent) {
        if (!validate_pathname($file_parent)) {
                die_error(400, &quot;Invalid file parent parameter&quot;);
        }
}

# parameters which are refnames
our $hash = $input_params{&#39;hash&#39;};
if (defined $hash) {
        if (!validate_refname($hash)) {
                die_error(400, &quot;Invalid hash parameter&quot;);
        }
}

our $hash_parent = $input_params{&#39;hash_parent&#39;};
if (defined $hash_parent) {
        if (!validate_refname($hash_parent)) {
                die_error(400, &quot;Invalid hash parent parameter&quot;);
        }
}

our $hash_base = $input_params{&#39;hash_base&#39;};
if (defined $hash_base) {
        if (!validate_refname($hash_base)) {
                die_error(400, &quot;Invalid hash base parameter&quot;);
        }
}

our @extra_options = @{$input_params{&#39;extra_options&#39;}};
# @extra_options is always defined, since it can only be (currently) set from
# CGI, and $cgi-&gt;param() returns the empty array in array context if the param
# is not set
foreach my $opt (@extra_options) {
        if (not exists $allowed_options{$opt}) {
                die_error(400, &quot;Invalid option parameter&quot;);
        }
        if (not grep(/^$action$/, @{$allowed_options{$opt}})) {
                die_error(400, &quot;Invalid option parameter for this action&quot;);
        }
}

our $hash_parent_base = $input_params{&#39;hash_parent_base&#39;};
if (defined $hash_parent_base) {
        if (!validate_refname($hash_parent_base)) {
                die_error(400, &quot;Invalid hash parent base parameter&quot;);
        }
}

# other parameters
our $page = $input_params{&#39;page&#39;};
if (defined $page) {
        if ($page =~ m/[^0-9]/) {
                die_error(400, &quot;Invalid page parameter&quot;);
        }
}

our $searchtype = $input_params{&#39;searchtype&#39;};
if (defined $searchtype) {
        if ($searchtype =~ m/[^a-z]/) {
                die_error(400, &quot;Invalid searchtype parameter&quot;);
        }
}

our $search_use_regexp = $input_params{&#39;search_use_regexp&#39;};

our $searchtext = $input_params{&#39;searchtext&#39;};
our $search_regexp = undef;
if (defined $searchtext) {
        if (length($searchtext) &lt; 2) {
                die_error(403, &quot;At least two characters are required for search parameter&quot;);
        }
        if ($search_use_regexp) {
                $search_regexp = $searchtext;
                if (!eval { qr/$search_regexp/; 1; }) {
                        (my $error = $@) =~ s/ at \S+ line \d+.*\n?//;
                        die_error(400, &quot;Invalid search regexp &#39;$search_regexp&#39;&quot;,
                                  esc_html($error));
                }
        } else {
                $search_regexp = quotemeta $searchtext;
        }
}</pre>

<p>}</p>

<p># path to the current git repository our $git_dir; sub evaluate_git_dir {</p>

<pre>our $git_dir = &quot;$projectroot/$project&quot; if $project;</pre>

<p>}</p>

<p>our (@snapshot_fmts, $git_avatar); sub configure_gitweb_features {</p>

<pre class="ruby"><span class="ruby-comment"># list of supported snapshot formats</span>
<span class="ruby-identifier">our</span> <span class="ruby-ivar">@snapshot_fmts</span> = <span class="ruby-identifier">gitweb_get_feature</span>(<span class="ruby-string">&#39;snapshot&#39;</span>);
<span class="ruby-ivar">@snapshot_fmts</span> = <span class="ruby-identifier">filter_snapshot_fmts</span>(<span class="ruby-ivar">@snapshot_fmts</span>);

<span class="ruby-comment"># check that the avatar feature is set to a known provider name,</span>
<span class="ruby-comment"># and for each provider check if the dependencies are satisfied.</span>
<span class="ruby-comment"># if the provider name is invalid or the dependencies are not met,</span>
<span class="ruby-comment"># reset $git_avatar to the empty string.</span>
<span class="ruby-identifier">our</span> (<span class="ruby-identifier">$git_avatar</span>) = <span class="ruby-identifier">gitweb_get_feature</span>(<span class="ruby-string">&#39;avatar&#39;</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$git_avatar</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;gravatar&#39;</span>) {
        <span class="ruby-identifier">$git_avatar</span> = <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">eval</span> { <span class="ruby-identifier">require</span> <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>; <span class="ruby-value">1</span>; });
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$git_avatar</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;picon&#39;</span>) {
        <span class="ruby-comment"># no dependencies</span>
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$git_avatar</span> = <span class="ruby-string">&#39;&#39;</span>;
}
</pre>

<p>}</p>

<p># custom error handler: &#39;die &lt;message&gt;&#39; is Internal Server
Error sub handle_errors_html {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$msg</span> = <span class="ruby-identifier">shift</span>; <span class="ruby-comment"># it is already HTML escaped</span>

<span class="ruby-comment"># to avoid infinite loop where error occurs in die_error,</span>
<span class="ruby-comment"># change handler to default handler, disabling handle_errors_html</span>
<span class="ruby-identifier">set_message</span>(<span class="ruby-string">&quot;Error occurred when inside die_error:\n$msg&quot;</span>);

<span class="ruby-comment"># you cannot jump out of die_error when called as error handler;</span>
<span class="ruby-comment"># the subroutine set via CGI::Carp::set_message is called _after_</span>
<span class="ruby-comment"># HTTP headers are already written, so it cannot write them itself</span>
<span class="ruby-identifier">die_error</span>(<span class="ruby-keyword">undef</span>, <span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$msg</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">error_handler</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">no_http_header</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
</pre>

<p>} set_message(&amp;handle_errors_html);</p>

<p># dispatch sub dispatch {</p>

<pre>if (!defined $action) {
        if (defined $hash) {
                $action = git_get_type($hash);
                $action or die_error(404, &quot;Object does not exist&quot;);
        } elsif (defined $hash_base &amp;&amp; defined $file_name) {
                $action = git_get_type(&quot;$hash_base:$file_name&quot;);
                $action or die_error(404, &quot;File or directory does not exist&quot;);
        } elsif (defined $project) {
                $action = &#39;summary&#39;;
        } else {
                $action = &#39;project_list&#39;;
        }
}
if (!defined($actions{$action})) {
        die_error(400, &quot;Unknown action&quot;);
}
if ($action !~ m/^(?:opml|project_list|project_index)$/ &amp;&amp;
    !$project) {
        die_error(400, &quot;Project needed&quot;);
}
$actions{$action}-&gt;();</pre>

<p>}</p>

<p>sub reset_timer {</p>

<pre>our $t0 = [ gettimeofday() ]
        if defined $t0;
our $number_of_git_cmds = 0;</pre>

<p>}</p>

<p>our $first_request = 1; sub run_request {</p>

<pre>reset_timer();

evaluate_uri();
if ($first_request) {
        evaluate_gitweb_config();
        evaluate_git_version();
}
if ($per_request_config) {
        if (ref($per_request_config) eq &#39;CODE&#39;) {
                $per_request_config-&gt;();
        } elsif (!$first_request) {
                evaluate_gitweb_config();
        }
}
check_loadavg();

# $projectroot and $projects_list might be set in gitweb config file
$projects_list ||= $projectroot;

evaluate_query_params();
evaluate_path_info();
evaluate_and_validate_params();
evaluate_git_dir();

configure_gitweb_features();

dispatch();</pre>

<p>}</p>

<p>our $is_last_request = sub { 1 }; our ($pre_dispatch_hook,
$post_dispatch_hook, $pre_listen_hook); our $CGI = &#39;CGI&#39;; our $cgi;
sub configure_as_fcgi {</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-constant">Fast</span>;
<span class="ruby-identifier">our</span> <span class="ruby-identifier">$CGI</span> = <span class="ruby-string">&#39;CGI::Fast&#39;</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$request_number</span> = <span class="ruby-value">0</span>;
<span class="ruby-comment"># let each child service 100 requests</span>
<span class="ruby-identifier">our</span> <span class="ruby-identifier">$is_last_request</span> = <span class="ruby-identifier">sub</span> { <span class="ruby-operator">+</span><span class="ruby-operator">+</span><span class="ruby-identifier">$request_number</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span> };
</pre>

<p>} sub evaluate_argv {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$script_name</span> = <span class="ruby-identifier">$ENV</span>{<span class="ruby-string">&#39;SCRIPT_NAME&#39;</span>} <span class="ruby-operator">||</span> <span class="ruby-identifier">$ENV</span>{<span class="ruby-string">&#39;SCRIPT_FILENAME&#39;</span>} <span class="ruby-operator">||</span> <span class="ruby-keyword">__FILE__</span>;
<span class="ruby-identifier">configure_as_fcgi</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">$script_name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\.fcgi$/</span>;

<span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> (<span class="ruby-ivar">@ARGV</span>);

<span class="ruby-identifier">require</span> <span class="ruby-constant">Getopt</span><span class="ruby-operator">::</span><span class="ruby-constant">Long</span>;
<span class="ruby-constant">Getopt</span><span class="ruby-operator">::</span><span class="ruby-constant">Long</span><span class="ruby-operator">::</span><span class="ruby-constant">GetOptions</span>(
        <span class="ruby-string">&#39;fastcgi|fcgi|f&#39;</span> =<span class="ruby-operator">&gt;</span> \<span class="ruby-operator">&amp;</span><span class="ruby-identifier">configure_as_fcgi</span>,
        <span class="ruby-string">&#39;nproc|n=i&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sub</span> {
                <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$arg</span>, <span class="ruby-identifier">$val</span>) = <span class="ruby-ivar">@_</span>;
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">eval</span> { <span class="ruby-identifier">require</span> <span class="ruby-constant">FCGI</span><span class="ruby-operator">::</span><span class="ruby-constant">ProcManager</span>; <span class="ruby-value">1</span>; };
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$proc_manager</span> = <span class="ruby-constant">FCGI</span><span class="ruby-operator">::</span><span class="ruby-constant">ProcManager</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">new</span>({
                        <span class="ruby-identifier">n_processes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$val</span>,
                });
                <span class="ruby-identifier">our</span> <span class="ruby-identifier">$pre_listen_hook</span>    = <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">$proc_manager</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">pm_manage</span>()        };
                <span class="ruby-identifier">our</span> <span class="ruby-identifier">$pre_dispatch_hook</span>  = <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">$proc_manager</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">pm_pre_dispatch</span>()  };
                <span class="ruby-identifier">our</span> <span class="ruby-identifier">$post_dispatch_hook</span> = <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">$proc_manager</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">pm_post_dispatch</span>() };
        },
);
</pre>

<p>}</p>

<p>sub run {</p>

<pre>       evaluate_argv();

       $first_request = 1;
       $pre_listen_hook-&gt;()
               if $pre_listen_hook;

REQUEST:
       while ($cgi = $CGI-&gt;new()) {
               $pre_dispatch_hook-&gt;()
                       if $pre_dispatch_hook;

               run_request();

               $post_dispatch_hook-&gt;()
                       if $post_dispatch_hook;
               $first_request = 0;

               last REQUEST if ($is_last_request-&gt;());
       }

DONE_GITWEB:
       1;</pre>

<p>}</p>

<p>run();</p>

<p>if (defined caller) {</p>

<pre># wrapped in a subroutine processing requests,
# e.g. mod_perl with ModPerl::Registry, or PSGI with Plack::App::WrapCGI
return;</pre>

<p>} else {</p>

<pre># pure CGI script, serving single request
exit;</pre>

<p>}</p>

<p>## ======================================================================
## action links</p>

<p># possible values of extra options # -full =&gt; 0|1      - use
absolute/full URL ($my_uri/$my_url as base) # -replay =&gt; 1      - start
from a current view (replay with modifications) # -path_info =&gt; 0|1 -
don&#39;t use/use path_info URL (if possible) # -anchor =&gt; ANCHOR - add
#ANCHOR to end of URL, implies -replay if used alone sub href {</p>

<pre>my %params = @_;
# default is to use -absolute url() i.e. $my_uri
my $href = $params{-full} ? $my_url : $my_uri;

# implicit -replay, must be first of implicit params
$params{-replay} = 1 if (keys %params == 1 &amp;&amp; $params{-anchor});

$params{&#39;project&#39;} = $project unless exists $params{&#39;project&#39;};

if ($params{-replay}) {
        while (my ($name, $symbol) = each %cgi_param_mapping) {
                if (!exists $params{$name}) {
                        $params{$name} = $input_params{$name};
                }
        }
}

my $use_pathinfo = gitweb_check_feature(&#39;pathinfo&#39;);
if (defined $params{&#39;project&#39;} &amp;&amp;
    (exists $params{-path_info} ? $params{-path_info} : $use_pathinfo)) {
        # try to put as many parameters as possible in PATH_INFO:
        #   - project name
        #   - action
        #   - hash_parent or hash_parent_base:/file_parent
        #   - hash or hash_base:/filename
        #   - the snapshot_format as an appropriate suffix

        # When the script is the root DirectoryIndex for the domain,
        # $href here would be something like http://gitweb.example.com/
        # Thus, we strip any trailing / from $href, to spare us double
        # slashes in the final URL
        $href =~ s,/$,,;

        # Then add the project name, if present
        $href .= &quot;/&quot;.esc_path_info($params{&#39;project&#39;});
        delete $params{&#39;project&#39;};

        # since we destructively absorb parameters, we keep this
        # boolean that remembers if we&#39;re handling a snapshot
        my $is_snapshot = $params{&#39;action&#39;} eq &#39;snapshot&#39;;

        # Summary just uses the project path URL, any other action is
        # added to the URL
        if (defined $params{&#39;action&#39;}) {
                $href .= &quot;/&quot;.esc_path_info($params{&#39;action&#39;})
                        unless $params{&#39;action&#39;} eq &#39;summary&#39;;
                delete $params{&#39;action&#39;};
        }

        # Next, we put hash_parent_base:/file_parent..hash_base:/file_name,
        # stripping nonexistent or useless pieces
        $href .= &quot;/&quot; if ($params{&#39;hash_base&#39;} || $params{&#39;hash_parent_base&#39;}
                || $params{&#39;hash_parent&#39;} || $params{&#39;hash&#39;});
        if (defined $params{&#39;hash_base&#39;}) {
                if (defined $params{&#39;hash_parent_base&#39;}) {
                        $href .= esc_path_info($params{&#39;hash_parent_base&#39;});
                        # skip the file_parent if it&#39;s the same as the file_name
                        if (defined $params{&#39;file_parent&#39;}) {
                                if (defined $params{&#39;file_name&#39;} &amp;&amp; $params{&#39;file_parent&#39;} eq $params{&#39;file_name&#39;}) {
                                        delete $params{&#39;file_parent&#39;};
                                } elsif ($params{&#39;file_parent&#39;} !~ /\.\./) {
                                        $href .= &quot;:/&quot;.esc_path_info($params{&#39;file_parent&#39;});
                                        delete $params{&#39;file_parent&#39;};
                                }
                        }
                        $href .= &quot;..&quot;;
                        delete $params{&#39;hash_parent&#39;};
                        delete $params{&#39;hash_parent_base&#39;};
                } elsif (defined $params{&#39;hash_parent&#39;}) {
                        $href .= esc_path_info($params{&#39;hash_parent&#39;}). &quot;..&quot;;
                        delete $params{&#39;hash_parent&#39;};
                }

                $href .= esc_path_info($params{&#39;hash_base&#39;});
                if (defined $params{&#39;file_name&#39;} &amp;&amp; $params{&#39;file_name&#39;} !~ /\.\./) {
                        $href .= &quot;:/&quot;.esc_path_info($params{&#39;file_name&#39;});
                        delete $params{&#39;file_name&#39;};
                }
                delete $params{&#39;hash&#39;};
                delete $params{&#39;hash_base&#39;};
        } elsif (defined $params{&#39;hash&#39;}) {
                $href .= esc_path_info($params{&#39;hash&#39;});
                delete $params{&#39;hash&#39;};
        }

        # If the action was a snapshot, we can absorb the
        # snapshot_format parameter too
        if ($is_snapshot) {
                my $fmt = $params{&#39;snapshot_format&#39;};
                # snapshot_format should always be defined when href()
                # is called, but just in case some code forgets, we
                # fall back to the default
                $fmt ||= $snapshot_fmts[0];
                $href .= $known_snapshot_formats{$fmt}{&#39;suffix&#39;};
                delete $params{&#39;snapshot_format&#39;};
        }
}

# now encode the parameters explicitly
my @result = ();
for (my $i = 0; $i &lt; @cgi_param_mapping; $i += 2) {
        my ($name, $symbol) = ($cgi_param_mapping[$i], $cgi_param_mapping[$i+1]);
        if (defined $params{$name}) {
                if (ref($params{$name}) eq &quot;ARRAY&quot;) {
                        foreach my $par (@{$params{$name}}) {
                                push @result, $symbol . &quot;=&quot; . esc_param($par);
                        }
                } else {
                        push @result, $symbol . &quot;=&quot; . esc_param($params{$name});
                }
        }
}
$href .= &quot;?&quot; . join(&#39;;&#39;, @result) if scalar @result;

# final transformation: trailing spaces must be escaped (URI-encoded)
$href =~ s/(\s+)$/CGI::escape($1)/e;

if ($params{-anchor}) {
        $href .= &quot;#&quot;.esc_param($params{-anchor});
}

return $href;</pre>

<p>}</p>

<p>## ======================================================================
## validation, quoting/unquoting and escaping</p>

<p>sub validate_action {</p>

<pre>my $input = shift || return undef;
return undef unless exists $actions{$input};
return $input;</pre>

<p>}</p>

<p>sub validate_project {</p>

<pre>my $input = shift || return undef;
if (!validate_pathname($input) ||
        !(-d &quot;$projectroot/$input&quot;) ||
        !check_export_ok(&quot;$projectroot/$input&quot;) ||
        ($strict_export &amp;&amp; !project_in_list($input))) {
        return undef;
} else {
        return $input;
}</pre>

<p>}</p>

<p>sub validate_pathname {</p>

<pre>my $input = shift || return undef;

# no &#39;.&#39; or &#39;..&#39; as elements of path, i.e. no &#39;.&#39; nor &#39;..&#39;
# at the beginning, at the end, and between slashes.
# also this catches doubled slashes
if ($input =~ m!(^|/)(|\.|\.\.)(/|$)!) {
        return undef;
}
# no null characters
if ($input =~ m!\0!) {
        return undef;
}
return $input;</pre>

<p>}</p>

<p>sub validate_refname {</p>

<pre>my $input = shift || return undef;

# textual hashes are O.K.
if ($input =~ m/^[0-9a-fA-F]{40}$/) {
        return $input;
}
# it must be correct pathname
$input = validate_pathname($input)
        or return undef;
# restrictions on ref name according to git-check-ref-format
if ($input =~ m!(/\.|\.\.|[\000-\040\177 ~^:?*\[]|/$)!) {
        return undef;
}
return $input;</pre>

<p>}</p>

<p># decode sequences of octets in utf8 into Perl&#39;s internal form, # which
is utf-8 with utf8 flag set if needed.  gitweb writes out # in utf-8 thanks
to binmode STDOUT, &#39;:utf8&#39; at beginning sub to_utf8 {</p>

<pre>my $str = shift;
return undef unless defined $str;

if (utf8::is_utf8($str) || utf8::decode($str)) {
        return $str;
} else {
        return decode($fallback_encoding, $str, Encode::FB_DEFAULT);
}</pre>

<p>}</p>

<p># quote unsafe chars, but keep the slash, even when it&#39;s not # correct,
but quoted slashes look too horrible in bookmarks sub esc_param {</p>

<pre>my $str = shift;
return undef unless defined $str;
$str =~ s/([^A-Za-z0-9\-_.~()\/:@ ]+)/CGI::escape($1)/eg;
$str =~ s/ /\+/g;
return $str;</pre>

<p>}</p>

<p># the quoting rules for path_info fragment are slightly different sub
esc_path_info {</p>

<pre>my $str = shift;
return undef unless defined $str;

# path_info doesn&#39;t treat &#39;+&#39; as space (specially), but &#39;?&#39; must be escaped
$str =~ s/([^A-Za-z0-9\-_.~();\/;:@&amp;= +]+)/CGI::escape($1)/eg;

return $str;</pre>

<p>}</p>

<p># quote unsafe chars in whole URL, so some characters cannot be quoted sub
esc_url {</p>

<pre>my $str = shift;
return undef unless defined $str;
$str =~ s/([^A-Za-z0-9\-_.~();\/;?:@&amp;= ]+)/CGI::escape($1)/eg;
$str =~ s/ /\+/g;
return $str;</pre>

<p>}</p>

<p># quote unsafe characters in HTML attributes sub esc_attr {</p>

<pre># for XHTML conformance escaping &#39;&quot;&#39; to &#39;&amp;quot;&#39; is not enough
return esc_html(@_);</pre>

<p>}</p>

<p># replace invalid utf8 character with SUBSTITUTION sequence sub esc_html {</p>

<pre>my $str = shift;
my %opts = @_;

return undef unless defined $str;

$str = to_utf8($str);
$str = $cgi-&gt;escapeHTML($str);
if ($opts{&#39;-nbsp&#39;}) {
        $str =~ s/ /&amp;nbsp;/g;
}
$str =~ s|([[:cntrl:]])|(($1 ne &quot;\t&quot;) ? quot_cec($1) : $1)|eg;
return $str;</pre>

<p>}</p>

<p># quote control characters and escape filename to HTML sub esc_path {</p>

<pre>my $str = shift;
my %opts = @_;

return undef unless defined $str;

$str = to_utf8($str);
$str = $cgi-&gt;escapeHTML($str);
if ($opts{&#39;-nbsp&#39;}) {
        $str =~ s/ /&amp;nbsp;/g;
}
$str =~ s|([[:cntrl:]])|quot_cec($1)|eg;
return $str;</pre>

<p>}</p>

<p># Sanitize for use in XHTML + application/xml+xhtm (valid XML 1.0) sub
sanitize {</p>

<pre>my $str = shift;

return undef unless defined $str;

$str = to_utf8($str);
$str =~ s|([[:cntrl:]])|(index(&quot;\t\n\r&quot;, $1) != -1 ? $1 : quot_cec($1))|eg;
return $str;</pre>

<p>}</p>

<p># Make control characters printable, using character escape codes (CEC)
sub quot_cec {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$cntrl</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span> = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">s</span> = ( <span class="ruby-comment"># character escape codes, aka escape sequences</span>
        <span class="ruby-string">&quot;\t&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\t&#39;</span>,   <span class="ruby-comment"># tab            (HT)</span>
        <span class="ruby-string">&quot;\n&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\n&#39;</span>,   <span class="ruby-comment"># line feed      (LF)</span>
        <span class="ruby-string">&quot;\r&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\r&#39;</span>,   <span class="ruby-comment"># carrige return (CR)</span>
        <span class="ruby-string">&quot;\f&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\f&#39;</span>,   <span class="ruby-comment"># form feed      (FF)</span>
        <span class="ruby-string">&quot;\b&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\b&#39;</span>,   <span class="ruby-comment"># backspace      (BS)</span>
        <span class="ruby-string">&quot;\a&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\a&#39;</span>,   <span class="ruby-comment"># alarm (bell)   (BEL)</span>
        <span class="ruby-string">&quot;\e&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\e&#39;</span>,   <span class="ruby-comment"># escape         (ESC)</span>
        <span class="ruby-string">&quot;\013&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\v&#39;</span>, <span class="ruby-comment"># vertical tab   (VT)</span>
        <span class="ruby-string">&quot;\000&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;\0&#39;</span>, <span class="ruby-comment"># nul character  (NUL)</span>
);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$chr</span> = ( (<span class="ruby-identifier">exists</span> <span class="ruby-identifier">$es</span>{<span class="ruby-identifier">$cntrl</span>})
            <span class="ruby-value">? </span><span class="ruby-identifier">$es</span>{<span class="ruby-identifier">$cntrl</span>}
            <span class="ruby-operator">:</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&#39;\%2x&#39;</span>, <span class="ruby-identifier">ord</span>(<span class="ruby-identifier">$cntrl</span>)) );
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$opts</span>{<span class="ruby-operator">-</span><span class="ruby-identifier">nohtml</span>}) {
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$chr</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&lt;span class=\&quot;cntrl\&quot;&gt;$chr&lt;/span&gt;&quot;</span>;
}
</pre>

<p>}</p>

<p># Alternatively use unicode control pictures codepoints, # Unicode
printable representation (PR) sub quot_upr {</p>

<pre>my $cntrl = shift;
my %opts = @_;

my $chr = sprintf(&#39;&amp;#%04d;&#39;, 0x2400+ord($cntrl));
if ($opts{-nohtml}) {
        return $chr;
} else {
        return &quot;&lt;span class=\&quot;cntrl\&quot;&gt;$chr&lt;/span&gt;&quot;;
}</pre>

<p>}</p>

<p># git may return quoted and escaped filenames sub unquote {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$str</span> = <span class="ruby-identifier">shift</span>;

<span class="ruby-identifier">sub</span> <span class="ruby-identifier">unq</span> {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$seq</span> = <span class="ruby-identifier">shift</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">s</span> = ( <span class="ruby-comment"># character escape codes, aka escape sequences</span>
                <span class="ruby-string">&#39;t&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\t&quot;</span>,   <span class="ruby-comment"># tab            (HT, TAB)</span>
                <span class="ruby-string">&#39;n&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\n&quot;</span>,   <span class="ruby-comment"># newline        (NL)</span>
                <span class="ruby-string">&#39;r&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\r&quot;</span>,   <span class="ruby-comment"># return         (CR)</span>
                <span class="ruby-string">&#39;f&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\f&quot;</span>,   <span class="ruby-comment"># form feed      (FF)</span>
                <span class="ruby-string">&#39;b&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\b&quot;</span>,   <span class="ruby-comment"># backspace      (BS)</span>
                <span class="ruby-string">&#39;a&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\a&quot;</span>,   <span class="ruby-comment"># alarm (bell)   (BEL)</span>
                <span class="ruby-string">&#39;e&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\e&quot;</span>,   <span class="ruby-comment"># escape         (ESC)</span>
                <span class="ruby-string">&#39;v&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\013&quot;</span>, <span class="ruby-comment"># vertical tab   (VT)</span>
        );

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$seq</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">7</span>]{<span class="ruby-value">1</span>,<span class="ruby-value">3</span>}<span class="ruby-identifier">$/</span>) {
                <span class="ruby-comment"># octal char sequence</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">chr</span>(<span class="ruby-identifier">oct</span>(<span class="ruby-identifier">$seq</span>));
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">exists</span> <span class="ruby-identifier">$es</span>{<span class="ruby-identifier">$seq</span>}) {
                <span class="ruby-comment"># C escape sequence, aka character escape code</span>
                <span class="ruby-keyword">return</span> <span class="ruby-identifier">$es</span>{<span class="ruby-identifier">$seq</span>};
        }
        <span class="ruby-comment"># quoted ordinary character</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$seq</span>;
}

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$str</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-string">&quot;(.*)&quot;</span><span class="ruby-identifier">$/</span>) {
        <span class="ruby-comment"># needs unquoting</span>
        <span class="ruby-identifier">$str</span> = <span class="ruby-node">$1</span>;
        <span class="ruby-identifier">$str</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span>\\([<span class="ruby-operator">^</span><span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">7</span>]<span class="ruby-operator">|</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">7</span>]{<span class="ruby-value">1</span>,<span class="ruby-value">3</span>})<span class="ruby-operator">/</span><span class="ruby-identifier">unq</span>(<span class="ruby-node">$1</span>)<span class="ruby-operator">/</span><span class="ruby-identifier">eg</span>;
}
<span class="ruby-keyword">return</span> <span class="ruby-identifier">$str</span>;
</pre>

<p>}</p>

<p># escape tabs (convert tabs to spaces) sub untabify {</p>

<pre>my $line = shift;

while ((my $pos = index($line, &quot;\t&quot;)) != -1) {
        if (my $count = (8 - ($pos % 8))) {
                my $spaces = &#39; &#39; x $count;
                $line =~ s/\t/$spaces/;
        }
}

return $line;</pre>

<p>}</p>

<p>sub project_in_list {</p>

<pre>my $project = shift;
my @list = git_get_projects_list();
return @list &amp;&amp; scalar(grep { $_-&gt;{&#39;path&#39;} eq $project } @list);</pre>

<p>}</p>

<p>## - ## HTML aware string manipulation</p>

<p># Try to chop given string on a word boundary between position # $len and
$len+$add_len. If there is no word boundary there, # chop at $len+$add_len.
Do not chop if chopped part plus ellipsis # (marking chopped part) would be
longer than given string. sub chop_str {</p>

<pre>my $str = shift;
my $len = shift;
my $add_len = shift || 10;
my $where = shift || &#39;right&#39;; # &#39;left&#39; | &#39;center&#39; | &#39;right&#39;

# Make sure perl knows it is utf8 encoded so we don&#39;t
# cut in the middle of a utf8 multibyte char.
$str = to_utf8($str);

# allow only $len chars, but don&#39;t cut a word if it would fit in $add_len
# if it doesn&#39;t fit, cut it if it&#39;s still longer than the dots we would add
# remove chopped character entities entirely

# when chopping in the middle, distribute $len into left and right part
# return early if chopping wouldn&#39;t make string shorter
if ($where eq &#39;center&#39;) {
        return $str if ($len + 5 &gt;= length($str)); # filler is length 5
        $len = int($len/2);
} else {
        return $str if ($len + 4 &gt;= length($str)); # filler is length 4
}

# regexps: ending and beginning with word part up to $add_len
my $endre = qr/.{$len}\w{0,$add_len}/;
my $begre = qr/\w{0,$add_len}.{$len}/;

if ($where eq &#39;left&#39;) {
        $str =~ m/^(.*?)($begre)$/;
        my ($lead, $body) = ($1, $2);
        if (length($lead) &gt; 4) {
                $lead = &quot; ...&quot;;
        }
        return &quot;$lead$body&quot;;

} elsif ($where eq &#39;center&#39;) {
        $str =~ m/^($endre)(.*)$/;
        my ($left, $str)  = ($1, $2);
        $str =~ m/^(.*?)($begre)$/;
        my ($mid, $right) = ($1, $2);
        if (length($mid) &gt; 5) {
                $mid = &quot; ... &quot;;
        }
        return &quot;$left$mid$right&quot;;

} else {
        $str =~ m/^($endre)(.*)$/;
        my $body = $1;
        my $tail = $2;
        if (length($tail) &gt; 4) {
                $tail = &quot;... &quot;;
        }
        return &quot;$body$tail&quot;;
}</pre>

<p>}</p>

<p># takes the same arguments as chop_str, but also wraps a &lt;span&gt;
around the # result with a title attribute if it does get chopped.
Additionally, the # string is HTML-escaped. sub chop_and_escape_str {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$str</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$chopped</span> = <span class="ruby-identifier">chop_str</span>(<span class="ruby-ivar">@_</span>);
<span class="ruby-identifier">$str</span> = <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$str</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$chopped</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$str</span>) {
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$chopped</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$str</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span>[[:<span class="ruby-identifier">cntrl</span><span class="ruby-operator">:</span>]]<span class="ruby-operator">/</span><span class="ruby-value">?/</span><span class="ruby-identifier">g</span>;
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">span</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">title</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$str</span>}, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$chopped</span>));
}
</pre>

<p>}</p>

<p># Highlight selected fragments of string, using given CSS class, # and
escape HTML.  It is assumed that fragments do not overlap. # Regions are
passed as list of pairs (array references). # # Example:
esc_html_hl_regions(foobar, mark, [ 0, 3 ]) returns # &#39;&lt;span
class=mark&gt;foo&lt;/span&gt;bar&#39; sub esc_html_hl_regions {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$str</span>, <span class="ruby-identifier">$css_class</span>, <span class="ruby-ivar">@sel</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span> = <span class="ruby-identifier">grep</span> { <span class="ruby-identifier">ref</span>(<span class="ruby-identifier">$_</span>) <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;ARRAY&#39;</span> } <span class="ruby-ivar">@sel</span>;
<span class="ruby-ivar">@sel</span>     = <span class="ruby-identifier">grep</span> { <span class="ruby-identifier">ref</span>(<span class="ruby-identifier">$_</span>) <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;ARRAY&#39;</span> } <span class="ruby-ivar">@sel</span>;
<span class="ruby-keyword">return</span> <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$str</span>, <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@sel</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$out</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$pos</span> = <span class="ruby-value">0</span>;

<span class="ruby-keyword">for</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$s</span> (<span class="ruby-ivar">@sel</span>) {
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$begin</span>, <span class="ruby-identifier">$end</span>) = @<span class="ruby-identifier">$s</span>;

        <span class="ruby-comment"># Don&#39;t create empty &lt;span&gt; elements.</span>
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$end</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$begin</span>;

        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$escaped</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$str</span>, <span class="ruby-identifier">$begin</span>, <span class="ruby-identifier">$end</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$begin</span>),
                               <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span>);

        <span class="ruby-identifier">$out</span> .= <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$str</span>, <span class="ruby-identifier">$pos</span>, <span class="ruby-identifier">$begin</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$pos</span>), <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span>)
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$begin</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>);
        <span class="ruby-identifier">$out</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">span</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$css_class</span>}, <span class="ruby-identifier">$escaped</span>);

        <span class="ruby-identifier">$pos</span> = <span class="ruby-identifier">$end</span>;
}
<span class="ruby-identifier">$out</span> .= <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$str</span>, <span class="ruby-identifier">$pos</span>), <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$pos</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">length</span>(<span class="ruby-identifier">$str</span>));

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$out</span>;
</pre>

<p>}</p>

<p># return positions of beginning and end of each match sub matchpos_list {</p>

<pre>my ($str, $regexp) = @_;
return unless (defined $str &amp;&amp; defined $regexp);

my @matches;
while ($str =~ /$regexp/g) {
        push @matches, [$-[0], $+[0]];
}
return @matches;</pre>

<p>}</p>

<p># highlight match (if any), and escape HTML sub esc_html_match_hl {</p>

<pre>my ($str, $regexp) = @_;
return esc_html($str) unless defined $regexp;

my @matches = matchpos_list($str, $regexp);
return esc_html($str) unless @matches;

return esc_html_hl_regions($str, &#39;match&#39;, @matches);</pre>

<p>}</p>

<p># highlight match (if any) of shortened string, and escape HTML sub
esc_html_match_hl_chopped {</p>

<pre>my ($str, $chopped, $regexp) = @_;
return esc_html_match_hl($str, $regexp) unless defined $chopped;

my @matches = matchpos_list($str, $regexp);
return esc_html($chopped) unless @matches;

# filter matches so that we mark chopped string
my $tail = &quot;... &quot;; # see chop_str
unless ($chopped =~ s/\Q$tail\E$//) {
        $tail = &#39;&#39;;
}
my $chop_len = length($chopped);
my $tail_len = length($tail);
my @filtered;

for my $m (@matches) {
        if ($m-&gt;[0] &gt; $chop_len) {
                push @filtered, [ $chop_len, $chop_len + $tail_len ] if ($tail_len &gt; 0);
                last;
        } elsif ($m-&gt;[1] &gt; $chop_len) {
                push @filtered, [ $m-&gt;[0], $chop_len + $tail_len ];
                last;
        }
        push @filtered, $m;
}

return esc_html_hl_regions($chopped . $tail, &#39;match&#39;, @filtered);</pre>

<p>}</p>

<p>## - ## functions returning short strings</p>

<p># CSS class for given age value (in seconds) sub age_class {</p>

<pre>my $age = shift;

if (!defined $age) {
        return &quot;noage&quot;;
} elsif ($age &lt; 60*60*2) {
        return &quot;age0&quot;;
} elsif ($age &lt; 60*60*24*2) {
        return &quot;age1&quot;;
} else {
        return &quot;age2&quot;;
}</pre>

<p>}</p>

<p># convert age in seconds to nn units ago string sub age_string {</p>

<pre>my $age = shift;
my $age_str;

if ($age &gt; 60*60*24*365*2) {
        $age_str = (int $age/60/60/24/365);
        $age_str .= &quot; years ago&quot;;
} elsif ($age &gt; 60*60*24*(365/12)*2) {
        $age_str = int $age/60/60/24/(365/12);
        $age_str .= &quot; months ago&quot;;
} elsif ($age &gt; 60*60*24*7*2) {
        $age_str = int $age/60/60/24/7;
        $age_str .= &quot; weeks ago&quot;;
} elsif ($age &gt; 60*60*24*2) {
        $age_str = int $age/60/60/24;
        $age_str .= &quot; days ago&quot;;
} elsif ($age &gt; 60*60*2) {
        $age_str = int $age/60/60;
        $age_str .= &quot; hours ago&quot;;
} elsif ($age &gt; 60*2) {
        $age_str = int $age/60;
        $age_str .= &quot; min ago&quot;;
} elsif ($age &gt; 2) {
        $age_str = int $age;
        $age_str .= &quot; sec ago&quot;;
} else {
        $age_str .= &quot; right now&quot;;
}
return $age_str;</pre>

<p>}</p>

<p>use constant {</p>

<pre class="ruby"><span class="ruby-constant">S_IFINVALID</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0030000</span>,
<span class="ruby-constant">S_IFGITLINK</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0160000</span>,
</pre>

<p>};</p>

<p># submodule/subproject, a commit object reference sub S_ISGITLINK {</p>

<pre>my $mode = shift;

return (($mode &amp; S_IFMT) == S_IFGITLINK)</pre>

<p>}</p>

<p># convert file mode in octal to symbolic file mode string sub mode_str {</p>

<pre>my $mode = oct shift;

if (S_ISGITLINK($mode)) {
        return &#39;m---------&#39;;
} elsif (S_ISDIR($mode &amp; S_IFMT)) {
        return &#39;drwxr-xr-x&#39;;
} elsif (S_ISLNK($mode)) {
        return &#39;lrwxrwxrwx&#39;;
} elsif (S_ISREG($mode)) {
        # git cares only about the executable bit
        if ($mode &amp; S_IXUSR) {
                return &#39;-rwxr-xr-x&#39;;
        } else {
                return &#39;-rw-r--r--&#39;;
        };
} else {
        return &#39;----------&#39;;
}</pre>

<p>}</p>

<p># convert file mode in octal to file type string sub file_type {</p>

<pre>my $mode = shift;

if ($mode !~ m/^[0-7]+$/) {
        return $mode;
} else {
        $mode = oct $mode;
}

if (S_ISGITLINK($mode)) {
        return &quot;submodule&quot;;
} elsif (S_ISDIR($mode &amp; S_IFMT)) {
        return &quot;directory&quot;;
} elsif (S_ISLNK($mode)) {
        return &quot;symlink&quot;;
} elsif (S_ISREG($mode)) {
        return &quot;file&quot;;
} else {
        return &quot;unknown&quot;;
}</pre>

<p>}</p>

<p># convert file mode in octal to file type description string sub
file_type_long {</p>

<pre>my $mode = shift;

if ($mode !~ m/^[0-7]+$/) {
        return $mode;
} else {
        $mode = oct $mode;
}

if (S_ISGITLINK($mode)) {
        return &quot;submodule&quot;;
} elsif (S_ISDIR($mode &amp; S_IFMT)) {
        return &quot;directory&quot;;
} elsif (S_ISLNK($mode)) {
        return &quot;symlink&quot;;
} elsif (S_ISREG($mode)) {
        if ($mode &amp; S_IXUSR) {
                return &quot;executable&quot;;
        } else {
                return &quot;file&quot;;
        };
} else {
        return &quot;unknown&quot;;
}</pre>

<p>}</p>

<p>## - ## functions returning short HTML fragments, or
transforming HTML fragments ## which don&#39;t belong to other sections</p>

<p># format line of commit message. sub format_log_line_html {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">shift</span>;

<span class="ruby-identifier">$line</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$line</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span>{\<span class="ruby-identifier">b</span>([<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">8</span>,<span class="ruby-value">40</span>})\<span class="ruby-identifier">b</span>}{
        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;object&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-node">$1</span>),
                                <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;text&quot;</span>}, <span class="ruby-node">$1</span>);
}<span class="ruby-identifier">eg</span>;

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$line</span>;
</pre>

<p>}</p>

<p># format marker of refs pointing to given object</p>

<p># the destination action is chosen based on object type and current
context: # - for annotated tags, we choose the tag view unless it&#39;s the
current view #   already, in which case we go to shortlog view # - for
other refs, we keep the current view if we&#39;re in history, shortlog or #
log view, and select shortlog otherwise sub format_ref_marker {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$id</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$markers</span> = <span class="ruby-string">&#39;&#39;</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$refs</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$id</span>}) {
        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ref</span> (@{<span class="ruby-identifier">$refs</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$id</span>}}) {
                <span class="ruby-comment"># this code exploits the fact that non-lightweight tags are the</span>
                <span class="ruby-comment"># only indirect objects, and that they are the only objects for which</span>
                <span class="ruby-comment"># we want to use tag instead of shortlog as action</span>
                <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$type</span>, <span class="ruby-identifier">$name</span>) = <span class="ruby-identifier">qw</span>();
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$indirect</span> = (<span class="ruby-identifier">$ref</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span>\<span class="ruby-operator">^</span>\{\}<span class="ruby-identifier">$/</span><span class="ruby-operator">/</span>);
                <span class="ruby-comment"># e.g. tags/v2.6.11 or heads/next</span>
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$ref</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span>(.<span class="ruby-operator">*</span><span class="ruby-value">?)</span><span class="ruby-identifier">s?</span><span class="ruby-operator">/</span>(.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$!</span>) {
                        <span class="ruby-identifier">$type</span> = <span class="ruby-node">$1</span>;
                        <span class="ruby-identifier">$name</span> = <span class="ruby-node">$2</span>;
                } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">$type</span> = <span class="ruby-string">&quot;ref&quot;</span>;
                        <span class="ruby-identifier">$name</span> = <span class="ruby-identifier">$ref</span>;
                }

                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$class</span> = <span class="ruby-identifier">$type</span>;
                <span class="ruby-identifier">$class</span> .= <span class="ruby-string">&quot; indirect&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$indirect</span>;

                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$dest_action</span> = <span class="ruby-string">&quot;shortlog&quot;</span>;

                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$indirect</span>) {
                        <span class="ruby-identifier">$dest_action</span> = <span class="ruby-string">&quot;tag&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$action</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;tag&quot;</span>;
                } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$action</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(history|(short)?log)$/</span>) {
                        <span class="ruby-identifier">$dest_action</span> = <span class="ruby-identifier">$action</span>;
                }

                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$dest</span> = <span class="ruby-string">&quot;&quot;</span>;
                <span class="ruby-identifier">$dest</span> .= <span class="ruby-string">&quot;refs/&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$ref</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span><span class="ruby-identifier">refs</span><span class="ruby-operator">/</span><span class="ruby-operator">!</span>;
                <span class="ruby-identifier">$dest</span> .= <span class="ruby-identifier">$ref</span>;

                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$link</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({
                        <span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(
                                <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$dest_action</span>,
                                <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$dest</span>
                        )}, <span class="ruby-identifier">$name</span>);

                <span class="ruby-identifier">$markers</span> .= <span class="ruby-string">&quot; &lt;span class=\&quot;&quot;</span>.<span class="ruby-identifier">esc_attr</span>(<span class="ruby-identifier">$class</span>).<span class="ruby-string">&quot;\&quot; title=\&quot;&quot;</span>.<span class="ruby-identifier">esc_attr</span>(<span class="ruby-identifier">$ref</span>).<span class="ruby-string">&quot;\&quot;&gt;&quot;</span> .
                        <span class="ruby-identifier">$link</span> . <span class="ruby-string">&quot;&lt;/span&gt;&quot;</span>;
        }
}

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$markers</span>) {
        <span class="ruby-keyword">return</span> <span class="ruby-string">&#39; &lt;span class=&quot;refs&quot;&gt;&#39;</span>. <span class="ruby-identifier">$markers</span> . <span class="ruby-string">&#39;&lt;/span&gt;&#39;</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>;
}
</pre>

<p>}</p>

<p># format, perhaps shortened and with markers, title line sub
format_subject_html {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$long</span>, <span class="ruby-identifier">$short</span>, <span class="ruby-identifier">$href</span>, <span class="ruby-identifier">$extra</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">$extra</span> = <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$extra</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">length</span>(<span class="ruby-identifier">$short</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">length</span>(<span class="ruby-identifier">$long</span>)) {
        <span class="ruby-identifier">$long</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span>[[:<span class="ruby-identifier">cntrl</span><span class="ruby-operator">:</span>]]<span class="ruby-operator">/</span><span class="ruby-value">?/</span><span class="ruby-identifier">g</span>;
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$href</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list subject&quot;</span>,
                        <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$long</span>)},
               <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$short</span>)) . <span class="ruby-identifier">$extra</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$href</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list subject&quot;</span>},
               <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$long</span>)) . <span class="ruby-identifier">$extra</span>;
}
</pre>

<p>}</p>

<p># Rather than recomputing the url for an email multiple times, we cache it
# after the first hit. This gives a visible benefit in views where the
avatar # for the same email is used repeatedly (e.g. shortlog). # The cache
is shared by all avatar engines (currently gravatar only), which # are free
to use it as preferred. Since only one avatar engine is used for any #
given page, there&#39;s no risk for cache conflicts. our %avatar_cache =
();</p>

<p># Compute the picon url for a given email, by using the picon search
service over at # <a
href="http://www.cs.indiana.edu/picons/search.html">www.cs.indiana.edu/picons/search.html</a>
sub picon_url {</p>

<pre>my $email = lc shift;
if (!$avatar_cache{$email}) {
        my ($user, $domain) = split(&#39;@&#39;, $email);
        $avatar_cache{$email} =
                &quot;//www.cs.indiana.edu/cgi-pub/kinzler/piconsearch.cgi/&quot; .
                &quot;$domain/$user/&quot; .
                &quot;users+domains+unknown/up/single&quot;;
}
return $avatar_cache{$email};</pre>

<p>}</p>

<p># Compute the gravatar url for a given email, if it&#39;s not in the cache
already. # Gravatar stores only the part of the URL before the size, since
that&#39;s the # one computationally more expensive. This also allows reuse
of the cache for # different sizes (for this particular engine). sub
gravatar_url {</p>

<pre>my $email = lc shift;
my $size = shift;
$avatar_cache{$email} ||=
        &quot;//www.gravatar.com/avatar/&quot; .
                Digest::MD5::md5_hex($email) . &quot;?s=&quot;;
return $avatar_cache{$email} . $size;</pre>

<p>}</p>

<p># Insert an avatar for the given $email at the given $size if the feature #
is enabled. sub git_get_avatar {</p>

<pre>my ($email, %opts) = @_;
my $pre_white  = ($opts{-pad_before} ? &quot;&amp;nbsp;&quot; : &quot;&quot;);
my $post_white = ($opts{-pad_after}  ? &quot;&amp;nbsp;&quot; : &quot;&quot;);
$opts{-size} ||= &#39;default&#39;;
my $size = $avatar_size{$opts{-size}} || $avatar_size{&#39;default&#39;};
my $url = &quot;&quot;;
if ($git_avatar eq &#39;gravatar&#39;) {
        $url = gravatar_url($email, $size);
} elsif ($git_avatar eq &#39;picon&#39;) {
        $url = picon_url($email);
}
# Other providers can be added by extending the if chain, defining $url
# as needed. If no variant puts something in $url, we assume avatars
# are completely disabled/unavailable.
if ($url) {
        return $pre_white .
               &quot;&lt;img width=\&quot;$size\&quot; &quot; .
                    &quot;class=\&quot;avatar\&quot; &quot; .
                    &quot;src=\&quot;&quot;.esc_url($url).&quot;\&quot; &quot; .
                    &quot;alt=\&quot;\&quot; &quot; .
               &quot;/&gt;&quot; . $post_white;
} else {
        return &quot;&quot;;
}</pre>

<p>}</p>

<p>sub format_search_author {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$author</span>, <span class="ruby-identifier">$searchtype</span>, <span class="ruby-identifier">$displaytext</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$have_search</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;search&#39;</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$have_search</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$performed</span> = <span class="ruby-string">&quot;&quot;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$searchtype</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;author&#39;</span>) {
                <span class="ruby-identifier">$performed</span> = <span class="ruby-string">&quot;authored&quot;</span>;
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$searchtype</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;committer&#39;</span>) {
                <span class="ruby-identifier">$performed</span> = <span class="ruby-string">&quot;committed&quot;</span>;
        }

        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;search&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                        <span class="ruby-identifier">searchtext</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$author</span>,
                        <span class="ruby-identifier">searchtype</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$searchtype</span>), <span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;list&quot;</span>,
                        <span class="ruby-identifier">title</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Search for commits $performed by $author&quot;</span>},
                        <span class="ruby-identifier">$displaytext</span>);

} <span class="ruby-keyword">else</span> {
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$displaytext</span>;
}
</pre>

<p>}</p>

<p># format the author name of the given commit with the given tag # the
author name is chopped and escaped according to the other # optional
parameters (see chop_str). sub format_author_html {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$tag</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$co</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$author</span> = <span class="ruby-identifier">chop_and_escape_str</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;author_name&#39;</span>}, <span class="ruby-ivar">@_</span>);
<span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&lt;$tag class=\&quot;author\&quot;&gt;&quot;</span> .
       <span class="ruby-identifier">format_search_author</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;author_name&#39;</span>}, <span class="ruby-string">&quot;author&quot;</span>,
               <span class="ruby-identifier">git_get_avatar</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;author_email&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">pad_after</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) .
               <span class="ruby-identifier">$author</span>) .
       <span class="ruby-string">&quot;&lt;/$tag&gt;&quot;</span>;
</pre>

<p>}</p>

<p># format git diff header line, i.e. diff (git|combined|cc)  sub
format_git_diff_header_line {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$diffinfo</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;nparents&#39;</span>}) {
        <span class="ruby-comment"># combined diff</span>
        <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-operator">^</span>(<span class="ruby-identifier">diff</span> (.<span class="ruby-operator">*</span><span class="ruby-value">?)</span> )<span class="ruby-string">&quot;?.*$!$1!;
        if ($to-&gt;{&#39;href&#39;}) {
                $line .= $cgi-&gt;a({-href =&gt; $to-&gt;{&#39;href&#39;}, -class =&gt; &quot;</span><span class="ruby-identifier">path</span><span class="ruby-node">&quot;},
                                 esc_path($to-&gt;{&#39;file&#39;}));
        } else { # file was deleted (no href)
                $line .= esc_path($to-&gt;{&#39;file&#39;});
        }
} else {
        # &quot;</span><span class="ruby-identifier">ordinary</span><span class="ruby-string">&quot; diff
        $line =~ s!^(diff (.*?) )&quot;</span><span class="ruby-operator">?</span><span class="ruby-identifier">a</span><span class="ruby-operator">/</span>.<span class="ruby-operator">*</span><span class="ruby-identifier">$!</span><span class="ruby-node">$1</span><span class="ruby-operator">!</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
                <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;path&quot;</span>},
                                 <span class="ruby-string">&#39;a/&#39;</span> . <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}));
        } <span class="ruby-keyword">else</span> { <span class="ruby-comment"># file was added (no href)</span>
                <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&#39;a/&#39;</span> . <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>});
        }
        <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&#39; &#39;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
                <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;path&quot;</span>},
                                 <span class="ruby-string">&#39;b/&#39;</span> . <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}));
        } <span class="ruby-keyword">else</span> { <span class="ruby-comment"># file was deleted</span>
                <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&#39;b/&#39;</span> . <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>});
        }
}

<span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&lt;div class=\&quot;diff header\&quot;&gt;$line&lt;/div&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p># format extended diff header line, before patch itself sub
format_extended_diff_header_line {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$diffinfo</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-comment"># match &lt;path&gt;</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-operator">^</span>((<span class="ruby-identifier">copy</span><span class="ruby-operator">|</span><span class="ruby-identifier">rename</span>) <span class="ruby-identifier">from</span> ).<span class="ruby-operator">*</span><span class="ruby-identifier">$!</span><span class="ruby-node">$1</span><span class="ruby-operator">!</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
        <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;path&quot;</span>},
                               <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}));
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-operator">^</span>((<span class="ruby-identifier">copy</span><span class="ruby-operator">|</span><span class="ruby-identifier">rename</span>) <span class="ruby-identifier">to</span> ).<span class="ruby-operator">*</span><span class="ruby-identifier">$!</span><span class="ruby-node">$1</span><span class="ruby-operator">!</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
        <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;path&quot;</span>},
                         <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}));
}
<span class="ruby-comment"># match single &lt;mode&gt;</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span>\<span class="ruby-identifier">s</span>(\<span class="ruby-identifier">d</span>{<span class="ruby-value">6</span>})<span class="ruby-identifier">$/</span>) {
        <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&#39;&lt;span class=&quot;info&quot;&gt; (&#39;</span> .
                 <span class="ruby-identifier">file_type_long</span>(<span class="ruby-node">$1</span>) .
                 <span class="ruby-string">&#39;)&lt;/span&gt;&#39;</span>;
}
<span class="ruby-comment"># match &lt;hash&gt;</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-identifier">index</span> [<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>},[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-operator">/</span>) {
        <span class="ruby-comment"># can match only for combined diff</span>
        <span class="ruby-identifier">$line</span> = <span class="ruby-string">&#39;index &#39;</span>;
        <span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;nparents&#39;</span>}; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}[<span class="ruby-identifier">$i</span>]) {
                        <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}[<span class="ruby-identifier">$i</span>],
                                          <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;hash&quot;</span>},
                                         <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>}[<span class="ruby-identifier">$i</span>],<span class="ruby-value">0</span>,<span class="ruby-value">7</span>));
                } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&#39;0&#39;</span> <span class="ruby-identifier">x</span> <span class="ruby-value">7</span>;
                }
                <span class="ruby-comment"># separator</span>
                <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&#39;,&#39;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;nparents&#39;</span>} <span class="ruby-operator">-</span> <span class="ruby-value">1</span>);
        }
        <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&#39;..&#39;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
                <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;hash&quot;</span>},
                                 <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},<span class="ruby-value">0</span>,<span class="ruby-value">7</span>));
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&#39;0&#39;</span> <span class="ruby-identifier">x</span> <span class="ruby-value">7</span>;
        }

} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-identifier">index</span> [<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-operator">..</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-operator">/</span>) {
        <span class="ruby-comment"># can match only for ordinary diff</span>
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$from_link</span>, <span class="ruby-identifier">$to_link</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
                <span class="ruby-identifier">$from_link</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;hash&quot;</span>},
                                     <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>},<span class="ruby-value">0</span>,<span class="ruby-value">7</span>));
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$from_link</span> = <span class="ruby-string">&#39;0&#39;</span> <span class="ruby-identifier">x</span> <span class="ruby-value">7</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
                <span class="ruby-identifier">$to_link</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;hash&quot;</span>},
                                   <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},<span class="ruby-value">0</span>,<span class="ruby-value">7</span>));
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$to_link</span> = <span class="ruby-string">&#39;0&#39;</span> <span class="ruby-identifier">x</span> <span class="ruby-value">7</span>;
        }
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$from_id</span>, <span class="ruby-identifier">$to_id</span>) = (<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>}, <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>});
        <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-identifier">$from_id</span>\.\.<span class="ruby-identifier">$to_id</span><span class="ruby-operator">!</span><span class="ruby-identifier">$from_link</span><span class="ruby-operator">..</span><span class="ruby-identifier">$to_link</span><span class="ruby-operator">!</span>;
}

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$line</span> . <span class="ruby-string">&quot;&lt;br/&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p># format from-file/to-file diff header sub format_diff_from_to_header {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$from_line</span>, <span class="ruby-identifier">$to_line</span>, <span class="ruby-identifier">$diffinfo</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-ivar">@parents</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$result</span> = <span class="ruby-string">&#39;&#39;</span>;

<span class="ruby-identifier">$line</span> = <span class="ruby-identifier">$from_line</span>;
<span class="ruby-comment">#assert($line =~ m/^---/) if DEBUG;</span>
<span class="ruby-comment"># no extra formatting for &quot;^--- /dev/null&quot;</span>
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span> <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;nparents&#39;</span>}) {
        <span class="ruby-comment"># ordinary (single parent) diff</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span><span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-operator">-</span> <span class="ruby-string">&quot;?a/!) {
                if ($from-&gt;{&#39;href&#39;}) {
                        $line = &#39;--- a/&#39; .
                                $cgi-&gt;a({-href=&gt;$from-&gt;{&#39;href&#39;}, -class=&gt;&quot;</span><span class="ruby-identifier">path</span><span class="ruby-string">&quot;},
                                        esc_path($from-&gt;{&#39;file&#39;}));
                } else {
                        $line = &#39;--- a/&#39; .
                                esc_path($from-&gt;{&#39;file&#39;});
                }
        }
        $result .= qq!&lt;div class=&quot;</span><span class="ruby-identifier">diff</span> <span class="ruby-identifier">from_file</span><span class="ruby-node">&quot;&gt;$line&lt;/div&gt;\n!;

} else {
        # combined diff (merge commit)
        for (my $i = 0; $i &lt; $diffinfo-&gt;{&#39;nparents&#39;}; $i++) {
                if ($from-&gt;{&#39;href&#39;}[$i]) {
                        $line = &#39;--- &#39; .
                                $cgi-&gt;a({-href=&gt;href(action=&gt;&quot;</span><span class="ruby-identifier">blobdiff</span><span class="ruby-string">&quot;,
                                                     hash_parent=&gt;$diffinfo-&gt;{&#39;from_id&#39;}[$i],
                                                     hash_parent_base=&gt;$parents[$i],
                                                     file_parent=&gt;$from-&gt;{&#39;file&#39;}[$i],
                                                     hash=&gt;$diffinfo-&gt;{&#39;to_id&#39;},
                                                     hash_base=&gt;$hash,
                                                     file_name=&gt;$to-&gt;{&#39;file&#39;}),
                                         -class=&gt;&quot;</span><span class="ruby-identifier">path</span><span class="ruby-string">&quot;,
                                         -title=&gt;&quot;</span><span class="ruby-identifier">diff</span><span class="ruby-string">&quot; . ($i+1)},
                                        $i+1) .
                                &#39;/&#39; .
                                $cgi-&gt;a({-href=&gt;$from-&gt;{&#39;href&#39;}[$i], -class=&gt;&quot;</span><span class="ruby-identifier">path</span><span class="ruby-string">&quot;},
                                        esc_path($from-&gt;{&#39;file&#39;}[$i]));
                } else {
                        $line = &#39;--- /dev/null&#39;;
                }
                $result .= qq!&lt;div class=&quot;</span><span class="ruby-identifier">diff</span> <span class="ruby-identifier">from_file</span><span class="ruby-node">&quot;&gt;$line&lt;/div&gt;\n!;
        }
}

$line = $to_line;
#assert($line =~ m/^\+\+\+/) if DEBUG;
# no extra formatting for &quot;</span><span class="ruby-operator">^</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span> <span class="ruby-regexp">/dev/nu</span><span class="ruby-identifier">ll</span><span class="ruby-string">&quot;
if ($line =~ m!^\+\+\+ &quot;</span><span class="ruby-operator">?</span><span class="ruby-identifier">b</span><span class="ruby-operator">/</span><span class="ruby-operator">!</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
                <span class="ruby-identifier">$line</span> = <span class="ruby-string">&#39;+++ b/&#39;</span> .
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;path&quot;</span>},
                                <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}));
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$line</span> = <span class="ruby-string">&#39;+++ b/&#39;</span> .
                        <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>});
        }
}
<span class="ruby-identifier">$result</span> .= <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">div</span> <span class="ruby-identifier">class</span>=<span class="ruby-string">&quot;diff to_file&quot;</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">$line</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/div&gt;\n!;

return $result;
</span></pre>

<p>}</p>

<p># create note for patch simplified by combined diff sub
format_diff_cc_simplified {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$diffinfo</span>, <span class="ruby-ivar">@parents</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$result</span> = <span class="ruby-string">&#39;&#39;</span>;

<span class="ruby-identifier">$result</span> .= <span class="ruby-string">&quot;&lt;div class=\&quot;diff header\&quot;&gt;&quot;</span> .
           <span class="ruby-string">&quot;diff --cc &quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">is_deleted</span>(<span class="ruby-identifier">$diffinfo</span>)) {
        <span class="ruby-identifier">$result</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>,
                                          <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                          <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                          <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>}),
                            <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;path&quot;</span>},
                           <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>}));
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$result</span> .= <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>});
}
<span class="ruby-identifier">$result</span> .= <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span> . <span class="ruby-comment"># class=&quot;diff header&quot;</span>
           <span class="ruby-string">&quot;&lt;div class=\&quot;diff nodifferences\&quot;&gt;&quot;</span> .
           <span class="ruby-string">&quot;Simple merge&quot;</span> .
           <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;diff nodifferences&quot;</span>

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$result</span>;
</pre>

<p>}</p>

<p>sub diff_line_class {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$line</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-comment"># ordinary diff</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$num_sign</span> = <span class="ruby-value">1</span>;
<span class="ruby-comment"># combined diff</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$to</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ref</span>(<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;ARRAY&quot;</span>) {
        <span class="ruby-identifier">$num_sign</span> = <span class="ruby-identifier">scalar</span> @{<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}};
}

<span class="ruby-identifier">my</span> <span class="ruby-ivar">@diff_line_classifier</span> = (
        { <span class="ruby-identifier">regexp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">qr</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>\@\@{<span class="ruby-identifier">$num_sign</span>} <span class="ruby-operator">/</span>, <span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;chunk_header&quot;</span>},
        { <span class="ruby-identifier">regexp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">qr</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>\\<span class="ruby-regexp">/,               class =&gt; &quot;incomplete&quot;  },
        { regexp =&gt; qr/</span><span class="ruby-operator">^</span> {<span class="ruby-identifier">$num_sign</span>}<span class="ruby-operator">/</span>,     <span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;ctx&quot;</span> },
        <span class="ruby-comment"># classifier for context must come before classifier add/rem,</span>
        <span class="ruby-comment"># or we would have to use more complicated regexp, for example</span>
        <span class="ruby-comment"># qr/(?= {0,$m}\+)[+ ]{$num_sign}/, where $m = $num_sign - 1;</span>
        { <span class="ruby-identifier">regexp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">qr</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-operator">+</span> ]{<span class="ruby-identifier">$num_sign</span>}<span class="ruby-operator">/</span>,   <span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;add&quot;</span> },
        { <span class="ruby-identifier">regexp</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">qr</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-operator">-</span> ]{<span class="ruby-identifier">$num_sign</span>}<span class="ruby-operator">/</span>,   <span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;rem&quot;</span> },
);
<span class="ruby-keyword">for</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$clsfy</span> (<span class="ruby-ivar">@diff_line_classifier</span>) {
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$clsfy</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;class&#39;</span>}
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">$clsfy</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;regexp&#39;</span>});
}

<span class="ruby-comment"># fallback</span>
<span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>;
</pre>

<p>}</p>

<p># assumes that $from and $to are defined and correctly filled, # and that
$line holds a line of chunk header for unified diff sub
format_unidiff_chunk_header {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$line</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$from_text</span>, <span class="ruby-identifier">$from_start</span>, <span class="ruby-identifier">$from_lines</span>, <span class="ruby-identifier">$to_text</span>, <span class="ruby-identifier">$to_start</span>, <span class="ruby-identifier">$to_lines</span>, <span class="ruby-identifier">$section</span>) =
        <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>\@{<span class="ruby-value">2</span>} (<span class="ruby-operator">-</span>(\<span class="ruby-identifier">d</span><span class="ruby-operator">+</span>)(<span class="ruby-value">?:</span>,(\<span class="ruby-identifier">d</span><span class="ruby-operator">+</span>))<span class="ruby-operator">?</span>) (\<span class="ruby-operator">+</span>(\<span class="ruby-identifier">d</span><span class="ruby-operator">+</span>)(<span class="ruby-value">?:</span>,(\<span class="ruby-identifier">d</span><span class="ruby-operator">+</span>))<span class="ruby-operator">?</span>) \@{<span class="ruby-value">2</span>}(.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$/</span>;

<span class="ruby-identifier">$from_lines</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from_lines</span>;
<span class="ruby-identifier">$to_lines</span>   = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$to_lines</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
        <span class="ruby-identifier">$from_text</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;$from-&gt;{&#39;href&#39;}#l$from_start&quot;</span>,
                             <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">$from_text</span>);
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
        <span class="ruby-identifier">$to_text</span>   = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;$to-&gt;{&#39;href&#39;}#l$to_start&quot;</span>,
                             <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">$to_text</span>);
}
<span class="ruby-identifier">$line</span> = <span class="ruby-string">&quot;&lt;span class=\&quot;chunk_info\&quot;&gt;@@ $from_text $to_text @@&lt;/span&gt;&quot;</span> .
        <span class="ruby-string">&quot;&lt;span class=\&quot;section\&quot;&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$section</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>) . <span class="ruby-string">&quot;&lt;/span&gt;&quot;</span>;
<span class="ruby-keyword">return</span> <span class="ruby-identifier">$line</span>;
</pre>

<p>}</p>

<p># assumes that $from and $to are defined and correctly filled, # and that
$line holds a line of chunk header for combined diff sub
format_cc_diff_chunk_header {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$line</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$prefix</span>, <span class="ruby-identifier">$ranges</span>, <span class="ruby-identifier">$section</span>) = <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>(\@<span class="ruby-operator">+</span>) (.<span class="ruby-operator">*</span><span class="ruby-value">?)</span> \@<span class="ruby-operator">+</span>(.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$/</span>;
<span class="ruby-identifier">my</span> (<span class="ruby-ivar">@from_text</span>, <span class="ruby-ivar">@from_start</span>, <span class="ruby-ivar">@from_nlines</span>, <span class="ruby-identifier">$to_text</span>, <span class="ruby-identifier">$to_start</span>, <span class="ruby-identifier">$to_nlines</span>);

<span class="ruby-ivar">@from_text</span> = <span class="ruby-identifier">split</span>(<span class="ruby-string">&#39; &#39;</span>, <span class="ruby-identifier">$ranges</span>);
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@from_text</span>; <span class="ruby-operator">+</span><span class="ruby-operator">+</span><span class="ruby-identifier">$i</span>) {
        (<span class="ruby-identifier">$from_start</span>[<span class="ruby-identifier">$i</span>], <span class="ruby-identifier">$from_nlines</span>[<span class="ruby-identifier">$i</span>]) =
                (<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>, <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$from_text</span>[<span class="ruby-identifier">$i</span>], <span class="ruby-value">1</span>)), <span class="ruby-value">0</span>);
}

<span class="ruby-identifier">$to_text</span>   = <span class="ruby-identifier">pop</span> <span class="ruby-ivar">@from_text</span>;
<span class="ruby-identifier">$to_start</span>  = <span class="ruby-identifier">pop</span> <span class="ruby-ivar">@from_start</span>;
<span class="ruby-identifier">$to_nlines</span> = <span class="ruby-identifier">pop</span> <span class="ruby-ivar">@from_nlines</span>;

<span class="ruby-identifier">$line</span> = <span class="ruby-string">&quot;&lt;span class=\&quot;chunk_info\&quot;&gt;$prefix &quot;</span>;
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@from_text</span>; <span class="ruby-operator">+</span><span class="ruby-operator">+</span><span class="ruby-identifier">$i</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}[<span class="ruby-identifier">$i</span>]) {
                <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;$from-&gt;{&#39;href&#39;}[$i]#l$from_start[$i]&quot;</span>,
                                  <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">$from_text</span>[<span class="ruby-identifier">$i</span>]);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$from_text</span>[<span class="ruby-identifier">$i</span>];
        }
        <span class="ruby-identifier">$line</span> .= <span class="ruby-string">&quot; &quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}) {
        <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;$to-&gt;{&#39;href&#39;}#l$to_start&quot;</span>,
                          <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">$to_text</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$line</span> .= <span class="ruby-identifier">$to_text</span>;
}
<span class="ruby-identifier">$line</span> .= <span class="ruby-string">&quot; $prefix&lt;/span&gt;&quot;</span> .
         <span class="ruby-string">&quot;&lt;span class=\&quot;section\&quot;&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$section</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>) . <span class="ruby-string">&quot;&lt;/span&gt;&quot;</span>;
<span class="ruby-keyword">return</span> <span class="ruby-identifier">$line</span>;
</pre>

<p>}</p>

<p># process patch (diff) line (not to be used for diff headers), # returning
HTML-formatted (but not wrapped) line. # If the line is passed as a
reference, it is treated as HTML and not # esc_html()&#39;ed. sub
format_diff_line {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$line</span>, <span class="ruby-identifier">$diff_class</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">ref</span>(<span class="ruby-identifier">$line</span>)) {
        <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">$$</span><span class="ruby-identifier">line</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$line</span>;
        <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">untabify</span>(<span class="ruby-identifier">$line</span>);

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$to</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>\@{<span class="ruby-value">2</span>} <span class="ruby-operator">/</span>) {
                <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">format_unidiff_chunk_header</span>(<span class="ruby-identifier">$line</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>);
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$from</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$to</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>\@{<span class="ruby-value">3</span>}<span class="ruby-operator">/</span>) {
                <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">format_cc_diff_chunk_header</span>(<span class="ruby-identifier">$line</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$line</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
        }
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$diff_classes</span> = <span class="ruby-string">&quot;diff&quot;</span>;
<span class="ruby-identifier">$diff_classes</span> .= <span class="ruby-string">&quot; $diff_class&quot;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diff_class</span>);
<span class="ruby-identifier">$line</span> = <span class="ruby-string">&quot;&lt;div class=\&quot;$diff_classes\&quot;&gt;$line&lt;/div&gt;\n&quot;</span>;

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$line</span>;
</pre>

<p>}</p>

<p># Generates undef or something like <em>snapshot</em> or snapshot
(<em>tbz2</em> <em>zip</em>), # linked.  Pass the hash of the tree/commit
to snapshot. sub format_snapshot_links {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$hash</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$num_fmts</span> = <span class="ruby-ivar">@snapshot_fmts</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$num_fmts</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) {
        <span class="ruby-comment"># A parenthesized list of links bearing format names.</span>
        <span class="ruby-comment"># e.g. &quot;snapshot (_tar.gz_ _zip_)&quot;</span>
        <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;snapshot (&quot;</span> . <span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>, <span class="ruby-identifier">map</span>
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({
                        <span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(
                                <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;snapshot&quot;</span>,
                                <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                <span class="ruby-identifier">snapshot_format</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$_</span>
                        )
                }, <span class="ruby-identifier">$known_snapshot_formats</span>{<span class="ruby-identifier">$_</span>}{<span class="ruby-string">&#39;display&#39;</span>})
        , <span class="ruby-ivar">@snapshot_fmts</span>) . <span class="ruby-string">&quot;)&quot;</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$num_fmts</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>) {
        <span class="ruby-comment"># A single &quot;snapshot&quot; link whose tooltip bears the format name.</span>
        <span class="ruby-comment"># i.e. &quot;_snapshot_&quot;</span>
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$fmt</span>) = <span class="ruby-ivar">@snapshot_fmts</span>;
        <span class="ruby-keyword">return</span>
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({
                        <span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(
                                <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;snapshot&quot;</span>,
                                <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                <span class="ruby-identifier">snapshot_format</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$fmt</span>
                        ),
                        <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;in format: $known_snapshot_formats{$fmt}{&#39;display&#39;}&quot;</span>
                }, <span class="ruby-string">&quot;snapshot&quot;</span>);
} <span class="ruby-keyword">else</span> { <span class="ruby-comment"># $num_fmts == 0</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">undef</span>;
}
</pre>

<p>}</p>

<p>## ................... ## functions returning values to be
passed, perhaps after some ## transformation, to other functions; e.g.
returning arguments to href()</p>

<p># returns hash to be passed to href to generate gitweb URL # in -title key
it returns description of link sub get_feed_info {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$format</span> = <span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;Atom&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-node">%rs = (action =&gt; lc($format));

# fee</span><span class="ruby-identifier">d</span> <span class="ruby-identifier">links</span> <span class="ruby-identifier">are</span> <span class="ruby-identifier">possible</span> <span class="ruby-identifier">only</span> <span class="ruby-keyword">for</span> <span class="ruby-identifier">project</span> <span class="ruby-identifier">views</span>
<span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$project</span>);
<span class="ruby-comment"># some views should link to OPML, or to generic project feed,</span>
<span class="ruby-comment"># or don&#39;t have specific feed yet (so they should use generic)</span>
<span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">$action</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$action</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(?:tags|heads|forks|tag|search)$/x</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$branch</span>;
<span class="ruby-comment"># branches refs uses &#39;refs/heads/&#39; prefix (fullname) to differentiate</span>
<span class="ruby-comment"># from tag links; this also makes possible to detect branch links</span>
<span class="ruby-keyword">if</span> ((<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span><span class="ruby-identifier">refs</span><span class="ruby-operator">/</span><span class="ruby-identifier">heads</span><span class="ruby-operator">/</span>(.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$!</span>) <span class="ruby-operator">||</span>
    (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span>      <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$hash</span>      <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span><span class="ruby-identifier">refs</span><span class="ruby-operator">/</span><span class="ruby-identifier">heads</span><span class="ruby-operator">/</span>(.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$!</span>)) {
        <span class="ruby-identifier">$branch</span> = <span class="ruby-node">$1</span>;
}
<span class="ruby-comment"># find log type for feed description (title)</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$type</span> = <span class="ruby-string">&#39;log&#39;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-identifier">$type</span>  = <span class="ruby-string">&quot;history of $file_name&quot;</span>;
        <span class="ruby-identifier">$type</span> .= <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$action</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;tree&#39;</span>);
        <span class="ruby-identifier">$type</span> .= <span class="ruby-string">&quot; on &#39;$branch&#39;&quot;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$branch</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$type</span> = <span class="ruby-string">&quot;log of $branch&quot;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$branch</span>);
}

<span class="ruby-identifier">$res</span>{<span class="ruby-operator">-</span><span class="ruby-identifier">title</span>} = <span class="ruby-identifier">$type</span>;
<span class="ruby-identifier">$res</span>{<span class="ruby-string">&#39;hash&#39;</span>} = (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$branch</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;refs/heads/$branch&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">undef</span>);
<span class="ruby-identifier">$res</span>{<span class="ruby-string">&#39;file_name&#39;</span>} = <span class="ruby-identifier">$file_name</span>;

<span class="ruby-keyword">return</span> <span class="ruby-regexp">%rs;
</span></pre>

<p>}</p>

<p>## - ## git utility subroutines, invoking git
commands</p>

<p># returns path to the core git executable and the git-dir parameter as
list sub git_cmd {</p>

<pre>$number_of_git_cmds++;
return $GIT, &#39;--git-dir=&#39;.$git_dir;</pre>

<p>}</p>

<p># quote the given arguments for passing them to the shell #
quote_command(command, arg 1, arg with &#39; and ! characters) #
=&gt; &#39;command&#39; &#39;arg 1&#39; &#39;arg with &#39;&#39;&#39; and
&#39;!&#39; characters&#39; # Try to avoid using this function wherever
possible. sub quote_command {</p>

<pre>return join(&#39; &#39;,
        map { my $a = $_; $a =~ s/([&#39;!])/&#39;\\$1&#39;/g; &quot;&#39;$a&#39;&quot; } @_ );</pre>

<p>}</p>

<p># get HEAD ref of given project as hash sub git_get_head_hash {</p>

<pre>return git_get_full_hash(shift, &#39;HEAD&#39;);</pre>

<p>}</p>

<p>sub git_get_full_hash {</p>

<pre>return git_get_hash(@_);</pre>

<p>}</p>

<p>sub git_get_short_hash {</p>

<pre>return git_get_hash(@_, &#39;--short=7&#39;);</pre>

<p>}</p>

<p>sub git_get_hash {</p>

<pre>my ($project, $hash, @options) = @_;
my $o_git_dir = $git_dir;
my $retval = undef;
$git_dir = &quot;$projectroot/$project&quot;;
if (open my $fd, &#39;-|&#39;, git_cmd(), &#39;rev-parse&#39;,
    &#39;--verify&#39;, &#39;-q&#39;, @options, $hash) {
        $retval = &lt;$fd&gt;;
        chomp $retval if defined $retval;
        close $fd;
}
if (defined $o_git_dir) {
        $git_dir = $o_git_dir;
}
return $retval;</pre>

<p>}</p>

<p># get type of given object sub git_get_type {</p>

<pre>my $hash = shift;

open my $fd, &quot;-|&quot;, git_cmd(), &quot;cat-file&quot;, &#39;-t&#39;, $hash or return;
my $type = &lt;$fd&gt;;
close $fd or return;
chomp $type;
return $type;</pre>

<p>}</p>

<p># repository configuration our $config_file = &#39;&#39;; our %config;</p>

<p># store multiple values for single key as anonymous array reference #
single values stored directly in the hash, not as [ &lt;value&gt; ] sub
hash_set_multi {</p>

<pre>my ($hash, $key, $value) = @_;

if (!exists $hash-&gt;{$key}) {
        $hash-&gt;{$key} = $value;
} elsif (!ref $hash-&gt;{$key}) {
        $hash-&gt;{$key} = [ $hash-&gt;{$key}, $value ];
} else {
        push @{$hash-&gt;{$key}}, $value;
}</pre>

<p>}</p>

<p># return hash of git project configuration # optionally limited to some
section, e.g. &#39;gitweb&#39; sub git_parse_project_config {</p>

<pre>my $section_regexp = shift;
my %config;

local $/ = &quot;\0&quot;;

open my $fh, &quot;-|&quot;, git_cmd(), &quot;config&quot;, &#39;-z&#39;, &#39;-l&#39;,
        or return;

while (my $keyval = &lt;$fh&gt;) {
        chomp $keyval;
        my ($key, $value) = split(/\n/, $keyval, 2);

        hash_set_multi(\%config, $key, $value)
                if (!defined $section_regexp || $key =~ /^(?:$section_regexp)\./o);
}
close $fh;

return %config;</pre>

<p>}</p>

<p># convert config value to boolean: &#39;true&#39; or &#39;false&#39; # no
value, number &gt; 0, &#39;true&#39; and &#39;yes&#39; values are true #
rest of values are treated as false (never as error) sub config_to_bool {</p>

<pre>my $val = shift;

return 1 if !defined $val;             # section.key

# strip leading and trailing whitespace
$val =~ s/^\s+//;
$val =~ s/\s+$//;

return (($val =~ /^\d+$/ &amp;&amp; $val) ||   # section.key = 1
        ($val =~ /^(?:true|yes)$/i));  # section.key = true</pre>

<p>}</p>

<p># convert config value to simple decimal number # an optional value suffix
of &#39;k&#39;, &#39;m&#39;, or &#39;g&#39; will cause the value # to be
multiplied by 1024, 1048576, or 1073741824 sub config_to_int {</p>

<pre>my $val = shift;

# strip leading and trailing whitespace
$val =~ s/^\s+//;
$val =~ s/\s+$//;

if (my ($num, $unit) = ($val =~ /^([0-9]*)([kmg])$/i)) {
        $unit = lc($unit);
        # unknown unit is treated as 1
        return $num * ($unit eq &#39;g&#39; ? 1073741824 :
                       $unit eq &#39;m&#39; ?    1048576 :
                       $unit eq &#39;k&#39; ?       1024 : 1);
}
return $val;</pre>

<p>}</p>

<p># convert config value to array reference, if needed sub config_to_multi {</p>

<pre>my $val = shift;

return ref($val) ? $val : (defined($val) ? [ $val ] : []);</pre>

<p>}</p>

<p>sub git_get_project_config {</p>

<pre>my ($key, $type) = @_;

return unless defined $git_dir;

# key sanity check
return unless ($key);
# only subsection, if exists, is case sensitive,
# and not lowercased by &#39;git config -z -l&#39;
if (my ($hi, $mi, $lo) = ($key =~ /^([^.]*)\.(.*)\.([^.]*)$/)) {
        $lo =~ s/_//g;
        $key = join(&quot;.&quot;, lc($hi), $mi, lc($lo));
        return if ($lo =~ /\W/ || $hi =~ /\W/);
} else {
        $key = lc($key);
        $key =~ s/_//g;
        return if ($key =~ /\W/);
}
$key =~ s/^gitweb\.//;

# type sanity check
if (defined $type) {
        $type =~ s/^--//;
        $type = undef
                unless ($type eq &#39;bool&#39; || $type eq &#39;int&#39;);
}

# get config
if (!defined $config_file ||
    $config_file ne &quot;$git_dir/config&quot;) {
        %config = git_parse_project_config(&#39;gitweb&#39;);
        $config_file = &quot;$git_dir/config&quot;;
}

# check if config variable (key) exists
return unless exists $config{&quot;gitweb.$key&quot;};

# ensure given type
if (!defined $type) {
        return $config{&quot;gitweb.$key&quot;};
} elsif ($type eq &#39;bool&#39;) {
        # backward compatibility: &#39;git config --bool&#39; returns true/false
        return config_to_bool($config{&quot;gitweb.$key&quot;}) ? &#39;true&#39; : &#39;false&#39;;
} elsif ($type eq &#39;int&#39;) {
        return config_to_int($config{&quot;gitweb.$key&quot;});
}
return $config{&quot;gitweb.$key&quot;};</pre>

<p>}</p>

<p># get hash of given path at given ref sub git_get_hash_by_path {</p>

<pre>my $base = shift;
my $path = shift || return undef;
my $type = shift;

$path =~ s,/+$,,;

open my $fd, &quot;-|&quot;, git_cmd(), &quot;ls-tree&quot;, $base, &quot;--&quot;, $path
        or die_error(500, &quot;Open git-ls-tree failed&quot;);
my $line = &lt;$fd&gt;;
close $fd or return undef;

if (!defined $line) {
        # there is no tree or hash given by $path at $base
        return undef;
}

#&#39;100644 blob 0fa3f3a66fb6a137f6ec2c19351ed4d807070ffa  panic.c&#39;
$line =~ m/^([0-9]+) (.+) ([0-9a-fA-F]{40})\t/;
if (defined $type &amp;&amp; $type ne $2) {
        # type doesn&#39;t match
        return undef;
}
return $3;</pre>

<p>}</p>

<p># get path of entry with given hash at given tree-ish (ref) # used to get
&#39;from&#39; filename for combined diff (merge commit) for renames sub
git_get_path_by_hash {</p>

<pre>my $base = shift || return;
my $hash = shift || return;

local $/ = &quot;\0&quot;;

open my $fd, &quot;-|&quot;, git_cmd(), &quot;ls-tree&quot;, &#39;-r&#39;, &#39;-t&#39;, &#39;-z&#39;, $base
        or return undef;
while (my $line = &lt;$fd&gt;) {
        chomp $line;

        #&#39;040000 tree 595596a6a9117ddba9fe379b6b012b558bac8423  gitweb&#39;
        #&#39;100644 blob e02e90f0429be0d2a69b76571101f20b8f75530f  gitweb/README&#39;
        if ($line =~ m/(?:[0-9]+) (?:.+) $hash\t(.+)$/) {
                close $fd;
                return $1;
        }
}
close $fd;
return undef;</pre>

<p>}</p>

<p>## ................... ## git utility functions, directly
accessing git repository</p>

<p># get the value of config variable either from file named as the variable #
itself in the repository ($GIT_DIR/$name file), or from gitweb.$name #
configuration variable in the repository config file. sub
git_get_file_or_project_config {</p>

<pre>my ($path, $name) = @_;

$git_dir = &quot;$projectroot/$path&quot;;
open my $fd, &#39;&lt;&#39;, &quot;$git_dir/$name&quot;
        or return git_get_project_config($name);
my $conf = &lt;$fd&gt;;
close $fd;
if (defined $conf) {
        chomp $conf;
}
return $conf;</pre>

<p>}</p>

<p>sub git_get_project_description {</p>

<pre>my $path = shift;
return git_get_file_or_project_config($path, &#39;description&#39;);</pre>

<p>}</p>

<p>sub git_get_project_category {</p>

<pre>my $path = shift;
return git_get_file_or_project_config($path, &#39;category&#39;);</pre>

<p>}</p>

<p># supported formats: # * $GIT_DIR/ctags/&lt;tagname&gt; file (in
&#39;ctags&#39; subdirectory) #   - if its contents is a number, use it as
tag weight, #   - otherwise add a tag with weight 1 # * $GIT_DIR/ctags
file, each line is a tag (with weight 1) #   the same value multiple times
increases tag weight # * `gitweb.ctag&#39; multi-valued repo config
variable sub git_get_project_ctags {</p>

<pre>my $project = shift;
my $ctags = {};

$git_dir = &quot;$projectroot/$project&quot;;
if (opendir my $dh, &quot;$git_dir/ctags&quot;) {
        my @files = grep { -f $_ } map { &quot;$git_dir/ctags/$_&quot; } readdir($dh);
        foreach my $tagfile (@files) {
                open my $ct, &#39;&lt;&#39;, $tagfile
                        or next;
                my $val = &lt;$ct&gt;;
                chomp $val if $val;
                close $ct;

                (my $ctag = $tagfile) =~ s#.  ##;
                if ($val =~ /^\d+$/) {
                        $ctags-&gt;{$ctag} = $val;
                } else {
                        $ctags-&gt;{$ctag} = 1;
                }
        }
        closedir $dh;

} elsif (open my $fh, &#39;&lt;&#39;, &quot;$git_dir/ctags&quot;) {
        while (my $line = &lt;$fh&gt;) {
                chomp $line;
                $ctags-&gt;{$line}++ if $line;
        }
        close $fh;

} else {
        my $taglist = config_to_multi(git_get_project_config(&#39;ctag&#39;));
        foreach my $tag (@$taglist) {
                $ctags-&gt;{$tag}++;
        }
}

return $ctags;</pre>

<p>}</p>

<p># return hash, where keys are content tags (&#39;ctags&#39;), # and values
are sum of weights of given tag in every project sub git_gather_all_ctags {</p>

<pre>my $projects = shift;
my $ctags = {};

foreach my $p (@$projects) {
        foreach my $ct (keys %{$p-&gt;{&#39;ctags&#39;}}) {
                $ctags-&gt;{$ct} += $p-&gt;{&#39;ctags&#39;}-&gt;{$ct};
        }
}

return $ctags;</pre>

<p>}</p>

<p>sub git_populate_project_tagcloud {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$ctags</span> = <span class="ruby-identifier">shift</span>;

<span class="ruby-comment"># First, merge different-cased tags; tags vote on casing</span>
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">tags_lc</span>;
<span class="ruby-identifier">foreach</span> (<span class="ruby-identifier">keys</span> <span class="ruby-string">%Qctags) {
        $</span><span class="ruby-identifier">ctags_lc</span>{<span class="ruby-identifier">lc</span> <span class="ruby-identifier">$_</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">count</span>} <span class="ruby-operator">+=</span> <span class="ruby-identifier">$ctags</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$_</span>};
        <span class="ruby-keyword">if</span> (<span class="ruby-keyword">not</span> <span class="ruby-identifier">$ctags_lc</span>{<span class="ruby-identifier">lc</span> <span class="ruby-identifier">$_</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">topcount</span>}
            <span class="ruby-keyword">or</span> <span class="ruby-identifier">$ctags_lc</span>{<span class="ruby-identifier">lc</span> <span class="ruby-identifier">$_</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">topcount</span>} <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">$ctags</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$_</span>}) {
                <span class="ruby-identifier">$ctags_lc</span>{<span class="ruby-identifier">lc</span> <span class="ruby-identifier">$_</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">topcount</span>} = <span class="ruby-identifier">$ctags</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$_</span>};
                <span class="ruby-identifier">$ctags_lc</span>{<span class="ruby-identifier">lc</span> <span class="ruby-identifier">$_</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">topname</span>} = <span class="ruby-identifier">$_</span>;
        }
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$cloud</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$matched</span> = <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;ctag&#39;</span>};
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">eval</span> { <span class="ruby-identifier">require</span> <span class="ruby-constant">HTML</span><span class="ruby-operator">::</span><span class="ruby-constant">TagCloud</span>; <span class="ruby-value">1</span>; }) {
        <span class="ruby-identifier">$cloud</span> = <span class="ruby-constant">HTML</span><span class="ruby-operator">::</span><span class="ruby-constant">TagCloud</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">new</span>;
        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ctag</span> (<span class="ruby-identifier">sort</span> <span class="ruby-identifier">keys</span> <span class="ruby-operator">%</span><span class="ruby-identifier">tags_lc</span>) {
                <span class="ruby-comment"># Pad the title with spaces so that the cloud looks</span>
                <span class="ruby-comment"># less crammed.</span>
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$title</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$ctags_lc</span>{<span class="ruby-identifier">$ctag</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">topname</span>});
                <span class="ruby-identifier">$title</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span> <span class="ruby-regexp">/&amp;nbsp;/</span><span class="ruby-identifier">g</span>;
                <span class="ruby-identifier">$title</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-regexp">/&amp;nbsp;/</span><span class="ruby-identifier">g</span>;
                <span class="ruby-identifier">$title</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-identifier">$/</span><span class="ruby-operator">&amp;</span><span class="ruby-identifier">nbsp</span>;<span class="ruby-regexp">/g;
                if (defined $matched &amp;&amp; $matched eq $ctag) {
                        $title = qq(&lt;span class=&quot;match&quot;&gt;$title&lt;/s</span><span class="ruby-identifier">pan</span><span class="ruby-operator">&gt;</span>);
                }
                <span class="ruby-identifier">$cloud</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">add</span>(<span class="ruby-identifier">$title</span>, <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>, <span class="ruby-identifier">ctag</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$ctag</span>),
                            <span class="ruby-identifier">$ctags_lc</span>{<span class="ruby-identifier">$ctag</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">count</span>});
        }
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$cloud</span> = {};
        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ctag</span> (<span class="ruby-identifier">keys</span> <span class="ruby-operator">%</span><span class="ruby-identifier">tags_lc</span>) {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$title</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$ctags_lc</span>{<span class="ruby-identifier">$ctag</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">topname</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$matched</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$matched</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$ctag</span>) {
                        <span class="ruby-identifier">$title</span> = <span class="ruby-identifier">qq</span>(<span class="ruby-operator">&lt;</span><span class="ruby-identifier">span</span> <span class="ruby-identifier">class</span>=<span class="ruby-string">&quot;match&quot;</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">$title</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/span&gt;);
                }
                $cloud-&gt;{$ctag}{count} = $ctags_lc{$ctag}-&gt;{count};
                $cloud-&gt;{$ctag}{ctag} =
                        $cgi-&gt;a({-href=&gt;href(project=&gt;undef, ctag=&gt;$ctag)}, $title);
        }
}
return $cloud;
</span></pre>

<p>}</p>

<p>sub git_show_project_tagcloud {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$cloud</span>, <span class="ruby-identifier">$count</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">ref</span> <span class="ruby-identifier">$cloud</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;HTML::TagCloud&#39;</span>) {
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">$cloud</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">html_and_css</span>(<span class="ruby-identifier">$count</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">my</span> <span class="ruby-ivar">@tags</span> = <span class="ruby-identifier">sort</span> { <span class="ruby-identifier">$cloud</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$a</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;count&#39;</span>} <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">$cloud</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$b</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;count&#39;</span>} } <span class="ruby-identifier">keys</span> <span class="ruby-operator">%</span><span class="ruby-identifier">$cloud</span>;
        <span class="ruby-keyword">return</span>
                <span class="ruby-string">&#39;&lt;div id=&quot;htmltagcloud&quot;&#39;</span>.(<span class="ruby-identifier">$project</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39; align=&quot;center&quot;&#39;</span>).<span class="ruby-string">&#39;&gt;&#39;</span> .
                <span class="ruby-identifier">join</span> (<span class="ruby-string">&#39;, &#39;</span>, <span class="ruby-identifier">map</span> {
                        <span class="ruby-identifier">$cloud</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$_</span>}<span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;ctag&#39;</span>}
                } <span class="ruby-identifier">splice</span>(<span class="ruby-ivar">@tags</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">$count</span>)) .
                <span class="ruby-string">&#39;&lt;/div&gt;&#39;</span>;
}
</pre>

<p>}</p>

<p>sub git_get_project_url_list {</p>

<pre>my $path = shift;

$git_dir = &quot;$projectroot/$path&quot;;
open my $fd, &#39;&lt;&#39;, &quot;$git_dir/cloneurl&quot;
        or return wantarray ?
        @{ config_to_multi(git_get_project_config(&#39;url&#39;)) } :
           config_to_multi(git_get_project_config(&#39;url&#39;));
my @git_project_url_list = map { chomp; $_ } &lt;$fd&gt;;
close $fd;

return wantarray ? @git_project_url_list : \@git_project_url_list;</pre>

<p>}</p>

<p>sub git_get_projects_list {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$filter</span> = <span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$paranoid</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@list</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-operator">-</span><span class="ruby-identifier">d</span> <span class="ruby-identifier">$projects_list</span>) {
        <span class="ruby-comment"># search in directory</span>
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$dir</span> = <span class="ruby-identifier">$projects_list</span>;
        <span class="ruby-comment"># remove the trailing &quot;/&quot;</span>
        <span class="ruby-identifier">$dir</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-operator">/</span><span class="ruby-operator">+</span><span class="ruby-identifier">$!</span><span class="ruby-operator">!</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$pfxlen</span> = <span class="ruby-identifier">length</span>(<span class="ruby-string">&quot;$dir&quot;</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$pfxdepth</span> = (<span class="ruby-identifier">$dir</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">tr!</span><span class="ruby-operator">/</span><span class="ruby-operator">!</span><span class="ruby-operator">!</span>);
        <span class="ruby-comment"># when filtering, search only given subdirectory</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$filter</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$paranoid</span>) {
                <span class="ruby-identifier">$dir</span> .= <span class="ruby-string">&quot;/$filter&quot;</span>;
                <span class="ruby-identifier">$dir</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-operator">/</span><span class="ruby-operator">+</span><span class="ruby-identifier">$!</span><span class="ruby-operator">!</span>;
        }

        <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">Find</span><span class="ruby-operator">::</span><span class="ruby-identifier">find</span>({
                <span class="ruby-identifier">follow_fast</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-comment"># follow symbolic links</span>
                <span class="ruby-identifier">follow_skip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>, <span class="ruby-comment"># ignore duplicates</span>
                <span class="ruby-identifier">dangling_symlinks</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-comment"># ignore dangling symlinks, silently</span>
                <span class="ruby-identifier">wanted</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sub</span> {
                        <span class="ruby-comment"># global variables</span>
                        <span class="ruby-identifier">our</span> <span class="ruby-identifier">$project_maxdepth</span>;
                        <span class="ruby-identifier">our</span> <span class="ruby-identifier">$projectroot</span>;
                        <span class="ruby-comment"># skip project-list toplevel, if we get it.</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">m!</span><span class="ruby-operator">^</span>[<span class="ruby-node">/.]$!);
                        # only directories can be git repositories
                        return unless (-d $_);
                        # don&#39;t traverse too deep (Find is super slow on os x)
                        # $project_maxdepth excludes depth of $projectroot
                        if (($File::Find::name =~ tr!/</span><span class="ruby-operator">!</span><span class="ruby-operator">!</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">$pfxdepth</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$project_maxdepth</span>) {
                                <span class="ruby-identifier">$File</span><span class="ruby-operator">::</span><span class="ruby-constant">Find</span><span class="ruby-operator">::</span><span class="ruby-identifier">prune</span> = <span class="ruby-value">1</span>;
                                <span class="ruby-keyword">return</span>;
                        }

                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$path</span> = <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$File</span><span class="ruby-operator">::</span><span class="ruby-constant">Find</span><span class="ruby-operator">::</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">$pfxlen</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>);
                        <span class="ruby-comment"># paranoidly only filter here</span>
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$paranoid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$filter</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$path</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span>\<span class="ruby-constant">Q</span><span class="ruby-identifier">$filter</span>\<span class="ruby-constant">E</span><span class="ruby-operator">/</span><span class="ruby-operator">!</span>) {
                                <span class="ruby-keyword">next</span>;
                        }
                        <span class="ruby-comment"># we check related file in $projectroot</span>
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">check_export_ok</span>(<span class="ruby-string">&quot;$projectroot/$path&quot;</span>)) {
                                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@list</span>, { <span class="ruby-identifier">path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$path</span> };
                                <span class="ruby-identifier">$File</span><span class="ruby-operator">::</span><span class="ruby-constant">Find</span><span class="ruby-operator">::</span><span class="ruby-identifier">prune</span> = <span class="ruby-value">1</span>;
                        }
                },
        }, <span class="ruby-string">&quot;$dir&quot;</span>);

} <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">-</span><span class="ruby-identifier">f</span> <span class="ruby-identifier">$projects_list</span>) {
        <span class="ruby-comment"># read from file(url-encoded):</span>
        <span class="ruby-comment"># &#39;git%2Fgit.git Linus+Torvalds&#39;</span>
        <span class="ruby-comment"># &#39;libs%2Fklibc%2Fklibc.git H.+Peter+Anvin&#39;</span>
        <span class="ruby-comment"># &#39;linux%2Fhotplug%2Fudev.git Greg+Kroah-Hartman&#39;</span>
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&#39;&lt;&#39;</span>, <span class="ruby-identifier">$projects_list</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">return</span>;
<span class="ruby-constant">PROJECT</span><span class="ruby-operator">:</span>
        <span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
                <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$line</span>;
                <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$path</span>, <span class="ruby-identifier">$owner</span>) = <span class="ruby-identifier">split</span> <span class="ruby-string">&#39; &#39;</span>, <span class="ruby-identifier">$line</span>;
                <span class="ruby-identifier">$path</span> = <span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">$path</span>);
                <span class="ruby-identifier">$owner</span> = <span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">$owner</span>);
                <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$path</span>) {
                        <span class="ruby-keyword">next</span>;
                }
                <span class="ruby-comment"># if $filter is rpovided, check if $path begins with $filter</span>
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$filter</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$path</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span>\<span class="ruby-constant">Q</span><span class="ruby-identifier">$filter</span>\<span class="ruby-constant">E</span><span class="ruby-operator">/</span><span class="ruby-operator">!</span>) {
                        <span class="ruby-keyword">next</span>;
                }
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">check_export_ok</span>(<span class="ruby-string">&quot;$projectroot/$path&quot;</span>)) {
                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$pr</span> = {
                                <span class="ruby-identifier">path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$path</span>
                        };
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$owner</span>) {
                                <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;owner&#39;</span>} = <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$owner</span>);
                        }
                        <span class="ruby-identifier">push</span> <span class="ruby-ivar">@list</span>, <span class="ruby-identifier">$pr</span>;
                }
        }
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>;
}
<span class="ruby-keyword">return</span> <span class="ruby-ivar">@list</span>;
</pre>

<p>}</p>

<p># written with help of Tree::Trie module (Perl Artistic <a
href="../compat/nedmalloc/License_txt.html">License</a>, GPL compatibile) #
as side effects it sets &#39;forks&#39; field to list of forks for forked
projects sub filter_forks_from_projects_list {</p>

<pre>       my $projects = shift;

       my %trie; # prefix tree of directories (path components)
       # generate trie out of those directories that might contain forks
       foreach my $pr (@$projects) {
               my $path = $pr-&gt;{&#39;path&#39;};
               $path =~ s/\.git$//;      # forks of &#39;repo.git&#39; are in &#39;repo/&#39; directory
               next if ($path =~ m!/$!); # skip non-bare repositories, e.g. &#39;repo/.git&#39;
               next unless ($path);      # skip &#39;.git&#39; repository: tests, git-instaweb
               next unless (-d &quot;$projectroot/$path&quot;); # containing directory exists
               $pr-&gt;{&#39;forks&#39;} = [];      # there can be 0 or more forks of project

               # add to trie
               my @dirs = split(&#39;/&#39;, $path);
               # walk the trie, until either runs out of components or out of trie
               my $ref = \%trie;
               while (scalar @dirs &amp;&amp;
                      exists($ref-&gt;{$dirs[0]})) {
                       $ref = $ref-&gt;{shift @dirs};
               }
               # create rest of trie structure from rest of components
               foreach my $dir (@dirs) {
                       $ref = $ref-&gt;{$dir} = {};
               }
               # create end marker, store $pr as a data
               $ref-&gt;{&#39;&#39;} = $pr if (!exists $ref-&gt;{&#39;&#39;});
       }

       # filter out forks, by finding shortest prefix match for paths
       my @filtered;
PROJECT:
       foreach my $pr (@$projects) {
               # trie lookup
               my $ref = \%trie;
       DIR:
               foreach my $dir (split(&#39;/&#39;, $pr-&gt;{&#39;path&#39;})) {
                       if (exists $ref-&gt;{&#39;&#39;}) {
                               # found [shortest] prefix, is a fork - skip it
                               push @{$ref-&gt;{&#39;&#39;}{&#39;forks&#39;}}, $pr;
                               next PROJECT;
                       }
                       if (!exists $ref-&gt;{$dir}) {
                               # not in trie, cannot have prefix, not a fork
                               push @filtered, $pr;
                               next PROJECT;
                       }
                       # If the dir is there, we just walk one step down the trie.
                       $ref = $ref-&gt;{$dir};
               }
               # we ran out of trie
               # (shouldn&#39;t happen: it&#39;s either no match, or end marker)
               push @filtered, $pr;
       }

       return @filtered;</pre>

<p>}</p>

<p># note: fill_project_list_info must be run first, # for
&#39;descr_long&#39; and &#39;ctags&#39; to be filled sub
search_projects_list {</p>

<pre class="ruby">       <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$projlist</span>, <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span>) = <span class="ruby-ivar">@_</span>;
       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$tagfilter</span>  = <span class="ruby-identifier">$opts</span>{<span class="ruby-string">&#39;tagfilter&#39;</span>};
       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$search_re</span> = <span class="ruby-identifier">$opts</span>{<span class="ruby-string">&#39;search_regexp&#39;</span>};

       <span class="ruby-keyword">return</span> @<span class="ruby-identifier">$projlist</span>
               <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$tagfilter</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$search_re</span>);

       <span class="ruby-comment"># searching projects require filling to be run before it;</span>
       <span class="ruby-identifier">fill_project_list_info</span>(<span class="ruby-identifier">$projlist</span>,
                              <span class="ruby-identifier">$tagfilter</span>  <span class="ruby-operator">?</span> <span class="ruby-string">&#39;ctags&#39;</span> <span class="ruby-operator">:</span> (),
                              <span class="ruby-identifier">$search_re</span> <span class="ruby-operator">?</span> (<span class="ruby-string">&#39;path&#39;</span>, <span class="ruby-string">&#39;descr&#39;</span>) <span class="ruby-operator">:</span> ());
       <span class="ruby-identifier">my</span> <span class="ruby-ivar">@projects</span>;
<span class="ruby-constant">PROJECT</span><span class="ruby-operator">:</span>
       <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$pr</span> (@<span class="ruby-identifier">$projlist</span>) {

               <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$tagfilter</span>) {
                       <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ref</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;ctags&#39;</span>}) <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;HASH&#39;</span>;
                       <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span>
                               <span class="ruby-identifier">grep</span> { <span class="ruby-identifier">lc</span>(<span class="ruby-identifier">$_</span>) <span class="ruby-identifier">eq</span> <span class="ruby-identifier">lc</span>(<span class="ruby-identifier">$tagfilter</span>) } <span class="ruby-identifier">keys</span> <span class="ruby-operator">%</span>{<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;ctags&#39;</span>}};
               }

               <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$search_re</span>) {
                       <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span>
                               <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/$search_re/</span> <span class="ruby-operator">||</span>
                               <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;descr_long&#39;</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/$search_re/</span>;
               }

               <span class="ruby-identifier">push</span> <span class="ruby-ivar">@projects</span>, <span class="ruby-identifier">$pr</span>;
       }

       <span class="ruby-keyword">return</span> <span class="ruby-ivar">@projects</span>;
</pre>

<p>}</p>

<p>our $gitweb_project_owner = undef; sub git_get_project_list_from_file {</p>

<pre>return if (defined $gitweb_project_owner);

$gitweb_project_owner = {};
# read from file (url-encoded):
# &#39;git%2Fgit.git Linus+Torvalds&#39;
# &#39;libs%2Fklibc%2Fklibc.git H.+Peter+Anvin&#39;
# &#39;linux%2Fhotplug%2Fudev.git Greg+Kroah-Hartman&#39;
if (-f $projects_list) {
        open(my $fd, &#39;&lt;&#39;, $projects_list);
        while (my $line = &lt;$fd&gt;) {
                chomp $line;
                my ($pr, $ow) = split &#39; &#39;, $line;
                $pr = unescape($pr);
                $ow = unescape($ow);
                $gitweb_project_owner-&gt;{$pr} = to_utf8($ow);
        }
        close $fd;
}</pre>

<p>}</p>

<p>sub git_get_project_owner {</p>

<pre>my $project = shift;
my $owner;

return undef unless $project;
$git_dir = &quot;$projectroot/$project&quot;;

if (!defined $gitweb_project_owner) {
        git_get_project_list_from_file();
}

if (exists $gitweb_project_owner-&gt;{$project}) {
        $owner = $gitweb_project_owner-&gt;{$project};
}
if (!defined $owner){
        $owner = git_get_project_config(&#39;owner&#39;);
}
if (!defined $owner) {
        $owner = get_file_owner(&quot;$git_dir&quot;);
}

return $owner;</pre>

<p>}</p>

<p>sub git_get_last_activity {</p>

<pre>my ($path) = @_;
my $fd;

$git_dir = &quot;$projectroot/$path&quot;;
open($fd, &quot;-|&quot;, git_cmd(), &#39;for-each-ref&#39;,
     &#39;--format=%(committer)&#39;,
     &#39;--sort=-committerdate&#39;,
     &#39;--count=1&#39;,
     &#39;refs/heads&#39;) or return;
my $most_recent = &lt;$fd&gt;;
close $fd or return;
if (defined $most_recent &amp;&amp;
    $most_recent =~ / (\d+) [-+][01]\d\d\d$/) {
        my $timestamp = $1;
        my $age = time - $timestamp;
        return ($age, age_string($age));
}
return (undef, undef);</pre>

<p>}</p>

<p># Implementation note: when a single remote is wanted, we cannot use
&#39;git # remote show -n&#39; because that command always work (assuming
it&#39;s a remote URL # if it&#39;s not defined), and we cannot use
&#39;git remote show&#39; because that would # try to make a network
roundtrip. So the only way to find if that particular # remote is defined
is to walk the list provided by &#39;git remote -v&#39; and stop if # and
when we find what we want. sub git_get_remotes_list {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$wanted</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-regexp">%rmotes</span> = ();

<span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&#39;-|&#39;</span> , <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&#39;remote&#39;</span>, <span class="ruby-string">&#39;-v&#39;</span>;
<span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$fd</span>;
<span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$remote</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
        <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$remote</span>;
        <span class="ruby-identifier">$remote</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span>\<span class="ruby-identifier">t</span>(.<span class="ruby-operator">*</span><span class="ruby-value">?)</span>\<span class="ruby-identifier">s</span><span class="ruby-operator">+</span>\((\<span class="ruby-identifier">w</span><span class="ruby-operator">+</span>)\)<span class="ruby-identifier">$!</span><span class="ruby-operator">!</span>;
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$wanted</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">$remote</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$wanted</span>;
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$url</span>, <span class="ruby-identifier">$key</span>) = (<span class="ruby-node">$1</span>, <span class="ruby-node">$2</span>);

        <span class="ruby-identifier">$remotes</span>{<span class="ruby-identifier">$remote</span>} <span class="ruby-operator">||=</span> { <span class="ruby-string">&#39;heads&#39;</span> =<span class="ruby-operator">&gt;</span> () };
        <span class="ruby-identifier">$remotes</span>{<span class="ruby-identifier">$remote</span>}{<span class="ruby-identifier">$key</span>} = <span class="ruby-identifier">$url</span>;
}
<span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">return</span>;
<span class="ruby-keyword">return</span> <span class="ruby-identifier">wantarray</span> <span class="ruby-operator">?</span> <span class="ruby-regexp">%rmotes</span> <span class="ruby-operator">:</span> \<span class="ruby-regexp">%rmotes</span>;
</pre>

<p>}</p>

<p># Takes a hash of remotes as first parameter and fills it by adding the #
available remote heads for each of the indicated remotes. sub
fill_remote_heads {</p>

<pre>my $remotes = shift;
my @heads = map { &quot;remotes/$_&quot; } keys %$remotes;
my @remoteheads = git_get_heads_list(undef, @heads);
foreach my $remote (keys %$remotes) {
        $remotes-&gt;{$remote}{&#39;heads&#39;} = [ grep {
                $_-&gt;{&#39;name&#39;} =~ s!^$remote/!!
                } @remoteheads ];
}</pre>

<p>}</p>

<p>sub git_get_references {</p>

<pre>my $type = shift || &quot;&quot;;
my %refs;
# 5dc01c595e6c6ec9ccda4f6f69c131c0dd945f8c refs/tags/v2.6.11
# c39ae07f393806ccf406ef966e9a15afc43cc36a refs/tags/v2.6.11^{}
open my $fd, &quot;-|&quot;, git_cmd(), &quot;show-ref&quot;, &quot;--dereference&quot;,
        ($type ? (&quot;--&quot;, &quot;refs/$type&quot;) : ()) # use -- &lt;pattern&gt; if $type
        or return;

while (my $line = &lt;$fd&gt;) {
        chomp $line;
        if ($line =~ m!^([0-9a-fA-F]{40})\srefs/($type.*)$!) {
                if (defined $refs{$1}) {
                        push @{$refs{$1}}, $2;
                } else {
                        $refs{$1} = [ $2 ];
                }
        }
}
close $fd or return;
return \%refs;</pre>

<p>}</p>

<p>sub git_get_rev_name_tags {</p>

<pre>my $hash = shift || return undef;

open my $fd, &quot;-|&quot;, git_cmd(), &quot;name-rev&quot;, &quot;--tags&quot;, $hash
        or return;
my $name_rev = &lt;$fd&gt;;
close $fd;

if ($name_rev =~ m|^$hash tags/(.*)$|) {
        return $1;
} else {
        # catches also &#39;$hash undefined&#39; output
        return undef;
}</pre>

<p>}</p>

<p>## - ## parse to hash functions</p>

<p>sub parse_date {</p>

<pre>my $epoch = shift;
my $tz = shift || &quot;-0000&quot;;

my %date;
my @months = (&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
my @days = (&quot;Sun&quot;, &quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, &quot;Thu&quot;, &quot;Fri&quot;, &quot;Sat&quot;);
my ($sec, $min, $hour, $mday, $mon, $year, $wday, $yday) = gmtime($epoch);
$date{&#39;hour&#39;} = $hour;
$date{&#39;minute&#39;} = $min;
$date{&#39;mday&#39;} = $mday;
$date{&#39;day&#39;} = $days[$wday];
$date{&#39;month&#39;} = $months[$mon];
$date{&#39;rfc2822&#39;}   = sprintf &quot;%s, %d %s %4d %02d:%02d:%02d +0000&quot;,
                     $days[$wday], $mday, $months[$mon], 1900+$year, $hour ,$min, $sec;
$date{&#39;mday-time&#39;} = sprintf &quot;%d %s %02d:%02d&quot;,
                     $mday, $months[$mon], $hour ,$min;
$date{&#39;iso-8601&#39;}  = sprintf &quot;%04d-%02d-%02dT%02d:%02d:%02dZ&quot;,
                     1900+$year, 1+$mon, $mday, $hour ,$min, $sec;

my ($tz_sign, $tz_hour, $tz_min) =
        ($tz =~ m/^([-+])(\d\d)(\d\d)$/);
$tz_sign = ($tz_sign eq &#39;-&#39; ? -1 : +1);
my $local = $epoch + $tz_sign*((($tz_hour*60) + $tz_min)*60);
($sec, $min, $hour, $mday, $mon, $year, $wday, $yday) = gmtime($local);
$date{&#39;hour_local&#39;} = $hour;
$date{&#39;minute_local&#39;} = $min;
$date{&#39;tz_local&#39;} = $tz;
$date{&#39;iso-tz&#39;} = sprintf(&quot;%04d-%02d-%02d %02d:%02d:%02d %s&quot;,
                          1900+$year, $mon+1, $mday,
                          $hour, $min, $sec, $tz);
return %date;</pre>

<p>}</p>

<p>sub parse_tag {</p>

<pre>my $tag_id = shift;
my %tag;
my @comment;

open my $fd, &quot;-|&quot;, git_cmd(), &quot;cat-file&quot;, &quot;tag&quot;, $tag_id or return;
$tag{&#39;id&#39;} = $tag_id;
while (my $line = &lt;$fd&gt;) {
        chomp $line;
        if ($line =~ m/^object ([0-9a-fA-F]{40})$/) {
                $tag{&#39;object&#39;} = $1;
        } elsif ($line =~ m/^type (.+)$/) {
                $tag{&#39;type&#39;} = $1;
        } elsif ($line =~ m/^tag (.+)$/) {
                $tag{&#39;name&#39;} = $1;
        } elsif ($line =~ m/^tagger (.*) ([0-9]+) (.*)$/) {
                $tag{&#39;author&#39;} = $1;
                $tag{&#39;author_epoch&#39;} = $2;
                $tag{&#39;author_tz&#39;} = $3;
                if ($tag{&#39;author&#39;} =~ m/^([^&lt;]+) &lt;([^&gt;]*)&gt;/) {
                        $tag{&#39;author_name&#39;}  = $1;
                        $tag{&#39;author_email&#39;} = $2;
                } else {
                        $tag{&#39;author_name&#39;} = $tag{&#39;author&#39;};
                }
        } elsif ($line =~ m/--BEGIN/) {
                push @comment, $line;
                last;
        } elsif ($line eq &quot;&quot;) {
                last;
        }
}
push @comment, &lt;$fd&gt;;
$tag{&#39;comment&#39;} = \@comment;
close $fd or return;
if (!defined $tag{&#39;name&#39;}) {
        return
};
return %tag</pre>

<p>}</p>

<p>sub parse_commit_text {</p>

<pre>my ($commit_text, $withparents) = @_;
my @commit_lines = split &#39;\n&#39;, $commit_text;
my %co;

pop @commit_lines; # Remove &#39;\0&#39;

if (! @commit_lines) {
        return;
}

my $header = shift @commit_lines;
if ($header !~ m/^[0-9a-fA-F]{40}/) {
        return;
}
($co{&#39;id&#39;}, my @parents) = split &#39; &#39;, $header;
while (my $line = shift @commit_lines) {
        last if $line eq &quot;\n&quot;;
        if ($line =~ m/^tree ([0-9a-fA-F]{40})$/) {
                $co{&#39;tree&#39;} = $1;
        } elsif ((!defined $withparents) &amp;&amp; ($line =~ m/^parent ([0-9a-fA-F]{40})$/)) {
                push @parents, $1;
        } elsif ($line =~ m/^author (.*) ([0-9]+) (.*)$/) {
                $co{&#39;author&#39;} = to_utf8($1);
                $co{&#39;author_epoch&#39;} = $2;
                $co{&#39;author_tz&#39;} = $3;
                if ($co{&#39;author&#39;} =~ m/^([^&lt;]+) &lt;([^&gt;]*)&gt;/) {
                        $co{&#39;author_name&#39;}  = $1;
                        $co{&#39;author_email&#39;} = $2;
                } else {
                        $co{&#39;author_name&#39;} = $co{&#39;author&#39;};
                }
        } elsif ($line =~ m/^committer (.*) ([0-9]+) (.*)$/) {
                $co{&#39;committer&#39;} = to_utf8($1);
                $co{&#39;committer_epoch&#39;} = $2;
                $co{&#39;committer_tz&#39;} = $3;
                if ($co{&#39;committer&#39;} =~ m/^([^&lt;]+) &lt;([^&gt;]*)&gt;/) {
                        $co{&#39;committer_name&#39;}  = $1;
                        $co{&#39;committer_email&#39;} = $2;
                } else {
                        $co{&#39;committer_name&#39;} = $co{&#39;committer&#39;};
                }
        }
}
if (!defined $co{&#39;tree&#39;}) {
        return;
};
$co{&#39;parents&#39;} = \@parents;
$co{&#39;parent&#39;} = $parents[0];

foreach my $title (@commit_lines) {
        $title =~ s/^    //;
        if ($title ne &quot;&quot;) {
                $co{&#39;title&#39;} = chop_str($title, 80, 5);
                # remove leading stuff of merges to make the interesting part visible
                if (length($title) &gt; 50) {
                        $title =~ s/^Automatic //;
                        $title =~ s/^merge (of|with) /Merge ... /i;
                        if (length($title) &gt; 50) {
                                $title =~ s/(http|rsync):\/\///;
                        }
                        if (length($title) &gt; 50) {
                                $title =~ s/(master|www|rsync)\.//;
                        }
                        if (length($title) &gt; 50) {
                                $title =~ s/kernel.org:?//;
                        }
                        if (length($title) &gt; 50) {
                                $title =~ s/\/pub\/scm//;
                        }
                }
                $co{&#39;title_short&#39;} = chop_str($title, 50, 5);
                last;
        }
}
if (! defined $co{&#39;title&#39;} || $co{&#39;title&#39;} eq &quot;&quot;) {
        $co{&#39;title&#39;} = $co{&#39;title_short&#39;} = &#39;(no commit message)&#39;;
}
# remove added spaces
foreach my $line (@commit_lines) {
        $line =~ s/^    //;
}
$co{&#39;comment&#39;} = \@commit_lines;

my $age = time - $co{&#39;committer_epoch&#39;};
$co{&#39;age&#39;} = $age;
$co{&#39;age_string&#39;} = age_string($age);
my ($sec, $min, $hour, $mday, $mon, $year, $wday, $yday) = gmtime($co{&#39;committer_epoch&#39;});
if ($age &gt; 60*60*24*7*2) {
        $co{&#39;age_string_date&#39;} = sprintf &quot;%4i-%02u-%02i&quot;, 1900 + $year, $mon+1, $mday;
        $co{&#39;age_string_age&#39;} = $co{&#39;age_string&#39;};
} else {
        $co{&#39;age_string_date&#39;} = $co{&#39;age_string&#39;};
        $co{&#39;age_string_age&#39;} = sprintf &quot;%4i-%02u-%02i&quot;, 1900 + $year, $mon+1, $mday;
}
return %co;</pre>

<p>}</p>

<p>sub parse_commit {</p>

<pre>my ($commit_id) = @_;
my %co;

local $/ = &quot;\0&quot;;

open my $fd, &quot;-|&quot;, git_cmd(), &quot;rev-list&quot;,
        &quot;--parents&quot;,
        &quot;--header&quot;,
        &quot;--max-count=1&quot;,
        $commit_id,
        &quot;--&quot;,
        or die_error(500, &quot;Open git-rev-list failed&quot;);
%co = parse_commit_text(&lt;$fd&gt;, 1);
close $fd;

return %co;</pre>

<p>}</p>

<p>sub parse_commits {</p>

<pre>my ($commit_id, $maxcount, $skip, $filename, @args) = @_;
my @cos;

$maxcount ||= 1;
$skip ||= 0;

local $/ = &quot;\0&quot;;

open my $fd, &quot;-|&quot;, git_cmd(), &quot;rev-list&quot;,
        &quot;--header&quot;,
        @args,
        (&quot;--max-count=&quot; . $maxcount),
        (&quot;--skip=&quot; . $skip),
        @extra_options,
        $commit_id,
        &quot;--&quot;,
        ($filename ? ($filename) : ())
        or die_error(500, &quot;Open git-rev-list failed&quot;);
while (my $line = &lt;$fd&gt;) {
        my %co = parse_commit_text($line);
        push @cos, \%co;
}
close $fd;

return wantarray ? @cos : \@cos;</pre>

<p>}</p>

<p># parse line of git-diff-tree raw output sub parse_difftree_raw_line {</p>

<pre>my $line = shift;
my %res;

# &#39;:100644 100644 03b218260e99b78c6df0ed378e59ed9205ccc96d 3b93d5e7cc7f7dd4ebed13a5cc1a4ad976fc94d8 M   ls-files.c&#39;
# &#39;:100644 100644 7f9281985086971d3877aca27704f2aaf9c448ce bc190ebc71bbd923f2b728e505408f5e54bd073a M   rev-tree.c&#39;
if ($line =~ m/^:([0-7]{6}) ([0-7]{6}) ([0-9a-fA-F]{40}) ([0-9a-fA-F]{40}) (.)([0-9]{0,3})\t(.*)$/) {
        $res{&#39;from_mode&#39;} = $1;
        $res{&#39;to_mode&#39;} = $2;
        $res{&#39;from_id&#39;} = $3;
        $res{&#39;to_id&#39;} = $4;
        $res{&#39;status&#39;} = $5;
        $res{&#39;similarity&#39;} = $6;
        if ($res{&#39;status&#39;} eq &#39;R&#39; || $res{&#39;status&#39;} eq &#39;C&#39;) { # renamed or copied
                ($res{&#39;from_file&#39;}, $res{&#39;to_file&#39;}) = map { unquote($_) } split(&quot;\t&quot;, $7);
        } else {
                $res{&#39;from_file&#39;} = $res{&#39;to_file&#39;} = $res{&#39;file&#39;} = unquote($7);
        }
}
# &#39;::100755 100755 100755 60e79ca1b01bc8b057abe17ddab484699a7f5fdb 94067cc5f73388f33722d52ae02f44692bc07490 94067cc5f73388f33722d52ae02f44692bc07490 MR git-gui/git-gui.sh&#39;
# combined diff (for merge commit)
elsif ($line =~ s/^(::+)((?:[0-7]{6} )+)((?:[0-9a-fA-F]{40} )+)([a-zA-Z]+)\t(.*)$//) {
        $res{&#39;nparents&#39;}  = length($1);
        $res{&#39;from_mode&#39;} = [ split(&#39; &#39;, $2) ];
        $res{&#39;to_mode&#39;} = pop @{$res{&#39;from_mode&#39;}};
        $res{&#39;from_id&#39;} = [ split(&#39; &#39;, $3) ];
        $res{&#39;to_id&#39;} = pop @{$res{&#39;from_id&#39;}};
        $res{&#39;status&#39;} = [ split(&#39;&#39;, $4) ];
        $res{&#39;to_file&#39;} = unquote($5);
}
# &#39;c512b523472485aef4fff9e57b229d9d243c967f&#39;
elsif ($line =~ m/^([0-9a-fA-F]{40})$/) {
        $res{&#39;commit&#39;} = $1;
}

return wantarray ? %res : \%res;</pre>

<p>}</p>

<p># wrapper: return parsed line of git-diff-tree raw output # (the argument
might be raw line, or parsed info) sub parsed_difftree_line {</p>

<pre>my $line_or_ref = shift;

if (ref($line_or_ref) eq &quot;HASH&quot;) {
        # pre-parsed (or generated by hand)
        return $line_or_ref;
} else {
        return parse_difftree_raw_line($line_or_ref);
}</pre>

<p>}</p>

<p># parse line of git-ls-tree output sub parse_ls_tree_line {</p>

<pre>my $line = shift;
my %opts = @_;
my %res;

if ($opts{&#39;-l&#39;}) {
        #&#39;100644 blob 0fa3f3a66fb6a137f6ec2c19351ed4d807070ffa   16717  panic.c&#39;
        $line =~ m/^([0-9]+) (.+) ([0-9a-fA-F]{40}) +(-|[0-9]+)\t(.+)$/s;

        $res{&#39;mode&#39;} = $1;
        $res{&#39;type&#39;} = $2;
        $res{&#39;hash&#39;} = $3;
        $res{&#39;size&#39;} = $4;
        if ($opts{&#39;-z&#39;}) {
                $res{&#39;name&#39;} = $5;
        } else {
                $res{&#39;name&#39;} = unquote($5);
        }
} else {
        #&#39;100644 blob 0fa3f3a66fb6a137f6ec2c19351ed4d807070ffa  panic.c&#39;
        $line =~ m/^([0-9]+) (.+) ([0-9a-fA-F]{40})\t(.+)$/s;

        $res{&#39;mode&#39;} = $1;
        $res{&#39;type&#39;} = $2;
        $res{&#39;hash&#39;} = $3;
        if ($opts{&#39;-z&#39;}) {
                $res{&#39;name&#39;} = $4;
        } else {
                $res{&#39;name&#39;} = unquote($4);
        }
}

return wantarray ? %res : \%res;</pre>

<p>}</p>

<p># generates <em>two</em> hashes, references to which are passed as 2 and 3
argument sub parse_from_to_diffinfo {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$diffinfo</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-ivar">@parents</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;nparents&#39;</span>}) {
        <span class="ruby-comment"># combined diff</span>
        <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>} = [];
        <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>} = [];
        <span class="ruby-identifier">fill_from_file_info</span>(<span class="ruby-identifier">$diffinfo</span>, <span class="ruby-ivar">@parents</span>)
                <span class="ruby-keyword">unless</span> <span class="ruby-identifier">exists</span> <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>};
        <span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;nparents&#39;</span>}; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
                <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}[<span class="ruby-identifier">$i</span>] =
                        <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>}[<span class="ruby-identifier">$i</span>] <span class="ruby-operator">?</span>
                                <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>}[<span class="ruby-identifier">$i</span>] <span class="ruby-operator">:</span>
                                <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>};
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>}[<span class="ruby-identifier">$i</span>] <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;A&quot;</span>) { <span class="ruby-comment"># not new (added) file</span>
                        <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}[<span class="ruby-identifier">$i</span>] = <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>,
                                                   <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parents</span>[<span class="ruby-identifier">$i</span>],
                                                   <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>}[<span class="ruby-identifier">$i</span>],
                                                   <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}[<span class="ruby-identifier">$i</span>]);
                } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>}[<span class="ruby-identifier">$i</span>] = <span class="ruby-keyword">undef</span>;
                }
        }
} <span class="ruby-keyword">else</span> {
        <span class="ruby-comment"># ordinary (not combined) diff</span>
        <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>} = <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>};
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>} <span class="ruby-identifier">ne</span> <span class="ruby-string">&quot;A&quot;</span>) { <span class="ruby-comment"># not new (added) file</span>
                <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>} = <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_parent</span>,
                                       <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>},
                                       <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>});
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">delete</span> <span class="ruby-identifier">$from</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>};
        }
}

<span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>} = <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>};
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">is_deleted</span>(<span class="ruby-identifier">$diffinfo</span>)) { <span class="ruby-comment"># file exists in result</span>
        <span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>} = <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>});
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">delete</span> <span class="ruby-identifier">$to</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;href&#39;</span>};
}
</pre>

<p>}</p>

<p>## ................... ## parse to array of hashes
functions</p>

<p>sub git_get_heads_list {</p>

<pre>my ($limit, @classes) = @_;
@classes = (&#39;heads&#39;) unless @classes;
my @patterns = map { &quot;refs/$_&quot; } @classes;
my @headslist;

open my $fd, &#39;-|&#39;, git_cmd(), &#39;for-each-ref&#39;,
        ($limit ? &#39;--count=&#39;.($limit+1) : ()), &#39;--sort=-committerdate&#39;,
        &#39;--format=%(objectname) %(refname) %(subject)%00%(committer)&#39;,
        @patterns
        or return;
while (my $line = &lt;$fd&gt;) {
        my %ref_item;

        chomp $line;
        my ($refinfo, $committerinfo) = split(/\0/, $line);
        my ($hash, $name, $title) = split(&#39; &#39;, $refinfo, 3);
        my ($committer, $epoch, $tz) =
                ($committerinfo =~ /^(.*) ([0-9]+) (.*)$/);
        $ref_item{&#39;fullname&#39;}  = $name;
        $name =~ s!^refs/(?:head|remote)s/!!;

        $ref_item{&#39;name&#39;}  = $name;
        $ref_item{&#39;id&#39;}    = $hash;
        $ref_item{&#39;title&#39;} = $title || &#39;(no commit message)&#39;;
        $ref_item{&#39;epoch&#39;} = $epoch;
        if ($epoch) {
                $ref_item{&#39;age&#39;} = age_string(time - $ref_item{&#39;epoch&#39;});
        } else {
                $ref_item{&#39;age&#39;} = &quot;unknown&quot;;
        }

        push @headslist, \%ref_item;
}
close $fd;

return wantarray ? @headslist : \@headslist;</pre>

<p>}</p>

<p>sub git_get_tags_list {</p>

<pre>my $limit = shift;
my @tagslist;

open my $fd, &#39;-|&#39;, git_cmd(), &#39;for-each-ref&#39;,
        ($limit ? &#39;--count=&#39;.($limit+1) : ()), &#39;--sort=-creatordate&#39;,
        &#39;--format=%(objectname) %(objecttype) %(refname) &#39;.
        &#39;%(*objectname) %(*objecttype) %(subject)%00%(creator)&#39;,
        &#39;refs/tags&#39;
        or return;
while (my $line = &lt;$fd&gt;) {
        my %ref_item;

        chomp $line;
        my ($refinfo, $creatorinfo) = split(/\0/, $line);
        my ($id, $type, $name, $refid, $reftype, $title) = split(&#39; &#39;, $refinfo, 6);
        my ($creator, $epoch, $tz) =
                ($creatorinfo =~ /^(.*) ([0-9]+) (.*)$/);
        $ref_item{&#39;fullname&#39;} = $name;
        $name =~ s!^refs/tags/!!;

        $ref_item{&#39;type&#39;} = $type;
        $ref_item{&#39;id&#39;} = $id;
        $ref_item{&#39;name&#39;} = $name;
        if ($type eq &quot;tag&quot;) {
                $ref_item{&#39;subject&#39;} = $title;
                $ref_item{&#39;reftype&#39;} = $reftype;
                $ref_item{&#39;refid&#39;}   = $refid;
        } else {
                $ref_item{&#39;reftype&#39;} = $type;
                $ref_item{&#39;refid&#39;}   = $id;
        }

        if ($type eq &quot;tag&quot; || $type eq &quot;commit&quot;) {
                $ref_item{&#39;epoch&#39;} = $epoch;
                if ($epoch) {
                        $ref_item{&#39;age&#39;} = age_string(time - $ref_item{&#39;epoch&#39;});
                } else {
                        $ref_item{&#39;age&#39;} = &quot;unknown&quot;;
                }
        }

        push @tagslist, \%ref_item;
}
close $fd;

return wantarray ? @tagslist : \@tagslist;</pre>

<p>}</p>

<p>## - ## filesystem-related functions</p>

<p>sub get_file_owner {</p>

<pre>my $path = shift;

my ($dev, $ino, $mode, $nlink, $st_uid, $st_gid, $rdev, $size) = stat($path);
my ($name, $passwd, $uid, $gid, $quota, $comment, $gcos, $dir, $shell) = getpwuid($st_uid);
if (!defined $gcos) {
        return undef;
}
my $owner = $gcos;
$owner =~ s/[,;].*$//;
return to_utf8($owner);</pre>

<p>}</p>

<p># assume that file exists sub insert_file {</p>

<pre>my $filename = shift;

open my $fd, &#39;&lt;&#39;, $filename;
print map { to_utf8($_) } &lt;$fd&gt;;
close $fd;</pre>

<p>}</p>

<p>## ................... ## mimetype related functions</p>

<p>sub mimetype_guess_file {</p>

<pre>my $filename = shift;
my $mimemap = shift;
-r $mimemap or return undef;

my %mimemap;
open(my $mh, &#39;&lt;&#39;, $mimemap) or return undef;
while (&lt;$mh&gt;) {
        next if m/^#/; # skip comments
        my ($mimetype, @exts) = split(/\s+/);
        foreach my $ext (@exts) {
                $mimemap{$ext} = $mimetype;
        }
}
close($mh);

$filename =~ /\.([^.]*)$/;
return $mimemap{$1};</pre>

<p>}</p>

<p>sub mimetype_guess {</p>

<pre>my $filename = shift;
my $mime;
$filename =~ /\./ or return undef;

if ($mimetypes_file) {
        my $file = $mimetypes_file;
        if ($file !~ m!^/!) { # if it is relative path
                # it is relative to project
                $file = &quot;$projectroot/$project/$file&quot;;
        }
        $mime = mimetype_guess_file($filename, $file);
}
$mime ||= mimetype_guess_file($filename, &#39;/etc/mime.types&#39;);
return $mime;</pre>

<p>}</p>

<p>sub blob_mimetype {</p>

<pre>my $fd = shift;
my $filename = shift;

if ($filename) {
        my $mime = mimetype_guess($filename);
        $mime and return $mime;
}

# just in case
return $default_blob_plain_mimetype unless $fd;

if (-T $fd) {
        return &#39;text/plain&#39;;
} elsif (! $filename) {
        return &#39;application/octet-stream&#39;;
} elsif ($filename =~ m/\.png$/i) {
        return &#39;image/png&#39;;
} elsif ($filename =~ m/\.gif$/i) {
        return &#39;image/gif&#39;;
} elsif ($filename =~ m/\.jpe?g$/i) {
        return &#39;image/jpeg&#39;;
} else {
        return &#39;application/octet-stream&#39;;
}</pre>

<p>}</p>

<p>sub blob_contenttype {</p>

<pre>my ($fd, $file_name, $type) = @_;

$type ||= blob_mimetype($fd, $file_name);
if ($type eq &#39;text/plain&#39; &amp;&amp; defined $default_text_plain_charset) {
        $type .= &quot;; charset=$default_text_plain_charset&quot;;
}

return $type;</pre>

<p>}</p>

<p># guess file syntax for syntax highlighting; return undef if no
highlighting # the name of syntax can (in the future) depend on syntax
highlighter used sub guess_file_syntax {</p>

<pre>my ($highlight, $mimetype, $file_name) = @_;
return undef unless ($highlight &amp;&amp; defined $file_name);
my $basename = basename($file_name, &#39;.in&#39;);
return $highlight_basename{$basename}
        if exists $highlight_basename{$basename};

$basename =~ /\.([^.]*)$/;
my $ext = $1 or return undef;
return $highlight_ext{$ext}
        if exists $highlight_ext{$ext};

return undef;</pre>

<p>}</p>

<p># run highlighter and return FD of its output, # or return original FD if
no highlighting sub run_highlighter {</p>

<pre>my ($fd, $highlight, $syntax) = @_;
return $fd unless ($highlight &amp;&amp; defined $syntax);

close $fd;
open $fd, quote_command(git_cmd(), &quot;cat-file&quot;, &quot;blob&quot;, $hash).&quot; | &quot;.
          quote_command($highlight_bin).
          &quot; --replace-tabs=8 --fragment --syntax $syntax |&quot;
        or die_error(500, &quot;Couldn&#39;t open file or run syntax highlighter&quot;);
return $fd;</pre>

<p>}</p>

<p>## ======================================================================
## functions printing HTML: header, footer, error page</p>

<p>sub get_page_title {</p>

<pre>my $title = to_utf8($site_name);

unless (defined $project) {
        if (defined $project_filter) {
                $title .= &quot; - projects in &#39;&quot; . esc_path($project_filter) . &quot;&#39;&quot;;
        }
        return $title;
}
$title .= &quot; - &quot; . to_utf8($project);

return $title unless (defined $action);
$title .= &quot;/$action&quot;; # $action is US-ASCII (7bit ASCII)

return $title unless (defined $file_name);
$title .= &quot; - &quot; . esc_path($file_name);
if ($action eq &quot;tree&quot; &amp;&amp; $file_name !~ m|/$|) {
        $title .= &quot;/&quot;;
}

return $title;</pre>

<p>}</p>

<p>sub get_content_type_html {</p>

<pre class="ruby"><span class="ruby-comment"># require explicit support from the UA if we are to send the page as</span>
<span class="ruby-comment"># &#39;application/xhtml+xml&#39;, otherwise send it as plain old &#39;text/html&#39;.</span>
<span class="ruby-comment"># we have to do this because MSIE sometimes globs &#39;*/*&#39;, pretending to</span>
<span class="ruby-comment"># support xhtml+xml but choking when it gets what it asked for.</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">http</span>(<span class="ruby-string">&#39;HTTP_ACCEPT&#39;</span>) <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">http</span>(<span class="ruby-string">&#39;HTTP_ACCEPT&#39;</span>) <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span>(,<span class="ruby-operator">|</span>;<span class="ruby-operator">|</span>\<span class="ruby-identifier">s</span><span class="ruby-operator">|</span><span class="ruby-operator">^</span>)<span class="ruby-identifier">application</span>\<span class="ruby-operator">/</span><span class="ruby-identifier">xhtml</span>\<span class="ruby-operator">+</span><span class="ruby-identifier">xml</span>(,<span class="ruby-operator">|</span>;<span class="ruby-operator">|</span>\<span class="ruby-identifier">s</span><span class="ruby-operator">|</span>$)<span class="ruby-operator">/</span> <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Accept</span>(<span class="ruby-string">&#39;application/xhtml+xml&#39;</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>) {
        <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;application/xhtml+xml&#39;</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;text/html&#39;</span>;
}
</pre>

<p>}</p>

<p>sub print_feed_meta {</p>

<pre class="ruby"><span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$project</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ref_params</span> = <span class="ruby-identifier">get_feed_info</span>();
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">exists</span> <span class="ruby-identifier">$href_params</span>{<span class="ruby-string">&#39;-title&#39;</span>}) {
                <span class="ruby-identifier">$href_params</span>{<span class="ruby-string">&#39;-title&#39;</span>} = <span class="ruby-string">&#39;log&#39;</span>;
        }

        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$format</span> (<span class="ruby-identifier">qw</span>(<span class="ruby-constant">RSS</span> <span class="ruby-constant">Atom</span>)) {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$type</span> = <span class="ruby-identifier">lc</span>(<span class="ruby-identifier">$format</span>);
                <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ink_attr</span> = (
                        <span class="ruby-string">&#39;-rel&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;alternate&#39;</span>,
                        <span class="ruby-string">&#39;-title&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">esc_attr</span>(<span class="ruby-string">&quot;$project - $href_params{&#39;-title&#39;} - $format feed&quot;</span>),
                        <span class="ruby-string">&#39;-type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;application/$type+xml&quot;</span>
                );

                <span class="ruby-identifier">$href_params</span>{<span class="ruby-string">&#39;extra_options&#39;</span>} = <span class="ruby-keyword">undef</span>;
                <span class="ruby-identifier">$href_params</span>{<span class="ruby-string">&#39;action&#39;</span>} = <span class="ruby-identifier">$type</span>;
                <span class="ruby-identifier">$link_attr</span>{<span class="ruby-string">&#39;-href&#39;</span>} = <span class="ruby-identifier">href</span>(<span class="ruby-operator">%</span><span class="ruby-identifier">ref_params</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;link &quot;</span>.
                      <span class="ruby-string">&quot;rel=\&quot;$link_attr{&#39;-rel&#39;}\&quot; &quot;</span>.
                      <span class="ruby-string">&quot;title=\&quot;$link_attr{&#39;-title&#39;}\&quot; &quot;</span>.
                      <span class="ruby-string">&quot;href=\&quot;$link_attr{&#39;-href&#39;}\&quot; &quot;</span>.
                      <span class="ruby-string">&quot;type=\&quot;$link_attr{&#39;-type&#39;}\&quot; &quot;</span>.
                      <span class="ruby-string">&quot;/&gt;\n&quot;</span>;

                <span class="ruby-identifier">$href_params</span>{<span class="ruby-string">&#39;extra_options&#39;</span>} = <span class="ruby-string">&#39;--no-merges&#39;</span>;
                <span class="ruby-identifier">$link_attr</span>{<span class="ruby-string">&#39;-href&#39;</span>} = <span class="ruby-identifier">href</span>(<span class="ruby-operator">%</span><span class="ruby-identifier">ref_params</span>);
                <span class="ruby-identifier">$link_attr</span>{<span class="ruby-string">&#39;-title&#39;</span>} .= <span class="ruby-string">&#39; (no merges)&#39;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;link &quot;</span>.
                      <span class="ruby-string">&quot;rel=\&quot;$link_attr{&#39;-rel&#39;}\&quot; &quot;</span>.
                      <span class="ruby-string">&quot;title=\&quot;$link_attr{&#39;-title&#39;}\&quot; &quot;</span>.
                      <span class="ruby-string">&quot;href=\&quot;$link_attr{&#39;-href&#39;}\&quot; &quot;</span>.
                      <span class="ruby-string">&quot;type=\&quot;$link_attr{&#39;-type&#39;}\&quot; &quot;</span>.
                      <span class="ruby-string">&quot;/&gt;\n&quot;</span>;
        }

} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">printf</span>(<span class="ruby-string">&#39;&lt;link rel=&quot;alternate&quot; title=&quot;%s projects list&quot; &#39;</span>.
               <span class="ruby-string">&#39;href=&quot;%s&quot; type=&quot;text/plain; charset=utf-8&quot; /&gt;&#39;</span>.<span class="ruby-string">&quot;\n&quot;</span>,
               <span class="ruby-identifier">esc_attr</span>(<span class="ruby-identifier">$site_name</span>), <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;project_index&quot;</span>));
        <span class="ruby-identifier">printf</span>(<span class="ruby-string">&#39;&lt;link rel=&quot;alternate&quot; title=&quot;%s projects feeds&quot; &#39;</span>.
               <span class="ruby-string">&#39;href=&quot;%s&quot; type=&quot;text/x-opml&quot; /&gt;&#39;</span>.<span class="ruby-string">&quot;\n&quot;</span>,
               <span class="ruby-identifier">esc_attr</span>(<span class="ruby-identifier">$site_name</span>), <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;opml&quot;</span>));
}
</pre>

<p>}</p>

<p>sub print_header_links {</p>

<pre>my $status = shift;

# print out each stylesheet that exist, providing backwards capability
# for those people who defined $stylesheet in a config file
if (defined $stylesheet) {
        print &#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;.esc_url($stylesheet).&#39;&quot;/&gt;&#39;.&quot;\n&quot;;
} else {
        foreach my $stylesheet (@stylesheets) {
                next unless $stylesheet;
                print &#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;.esc_url($stylesheet).&#39;&quot;/&gt;&#39;.&quot;\n&quot;;
        }
}
print_feed_meta()
        if ($status eq &#39;200 OK&#39;);
if (defined $favicon) {
        print qq(&lt;link rel=&quot;shortcut icon&quot; href=&quot;).esc_url($favicon).qq(&quot; type=&quot;image/png&quot; /&gt;\n);
}</pre>

<p>}</p>

<p>sub print_nav_breadcrumbs_path {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$dirprefix</span> = <span class="ruby-keyword">undef</span>;
<span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$part</span> = <span class="ruby-identifier">shift</span>) {
        <span class="ruby-identifier">$dirprefix</span> .= <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$dirprefix</span>;
        <span class="ruby-identifier">$dirprefix</span> .= <span class="ruby-identifier">$part</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,
                                     <span class="ruby-identifier">project_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$dirprefix</span>,
                                     <span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;project_list&quot;</span>)},
                      <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$part</span>)) . <span class="ruby-string">&quot; / &quot;</span>;
}
</pre>

<p>}</p>

<p>sub print_nav_breadcrumbs {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span> = <span class="ruby-ivar">@_</span>;

<span class="ruby-keyword">for</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$crumb</span> (<span class="ruby-ivar">@extra_breadcrumbs</span>, [ <span class="ruby-identifier">$home_link_str</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$home_link</span> ]) {
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">esc_url</span>(<span class="ruby-identifier">$crumb</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value">1</span>])}, <span class="ruby-identifier">$crumb</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value">0</span>]) . <span class="ruby-string">&quot; / &quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$project</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-ivar">@dirname</span> = <span class="ruby-identifier">split</span> <span class="ruby-string">&#39;/&#39;</span>, <span class="ruby-identifier">$project</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$projectbasename</span> = <span class="ruby-identifier">pop</span> <span class="ruby-ivar">@dirname</span>;
        <span class="ruby-identifier">print_nav_breadcrumbs_path</span>(<span class="ruby-ivar">@dirname</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;summary&quot;</span>)}, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$projectbasename</span>));
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$action</span>) {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$action_print</span> = <span class="ruby-identifier">$action</span> ;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$opts</span>{<span class="ruby-operator">-</span><span class="ruby-identifier">action_extra</span>}) {
                        <span class="ruby-identifier">$action_print</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$action</span>)},
                                <span class="ruby-identifier">$action</span>);
                }
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; / $action_print&quot;</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$opts</span>{<span class="ruby-operator">-</span><span class="ruby-identifier">action_extra</span>}) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; / $opts{-action_extra}&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;\n&quot;</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$project_filter</span>) {
        <span class="ruby-identifier">print_nav_breadcrumbs_path</span>(<span class="ruby-identifier">split</span> <span class="ruby-string">&#39;/&#39;</span>, <span class="ruby-identifier">$project_filter</span>);
}
</pre>

<p>}</p>

<p>sub print_search_form {</p>

<pre class="ruby"><span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$searchtext</span>) {
        <span class="ruby-identifier">$searchtext</span> = <span class="ruby-string">&quot;&quot;</span>;
}
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$search_hash</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span>) {
        <span class="ruby-identifier">$search_hash</span> = <span class="ruby-identifier">$hash_base</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span>) {
        <span class="ruby-identifier">$search_hash</span> = <span class="ruby-identifier">$hash</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$search_hash</span> = <span class="ruby-string">&quot;HEAD&quot;</span>;
}
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$action</span> = <span class="ruby-identifier">$my_uri</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$use_pathinfo</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;pathinfo&#39;</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$use_pathinfo</span>) {
        <span class="ruby-identifier">$action</span> .= <span class="ruby-string">&quot;/&quot;</span>.<span class="ruby-identifier">esc_url</span>(<span class="ruby-identifier">$project</span>);
}
<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">startform</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;get&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$action</span>) .
      <span class="ruby-string">&quot;&lt;div class=\&quot;search\&quot;&gt;\n&quot;</span> .
      (<span class="ruby-operator">!</span><span class="ruby-identifier">$use_pathinfo</span> <span class="ruby-operator">&amp;&amp;</span>
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">input</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$project</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">type</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;hidden&quot;</span>}) . <span class="ruby-string">&quot;\n&quot;</span>) .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">input</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;a&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;search&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">type</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;hidden&quot;</span>}) . <span class="ruby-string">&quot;\n&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">input</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;h&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$search_hash</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">type</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;hidden&quot;</span>}) . <span class="ruby-string">&quot;\n&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">popup_menu</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;st&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;commit&#39;</span>,
                       <span class="ruby-operator">-</span><span class="ruby-identifier">values</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-string">&#39;grep&#39;</span>, <span class="ruby-string">&#39;author&#39;</span>, <span class="ruby-string">&#39;committer&#39;</span>, <span class="ruby-string">&#39;pickaxe&#39;</span>]) .
      <span class="ruby-string">&quot; &quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;search_help&quot;</span>),
                     <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;search help&quot;</span> }, <span class="ruby-string">&quot;?&quot;</span>) . <span class="ruby-string">&quot; search:\n&quot;</span>,
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">textfield</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;s&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$searchtext</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">override</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) . <span class="ruby-string">&quot;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;span title=\&quot;Extended regular expression\&quot;&gt;&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">checkbox</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;sr&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;re&#39;</span>,
                     <span class="ruby-operator">-</span><span class="ruby-identifier">checked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$search_use_regexp</span>) .
      <span class="ruby-string">&quot;&lt;/span&gt;&quot;</span> .
      <span class="ruby-string">&quot;&lt;/div&gt;&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_form</span>() . <span class="ruby-string">&quot;\n&quot;</span>;
</pre>

<p>}</p>

<p>sub git_header_html {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$status</span> = <span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;200 OK&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$expires</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span> = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$title</span> = <span class="ruby-identifier">get_page_title</span>();
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$content_type</span> = <span class="ruby-identifier">get_content_type_html</span>();
<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">header</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">type</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$content_type</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">charset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;utf-8&#39;</span>,
                   <span class="ruby-operator">-</span><span class="ruby-identifier">status</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$status</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">expires</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$expires</span>)
        <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$opts</span>{<span class="ruby-string">&#39;-no_http_header&#39;</span>});
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$mod_perl_version</span> = <span class="ruby-identifier">$ENV</span>{<span class="ruby-string">&#39;MOD_PERL&#39;</span>} <span class="ruby-operator">?</span> <span class="ruby-string">&quot; $ENV{&#39;MOD_PERL&#39;}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&quot;</span>;
</pre>

<p>&lt;?xml version=1.0 encoding=utf-8?&gt; &lt;!DOCTYPE html PUBLIC
-//W3C//DTD XHTML 1.0 Strict//EN <a
href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</a>&gt;
&lt;html xmlns=<a
href="http://www.w3.org/1999/xhtml">www.w3.org/1999/xhtml</a>
xml:lang=en-US lang=en-US&gt; &lt;! git web interface version
$version, (C) 2005-2006, Kay Sievers &lt;kay.sievers@vrfy.org&gt;,
Christian Gierke &gt; &lt;! git core binaries version $git_version &gt;
&lt;head&gt; &lt;meta http-equiv=content-type content=$content_type;
charset=utf-8/&gt; &lt;meta name=generator content=gitweb/$version
git/$git_version$mod_perl_version/&gt; &lt;meta name=robots
content=index, nofollow/&gt; &lt;title&gt;$title&lt;/title&gt; EOF</p>

<pre class="ruby"><span class="ruby-comment"># the stylesheet, favicon etc urls won&#39;t work correctly with path_info</span>
<span class="ruby-comment"># unless we set the appropriate base URL</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$ENV</span>{<span class="ruby-string">&#39;PATH_INFO&#39;</span>}) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;base href=\&quot;&quot;</span>.<span class="ruby-identifier">esc_url</span>(<span class="ruby-identifier">$base_url</span>).<span class="ruby-string">&quot;\&quot; /&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print_header_links</span>(<span class="ruby-identifier">$status</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$site_html_head_string</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$site_html_head_string</span>);
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/head&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;body&gt;\n&quot;</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$site_header</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">-</span><span class="ruby-identifier">f</span> <span class="ruby-identifier">$site_header</span>) {
        <span class="ruby-identifier">insert_file</span>(<span class="ruby-identifier">$site_header</span>);
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_header\&quot;&gt;\n&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$logo</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">esc_url</span>(<span class="ruby-identifier">$logo_url</span>),
                       <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$logo_label</span>},
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">img</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">src</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">esc_url</span>(<span class="ruby-identifier">$logo</span>),
                                 <span class="ruby-operator">-</span><span class="ruby-identifier">width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">72</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">27</span>,
                                 <span class="ruby-operator">-</span><span class="ruby-identifier">alt</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;git&quot;</span>,
                                 <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;logo&quot;</span>}));
}
<span class="ruby-identifier">print_nav_breadcrumbs</span>(<span class="ruby-operator">%</span><span class="ruby-identifier">pts</span>);
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$have_search</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;search&#39;</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$project</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$have_search</span>) {
        <span class="ruby-identifier">print_search_form</span>();
}
</pre>

<p>}</p>

<p>sub git_footer_html {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$feed_class</span> = <span class="ruby-string">&#39;rss_logo&#39;</span>;

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_footer\&quot;&gt;\n&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$project</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$descr</span> = <span class="ruby-identifier">git_get_project_description</span>(<span class="ruby-identifier">$project</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$descr</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_footer_text\&quot;&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$descr</span>) . <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
        }

        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ref_params</span> = <span class="ruby-identifier">get_feed_info</span>();
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-operator">%</span><span class="ruby-identifier">ref_params</span>) {
                <span class="ruby-identifier">$feed_class</span> .= <span class="ruby-string">&#39; generic&#39;</span>;
        }
        <span class="ruby-identifier">$href_params</span>{<span class="ruby-string">&#39;-title&#39;</span>} <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;log&#39;</span>;

        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$format</span> (<span class="ruby-identifier">qw</span>(<span class="ruby-constant">RSS</span> <span class="ruby-constant">Atom</span>)) {
                <span class="ruby-identifier">$href_params</span>{<span class="ruby-string">&#39;action&#39;</span>} = <span class="ruby-identifier">lc</span>(<span class="ruby-identifier">$format</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">%</span><span class="ruby-identifier">ref_params</span>),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;$href_params{&#39;-title&#39;} $format feed&quot;</span>,
                              <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$feed_class</span>}, <span class="ruby-identifier">$format</span>).<span class="ruby-string">&quot;\n&quot;</span>;
        }

} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;opml&quot;</span>,
                                     <span class="ruby-identifier">project_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$project_filter</span>),
                      <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$feed_class</span>}, <span class="ruby-string">&quot;OPML&quot;</span>) . <span class="ruby-string">&quot; &quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;project_index&quot;</span>,
                                     <span class="ruby-identifier">project_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$project_filter</span>),
                      <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$feed_class</span>}, <span class="ruby-string">&quot;TXT&quot;</span>) . <span class="ruby-string">&quot;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;page_footer&quot;</span>

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$t0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;timed&#39;</span>)) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div id=\&quot;generating_info\&quot;&gt;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&#39;This page took &#39;</span>.
              <span class="ruby-string">&#39;&lt;span id=&quot;generating_time&quot; class=&quot;time_span&quot;&gt;&#39;</span>.
              <span class="ruby-identifier">tv_interval</span>(<span class="ruby-identifier">$t0</span>, [ <span class="ruby-identifier">gettimeofday</span>() ]).
              <span class="ruby-string">&#39; seconds &lt;/span&gt;&#39;</span>.
              <span class="ruby-string">&#39; and &#39;</span>.
              <span class="ruby-string">&#39;&lt;span id=&quot;generating_cmd&quot;&gt;&#39;</span>.
              <span class="ruby-identifier">$number_of_git_cmds</span>.
              <span class="ruby-string">&#39;&lt;/span&gt; git commands &#39;</span>.
              <span class="ruby-string">&quot; to generate.\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;page_footer&quot;</span>
}

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$site_footer</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">-</span><span class="ruby-identifier">f</span> <span class="ruby-identifier">$site_footer</span>) {
        <span class="ruby-identifier">insert_file</span>(<span class="ruby-identifier">$site_footer</span>);
}

<span class="ruby-identifier">print</span> <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">script</span> <span class="ruby-identifier">type</span>=<span class="ruby-string">&quot;text/javascript&quot;</span> <span class="ruby-identifier">src</span>=<span class="ruby-string">&quot;!.esc_url($javascript).qq!&quot;</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/script&gt;\n!;
if (defined $action &amp;&amp;
    $action eq &#39;blame_incremental&#39;) {
        print qq!&lt;script type=&quot;text/</span><span class="ruby-identifier">javascript</span><span class="ruby-string">&quot;&gt;\n!.
              qq!startBlame(&quot;</span><span class="ruby-operator">!</span>. <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame_data&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>) .<span class="ruby-identifier">qq!</span><span class="ruby-string">&quot;,\n!.
              qq!           &quot;</span><span class="ruby-operator">!</span>. <span class="ruby-identifier">href</span>() .<span class="ruby-identifier">qq!</span><span class="ruby-string">&quot;);\n!.
              qq!&lt;/script&gt;\n!;
} else {
        my ($jstimezone, $tz_cookie, $datetime_class) =
                gitweb_get_feature(&#39;javascript-timezone&#39;);

        print qq!&lt;script type=&quot;</span><span class="ruby-identifier">text</span><span class="ruby-operator">/</span><span class="ruby-identifier">javascript</span><span class="ruby-node">&quot;&gt;\n!.
              qq!window.onload = function () {\n!;
        if (gitweb_check_feature(&#39;javascript-actions&#39;)) {
                print qq!       fixLinks();\n!;
        }
        if ($jstimezone &amp;&amp; $tz_cookie &amp;&amp; $datetime_class) {
                print qq!       var tz_cookie = { name: &#39;$tz_cookie&#39;, expires: 14, path: &#39;/&#39; };\n!. # in days
                      qq!       onloadTZSetup(&#39;$jstimezone&#39;, tz_cookie, &#39;$datetime_class&#39;);\n!;
        }
        print qq!};\n!.
              qq!&lt;/script&gt;\n!;
}

print &quot;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/body&gt;\n&quot; .
      &quot;&lt;/</span><span class="ruby-identifier">html</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;;
</span></pre>

<p>}</p>

<p># die_error(&lt;http_status_code&gt;, &lt;error_message&gt;[,
&lt;detailed_html_description&gt;]) # Example: die_error(404, &#39;Hash not
found&#39;) # By convention, use the following status codes (as defined in
RFC 2616): # 400: Invalid or missing CGI parameters, or #      requested
object exists but has wrong type. # 403: Requested feature (like pickaxe
or snapshot) not enabled on #      this server or project. # 404:
Requested object/revision/project doesn&#39;t exist. # 500: The server
isn&#39;t configured properly, or #      an internal error occurred (e.g.
failed assertions caused by bugs), or #      an unknown error occurred
(e.g. the git binary died unexpectedly). # 503: The server is currently
unavailable (because it is overloaded, #      or down for maintenance). 
Generally, this is a temporary state. sub die_error {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$status</span> = <span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-value">500</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$error</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">shift</span>) <span class="ruby-operator">||</span> <span class="ruby-string">&quot;Internal Server Error&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$extra</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span> = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ttp_responses</span> = (
        <span class="ruby-value">400</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;400 Bad Request&#39;</span>,
        <span class="ruby-value">403</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;403 Forbidden&#39;</span>,
        <span class="ruby-value">404</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;404 Not Found&#39;</span>,
        <span class="ruby-value">500</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;500 Internal Server Error&#39;</span>,
        <span class="ruby-value">503</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;503 Service Unavailable&#39;</span>,
);
<span class="ruby-identifier">git_header_html</span>(<span class="ruby-identifier">$http_responses</span>{<span class="ruby-identifier">$status</span>}, <span class="ruby-keyword">undef</span>, <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span>);
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&quot;</span>;
</pre>

<p>&lt;div class=page_body&gt; &lt;br /&gt;&lt;br /&gt; $status - $error
&lt;br /&gt; EOF</p>

<pre>if (defined $extra) {
        print &quot;&lt;hr /&gt;\n&quot; .
              &quot;$extra\n&quot;;
}
print &quot;&lt;/div&gt;\n&quot;;

git_footer_html();
goto DONE_GITWEB
        unless ($opts{&#39;-error_handler&#39;});</pre>

<p>}</p>

<p>## - ## functions printing or outputting HTML:
navigation</p>

<p>sub git_print_page_nav {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$current</span>, <span class="ruby-identifier">$suppress</span>, <span class="ruby-identifier">$head</span>, <span class="ruby-identifier">$treehead</span>, <span class="ruby-identifier">$treebase</span>, <span class="ruby-identifier">$extra</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">$extra</span> = <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$extra</span>; <span class="ruby-comment"># pager or formats</span>

<span class="ruby-identifier">my</span> <span class="ruby-ivar">@navs</span> = <span class="ruby-identifier">qw</span>(<span class="ruby-identifier">summary</span> <span class="ruby-identifier">shortlog</span> <span class="ruby-identifier">log</span> <span class="ruby-identifier">commit</span> <span class="ruby-identifier">commitdiff</span> <span class="ruby-identifier">tree</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$suppress</span>) {
        <span class="ruby-ivar">@navs</span> = <span class="ruby-identifier">grep</span> { <span class="ruby-identifier">$_</span> <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$suppress</span> } <span class="ruby-ivar">@navs</span>;
}

<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">rg</span> = <span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$_</span>} } <span class="ruby-ivar">@navs</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$head</span>) {
        <span class="ruby-keyword">for</span> (<span class="ruby-identifier">qw</span>(<span class="ruby-identifier">commit</span> <span class="ruby-identifier">commitdiff</span>)) {
                <span class="ruby-identifier">$arg</span>{<span class="ruby-identifier">$_</span>}{<span class="ruby-string">&#39;hash&#39;</span>} = <span class="ruby-identifier">$head</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$current</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>(<span class="ruby-identifier">tree</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">log</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">shortlog</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">commit</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">commitdiff</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">search</span>)<span class="ruby-identifier">$/</span><span class="ruby-identifier">x</span>) {
                <span class="ruby-keyword">for</span> (<span class="ruby-identifier">qw</span>(<span class="ruby-identifier">shortlog</span> <span class="ruby-identifier">log</span>)) {
                        <span class="ruby-identifier">$arg</span>{<span class="ruby-identifier">$_</span>}{<span class="ruby-string">&#39;hash&#39;</span>} = <span class="ruby-identifier">$head</span>;
                }
        }
}

<span class="ruby-identifier">$arg</span>{<span class="ruby-string">&#39;tree&#39;</span>}{<span class="ruby-string">&#39;hash&#39;</span>} = <span class="ruby-identifier">$treehead</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$treehead</span>;
<span class="ruby-identifier">$arg</span>{<span class="ruby-string">&#39;tree&#39;</span>}{<span class="ruby-string">&#39;hash_base&#39;</span>} = <span class="ruby-identifier">$treebase</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$treebase</span>;

<span class="ruby-identifier">my</span> <span class="ruby-ivar">@actions</span> = <span class="ruby-identifier">gitweb_get_feature</span>(<span class="ruby-string">&#39;actions&#39;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-regexp">%rpl = (
        &#39;%&#39; =&gt; &#39;%&#39;,
        &#39;n&#39; =&gt; $proje</span><span class="ruby-identifier">ct</span>,         <span class="ruby-comment"># project name</span>
        <span class="ruby-string">&#39;f&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$git_dir</span>,         <span class="ruby-comment"># project path within filesystem</span>
        <span class="ruby-string">&#39;h&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$treehead</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>,  <span class="ruby-comment"># current hash (&#39;h&#39; parameter)</span>
        <span class="ruby-string">&#39;b&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$treebase</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>,  <span class="ruby-comment"># hash base (&#39;hb&#39; parameter)</span>
);
<span class="ruby-keyword">while</span> (<span class="ruby-ivar">@actions</span>) {
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$label</span>, <span class="ruby-identifier">$link</span>, <span class="ruby-identifier">$pos</span>) = <span class="ruby-identifier">splice</span>(<span class="ruby-ivar">@actions</span>,<span class="ruby-value">0</span>,<span class="ruby-value">3</span>);
        <span class="ruby-comment"># insert</span>
        <span class="ruby-ivar">@navs</span> = <span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$pos</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">$_</span>, <span class="ruby-identifier">$label</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">$_</span> } <span class="ruby-ivar">@navs</span>;
        <span class="ruby-comment"># munch munch</span>
        <span class="ruby-identifier">$link</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-string">%Q([%nfhb])</span><span class="ruby-operator">/</span><span class="ruby-identifier">$repl</span>{<span class="ruby-node">$1</span>}<span class="ruby-operator">/</span><span class="ruby-identifier">g</span>;
        <span class="ruby-identifier">$arg</span>{<span class="ruby-identifier">$label</span>}{<span class="ruby-string">&#39;_href&#39;</span>} = <span class="ruby-identifier">$link</span>;
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_nav\&quot;&gt;\n&quot;</span> .
        (<span class="ruby-identifier">join</span> <span class="ruby-string">&quot; | &quot;</span>,
         <span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$current</span> <span class="ruby-operator">?</span>
               <span class="ruby-identifier">$_</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">$arg</span>{<span class="ruby-identifier">$_</span>}{<span class="ruby-identifier">_href</span>} <span class="ruby-operator">?</span> <span class="ruby-identifier">$arg</span>{<span class="ruby-identifier">$_</span>}{<span class="ruby-identifier">_href</span>} <span class="ruby-operator">:</span> <span class="ruby-identifier">href</span>(<span class="ruby-string">%Q{$arg{$_}}</span>))}, <span class="ruby-string">&quot;$_&quot;</span>)
         } <span class="ruby-ivar">@navs</span>);
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;br/&gt;\n$extra&lt;br/&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p># returns a submenu for the nagivation of the refs views (tags, heads, #
remotes) with the current view disabled and the remotes view only #
available if the feature is enabled sub format_ref_views {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$current</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@ref_views</span> = <span class="ruby-identifier">qw</span>{<span class="ruby-identifier">tags</span> <span class="ruby-identifier">heads</span>};
<span class="ruby-identifier">push</span> <span class="ruby-ivar">@ref_views</span>, <span class="ruby-string">&#39;remotes&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;remote_heads&#39;</span>);
<span class="ruby-keyword">return</span> <span class="ruby-identifier">join</span> <span class="ruby-string">&quot; | &quot;</span>, <span class="ruby-identifier">map</span> {
        <span class="ruby-identifier">$_</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$current</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$_</span> <span class="ruby-operator">:</span>
        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$_</span>)}, <span class="ruby-identifier">$_</span>)
} <span class="ruby-ivar">@ref_views</span>
</pre>

<p>}</p>

<p>sub format_paging_nav {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$action</span>, <span class="ruby-identifier">$page</span>, <span class="ruby-identifier">$has_next_link</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$paging_nav</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$page</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
        <span class="ruby-identifier">$paging_nav</span> .=
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">page</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>)}, <span class="ruby-string">&quot;first&quot;</span>) .
                <span class="ruby-string">&quot; &amp;sdot; &quot;</span> .
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">page</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$page</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>),
                         <span class="ruby-operator">-</span><span class="ruby-identifier">accesskey</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Alt-p&quot;</span>}, <span class="ruby-string">&quot;prev&quot;</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$paging_nav</span> .= <span class="ruby-string">&quot;first &amp;sdot; prev&quot;</span>;
}

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$has_next_link</span>) {
        <span class="ruby-identifier">$paging_nav</span> .= <span class="ruby-string">&quot; &amp;sdot; &quot;</span> .
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">page</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$page</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>),
                         <span class="ruby-operator">-</span><span class="ruby-identifier">accesskey</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;n&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Alt-n&quot;</span>}, <span class="ruby-string">&quot;next&quot;</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$paging_nav</span> .= <span class="ruby-string">&quot; &amp;sdot; next&quot;</span>;
}

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$paging_nav</span>;
</pre>

<p>}</p>

<p>## ................... ## functions printing or outputting
HTML: div</p>

<p>sub git_print_header_div {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$action</span>, <span class="ruby-identifier">$title</span>, <span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$hash_base</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">rgs</span> = ();

<span class="ruby-identifier">$args</span>{<span class="ruby-string">&#39;action&#39;</span>} = <span class="ruby-identifier">$action</span>;
<span class="ruby-identifier">$args</span>{<span class="ruby-string">&#39;hash&#39;</span>} = <span class="ruby-identifier">$hash</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$hash</span>;
<span class="ruby-identifier">$args</span>{<span class="ruby-string">&#39;hash_base&#39;</span>} = <span class="ruby-identifier">$hash_base</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$hash_base</span>;

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;header\&quot;&gt;\n&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">%</span><span class="ruby-identifier">rgs</span>), <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;title&quot;</span>},
      <span class="ruby-identifier">$title</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$title</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">$action</span>) .
      <span class="ruby-string">&quot;\n&lt;/div&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p>sub format_repo_url {</p>

<pre>my ($name, $url) = @_;
return &quot;&lt;tr class=\&quot;metadata_url\&quot;&gt;&lt;td&gt;$name&lt;/td&gt;&lt;td&gt;$url&lt;/td&gt;&lt;/tr&gt;\n&quot;;</pre>

<p>}</p>

<p># Group output by placing it in a DIV element and adding a header. #
Options for start_div() can be provided by passing a hash reference as the
# first parameter to the function. # Options to git_print_header_div() can
be provided by passing an array # reference. This must follow the options
to start_div if they are present. # The content can be a scalar, which is
output as-is, a scalar reference, which # is output after html escaping, an
IO handle passed either as *handle or # *handle{IO}, or a function
reference. In the latter case all following # parameters will be taken as
argument to the content function call. sub git_print_section {</p>

<pre>my ($div_args, $header_args, $content);
my $arg = shift;
if (ref($arg) eq &#39;HASH&#39;) {
        $div_args = $arg;
        $arg = shift;
}
if (ref($arg) eq &#39;ARRAY&#39;) {
        $header_args = $arg;
        $arg = shift;
}
$content = $arg;

print $cgi-&gt;start_div($div_args);
git_print_header_div(@$header_args);

if (ref($content) eq &#39;CODE&#39;) {
        $content-&gt;(@_);
} elsif (ref($content) eq &#39;SCALAR&#39;) {
        print esc_html($$content);
} elsif (ref($content) eq &#39;GLOB&#39; or ref($content) eq &#39;IO::Handle&#39;) {
        print &lt;$content&gt;;
} elsif (!ref($content) &amp;&amp; defined($content)) {
        print $content;
}

print $cgi-&gt;end_div;</pre>

<p>}</p>

<p>sub format_timestamp_html {</p>

<pre>my $date = shift;
my $strtime = $date-&gt;{&#39;rfc2822&#39;};

my (undef, undef, $datetime_class) =
        gitweb_get_feature(&#39;javascript-timezone&#39;);
if ($datetime_class) {
        $strtime = qq!&lt;span class=&quot;$datetime_class&quot;&gt;$strtime&lt;/span&gt;!;
}

my $localtime_format = &#39;(%02d:%02d %s)&#39;;
if ($date-&gt;{&#39;hour_local&#39;} &lt; 6) {
        $localtime_format = &#39;(&lt;span class=&quot;atnight&quot;&gt;%02d:%02d&lt;/span&gt; %s)&#39;;
}
$strtime .= &#39; &#39; .
            sprintf($localtime_format,
                    $date-&gt;{&#39;hour_local&#39;}, $date-&gt;{&#39;minute_local&#39;}, $date-&gt;{&#39;tz_local&#39;});

return $strtime;</pre>

<p>}</p>

<p># Outputs the author name and date in long form sub git_print_authorship {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$co</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">pts</span> = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$tag</span> = <span class="ruby-identifier">$opts</span>{<span class="ruby-operator">-</span><span class="ruby-identifier">tag</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&#39;div&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$author</span> = <span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;author_name&#39;</span>};

<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">d</span> = <span class="ruby-identifier">parse_date</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;author_epoch&#39;</span>}, <span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;author_tz&#39;</span>});
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;$tag class=\&quot;author_date\&quot;&gt;&quot;</span> .
      <span class="ruby-identifier">format_search_author</span>(<span class="ruby-identifier">$author</span>, <span class="ruby-string">&quot;author&quot;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$author</span>)) .
      <span class="ruby-string">&quot; [&quot;</span>.<span class="ruby-identifier">format_timestamp_html</span>(\<span class="ruby-operator">%</span><span class="ruby-identifier">d</span>).<span class="ruby-string">&quot;]&quot;</span>.
      <span class="ruby-identifier">git_get_avatar</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;author_email&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">pad_before</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) .
      <span class="ruby-string">&quot;&lt;/$tag&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p># Outputs table rows containing the full author or committer information, #
in the format expected for &#39;commit&#39; view (&amp; similar). #
Parameters are a commit hash reference, followed by the list of people # to
output information for. If the list is empty it defaults to both # author
and committer. sub git_print_authorship_rows {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$co</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-comment"># too bad we can&#39;t use @people = @_ || (&#39;author&#39;, &#39;committer&#39;)</span>
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@people</span> = <span class="ruby-ivar">@_</span>;
<span class="ruby-ivar">@people</span> = (<span class="ruby-string">&#39;author&#39;</span>, <span class="ruby-string">&#39;committer&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@people</span>;
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$who</span> (<span class="ruby-ivar">@people</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-node">%w = parse_d</span><span class="ruby-identifier">ate</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&quot;${who}_epoch&quot;</span>}, <span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&quot;${who}_tz&quot;</span>});
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;&lt;td&gt;$who&lt;/td&gt;&lt;td&gt;&quot;</span> .
              <span class="ruby-identifier">format_search_author</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&quot;${who}_name&quot;</span>}, <span class="ruby-identifier">$who</span>,
                                   <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&quot;${who}_name&quot;</span>})) . <span class="ruby-string">&quot; &quot;</span> .
              <span class="ruby-identifier">format_search_author</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&quot;${who}_email&quot;</span>}, <span class="ruby-identifier">$who</span>,
                                   <span class="ruby-identifier">esc_html</span>(<span class="ruby-string">&quot;&lt;&quot;</span> . <span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&quot;${who}_email&quot;</span>} . <span class="ruby-string">&quot;&gt;&quot;</span>)) .
              <span class="ruby-string">&quot;&lt;/td&gt;&lt;td rowspan=\&quot;2\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">git_get_avatar</span>(<span class="ruby-identifier">$co</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&quot;${who}_email&quot;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">size</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;double&#39;</span>) .
              <span class="ruby-string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;tr&gt;&quot;</span> .
              <span class="ruby-string">&quot;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&quot;</span> .
              <span class="ruby-identifier">format_timestamp_html</span>(\<span class="ruby-node">%w) .
              &quot;&lt;/td</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot; .
              &quot;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/tr&gt;\n&quot;;
}
</span></pre>

<p>}</p>

<p>sub git_print_page_path {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$name</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$type</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$hb</span> = <span class="ruby-identifier">shift</span>;

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_path\&quot;&gt;&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hb</span>),
              <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;tree root&#39;</span>}, <span class="ruby-identifier">to_utf8</span>(<span class="ruby-string">&quot;[$project]&quot;</span>));
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot; / &quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$name</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-ivar">@dirname</span> = <span class="ruby-identifier">split</span> <span class="ruby-string">&#39;/&#39;</span>, <span class="ruby-identifier">$name</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$basename</span> = <span class="ruby-identifier">pop</span> <span class="ruby-ivar">@dirname</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fullname</span> = <span class="ruby-string">&#39;&#39;</span>;

        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$dir</span> (<span class="ruby-ivar">@dirname</span>) {
                <span class="ruby-identifier">$fullname</span> .= (<span class="ruby-identifier">$fullname</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>) . <span class="ruby-identifier">$dir</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$fullname</span>,
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hb</span>),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$fullname</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$dir</span>));
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; / &quot;</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$type</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;blob&#39;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob_plain&quot;</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>,
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hb</span>),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$name</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$basename</span>));
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$type</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;tree&#39;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>,
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hb</span>),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$name</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$basename</span>));
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; / &quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$basename</span>);
        }
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;br/&gt;&lt;/div&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p>sub git_print_log {</p>

<pre>my $log = shift;
my %opts = @_;

if ($opts{&#39;-remove_title&#39;}) {
        # remove title, i.e. first line of log
        shift @$log;
}
# remove leading empty lines
while (defined $log-&gt;[0] &amp;&amp; $log-&gt;[0] eq &quot;&quot;) {
        shift @$log;
}

# print log
my $skip_blank_line = 0;
foreach my $line (@$log) {
        if ($line =~ m/^\s*([A-Z][-A-Za-z]*-[Bb]y|C[Cc]): /) {
                if (! $opts{&#39;-remove_signoff&#39;}) {
                        print &quot;&lt;span class=\&quot;signoff\&quot;&gt;&quot; . esc_html($line) . &quot;&lt;/span&gt;&lt;br/&gt;\n&quot;;
                        $skip_blank_line = 1;
                }
                next;
        }

        if ($line =~ m,\s*([a-z]*link): (https?://\S+),i) {
                if (! $opts{&#39;-remove_signoff&#39;}) {
                        print &quot;&lt;span class=\&quot;signoff\&quot;&gt;&quot; . esc_html($1) . &quot;: &quot; .
                                &quot;&lt;a href=\&quot;&quot; . esc_html($2) . &quot;\&quot;&gt;&quot; . esc_html($2) . &quot;&lt;/a&gt;&quot; .
                                &quot;&lt;/span&gt;&lt;br/&gt;\n&quot;;
                        $skip_blank_line = 1;
                }
                next;
        }

        # print only one empty line
        # do not print empty line after signoff
        if ($line eq &quot;&quot;) {
                next if ($skip_blank_line);
                $skip_blank_line = 1;
        } else {
                $skip_blank_line = 0;
        }

        print format_log_line_html($line) . &quot;&lt;br/&gt;\n&quot;;
}

if ($opts{&#39;-final_empty_line&#39;}) {
        # end with single empty line
        print &quot;&lt;br/&gt;\n&quot; unless $skip_blank_line;
}</pre>

<p>}</p>

<p># return link target (what link points to) sub git_get_link_target {</p>

<pre>my $hash = shift;
my $link_target;

# read link
open my $fd, &quot;-|&quot;, git_cmd(), &quot;cat-file&quot;, &quot;blob&quot;, $hash
        or return;
{
        local $/ = undef;
        $link_target = &lt;$fd&gt;;
}
close $fd
        or return;

return $link_target;</pre>

<p>}</p>

<p># given link target, and the directory (basedir) the link is in, # return
target of link relative to top directory (top tree); # return undef if it
is not possible (including absolute links). sub normalize_link_target {</p>

<pre>my ($link_target, $basedir) = @_;

# absolute symlinks (beginning with &#39;/&#39;) cannot be normalized
return if (substr($link_target, 0, 1) eq &#39;/&#39;);

# normalize link target to path from top (root) tree (dir)
my $path;
if ($basedir) {
        $path = $basedir . &#39;/&#39; . $link_target;
} else {
        # we are in top (root) tree (dir)
        $path = $link_target;
}

# remove //, /./, and /../
my @path_parts;
foreach my $part (split(&#39;/&#39;, $path)) {
        # discard &#39;.&#39; and &#39;&#39;
        next if (!$part || $part eq &#39;.&#39;);
        # handle &#39;..&#39;
        if ($part eq &#39;..&#39;) {
                if (@path_parts) {
                        pop @path_parts;
                } else {
                        # link leads outside repository (outside top dir)
                        return;
                }
        } else {
                push @path_parts, $part;
        }
}
$path = join(&#39;/&#39;, @path_parts);

return $path;</pre>

<p>}</p>

<p># print tree entry (row of git_tree), but without encompassing &lt;tr&gt;
element sub git_print_tree_entry {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$t</span>, <span class="ruby-identifier">$basedir</span>, <span class="ruby-identifier">$hash_base</span>, <span class="ruby-identifier">$have_blame</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ase_key</span> = ();
<span class="ruby-identifier">$base_key</span>{<span class="ruby-string">&#39;hash_base&#39;</span>} = <span class="ruby-identifier">$hash_base</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span>;

<span class="ruby-comment"># The format of a table row is: mode list link.  Where mode is</span>
<span class="ruby-comment"># the mode of the entry, list is the name of the entry, an href,</span>
<span class="ruby-comment"># and link is the action links of the entry.</span>

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;mode\&quot;&gt;&quot;</span> . <span class="ruby-identifier">mode_str</span>(<span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;mode&#39;</span>}) . <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">exists</span> <span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;size&#39;</span>}) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;size\&quot;&gt;$t-&gt;{&#39;size&#39;}&lt;/td&gt;\n&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;type&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;blob&quot;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;list\&quot;&gt;&quot;</span> .
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;hash&#39;</span>},
                                       <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>, <span class="ruby-operator">%</span><span class="ruby-identifier">ase_key</span>),
                        <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;name&#39;</span>}));
        <span class="ruby-keyword">if</span> (<span class="ruby-constant">S_ISLNK</span>(<span class="ruby-identifier">oct</span> <span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;mode&#39;</span>})) {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$link_target</span> = <span class="ruby-identifier">git_get_link_target</span>(<span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;hash&#39;</span>});
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$link_target</span>) {
                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$norm_target</span> = <span class="ruby-identifier">normalize_link_target</span>(<span class="ruby-identifier">$link_target</span>, <span class="ruby-identifier">$basedir</span>);
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$norm_target</span>) {
                                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; -&gt; &quot;</span> .
                                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;object&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_base</span>,
                                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$norm_target</span>),
                                               <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$norm_target</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$link_target</span>));
                        } <span class="ruby-keyword">else</span> {
                                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; -&gt; &quot;</span> . <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$link_target</span>);
                        }
                }
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;hash&#39;</span>},
                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>, <span class="ruby-operator">%</span><span class="ruby-identifier">ase_key</span>)},
                      <span class="ruby-string">&quot;blob&quot;</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$have_blame</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> .
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;hash&#39;</span>},
                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>, <span class="ruby-operator">%</span><span class="ruby-identifier">ase_key</span>)},
                              <span class="ruby-string">&quot;blame&quot;</span>);
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> .
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_base</span>,
                                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;hash&#39;</span>}, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>)},
                              <span class="ruby-string">&quot;history&quot;</span>);
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> .
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob_plain&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_base</span>,
                                       <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>)},
                        <span class="ruby-string">&quot;raw&quot;</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;

} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;type&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;tree&quot;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;list\&quot;&gt;&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;hash&#39;</span>},
                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>,
                                     <span class="ruby-operator">%</span><span class="ruby-identifier">ase_key</span>)},
                      <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;name&#39;</span>}));
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;hash&#39;</span>},
                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>,
                                     <span class="ruby-operator">%</span><span class="ruby-identifier">ase_key</span>)},
                      <span class="ruby-string">&quot;tree&quot;</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> .
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_base</span>,
                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>)},
                              <span class="ruby-string">&quot;history&quot;</span>);
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-comment"># unknown object: we can only present history for it</span>
        <span class="ruby-comment"># (this includes &#39;commit&#39; object, i.e. submodule support)</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;list\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$t</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;name&#39;</span>}) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>,
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_base</span>,
                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;$basedir$t-&gt;{&#39;name&#39;}&quot;</span>)},
                              <span class="ruby-string">&quot;history&quot;</span>);
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
}
</pre>

<p>}</p>

<p>## ................... ## functions printing large
fragments of HTML</p>

<p># get pre-image filenames for merge (combined) diff sub fill_from_file_info
{</p>

<pre>my ($diff, @parents) = @_;

$diff-&gt;{&#39;from_file&#39;} = [ ];
$diff-&gt;{&#39;from_file&#39;}[$diff-&gt;{&#39;nparents&#39;} - 1] = undef;
for (my $i = 0; $i &lt; $diff-&gt;{&#39;nparents&#39;}; $i++) {
        if ($diff-&gt;{&#39;status&#39;}[$i] eq &#39;R&#39; ||
            $diff-&gt;{&#39;status&#39;}[$i] eq &#39;C&#39;) {
                $diff-&gt;{&#39;from_file&#39;}[$i] =
                        git_get_path_by_hash($parents[$i], $diff-&gt;{&#39;from_id&#39;}[$i]);
        }
}

return $diff;</pre>

<p>}</p>

<p># is current raw difftree line of file deletion sub is_deleted {</p>

<pre>my $diffinfo = shift;

return $diffinfo-&gt;{&#39;to_id&#39;} eq (&#39;0&#39; x 40);</pre>

<p>}</p>

<p># does patch correspond to [previous] difftree raw line # $diffinfo  -
hashref of parsed raw diff format # $patchinfo - hashref of parsed patch
diff format #              (the same keys as in $diffinfo) sub
is_patch_split {</p>

<pre>my ($diffinfo, $patchinfo) = @_;

return defined $diffinfo &amp;&amp; defined $patchinfo
        &amp;&amp; $diffinfo-&gt;{&#39;to_file&#39;} eq $patchinfo-&gt;{&#39;to_file&#39;};</pre>

<p>}</p>

<p>sub git_difftree_body {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$difftree</span>, <span class="ruby-identifier">$hash</span>, <span class="ruby-ivar">@parents</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$parent</span>) = <span class="ruby-identifier">$parents</span>[<span class="ruby-value">0</span>];
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$have_blame</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;blame&#39;</span>);
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;list_head\&quot;&gt;\n&quot;</span>;
<span class="ruby-keyword">if</span> ($<span class="ruby-comment">#{$difftree} &gt; 10) {</span>
        <span class="ruby-identifier">print</span>(($<span class="ruby-comment">#{$difftree} + 1) . &quot; files changed:\n&quot;);</span>
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;&quot;</span> .
      (<span class="ruby-ivar">@parents</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;combined &quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>) .
      <span class="ruby-string">&quot;diff_tree\&quot;&gt;\n&quot;</span>;

<span class="ruby-comment"># header only for combined diff in &#39;commitdiff&#39; view</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$has_header</span> = @<span class="ruby-identifier">$difftree</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@parents</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$action</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;commitdiff&#39;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$has_header</span>) {
        <span class="ruby-comment"># table header</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;thead&gt;&lt;tr&gt;\n&quot;</span> .
               <span class="ruby-string">&quot;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;\n&quot;</span>; <span class="ruby-comment"># filename, patchN link</span>
        <span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@parents</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$par</span> = <span class="ruby-identifier">$parents</span>[<span class="ruby-identifier">$i</span>];
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;th&gt;&quot;</span> .
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commitdiff&quot;</span>,
                                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$par</span>),
                               <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;commitdiff to parent number &#39;</span> .
                                          (<span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>) . <span class="ruby-string">&#39;: &#39;</span> . <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$par</span>,<span class="ruby-value">0</span>,<span class="ruby-value">7</span>)},
                              <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>) .
                      <span class="ruby-string">&quot;&amp;nbsp;&lt;/th&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/tr&gt;&lt;/thead&gt;\n&lt;tbody&gt;\n&quot;</span>;
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$patchno</span> = <span class="ruby-value">0</span>;
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> (@{<span class="ruby-identifier">$difftree</span>}) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$diff</span> = <span class="ruby-identifier">parsed_difftree_line</span>(<span class="ruby-identifier">$line</span>);

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">exists</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;nparents&#39;</span>}) { <span class="ruby-comment"># combined diff</span>

                <span class="ruby-identifier">fill_from_file_info</span>(<span class="ruby-identifier">$diff</span>, <span class="ruby-ivar">@parents</span>)
                        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">exists</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>};

                <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">is_deleted</span>(<span class="ruby-identifier">$diff</span>)) {
                        <span class="ruby-comment"># file exists in the result (child) commit</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> .
                              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>},
                                                     <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>),
                                      <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>})) .
                              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> .
                              <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>}) .
                              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                }

                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$action</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;commitdiff&#39;</span>) {
                        <span class="ruby-comment"># link to patch</span>
                        <span class="ruby-identifier">$patchno</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
                              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">anchor</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;patch$patchno&quot;</span>)},
                                      <span class="ruby-string">&quot;patch&quot;</span>) .
                              <span class="ruby-string">&quot; | &quot;</span> .
                              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                }

                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$has_history</span> = <span class="ruby-value">0</span>;
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$not_deleted</span> = <span class="ruby-value">0</span>;
                <span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;nparents&#39;</span>}; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$hash_parent</span> = <span class="ruby-identifier">$parents</span>[<span class="ruby-identifier">$i</span>];
                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$from_hash</span> = <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>}[<span class="ruby-identifier">$i</span>];
                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$from_path</span> = <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>}[<span class="ruby-identifier">$i</span>];
                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$status</span> = <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>}[<span class="ruby-identifier">$i</span>];

                        <span class="ruby-identifier">$has_history</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">$status</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;A&#39;</span>);
                        <span class="ruby-identifier">$not_deleted</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">$status</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;D&#39;</span>);

                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$status</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;A&#39;</span>) {
                                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td  class=\&quot;link\&quot; align=\&quot;right\&quot;&gt; | &lt;/td&gt;\n&quot;</span>;
                        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$status</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;D&#39;</span>) {
                                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
                                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>,
                                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from_hash</span>,
                                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from_path</span>)},
                                              <span class="ruby-string">&quot;blob&quot;</span> . (<span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)) .
                                      <span class="ruby-string">&quot; | &lt;/td&gt;\n&quot;</span>;
                        } <span class="ruby-keyword">else</span> {
                                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$from_hash</span>) {
                                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link nochange\&quot;&gt;&quot;</span>;
                                } <span class="ruby-keyword">else</span> {
                                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
                                }
                                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blobdiff&quot;</span>,
                                                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                                             <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from_hash</span>,
                                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                                             <span class="ruby-identifier">hash_parent_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_parent</span>,
                                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>},
                                                             <span class="ruby-identifier">file_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$from_path</span>)},
                                              <span class="ruby-string">&quot;diff&quot;</span> . (<span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)) .
                                      <span class="ruby-string">&quot; | &lt;/td&gt;\n&quot;</span>;
                        }
                }

                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$not_deleted</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>,
                                                     <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>},
                                                     <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>)},
                                      <span class="ruby-string">&quot;blob&quot;</span>);
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$has_history</span>);
                }
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$has_history</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>},
                                                     <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>)},
                                      <span class="ruby-string">&quot;history&quot;</span>);
                }
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;

                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
                <span class="ruby-keyword">next</span>; <span class="ruby-comment"># instead of &#39;else&#39; clause, to avoid extra indent</span>
        }
        <span class="ruby-comment"># else ordinary diff</span>

        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$to_mode_oct</span>, <span class="ruby-identifier">$to_mode_str</span>, <span class="ruby-identifier">$to_file_type</span>);
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$from_mode_oct</span>, <span class="ruby-identifier">$from_mode_str</span>, <span class="ruby-identifier">$from_file_type</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_mode&#39;</span>} <span class="ruby-identifier">ne</span> (<span class="ruby-string">&#39;0&#39;</span> <span class="ruby-identifier">x</span> <span class="ruby-value">6</span>)) {
                <span class="ruby-identifier">$to_mode_oct</span> = <span class="ruby-identifier">oct</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_mode&#39;</span>};
                <span class="ruby-keyword">if</span> (<span class="ruby-constant">S_ISREG</span>(<span class="ruby-identifier">$to_mode_oct</span>)) { <span class="ruby-comment"># only for regular file</span>
                        <span class="ruby-identifier">$to_mode_str</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;%04o&quot;</span>, <span class="ruby-identifier">$to_mode_oct</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0777</span>); <span class="ruby-comment"># permission bits</span>
                }
                <span class="ruby-identifier">$to_file_type</span> = <span class="ruby-identifier">file_type</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_mode&#39;</span>});
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_mode&#39;</span>} <span class="ruby-identifier">ne</span> (<span class="ruby-string">&#39;0&#39;</span> <span class="ruby-identifier">x</span> <span class="ruby-value">6</span>)) {
                <span class="ruby-identifier">$from_mode_oct</span> = <span class="ruby-identifier">oct</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_mode&#39;</span>};
                <span class="ruby-keyword">if</span> (<span class="ruby-constant">S_ISREG</span>(<span class="ruby-identifier">$from_mode_oct</span>)) { <span class="ruby-comment"># only for regular file</span>
                        <span class="ruby-identifier">$from_mode_str</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;%04o&quot;</span>, <span class="ruby-identifier">$from_mode_oct</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0777</span>); <span class="ruby-comment"># permission bits</span>
                }
                <span class="ruby-identifier">$from_file_type</span> = <span class="ruby-identifier">file_type</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_mode&#39;</span>});
        }

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;A&quot;</span>) { <span class="ruby-comment"># created</span>
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$mode_chng</span> = <span class="ruby-string">&quot;&lt;span class=\&quot;file_status new\&quot;&gt;[new $to_file_type&quot;</span>;
                <span class="ruby-identifier">$mode_chng</span>   .= <span class="ruby-string">&quot; with mode: $to_mode_str&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$to_mode_str</span>;
                <span class="ruby-identifier">$mode_chng</span>   .= <span class="ruby-string">&quot;]&lt;/span&gt;&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}));
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;$mode_chng&lt;/td&gt;\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$action</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;commitdiff&#39;</span>) {
                        <span class="ruby-comment"># link to patch</span>
                        <span class="ruby-identifier">$patchno</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">anchor</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;patch$patchno&quot;</span>)},
                                      <span class="ruby-string">&quot;patch&quot;</span>) .
                              <span class="ruby-string">&quot; | &quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>})},
                              <span class="ruby-string">&quot;blob&quot;</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;

        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;D&quot;</span>) { <span class="ruby-comment"># deleted</span>
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$mode_chng</span> = <span class="ruby-string">&quot;&lt;span class=\&quot;file_status deleted\&quot;&gt;[deleted $from_file_type]&lt;/span&gt;&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>},
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}),
                               <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}));
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;$mode_chng&lt;/td&gt;\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$action</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;commitdiff&#39;</span>) {
                        <span class="ruby-comment"># link to patch</span>
                        <span class="ruby-identifier">$patchno</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">anchor</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;patch$patchno&quot;</span>)},
                                      <span class="ruby-string">&quot;patch&quot;</span>) .
                              <span class="ruby-string">&quot; | &quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>},
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>})},
                              <span class="ruby-string">&quot;blob&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$have_blame</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>})},
                                      <span class="ruby-string">&quot;blame&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>,
                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>})},
                              <span class="ruby-string">&quot;history&quot;</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;

        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;M&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;T&quot;</span>) { <span class="ruby-comment"># modified, or type changed</span>
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$mode_chnge</span> = <span class="ruby-string">&quot;&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_mode&#39;</span>} <span class="ruby-operator">!=</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_mode&#39;</span>}) {
                        <span class="ruby-identifier">$mode_chnge</span> = <span class="ruby-string">&quot;&lt;span class=\&quot;file_status mode_chnge\&quot;&gt;[changed&quot;</span>;
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from_file_type</span> <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$to_file_type</span>) {
                                <span class="ruby-identifier">$mode_chnge</span> .= <span class="ruby-string">&quot; from $from_file_type to $to_file_type&quot;</span>;
                        }
                        <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">$from_mode_oct</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0777</span>) <span class="ruby-operator">!=</span> (<span class="ruby-identifier">$to_mode_oct</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0777</span>)) {
                                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from_mode_str</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$to_mode_str</span>) {
                                        <span class="ruby-identifier">$mode_chnge</span> .= <span class="ruby-string">&quot; mode: $from_mode_str-&gt;$to_mode_str&quot;</span>;
                                } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$to_mode_str</span>) {
                                        <span class="ruby-identifier">$mode_chnge</span> .= <span class="ruby-string">&quot; mode: $to_mode_str&quot;</span>;
                                }
                        }
                        <span class="ruby-identifier">$mode_chnge</span> .= <span class="ruby-string">&quot;]&lt;/span&gt;\n&quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>}));
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;$mode_chnge&lt;/td&gt;\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$action</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;commitdiff&#39;</span>) {
                        <span class="ruby-comment"># link to patch</span>
                        <span class="ruby-identifier">$patchno</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">anchor</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;patch$patchno&quot;</span>)},
                                      <span class="ruby-string">&quot;patch&quot;</span>) .
                              <span class="ruby-string">&quot; | &quot;</span>;
                } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>} <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>}) {
                        <span class="ruby-comment"># &quot;commit&quot; view and modified file (not onlu mode changed)</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blobdiff&quot;</span>,
                                                     <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>}, <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>},
                                                     <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">hash_parent_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>})},
                                      <span class="ruby-string">&quot;diff&quot;</span>) .
                              <span class="ruby-string">&quot; | &quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>})},
                               <span class="ruby-string">&quot;blob&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$have_blame</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>})},
                                      <span class="ruby-string">&quot;blame&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file&#39;</span>})},
                              <span class="ruby-string">&quot;history&quot;</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;

        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;R&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;C&quot;</span>) { <span class="ruby-comment"># renamed or copied</span>
                <span class="ruby-identifier">my</span> <span class="ruby-value">%sat</span><span class="ruby-identifier">us_name</span> = (<span class="ruby-string">&#39;R&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;moved&#39;</span>, <span class="ruby-string">&#39;C&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;copied&#39;</span>);
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$nstatus</span> = <span class="ruby-identifier">$status_name</span>{<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;status&#39;</span>}};
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$mode_chng</span> = <span class="ruby-string">&quot;&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_mode&#39;</span>} <span class="ruby-operator">!=</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_mode&#39;</span>}) {
                        <span class="ruby-comment"># mode also for directories, so we cannot use $to_mode_str</span>
                        <span class="ruby-identifier">$mode_chng</span> = <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;, mode: %04o&quot;</span>, <span class="ruby-identifier">$to_mode_oct</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0777</span>);
                }
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> .
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>}, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>}),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>})) . <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;td&gt;&lt;span class=\&quot;file_status $nstatus\&quot;&gt;[$nstatus from &quot;</span> .
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>,
                                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>}, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>}),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>})) .
                      <span class="ruby-string">&quot; with &quot;</span> . (<span class="ruby-identifier">int</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;similarity&#39;</span>}) . <span class="ruby-string">&quot;% similarity$mode_chng]&lt;/span&gt;&lt;/td&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$action</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;commitdiff&#39;</span>) {
                        <span class="ruby-comment"># link to patch</span>
                        <span class="ruby-identifier">$patchno</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">anchor</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;patch$patchno&quot;</span>)},
                                      <span class="ruby-string">&quot;patch&quot;</span>) .
                              <span class="ruby-string">&quot; | &quot;</span>;
                } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>} <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>}) {
                        <span class="ruby-comment"># &quot;commit&quot; view and modified file (not only pure rename or copy)</span>
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blobdiff&quot;</span>,
                                                     <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>}, <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_id&#39;</span>},
                                                     <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">hash_parent_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>}, <span class="ruby-identifier">file_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;from_file&#39;</span>})},
                                      <span class="ruby-string">&quot;diff&quot;</span>) .
                              <span class="ruby-string">&quot; | &quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_id&#39;</span>},
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>})},
                              <span class="ruby-string">&quot;blob&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$have_blame</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>})},
                                      <span class="ruby-string">&quot;blame&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>,
                                            <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$diff</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>})},
                              <span class="ruby-string">&quot;history&quot;</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;

        } <span class="ruby-comment"># we should not encounter Unmerged (U) or Unknown (X) status</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/tbody&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$has_header</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p># Print context lines and then rem/add lines in a side-by-side manner. sub
print_sidebyside_diff_lines {</p>

<pre>my ($ctx, $rem, $add) = @_;

# print context block before add/rem block
if (@$ctx) {
        print join &#39;&#39;,
                &#39;&lt;div class=&quot;chunk_block ctx&quot;&gt;&#39;,
                        &#39;&lt;div class=&quot;old&quot;&gt;&#39;,
                        @$ctx,
                        &#39;&lt;/div&gt;&#39;,
                        &#39;&lt;div class=&quot;new&quot;&gt;&#39;,
                        @$ctx,
                        &#39;&lt;/div&gt;&#39;,
                &#39;&lt;/div&gt;&#39;;
}

if (!@$add) {
        # pure removal
        print join &#39;&#39;,
                &#39;&lt;div class=&quot;chunk_block rem&quot;&gt;&#39;,
                        &#39;&lt;div class=&quot;old&quot;&gt;&#39;,
                        @$rem,
                        &#39;&lt;/div&gt;&#39;,
                &#39;&lt;/div&gt;&#39;;
} elsif (!@$rem) {
        # pure addition
        print join &#39;&#39;,
                &#39;&lt;div class=&quot;chunk_block add&quot;&gt;&#39;,
                        &#39;&lt;div class=&quot;new&quot;&gt;&#39;,
                        @$add,
                        &#39;&lt;/div&gt;&#39;,
                &#39;&lt;/div&gt;&#39;;
} else {
        print join &#39;&#39;,
                &#39;&lt;div class=&quot;chunk_block chg&quot;&gt;&#39;,
                        &#39;&lt;div class=&quot;old&quot;&gt;&#39;,
                        @$rem,
                        &#39;&lt;/div&gt;&#39;,
                        &#39;&lt;div class=&quot;new&quot;&gt;&#39;,
                        @$add,
                        &#39;&lt;/div&gt;&#39;,
                &#39;&lt;/div&gt;&#39;;
}</pre>

<p>}</p>

<p># Print context lines and then rem/add lines in inline manner. sub
print_inline_diff_lines {</p>

<pre>my ($ctx, $rem, $add) = @_;

print @$ctx, @$rem, @$add;</pre>

<p>}</p>

<p># Format removed and added line, mark changed part and HTML-format them. #
Implementation is based on contrib/diff-highlight sub
format_rem_add_lines_pair {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$rem</span>, <span class="ruby-identifier">$add</span>, <span class="ruby-identifier">$num_parents</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-comment"># We need to untabify lines before split()&#39;ing them;</span>
<span class="ruby-comment"># otherwise offsets would be invalid.</span>
<span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$rem</span>;
<span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$add</span>;
<span class="ruby-identifier">$rem</span> = <span class="ruby-identifier">untabify</span>(<span class="ruby-identifier">$rem</span>);
<span class="ruby-identifier">$add</span> = <span class="ruby-identifier">untabify</span>(<span class="ruby-identifier">$add</span>);

<span class="ruby-identifier">my</span> <span class="ruby-ivar">@rem</span> = <span class="ruby-identifier">split</span>(<span class="ruby-regexp">//</span>, <span class="ruby-identifier">$rem</span>);
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@add</span> = <span class="ruby-identifier">split</span>(<span class="ruby-regexp">//</span>, <span class="ruby-identifier">$add</span>);
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$esc_rem</span>, <span class="ruby-identifier">$esc_add</span>);
<span class="ruby-comment"># Ignore leading +/- characters for each parent.</span>
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$prefix_len</span>, <span class="ruby-identifier">$suffix_len</span>) = (<span class="ruby-identifier">$num_parents</span>, <span class="ruby-value">0</span>);
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$prefix_has_nonspace</span>, <span class="ruby-identifier">$suffix_has_nonspace</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$shorter</span> = (<span class="ruby-ivar">@rem</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@add</span>) <span class="ruby-operator">?</span> <span class="ruby-ivar">@rem</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@add</span>;
<span class="ruby-keyword">while</span> (<span class="ruby-identifier">$prefix_len</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">$shorter</span>) {
        <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$rem</span>[<span class="ruby-identifier">$prefix_len</span>] <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$add</span>[<span class="ruby-identifier">$prefix_len</span>]);

        <span class="ruby-identifier">$prefix_has_nonspace</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$rem</span>[<span class="ruby-identifier">$prefix_len</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp">/\s/</span>);
        <span class="ruby-identifier">$prefix_len</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
}

<span class="ruby-keyword">while</span> (<span class="ruby-identifier">$prefix_len</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$suffix_len</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">$shorter</span>) {
        <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$rem</span>[<span class="ruby-value">-1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$suffix_len</span>] <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$add</span>[<span class="ruby-value">-1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$suffix_len</span>]);

        <span class="ruby-identifier">$suffix_has_nonspace</span> = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$rem</span>[<span class="ruby-value">-1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$suffix_len</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp">/\s/</span>);
        <span class="ruby-identifier">$suffix_len</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
}

<span class="ruby-comment"># Mark lines that are different from each other, but have some common</span>
<span class="ruby-comment"># part that isn&#39;t whitespace.  If lines are completely different, don&#39;t</span>
<span class="ruby-comment"># mark them because that would make output unreadable, especially if</span>
<span class="ruby-comment"># diff consists of multiple lines.</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$prefix_has_nonspace</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$suffix_has_nonspace</span>) {
        <span class="ruby-identifier">$esc_rem</span> = <span class="ruby-identifier">esc_html_hl_regions</span>(<span class="ruby-identifier">$rem</span>, <span class="ruby-string">&#39;marked&#39;</span>,
                [<span class="ruby-identifier">$prefix_len</span>, <span class="ruby-ivar">@rem</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$suffix_len</span>], <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
        <span class="ruby-identifier">$esc_add</span> = <span class="ruby-identifier">esc_html_hl_regions</span>(<span class="ruby-identifier">$add</span>, <span class="ruby-string">&#39;marked&#39;</span>,
                [<span class="ruby-identifier">$prefix_len</span>, <span class="ruby-ivar">@add</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$suffix_len</span>], <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$esc_rem</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$rem</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
        <span class="ruby-identifier">$esc_add</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$add</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
}

<span class="ruby-keyword">return</span> <span class="ruby-identifier">format_diff_line</span>(\<span class="ruby-identifier">$esc_rem</span>, <span class="ruby-string">&#39;rem&#39;</span>),
       <span class="ruby-identifier">format_diff_line</span>(\<span class="ruby-identifier">$esc_add</span>, <span class="ruby-string">&#39;add&#39;</span>);
</pre>

<p>}</p>

<p># HTML-format diff context, removed and added lines. sub
format_ctx_rem_add_lines {</p>

<pre>my ($ctx, $rem, $add, $num_parents) = @_;
my (@new_ctx, @new_rem, @new_add);
my $can_highlight = 0;
my $is_combined = ($num_parents &gt; 1);

# Highlight if every removed line has a corresponding added line.
if (@$add &gt; 0 &amp;&amp; @$add == @$rem) {
        $can_highlight = 1;

        # Highlight lines in combined diff only if the chunk contains
        # diff between the same version, e.g.
        #
        #    - a
        #   -  b
        #    + c
        #   +  d
        #
        # Otherwise the highlightling would be confusing.
        if ($is_combined) {
                for (my $i = 0; $i &lt; @$add; $i++) {
                        my $prefix_rem = substr($rem-&gt;[$i], 0, $num_parents);
                        my $prefix_add = substr($add-&gt;[$i], 0, $num_parents);

                        $prefix_rem =~ s/-/+/g;

                        if ($prefix_rem ne $prefix_add) {
                                $can_highlight = 0;
                                last;
                        }
                }
        }
}

if ($can_highlight) {
        for (my $i = 0; $i &lt; @$add; $i++) {
                my ($line_rem, $line_add) = format_rem_add_lines_pair(
                        $rem-&gt;[$i], $add-&gt;[$i], $num_parents);
                push @new_rem, $line_rem;
                push @new_add, $line_add;
        }
} else {
        @new_rem = map { format_diff_line($_, &#39;rem&#39;) } @$rem;
        @new_add = map { format_diff_line($_, &#39;add&#39;) } @$add;
}

@new_ctx = map { format_diff_line($_, &#39;ctx&#39;) } @$ctx;

return (\@new_ctx, \@new_rem, \@new_add);</pre>

<p>}</p>

<p># Print context lines and then rem/add lines. sub print_diff_lines {</p>

<pre>my ($ctx, $rem, $add, $diff_style, $num_parents) = @_;
my $is_combined = $num_parents &gt; 1;

($ctx, $rem, $add) = format_ctx_rem_add_lines($ctx, $rem, $add,
        $num_parents);

if ($diff_style eq &#39;sidebyside&#39; &amp;&amp; !$is_combined) {
        print_sidebyside_diff_lines($ctx, $rem, $add);
} else {
        # default &#39;inline&#39; style and unknown styles
        print_inline_diff_lines($ctx, $rem, $add);
}</pre>

<p>}</p>

<p>sub print_diff_chunk {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$diff_style</span>, <span class="ruby-identifier">$num_parents</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-ivar">@chunk</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> (<span class="ruby-ivar">@ctx</span>, <span class="ruby-ivar">@rem</span>, <span class="ruby-ivar">@add</span>);

<span class="ruby-comment"># The class of the previous line.</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$prev_class</span> = <span class="ruby-string">&#39;&#39;</span>;

<span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@chunk</span>;

<span class="ruby-comment"># incomplete last line might be among removed or added lines,</span>
<span class="ruby-comment"># or both, or among context lines: find which</span>
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">1</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@chunk</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$chunk</span>[<span class="ruby-identifier">$i</span>][<span class="ruby-value">0</span>] <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;incomplete&#39;</span>) {
                <span class="ruby-identifier">$chunk</span>[<span class="ruby-identifier">$i</span>][<span class="ruby-value">0</span>] = <span class="ruby-identifier">$chunk</span>[<span class="ruby-identifier">$i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>][<span class="ruby-value">0</span>];
        }
}

<span class="ruby-comment"># guardian</span>
<span class="ruby-identifier">push</span> <span class="ruby-ivar">@chunk</span>, [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>];

<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$line_info</span> (<span class="ruby-ivar">@chunk</span>) {
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$class</span>, <span class="ruby-identifier">$line</span>) = @<span class="ruby-identifier">$line_info</span>;

        <span class="ruby-comment"># print chunk headers</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$class</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$class</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;chunk_header&#39;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">format_diff_line</span>(<span class="ruby-identifier">$line</span>, <span class="ruby-identifier">$class</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>);
                <span class="ruby-keyword">next</span>;
        }

        <span class="ruby-comment">## print from accumulator when have some add/rem lines or end</span>
        <span class="ruby-comment"># of chunk (flush context lines), or when have add and rem</span>
        <span class="ruby-comment"># lines and new block is reached (otherwise add/rem lines could</span>
        <span class="ruby-comment"># be reordered)</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">$class</span> <span class="ruby-operator">||</span> ((<span class="ruby-ivar">@rem</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@add</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$class</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;ctx&#39;</span>) <span class="ruby-operator">||</span>
            (<span class="ruby-ivar">@rem</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@add</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$class</span> <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$prev_class</span>)) {
                <span class="ruby-identifier">print_diff_lines</span>(\<span class="ruby-ivar">@ctx</span>, \<span class="ruby-ivar">@rem</span>, \<span class="ruby-ivar">@add</span>,
                                 <span class="ruby-identifier">$diff_style</span>, <span class="ruby-identifier">$num_parents</span>);
                <span class="ruby-ivar">@ctx</span> = <span class="ruby-ivar">@rem</span> = <span class="ruby-ivar">@add</span> = ();
        }

        <span class="ruby-comment">## adding lines to accumulator</span>
        <span class="ruby-comment"># guardian value</span>
        <span class="ruby-identifier">last</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$line</span>;
        <span class="ruby-comment"># rem, add or change</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$class</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;rem&#39;</span>) {
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@rem</span>, <span class="ruby-identifier">$line</span>;
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$class</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;add&#39;</span>) {
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@add</span>, <span class="ruby-identifier">$line</span>;
        }
        <span class="ruby-comment"># context line</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$class</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;ctx&#39;</span>) {
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@ctx</span>, <span class="ruby-identifier">$line</span>;
        }

        <span class="ruby-identifier">$prev_class</span> = <span class="ruby-identifier">$class</span>;
}
</pre>

<p>}</p>

<p>sub git_patchset_body {</p>

<pre class="ruby">       <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$fd</span>, <span class="ruby-identifier">$diff_style</span>, <span class="ruby-identifier">$difftree</span>, <span class="ruby-identifier">$hash</span>, <span class="ruby-ivar">@hash_parents</span>) = <span class="ruby-ivar">@_</span>;
       <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$hash_parent</span>) = <span class="ruby-identifier">$hash_parents</span>[<span class="ruby-value">0</span>];

       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$is_combined</span> = (<span class="ruby-ivar">@hash_parents</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$patch_idx</span> = <span class="ruby-value">0</span>;
       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$patch_number</span> = <span class="ruby-value">0</span>;
       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$patch_line</span>;
       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$diffinfo</span>;
       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$to_name</span>;
       <span class="ruby-identifier">my</span> (<span class="ruby-operator">%</span><span class="ruby-identifier">rom</span>, <span class="ruby-operator">%</span><span class="ruby-identifier">o</span>);
       <span class="ruby-identifier">my</span> <span class="ruby-ivar">@chunk</span>; <span class="ruby-comment"># for side-by-side diff</span>

       <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;patchset\&quot;&gt;\n&quot;</span>;

       <span class="ruby-comment"># skip to first patch</span>
       <span class="ruby-keyword">while</span> (<span class="ruby-identifier">$patch_line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
               <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$patch_line</span>;

               <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$patch_line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-identifier">diff</span> <span class="ruby-node">/);
       }

PATCH:
       while ($patch_line) {

               # parse &quot;git diff&quot; header line
               if ($patch_line =~ m/</span><span class="ruby-operator">^</span><span class="ruby-identifier">diff</span> <span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-identifier">git</span> (\<span class="ruby-string">&quot;(?:[^\\\&quot;]*(?:\\.[^\\\&quot;]*)*)\&quot;|[^ &quot;</span>]<span class="ruby-operator">*</span>) (.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$/</span>) {
                       <span class="ruby-comment"># $1 is from_name, which we do not use</span>
                       <span class="ruby-identifier">$to_name</span> = <span class="ruby-identifier">unquote</span>(<span class="ruby-node">$2</span>);
                       <span class="ruby-identifier">$to_name</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-operator">^</span><span class="ruby-identifier">b</span><span class="ruby-operator">/</span><span class="ruby-operator">!</span><span class="ruby-operator">!</span>;
               } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$patch_line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-identifier">diff</span> <span class="ruby-operator">-</span><span class="ruby-operator">-</span>(<span class="ruby-identifier">cc</span><span class="ruby-operator">|</span><span class="ruby-identifier">combined</span>) (<span class="ruby-string">&quot;?.*&quot;</span><span class="ruby-operator">?</span>)<span class="ruby-identifier">$/</span>) {
                       <span class="ruby-comment"># $1 is &#39;cc&#39; or &#39;combined&#39;, which we do not use</span>
                       <span class="ruby-identifier">$to_name</span> = <span class="ruby-identifier">unquote</span>(<span class="ruby-node">$2</span>);
               } <span class="ruby-keyword">else</span> {
                       <span class="ruby-identifier">$to_name</span> = <span class="ruby-keyword">undef</span>;
               }

               <span class="ruby-comment"># check if current patch belong to current raw line</span>
               <span class="ruby-comment"># and parse raw git-diff line if needed</span>
               <span class="ruby-keyword">if</span> (<span class="ruby-identifier">is_patch_split</span>(<span class="ruby-identifier">$diffinfo</span>, { <span class="ruby-string">&#39;to_file&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$to_name</span> })) {
                       <span class="ruby-comment"># this is continuation of a split patch</span>
                       <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;patch cont\&quot;&gt;\n&quot;</span>;
               } <span class="ruby-keyword">else</span> {
                       <span class="ruby-comment"># advance raw git-diff output if needed</span>
                       <span class="ruby-identifier">$patch_idx</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$diffinfo</span>;

                       <span class="ruby-comment"># read and prepare patch information</span>
                       <span class="ruby-identifier">$diffinfo</span> = <span class="ruby-identifier">parsed_difftree_line</span>(<span class="ruby-identifier">$difftree</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>[<span class="ruby-identifier">$patch_idx</span>]);

                       <span class="ruby-comment"># compact combined diff output can have some patches skipped</span>
                       <span class="ruby-comment"># find which patch (using pathname of result) we are at now;</span>
                       <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$is_combined</span>) {
                               <span class="ruby-keyword">while</span> (<span class="ruby-identifier">$to_name</span> <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$diffinfo</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;to_file&#39;</span>}) {
                                       <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;patch\&quot; id=\&quot;patch&quot;</span>. (<span class="ruby-identifier">$patch_idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>) .<span class="ruby-string">&quot;\&quot;&gt;\n&quot;</span> .
                                             <span class="ruby-identifier">format_diff_cc_simplified</span>(<span class="ruby-identifier">$diffinfo</span>, <span class="ruby-ivar">@hash_parents</span>) .
                                             <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;  <span class="ruby-comment"># class=&quot;patch&quot;</span>

                                       <span class="ruby-identifier">$patch_idx</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
                                       <span class="ruby-identifier">$patch_number</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;

                                       <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$patch_idx</span> <span class="ruby-operator">&gt;</span> $<span class="ruby-comment">#$difftree;</span>
                                       <span class="ruby-identifier">$diffinfo</span> = <span class="ruby-identifier">parsed_difftree_line</span>(<span class="ruby-identifier">$difftree</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>[<span class="ruby-identifier">$patch_idx</span>]);
                               }
                       }

                       <span class="ruby-comment"># modifies %from, %to hashes</span>
                       <span class="ruby-identifier">parse_from_to_diffinfo</span>(<span class="ruby-identifier">$diffinfo</span>, \<span class="ruby-operator">%</span><span class="ruby-identifier">rom</span>, \<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>, <span class="ruby-ivar">@hash_parents</span>);

                       <span class="ruby-comment"># this is first patch for raw difftree line with $patch_idx index</span>
                       <span class="ruby-comment"># we index @$difftree array from 0, but number patches from 1</span>
                       <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;patch\&quot; id=\&quot;patch&quot;</span>. (<span class="ruby-identifier">$patch_idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>) .<span class="ruby-string">&quot;\&quot;&gt;\n&quot;</span>;
               }

               <span class="ruby-comment"># git diff header</span>
               <span class="ruby-comment">#assert($patch_line =~ m/^diff /) if DEBUG;</span>
               <span class="ruby-comment">#assert($patch_line !~ m!$/$!) if DEBUG; # is chomp-ed</span>
               <span class="ruby-identifier">$patch_number</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
               <span class="ruby-comment"># print &quot;git diff&quot; header</span>
               <span class="ruby-identifier">print</span> <span class="ruby-identifier">format_git_diff_header_line</span>(<span class="ruby-identifier">$patch_line</span>, <span class="ruby-identifier">$diffinfo</span>,
                                                 \<span class="ruby-operator">%</span><span class="ruby-identifier">rom</span>, \<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>);

               <span class="ruby-comment"># print extended diff header</span>
               <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;diff extended_header\&quot;&gt;\n&quot;</span>;
       <span class="ruby-constant">EXTENDED_HEADER</span><span class="ruby-operator">:</span>
               <span class="ruby-keyword">while</span> (<span class="ruby-identifier">$patch_line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
                       <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$patch_line</span>;

                       <span class="ruby-identifier">last</span> <span class="ruby-constant">EXTENDED_HEADER</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$patch_line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-operator">-</span> <span class="ruby-operator">|</span><span class="ruby-operator">^</span><span class="ruby-identifier">diff</span> <span class="ruby-regexp">/);

                       print format_extended_diff_header_line($patch_line, $diffinfo,
                                                              \%from, \%to);
               }
               print &quot;&lt;/</span><span class="ruby-identifier">div</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n</span><span class="ruby-node">&quot;; # class=&quot;</span><span class="ruby-identifier">diff</span> <span class="ruby-identifier">extended_header</span><span class="ruby-node">&quot;

               # from-file/to-file diff header
               if (! $patch_line) {
                       print &quot;</span><span class="ruby-operator">&lt;</span><span class="ruby-node">/div&gt;\n&quot;; # class=&quot;patch&quot;
                       last PATCH;
               }
               next PATCH if ($patch_line =~ m/</span><span class="ruby-operator">^</span><span class="ruby-identifier">diff</span> <span class="ruby-node">/);
               #assert($patch_line =~ m/</span><span class="ruby-operator">^</span><span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-node">/) if DEBUG;

               my $last_patch_line = $patch_line;
               $patch_line = &lt;$fd&gt;;
               chomp $patch_line;
               #assert($patch_line =~ m/</span><span class="ruby-operator">^</span>\<span class="ruby-operator">+</span>\<span class="ruby-operator">+</span>\<span class="ruby-operator">+</span><span class="ruby-node">/) if DEBUG;

               print format_diff_from_to_header($last_patch_line, $patch_line,
                                                $diffinfo, \%from, \%to,
                                                @hash_parents);

               # the patch itself
       LINE:
               while ($patch_line = &lt;$fd&gt;) {
                       chomp $patch_line;

                       next PATCH if ($patch_line =~ m/</span><span class="ruby-operator">^</span><span class="ruby-identifier">diff</span> <span class="ruby-regexp">/);

                       my $class = diff_line_class($patch_line, \%from, \%to);

                       if ($class eq &#39;chunk_header&#39;) {
                               print_diff_chunk($diff_style, scalar @hash_parents, \%from, \%to, @chunk);
                               @chunk = ();
                       }

                       push @chunk, [ $class, $patch_line ];
               }

       } continue {
               if (@chunk) {
                       print_diff_chunk($diff_style, scalar @hash_parents, \%from, \%to, @chunk);
                       @chunk = ();
               }
               print &quot;&lt;/</span><span class="ruby-identifier">div</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n</span><span class="ruby-node">&quot;; # class=&quot;</span><span class="ruby-identifier">patch</span><span class="ruby-node">&quot;
       }

       # for compact combined (--cc) format, with chunk and patch simplification
       # the patchset might be empty, but there might be unprocessed raw lines
       for (++$patch_idx if $patch_number &gt; 0;
            $patch_idx &lt; @$difftree;
            ++$patch_idx) {
               # read and prepare patch information
               $diffinfo = parsed_difftree_line($difftree-&gt;[$patch_idx]);

               # generate anchor for &quot;</span><span class="ruby-identifier">patch</span><span class="ruby-string">&quot; links in difftree / whatchanged part
               print &quot;</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">div</span> <span class="ruby-identifier">class</span>=\<span class="ruby-string">&quot;patch\&quot; id=\&quot;patch&quot;</span>. (<span class="ruby-identifier">$patch_idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>) .<span class="ruby-string">&quot;\&quot;&gt;\n&quot;</span> .
                     <span class="ruby-identifier">format_diff_cc_simplified</span>(<span class="ruby-identifier">$diffinfo</span>, <span class="ruby-ivar">@hash_parents</span>) .
                     <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;  <span class="ruby-comment"># class=&quot;patch&quot;</span>

               <span class="ruby-identifier">$patch_number</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
       }

       <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$patch_number</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>) {
               <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@hash_parents</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) {
                       <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;diff nodifferences\&quot;&gt;Trivial merge&lt;/div&gt;\n&quot;</span>;
               } <span class="ruby-keyword">else</span> {
                       <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;diff nodifferences\&quot;&gt;No differences found&lt;/div&gt;\n&quot;</span>;
               }
       }

       <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;patchset&quot;</span>
</pre>

<p>}</p>

<p># . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</p>

<p>sub git_project_search_form {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$searchtext</span>, <span class="ruby-identifier">$search_use_regexp</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$limit</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$project_filter</span>) {
        <span class="ruby-identifier">$limit</span> = <span class="ruby-string">&quot; in &#39;$project_filter/&#39;&quot;</span>;
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;projsearch\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">startform</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;get&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$my_uri</span>) .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">hidden</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;project_list&#39;</span>)  . <span class="ruby-string">&quot;\n&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">hidden</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;pf&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$project_filter</span>). <span class="ruby-string">&quot;\n&quot;</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$project_filter</span>);
<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">textfield</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;s&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$searchtext</span>,
                      <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Search project by name and description$limit&quot;</span>,
                      <span class="ruby-operator">-</span><span class="ruby-identifier">size</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">60</span>) . <span class="ruby-string">&quot;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;span title=\&quot;Extended regular expression\&quot;&gt;&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">checkbox</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;sr&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;re&#39;</span>,
                     <span class="ruby-operator">-</span><span class="ruby-identifier">checked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$search_use_regexp</span>) .
      <span class="ruby-string">&quot;&lt;/span&gt;\n&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">submit</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;btnS&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Search&#39;</span>) .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_form</span>() . <span class="ruby-string">&quot;\n&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>, <span class="ruby-identifier">searchtext</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">undef</span>,
                             <span class="ruby-identifier">project_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$project_filter</span>)},
              <span class="ruby-identifier">esc_html</span>(<span class="ruby-string">&quot;List all projects$limit&quot;</span>)) . <span class="ruby-string">&quot;&lt;br /&gt;\n&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p># entry for given @keys needs filling if at least one of keys in list # is
not present in %$project_info sub project_info_needs_filling {</p>

<pre>my ($project_info, @keys) = @_;

# return List::MoreUtils::any { !exists $project_info-&gt;{$_} } @keys;
foreach my $key (@keys) {
        if (!exists $project_info-&gt;{$key}) {
                return 1;
        }
}
return;</pre>

<p>}</p>

<p># fills project list info (age, description, owner, category, forks, etc.)
# for each project in the list, removing invalid projects from # returned
list, or fill only specified info. # # Invalid projects are removed from
the returned list if and only if you # ask &#39;age&#39; or
&#39;age_string&#39; to be filled, because they are the only fields # that
run unconditionally git command that requires repository, and # therefore
do always check if project repository is invalid. # # USAGE: # *
fill_project_list_info(@project_list, &#39;descr_long&#39;,
&#39;ctags&#39;) #   ensures that &#39;descr_long&#39; and &#39;ctags&#39;
fields are filled # * @project_list = fill_project_list_info(@project_list)
#   ensures that all fields are filled (and invalid projects removed) # #
NOTE: modifies $projlist, but does not remove entries from it sub
fill_project_list_info {</p>

<pre class="ruby">       <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$projlist</span>, <span class="ruby-ivar">@wanted_keys</span>) = <span class="ruby-ivar">@_</span>;
       <span class="ruby-identifier">my</span> <span class="ruby-ivar">@projects</span>;
       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filter_set</span> = <span class="ruby-identifier">sub</span> { <span class="ruby-keyword">return</span> <span class="ruby-ivar">@_</span>; };
       <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@wanted_keys</span>) {
               <span class="ruby-identifier">my</span> <span class="ruby-node">%wnted_keys = ma</span><span class="ruby-identifier">p</span> { <span class="ruby-identifier">$_</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> } <span class="ruby-ivar">@wanted_keys</span>;
               <span class="ruby-identifier">$filter_set</span> = <span class="ruby-identifier">sub</span> { <span class="ruby-keyword">return</span> <span class="ruby-identifier">grep</span> { <span class="ruby-identifier">$wanted_keys</span>{<span class="ruby-identifier">$_</span>} } <span class="ruby-ivar">@_</span>; };
       }

       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$show_ctags</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;ctags&#39;</span>);
<span class="ruby-constant">PROJECT</span><span class="ruby-operator">:</span>
       <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$pr</span> (@<span class="ruby-identifier">$projlist</span>) {
               <span class="ruby-keyword">if</span> (<span class="ruby-identifier">project_info_needs_filling</span>(<span class="ruby-identifier">$pr</span>, <span class="ruby-identifier">$filter_set</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>(<span class="ruby-string">&#39;age&#39;</span>, <span class="ruby-string">&#39;age_string&#39;</span>))) {
                       <span class="ruby-identifier">my</span> (<span class="ruby-ivar">@activity</span>) = <span class="ruby-identifier">git_get_last_activity</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>});
                       <span class="ruby-keyword">unless</span> (<span class="ruby-ivar">@activity</span>) {
                               <span class="ruby-keyword">next</span> <span class="ruby-constant">PROJECT</span>;
                       }
                       (<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;age&#39;</span>}, <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;age_string&#39;</span>}) = <span class="ruby-ivar">@activity</span>;
               }
               <span class="ruby-keyword">if</span> (<span class="ruby-identifier">project_info_needs_filling</span>(<span class="ruby-identifier">$pr</span>, <span class="ruby-identifier">$filter_set</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>(<span class="ruby-string">&#39;descr&#39;</span>, <span class="ruby-string">&#39;descr_long&#39;</span>))) {
                       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$descr</span> = <span class="ruby-identifier">git_get_project_description</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}) <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>;
                       <span class="ruby-identifier">$descr</span> = <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$descr</span>);
                       <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;descr_long&#39;</span>} = <span class="ruby-identifier">$descr</span>;
                       <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;descr&#39;</span>} = <span class="ruby-identifier">chop_str</span>(<span class="ruby-identifier">$descr</span>, <span class="ruby-identifier">$projects_list_description_width</span>, <span class="ruby-value">5</span>);
               }
               <span class="ruby-keyword">if</span> (<span class="ruby-identifier">project_info_needs_filling</span>(<span class="ruby-identifier">$pr</span>, <span class="ruby-identifier">$filter_set</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>(<span class="ruby-string">&#39;owner&#39;</span>))) {
                       <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;owner&#39;</span>} = <span class="ruby-identifier">git_get_project_owner</span>(<span class="ruby-string">&quot;$pr-&gt;{&#39;path&#39;}&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>;
               }
               <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$show_ctags</span> <span class="ruby-operator">&amp;&amp;</span>
                   <span class="ruby-identifier">project_info_needs_filling</span>(<span class="ruby-identifier">$pr</span>, <span class="ruby-identifier">$filter_set</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>(<span class="ruby-string">&#39;ctags&#39;</span>))) {
                       <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;ctags&#39;</span>} = <span class="ruby-identifier">git_get_project_ctags</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>});
               }
               <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$projects_list_group_categories</span> <span class="ruby-operator">&amp;&amp;</span>
                   <span class="ruby-identifier">project_info_needs_filling</span>(<span class="ruby-identifier">$pr</span>, <span class="ruby-identifier">$filter_set</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>(<span class="ruby-string">&#39;category&#39;</span>))) {
                       <span class="ruby-identifier">my</span> <span class="ruby-identifier">$cat</span> = <span class="ruby-identifier">git_get_project_category</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}) <span class="ruby-operator">||</span>
                                                          <span class="ruby-identifier">$project_list_default_category</span>;
                       <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;category&#39;</span>} = <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$cat</span>);
               }

               <span class="ruby-identifier">push</span> <span class="ruby-ivar">@projects</span>, <span class="ruby-identifier">$pr</span>;
       }

       <span class="ruby-keyword">return</span> <span class="ruby-ivar">@projects</span>;
</pre>

<p>}</p>

<p>sub sort_projects_list {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$projlist</span>, <span class="ruby-identifier">$order</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">sub</span> <span class="ruby-identifier">order_str</span> {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$key</span> = <span class="ruby-identifier">shift</span>;
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">sub</span> { <span class="ruby-identifier">$a</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$key</span>} <span class="ruby-identifier">cmp</span> <span class="ruby-identifier">$b</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$key</span>} };
}

<span class="ruby-identifier">sub</span> <span class="ruby-identifier">order_num_then_undef</span> {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$key</span> = <span class="ruby-identifier">shift</span>;
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">sub</span> {
                <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$a</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$key</span>} <span class="ruby-operator">?</span>
                        (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$b</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$key</span>} <span class="ruby-operator">?</span> <span class="ruby-identifier">$a</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$key</span>} <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">$b</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$key</span>} <span class="ruby-operator">:</span> <span class="ruby-value">-1</span>) <span class="ruby-operator">:</span>
                        (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$b</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$key</span>} <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>)
        };
}

<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">rderings</span> = (
        <span class="ruby-identifier">project</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">order_str</span>(<span class="ruby-string">&#39;path&#39;</span>),
        <span class="ruby-identifier">descr</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">order_str</span>(<span class="ruby-string">&#39;descr_long&#39;</span>),
        <span class="ruby-identifier">owner</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">order_str</span>(<span class="ruby-string">&#39;owner&#39;</span>),
        <span class="ruby-identifier">age</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">order_num_then_undef</span>(<span class="ruby-string">&#39;age&#39;</span>),
);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$ordering</span> = <span class="ruby-identifier">$orderings</span>{<span class="ruby-identifier">$order</span>};
<span class="ruby-keyword">return</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$ordering</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">sort</span> <span class="ruby-identifier">$ordering</span> @<span class="ruby-identifier">$projlist</span> <span class="ruby-operator">:</span> @<span class="ruby-identifier">$projlist</span>;
</pre>

<p>}</p>

<p># returns a hash of categories, containing the list of project # belonging
to each category sub build_projlist_by_category {</p>

<pre>my ($projlist, $from, $to) = @_;
my %categories;

$from = 0 unless defined $from;
$to = $#$projlist if (!defined $to || $#$projlist &lt; $to);

for (my $i = $from; $i &lt;= $to; $i++) {
        my $pr = $projlist-&gt;[$i];
        push @{$categories{ $pr-&gt;{&#39;category&#39;} }}, $pr;
}

return wantarray ? %categories : \%categories;</pre>

<p>}</p>

<p># print &#39;sort by&#39; &lt;th&gt; element, generating &#39;sort by
$name&#39; replay link # if that order is not selected sub print_sort_th {</p>

<pre>print format_sort_th(@_);</pre>

<p>}</p>

<p>sub format_sort_th {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$name</span>, <span class="ruby-identifier">$order</span>, <span class="ruby-identifier">$header</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$sort_th</span> = <span class="ruby-string">&quot;&quot;</span>;
<span class="ruby-identifier">$header</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">ucfirst</span>(<span class="ruby-identifier">$name</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$order</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$name</span>) {
        <span class="ruby-identifier">$sort_th</span> .= <span class="ruby-string">&quot;&lt;th&gt;$header&lt;/th&gt;\n&quot;</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$sort_th</span> .= <span class="ruby-string">&quot;&lt;th&gt;&quot;</span> .
                    <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">order</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$name</span>),
                             <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;header&quot;</span>}, <span class="ruby-identifier">$header</span>) .
                    <span class="ruby-string">&quot;&lt;/th&gt;\n&quot;</span>;
}

<span class="ruby-keyword">return</span> <span class="ruby-identifier">$sort_th</span>;
</pre>

<p>}</p>

<p>sub git_project_list_rows {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$projlist</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$check_forks</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">$from</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from</span>;
<span class="ruby-identifier">$to</span> = $<span class="ruby-comment">#$projlist if (!defined $to || $#$projlist &lt; $to);</span>

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-identifier">$from</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$to</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$pr</span> = <span class="ruby-identifier">$projlist</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>[<span class="ruby-identifier">$i</span>];

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$check_forks</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;forks&#39;</span>}) {
                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$nforks</span> = <span class="ruby-identifier">scalar</span> @{<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;forks&#39;</span>}};
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$nforks</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
                                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;forks&quot;</span>),
                                               <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;$nforks forks&quot;</span>}, <span class="ruby-string">&quot;+&quot;</span>);
                        } <span class="ruby-keyword">else</span> {
                                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">span</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;$nforks forks&quot;</span>}, <span class="ruby-string">&quot;+&quot;</span>);
                        }
                }
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;summary&quot;</span>),
                                <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>},
                               <span class="ruby-identifier">esc_html_match_hl</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">$search_regexp</span>)) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;summary&quot;</span>),
                                <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>,
                                <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;descr_long&#39;</span>}},
                                <span class="ruby-identifier">$search_regexp</span>
                                <span class="ruby-value">? </span><span class="ruby-identifier">esc_html_match_hl_chopped</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;descr_long&#39;</span>},
                                                            <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;descr&#39;</span>}, <span class="ruby-identifier">$search_regexp</span>)
                                <span class="ruby-operator">:</span> <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;descr&#39;</span>})) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
        <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$omit_owner</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&lt;i&gt;&quot;</span> . <span class="ruby-identifier">chop_and_escape_str</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;owner&#39;</span>}, <span class="ruby-value">15</span>) . <span class="ruby-string">&quot;&lt;/i&gt;&lt;/td&gt;\n&quot;</span>;
        }
        <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$omit_age_column</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;&quot;</span>. <span class="ruby-identifier">age_class</span>(<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;age&#39;</span>}) . <span class="ruby-string">&quot;\&quot;&gt;&quot;</span> .
                    (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;age_string&#39;</span>} <span class="ruby-operator">?</span> <span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;age_string&#39;</span>} <span class="ruby-operator">:</span> <span class="ruby-string">&quot;No commits&quot;</span>) . <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span><span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;summary&quot;</span>)}, <span class="ruby-string">&quot;summary&quot;</span>)   . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;shortlog&quot;</span>)}, <span class="ruby-string">&quot;shortlog&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;log&quot;</span>)}, <span class="ruby-string">&quot;log&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>)}, <span class="ruby-string">&quot;tree&quot;</span>) .
              (<span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;forks&#39;</span>} <span class="ruby-operator">?</span> <span class="ruby-string">&quot; | &quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$pr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;forks&quot;</span>)}, <span class="ruby-string">&quot;forks&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
</pre>

<p>}</p>

<p>sub git_project_list_body {</p>

<pre class="ruby"><span class="ruby-comment"># actually uses global variable $project</span>
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$projlist</span>, <span class="ruby-identifier">$order</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$extra</span>, <span class="ruby-identifier">$no_header</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@projects</span> = @<span class="ruby-identifier">$projlist</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$check_forks</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;forks&#39;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$show_ctags</span>  = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;ctags&#39;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$tagfilter</span> = <span class="ruby-identifier">$show_ctags</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;ctag&#39;</span>} <span class="ruby-operator">:</span> <span class="ruby-keyword">undef</span>;
<span class="ruby-identifier">$check_forks</span> = <span class="ruby-keyword">undef</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$tagfilter</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$search_regexp</span>);

<span class="ruby-comment"># filtering out forks before filling info allows to do less work</span>
<span class="ruby-ivar">@projects</span> = <span class="ruby-identifier">filter_forks_from_projects_list</span>(\<span class="ruby-ivar">@projects</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$check_forks</span>);
<span class="ruby-comment"># search_projects_list pre-fills required info</span>
<span class="ruby-ivar">@projects</span> = <span class="ruby-identifier">search_projects_list</span>(\<span class="ruby-ivar">@projects</span>,
                                 <span class="ruby-string">&#39;search_regexp&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$search_regexp</span>,
                                 <span class="ruby-string">&#39;tagfilter&#39;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$tagfilter</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$tagfilter</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$search_regexp</span>);
<span class="ruby-comment"># fill the rest</span>
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@all_fields</span> = (<span class="ruby-string">&#39;descr&#39;</span>, <span class="ruby-string">&#39;descr_long&#39;</span>, <span class="ruby-string">&#39;ctags&#39;</span>, <span class="ruby-string">&#39;category&#39;</span>);
<span class="ruby-identifier">push</span> <span class="ruby-ivar">@all_fields</span>, (<span class="ruby-string">&#39;age&#39;</span>, <span class="ruby-string">&#39;age_string&#39;</span>) <span class="ruby-keyword">unless</span>(<span class="ruby-identifier">$omit_age_column</span>);
<span class="ruby-identifier">push</span> <span class="ruby-ivar">@all_fields</span>, <span class="ruby-string">&#39;owner&#39;</span> <span class="ruby-keyword">unless</span>(<span class="ruby-identifier">$omit_owner</span>);
<span class="ruby-ivar">@projects</span> = <span class="ruby-identifier">fill_project_list_info</span>(\<span class="ruby-ivar">@projects</span>, <span class="ruby-ivar">@all_fields</span>);

<span class="ruby-identifier">$order</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">$default_projects_order</span>;
<span class="ruby-identifier">$from</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from</span>;
<span class="ruby-identifier">$to</span> = $<span class="ruby-comment">#projects if (!defined $to || $#projects &lt; $to);</span>

<span class="ruby-comment"># short circuit</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$from</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$to</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;center&gt;\n&quot;</span>.
              <span class="ruby-string">&quot;&lt;b&gt;No such projects found&lt;/b&gt;&lt;br /&gt;\n&quot;</span>.
              <span class="ruby-string">&quot;Click &quot;</span>.<span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">href</span>(<span class="ruby-identifier">project</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>)},<span class="ruby-string">&quot;here&quot;</span>).<span class="ruby-string">&quot; to view all projects&lt;br /&gt;\n&quot;</span>.
              <span class="ruby-string">&quot;&lt;/center&gt;\n&lt;br /&gt;\n&quot;</span>;
        <span class="ruby-keyword">return</span>;
}

<span class="ruby-ivar">@projects</span> = <span class="ruby-identifier">sort_projects_list</span>(\<span class="ruby-ivar">@projects</span>, <span class="ruby-identifier">$order</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$show_ctags</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ctags</span> = <span class="ruby-identifier">git_gather_all_ctags</span>(\<span class="ruby-ivar">@projects</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$cloud</span> = <span class="ruby-identifier">git_populate_project_tagcloud</span>(<span class="ruby-identifier">$ctags</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">git_show_project_tagcloud</span>(<span class="ruby-identifier">$cloud</span>, <span class="ruby-value">64</span>);
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;project_list\&quot;&gt;\n&quot;</span>;
<span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$no_header</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$check_forks</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;th&gt;&lt;/th&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">print_sort_th</span>(<span class="ruby-string">&#39;project&#39;</span>, <span class="ruby-identifier">$order</span>, <span class="ruby-string">&#39;Project&#39;</span>);
        <span class="ruby-identifier">print_sort_th</span>(<span class="ruby-string">&#39;descr&#39;</span>, <span class="ruby-identifier">$order</span>, <span class="ruby-string">&#39;Description&#39;</span>);
        <span class="ruby-identifier">print_sort_th</span>(<span class="ruby-string">&#39;owner&#39;</span>, <span class="ruby-identifier">$order</span>, <span class="ruby-string">&#39;Owner&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$omit_owner</span>;
        <span class="ruby-identifier">print_sort_th</span>(<span class="ruby-string">&#39;age&#39;</span>, <span class="ruby-identifier">$order</span>, <span class="ruby-string">&#39;Last Change&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$omit_age_column</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;th&gt;&lt;/th&gt;\n&quot;</span> . <span class="ruby-comment"># for links</span>
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$projects_list_group_categories</span>) {
        <span class="ruby-comment"># only display categories with projects in the $from-$to window</span>
        <span class="ruby-ivar">@projects</span> = <span class="ruby-identifier">sort</span> {<span class="ruby-identifier">$a</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;category&#39;</span>} <span class="ruby-identifier">cmp</span> <span class="ruby-identifier">$b</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;category&#39;</span>}} <span class="ruby-ivar">@projects</span>[<span class="ruby-identifier">$from</span><span class="ruby-operator">..</span><span class="ruby-identifier">$to</span>];
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ategories</span> = <span class="ruby-identifier">build_projlist_by_category</span>(\<span class="ruby-ivar">@projects</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>);
        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$cat</span> (<span class="ruby-identifier">sort</span> <span class="ruby-identifier">keys</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ategories</span>) {
                <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">$cat</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;&quot;</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span>;
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$check_forks</span>) {
                                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&lt;/td&gt;\n&quot;</span>;
                        }
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;category\&quot; colspan=\&quot;5\&quot;&gt;&quot;</span>.<span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$cat</span>).<span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
                }

                <span class="ruby-identifier">git_project_list_rows</span>(<span class="ruby-identifier">$categories</span>{<span class="ruby-identifier">$cat</span>}, <span class="ruby-keyword">undef</span>, <span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$check_forks</span>);
        }
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">git_project_list_rows</span>(\<span class="ruby-ivar">@projects</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$check_forks</span>);
}

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$extra</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$check_forks</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&lt;/td&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td colspan=\&quot;5\&quot;&gt;$extra&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p>sub git_log_body {</p>

<pre class="ruby"><span class="ruby-comment"># uses global variable $project</span>
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$commitlist</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$extra</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">$from</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from</span>;
<span class="ruby-identifier">$to</span> = $<span class="ruby-comment">#{$commitlist} if (!defined $to || $#{$commitlist} &lt; $to);</span>

<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$to</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-string">%Q{$commitlist-&gt;[$i]}</span>;
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-operator">%</span><span class="ruby-identifier">o</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$commit</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>};
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ref</span> = <span class="ruby-identifier">format_ref_marker</span>(<span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$commit</span>);
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>,
                       <span class="ruby-string">&quot;&lt;span class=\&quot;age\&quot;&gt;$co{&#39;age_string&#39;}&lt;/span&gt;&quot;</span> .
                       <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-identifier">$ref</span>,
                       <span class="ruby-identifier">$commit</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;title_text\&quot;&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;div class=\&quot;log_link\&quot;&gt;\n&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>)}, <span class="ruby-string">&quot;commit&quot;</span>) .
              <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commitdiff&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>)}, <span class="ruby-string">&quot;commitdiff&quot;</span>) .
              <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>)}, <span class="ruby-string">&quot;tree&quot;</span>) .
              <span class="ruby-string">&quot;&lt;br/&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
              <span class="ruby-identifier">git_print_authorship</span>(\<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">tag</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;span&#39;</span>);
              <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;br/&gt;\n&lt;/div&gt;\n&quot;</span>;

        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;log_body\&quot;&gt;\n&quot;</span>;
        <span class="ruby-identifier">git_print_log</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;comment&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">final_empty_line</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$extra</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_nav\&quot;&gt;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$extra\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
}
</pre>

<p>}</p>

<p>sub git_shortlog_body {</p>

<pre class="ruby"><span class="ruby-comment"># uses global variable $project</span>
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$commitlist</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$extra</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">$from</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from</span>;
<span class="ruby-identifier">$to</span> = $<span class="ruby-comment">#{$commitlist} if (!defined $to || $#{$commitlist} &lt; $to);</span>

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;shortlog\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-identifier">$from</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$to</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-string">%Q{$commitlist-&gt;[$i]}</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$commit</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>};
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ref</span> = <span class="ruby-identifier">format_ref_marker</span>(<span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$commit</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;
        <span class="ruby-comment"># git_summary() used print &quot;&lt;td&gt;&lt;i&gt;$co{&#39;age_string&#39;}&lt;/i&gt;&lt;/td&gt;\n&quot; .</span>
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td title=\&quot;$co{&#39;age_string_age&#39;}\&quot;&gt;&lt;i&gt;$co{&#39;age_string_date&#39;}&lt;/i&gt;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-identifier">format_author_html</span>(<span class="ruby-string">&#39;td&#39;</span>, \<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>, <span class="ruby-value">10</span>) . <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">format_subject_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title_short&#39;</span>},
                                  <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>), <span class="ruby-identifier">$ref</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>)}, <span class="ruby-string">&quot;commit&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commitdiff&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>)}, <span class="ruby-string">&quot;commitdiff&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>)}, <span class="ruby-string">&quot;tree&quot;</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$snapshot_links</span> = <span class="ruby-identifier">format_snapshot_links</span>(<span class="ruby-identifier">$commit</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$snapshot_links</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> . <span class="ruby-identifier">$snapshot_links</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$extra</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td colspan=\&quot;4\&quot;&gt;$extra&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p>sub git_history_body {</p>

<pre class="ruby"><span class="ruby-comment"># Warning: assumes constant type (blob or tree) during history</span>
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$commitlist</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$extra</span>,
    <span class="ruby-identifier">$file_name</span>, <span class="ruby-identifier">$file_hash</span>, <span class="ruby-identifier">$ftype</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">$from</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from</span>;
<span class="ruby-identifier">$to</span> = $<span class="ruby-comment">#{$commitlist} unless (defined $to &amp;&amp; $to &lt;= $#{$commitlist});</span>

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;history\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-identifier">$from</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$to</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-string">%Q{$commitlist-&gt;[$i]}</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-operator">%</span><span class="ruby-identifier">o</span>) {
                <span class="ruby-keyword">next</span>;
        }
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$commit</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>};

        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ref</span> = <span class="ruby-identifier">format_ref_marker</span>(<span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$commit</span>);

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td title=\&quot;$co{&#39;age_string_age&#39;}\&quot;&gt;&lt;i&gt;$co{&#39;age_string_date&#39;}&lt;/i&gt;&lt;/td&gt;\n&quot;</span> .
<span class="ruby-comment"># shortlog:   format_author_html(&#39;td&#39;, \%co, 10)</span>
              <span class="ruby-identifier">format_author_html</span>(<span class="ruby-string">&#39;td&#39;</span>, \<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>, <span class="ruby-value">15</span>, <span class="ruby-value">3</span>) . <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>;
        <span class="ruby-comment"># originally git_history used chop_str($co{&#39;title&#39;}, 50)</span>
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">format_subject_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title_short&#39;</span>},
                                  <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>), <span class="ruby-identifier">$ref</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$ftype</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>)}, <span class="ruby-identifier">$ftype</span>) . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commitdiff&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>)}, <span class="ruby-string">&quot;commitdiff&quot;</span>);

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$ftype</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;blob&#39;</span>) {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$blob_current</span> = <span class="ruby-identifier">$file_hash</span>;
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$blob_parent</span>  = <span class="ruby-identifier">git_get_hash_by_path</span>(<span class="ruby-identifier">$commit</span>, <span class="ruby-identifier">$file_name</span>);
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$blob_current</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$blob_parent</span> <span class="ruby-operator">&amp;&amp;</span>
                                <span class="ruby-identifier">$blob_current</span> <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$blob_parent</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> .
                                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blobdiff&quot;</span>,
                                                       <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$blob_current</span>, <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$blob_parent</span>,
                                                       <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_base</span>, <span class="ruby-identifier">hash_parent_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>,
                                                       <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>)},
                                        <span class="ruby-string">&quot;diff to current&quot;</span>);
                }
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$extra</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td colspan=\&quot;4\&quot;&gt;$extra&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p>sub git_tags_body {</p>

<pre class="ruby"><span class="ruby-comment"># uses global variable $project</span>
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$taglist</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$extra</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">$from</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from</span>;
<span class="ruby-identifier">$to</span> = $<span class="ruby-comment">#{$taglist} if (!defined $to || $#{$taglist} &lt; $to);</span>

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;tags\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-identifier">$from</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$to</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$entry</span> = <span class="ruby-identifier">$taglist</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>[<span class="ruby-identifier">$i</span>];
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ag</span> = <span class="ruby-string">%Qentry;
        my $</span><span class="ruby-identifier">comment</span> = <span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;subject&#39;</span>};
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$comment_short</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$comment</span>) {
                <span class="ruby-identifier">$comment_short</span> = <span class="ruby-identifier">chop_str</span>(<span class="ruby-identifier">$comment</span>, <span class="ruby-value">30</span>, <span class="ruby-value">5</span>);
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;age&#39;</span>}) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&lt;i&gt;$tag{&#39;age&#39;}&lt;/i&gt;&lt;/td&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&lt;/td&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;reftype&#39;</span>}, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;refid&#39;</span>}),
                       <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list name&quot;</span>}, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;name&#39;</span>})) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$comment</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">format_subject_html</span>(<span class="ruby-identifier">$comment</span>, <span class="ruby-identifier">$comment_short</span>,
                                          <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tag&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;id&#39;</span>}));
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;selflink\&quot;&gt;&quot;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;type&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;tag&quot;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tag&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;id&#39;</span>})}, <span class="ruby-string">&quot;tag&quot;</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&amp;nbsp;&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;reftype&#39;</span>}, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;refid&#39;</span>})}, <span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;reftype&#39;</span>});
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;reftype&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;commit&quot;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;shortlog&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;fullname&#39;</span>})}, <span class="ruby-string">&quot;shortlog&quot;</span>) .
                      <span class="ruby-string">&quot; | &quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;log&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;fullname&#39;</span>})}, <span class="ruby-string">&quot;log&quot;</span>);
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;reftype&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-string">&quot;blob&quot;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob_plain&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;refid&#39;</span>})}, <span class="ruby-string">&quot;raw&quot;</span>);
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$extra</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td colspan=\&quot;5\&quot;&gt;$extra&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p>sub git_heads_body {</p>

<pre class="ruby"><span class="ruby-comment"># uses global variable $project</span>
<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$headlist</span>, <span class="ruby-identifier">$head_at</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$extra</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">$from</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from</span>;
<span class="ruby-identifier">$to</span> = $<span class="ruby-comment">#{$headlist} if (!defined $to || $#{$headlist} &lt; $to);</span>

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;heads\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-identifier">$from</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$to</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$entry</span> = <span class="ruby-identifier">$headlist</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>[<span class="ruby-identifier">$i</span>];
        <span class="ruby-identifier">my</span> <span class="ruby-regexp">%rf = %$en</span><span class="ruby-identifier">try</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$curr</span> = <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$head_at</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$ref</span>{<span class="ruby-string">&#39;id&#39;</span>} <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$head_at</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&lt;i&gt;$ref{&#39;age&#39;}&lt;/i&gt;&lt;/td&gt;\n&quot;</span> .
              (<span class="ruby-identifier">$curr</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&lt;td class=\&quot;current_head\&quot;&gt;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>) .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;shortlog&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$ref</span>{<span class="ruby-string">&#39;fullname&#39;</span>}),
                       <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list name&quot;</span>},<span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$ref</span>{<span class="ruby-string">&#39;name&#39;</span>})) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;shortlog&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$ref</span>{<span class="ruby-string">&#39;fullname&#39;</span>})}, <span class="ruby-string">&quot;shortlog&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;log&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$ref</span>{<span class="ruby-string">&#39;fullname&#39;</span>})}, <span class="ruby-string">&quot;log&quot;</span>) . <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$ref</span>{<span class="ruby-string">&#39;fullname&#39;</span>}, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$ref</span>{<span class="ruby-string">&#39;fullname&#39;</span>})}, <span class="ruby-string">&quot;tree&quot;</span>) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$extra</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td colspan=\&quot;3\&quot;&gt;$extra&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p># Display a single remote block sub git_remote_block {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$remote</span>, <span class="ruby-identifier">$rdata</span>, <span class="ruby-identifier">$limit</span>, <span class="ruby-identifier">$head</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$heads</span> = <span class="ruby-identifier">$rdata</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;heads&#39;</span>};
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$fetch</span> = <span class="ruby-identifier">$rdata</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;fetch&#39;</span>};
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$push</span> = <span class="ruby-identifier">$rdata</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;push&#39;</span>};

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$urls_table</span> = <span class="ruby-string">&quot;&lt;table class=\&quot;projects_list\&quot;&gt;\n&quot;</span> ;

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$fetch</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$fetch</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$push</span>) {
                <span class="ruby-identifier">$urls_table</span> .= <span class="ruby-identifier">format_repo_url</span>(<span class="ruby-string">&quot;URL&quot;</span>, <span class="ruby-identifier">$fetch</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$urls_table</span> .= <span class="ruby-identifier">format_repo_url</span>(<span class="ruby-string">&quot;Fetch URL&quot;</span>, <span class="ruby-identifier">$fetch</span>);
                <span class="ruby-identifier">$urls_table</span> .= <span class="ruby-identifier">format_repo_url</span>(<span class="ruby-string">&quot;Push URL&quot;</span>, <span class="ruby-identifier">$push</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$push</span>;
        }
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$push</span>) {
        <span class="ruby-identifier">$urls_table</span> .= <span class="ruby-identifier">format_repo_url</span>(<span class="ruby-string">&quot;Push URL&quot;</span>, <span class="ruby-identifier">$push</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$urls_table</span> .= <span class="ruby-identifier">format_repo_url</span>(<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;No remote URL&quot;</span>);
}

<span class="ruby-identifier">$urls_table</span> .= <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$dots</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$limit</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$limit</span> <span class="ruby-operator">&lt;</span> @<span class="ruby-identifier">$heads</span>) {
        <span class="ruby-identifier">$dots</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;remotes&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$remote</span>)}, <span class="ruby-string">&quot;...&quot;</span>);
}

<span class="ruby-identifier">print</span> <span class="ruby-identifier">$urls_table</span>;
<span class="ruby-identifier">git_heads_body</span>(<span class="ruby-identifier">$heads</span>, <span class="ruby-identifier">$head</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">$limit</span>, <span class="ruby-identifier">$dots</span>);
</pre>

<p>}</p>

<p># Display a list of remote names with the respective fetch and push URLs
sub git_remotes_list {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$remotedata</span>, <span class="ruby-identifier">$limit</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;heads\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@remotes</span> = <span class="ruby-identifier">sort</span> <span class="ruby-identifier">keys</span> <span class="ruby-string">%Qremotedata;

my $</span><span class="ruby-identifier">limited</span> = <span class="ruby-identifier">$limit</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$limit</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@remotes</span>;

$<span class="ruby-comment">#remotes = $limit - 1 if $limited;</span>

<span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$remote</span> = <span class="ruby-identifier">shift</span> <span class="ruby-ivar">@remotes</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$rdata</span> = <span class="ruby-identifier">$remotedata</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$remote</span>};
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fetch</span> = <span class="ruby-identifier">$rdata</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;fetch&#39;</span>};
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$push</span> = <span class="ruby-identifier">$rdata</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;push&#39;</span>};
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;remotes&#39;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$remote</span>),
                       <span class="ruby-operator">-</span><span class="ruby-identifier">class</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list name&quot;</span>},<span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$remote</span>)) .
              <span class="ruby-string">&quot;&lt;/td&gt;&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
              (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$fetch</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$fetch</span>}, <span class="ruby-string">&quot;fetch&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-string">&quot;fetch&quot;</span>) .
              <span class="ruby-string">&quot; | &quot;</span> .
              (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$push</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$push</span>}, <span class="ruby-string">&quot;push&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-string">&quot;push&quot;</span>) .
              <span class="ruby-string">&quot;&lt;/td&gt;&quot;</span>;

        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$limited</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td colspan=\&quot;3\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;remotes&quot;</span>)}, <span class="ruby-string">&quot;...&quot;</span>) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> . <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;&quot;</span>;
</pre>

<p>}</p>

<p># Display remote heads grouped by remote, unless there are too many #
remotes, in which case we only display the remote names sub
git_remotes_body {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$remotedata</span>, <span class="ruby-identifier">$limit</span>, <span class="ruby-identifier">$head</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$limit</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">$limit</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">keys</span> <span class="ruby-string">%Qremotedata) {
        git_remotes_list($</span><span class="ruby-identifier">remotedata</span>, <span class="ruby-identifier">$limit</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">fill_remote_heads</span>(<span class="ruby-identifier">$remotedata</span>);
        <span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$remote</span>, <span class="ruby-identifier">$rdata</span>) = <span class="ruby-identifier">each</span> <span class="ruby-string">%Qremotedata) {
                git_print_section({-class=&gt;&quot;remote&quot;, -id=&gt;$</span><span class="ruby-identifier">remote</span>},
                        [<span class="ruby-string">&quot;remotes&quot;</span>, <span class="ruby-identifier">$remote</span>, <span class="ruby-identifier">$remote</span>], <span class="ruby-identifier">sub</span> {
                                <span class="ruby-identifier">git_remote_block</span>(<span class="ruby-identifier">$remote</span>, <span class="ruby-identifier">$rdata</span>, <span class="ruby-identifier">$limit</span>, <span class="ruby-identifier">$head</span>);
                        });
        }
}
</pre>

<p>}</p>

<p>sub git_search_message {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$greptype</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$searchtype</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;commit&#39;</span>) {
        <span class="ruby-identifier">$greptype</span> = <span class="ruby-string">&quot;--grep=&quot;</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$searchtype</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;author&#39;</span>) {
        <span class="ruby-identifier">$greptype</span> = <span class="ruby-string">&quot;--author=&quot;</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$searchtype</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;committer&#39;</span>) {
        <span class="ruby-identifier">$greptype</span> = <span class="ruby-string">&quot;--committer=&quot;</span>;
}
<span class="ruby-identifier">$greptype</span> .= <span class="ruby-identifier">$searchtext</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@commitlist</span> = <span class="ruby-identifier">parse_commits</span>(<span class="ruby-identifier">$hash</span>, <span class="ruby-value">101</span>, (<span class="ruby-value">100</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">$page</span>), <span class="ruby-keyword">undef</span>,
                               <span class="ruby-identifier">$greptype</span>, <span class="ruby-string">&#39;--regexp-ignore-case&#39;</span>,
                               <span class="ruby-identifier">$search_use_regexp</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;--extended-regexp&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;--fixed-strings&#39;</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$paging_nav</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$page</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
        <span class="ruby-identifier">$paging_nav</span> .=
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">page</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>)},
                        <span class="ruby-string">&quot;first&quot;</span>) .
                <span class="ruby-string">&quot; &amp;sdot; &quot;</span> .
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">page</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$page</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>),
                         <span class="ruby-operator">-</span><span class="ruby-identifier">accesskey</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Alt-p&quot;</span>}, <span class="ruby-string">&quot;prev&quot;</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$paging_nav</span> .= <span class="ruby-string">&quot;first &amp;sdot; prev&quot;</span>;
}
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$next_link</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-keyword">if</span> ($<span class="ruby-comment">#commitlist &gt;= 100) {</span>
        <span class="ruby-identifier">$next_link</span> =
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">page</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$page</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>),
                         <span class="ruby-operator">-</span><span class="ruby-identifier">accesskey</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;n&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Alt-n&quot;</span>}, <span class="ruby-string">&quot;next&quot;</span>);
        <span class="ruby-identifier">$paging_nav</span> .= <span class="ruby-string">&quot; &amp;sdot; $next_link&quot;</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$paging_nav</span> .= <span class="ruby-string">&quot; &amp;sdot; next&quot;</span>;
}

<span class="ruby-identifier">git_header_html</span>();

<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash</span>,<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},<span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$paging_nav</span>);
<span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}), <span class="ruby-identifier">$hash</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$page</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@commitlist</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;p&gt;No match.&lt;/p&gt;\n&quot;</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">git_search_grep_body</span>(\<span class="ruby-ivar">@commitlist</span>, <span class="ruby-value">0</span>, <span class="ruby-value">99</span>, <span class="ruby-identifier">$next_link</span>);
}

<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_search_changes {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">local</span> <span class="ruby-identifier">$/</span> = <span class="ruby-string">&quot;\n&quot;</span>;
<span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&#39;-|&#39;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&#39;--no-pager&#39;</span>, <span class="ruby-string">&#39;log&#39;</span>, <span class="ruby-ivar">@diff_opts</span>,
        <span class="ruby-string">&#39;--pretty=format:%H&#39;</span>, <span class="ruby-string">&#39;--no-abbrev&#39;</span>, <span class="ruby-string">&#39;--raw&#39;</span>, <span class="ruby-string">&quot;-S$searchtext&quot;</span>,
        (<span class="ruby-identifier">$search_use_regexp</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;--pickaxe-regex&#39;</span> <span class="ruby-operator">:</span> ())
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-log failed&quot;</span>);

<span class="ruby-identifier">git_header_html</span>();

<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash</span>,<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},<span class="ruby-identifier">$hash</span>);
<span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}), <span class="ruby-identifier">$hash</span>);

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;pickaxe search\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-keyword">undef</span> <span class="ruby-operator">%</span><span class="ruby-identifier">co</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@files</span>;
<span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
        <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$line</span>;
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$line</span>;

        <span class="ruby-identifier">my</span> <span class="ruby-value">%st = parse</span><span class="ruby-identifier">_difftree_raw_line</span>(<span class="ruby-identifier">$line</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$set</span>{<span class="ruby-string">&#39;commit&#39;</span>}) {
                <span class="ruby-comment"># finish previous commit</span>
                <span class="ruby-keyword">if</span> (<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
                              <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
                              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>})},
                                      <span class="ruby-string">&quot;commit&quot;</span>) .
                              <span class="ruby-string">&quot; | &quot;</span> .
                              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},
                                                     <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>})},
                                      <span class="ruby-string">&quot;tree&quot;</span>) .
                              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
                              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
                }

                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
                } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
                }
                <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;
                <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$set</span>{<span class="ruby-string">&#39;commit&#39;</span>});
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$author</span> = <span class="ruby-identifier">chop_and_escape_str</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_name&#39;</span>}, <span class="ruby-value">15</span>, <span class="ruby-value">5</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td title=\&quot;$co{&#39;age_string_age&#39;}\&quot;&gt;&lt;i&gt;$co{&#39;age_string_date&#39;}&lt;/i&gt;&lt;/td&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;td&gt;&lt;i&gt;$author&lt;/i&gt;&lt;/td&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> .
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>}),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list subject&quot;</span>},
                              <span class="ruby-identifier">chop_and_escape_str</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}, <span class="ruby-value">50</span>) . <span class="ruby-string">&quot;&lt;br/&gt;&quot;</span>);
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$set</span>{<span class="ruby-string">&#39;to_id&#39;</span>}) {
                <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$set</span>{<span class="ruby-string">&#39;to_id&#39;</span>} <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-value">0</span>{<span class="ruby-value">40</span>}<span class="ruby-identifier">$/</span>);

                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>},
                                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$set</span>{<span class="ruby-string">&#39;to_id&#39;</span>}, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$set</span>{<span class="ruby-string">&#39;to_file&#39;</span>}),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>},
                              <span class="ruby-string">&quot;&lt;span class=\&quot;match\&quot;&gt;&quot;</span> . <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$set</span>{<span class="ruby-string">&#39;file&#39;</span>}) . <span class="ruby-string">&quot;&lt;/span&gt;&quot;</span>) .
                      <span class="ruby-string">&quot;&lt;br/&gt;\n&quot;</span>;
        }
}
<span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>;

<span class="ruby-comment"># finish last commit (warning: repetition!)</span>
<span class="ruby-keyword">if</span> (<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>})},
                      <span class="ruby-string">&quot;commit&quot;</span>) .
              <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},
                                     <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>})},
                      <span class="ruby-string">&quot;tree&quot;</span>) .
              <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;

<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_search_files {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">local</span> <span class="ruby-identifier">$/</span> = <span class="ruby-string">&quot;\n&quot;</span>;
<span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&#39;grep&#39;</span>, <span class="ruby-string">&#39;-n&#39;</span>, <span class="ruby-string">&#39;-z&#39;</span>,
        <span class="ruby-identifier">$search_use_regexp</span> <span class="ruby-operator">?</span> (<span class="ruby-string">&#39;-E&#39;</span>, <span class="ruby-string">&#39;-i&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-string">&#39;-F&#39;</span>,
        <span class="ruby-identifier">$searchtext</span>, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>}
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-grep failed&quot;</span>);

<span class="ruby-identifier">git_header_html</span>();

<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash</span>,<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},<span class="ruby-identifier">$hash</span>);
<span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}), <span class="ruby-identifier">$hash</span>);

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;grep_search\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$matches</span> = <span class="ruby-value">0</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$lastfile</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$file_href</span>;
<span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
        <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$line</span>;
        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$file</span>, <span class="ruby-identifier">$lno</span>, <span class="ruby-identifier">$ltext</span>, <span class="ruby-identifier">$binary</span>);
        <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$matches</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1000</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^Binary file (.+) matches$/</span>) {
                <span class="ruby-identifier">$file</span> = <span class="ruby-node">$1</span>;
                <span class="ruby-identifier">$binary</span> = <span class="ruby-value">1</span>;
        } <span class="ruby-keyword">else</span> {
                (<span class="ruby-identifier">$file</span>, <span class="ruby-identifier">$lno</span>, <span class="ruby-identifier">$ltext</span>) = <span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\0/</span>, <span class="ruby-identifier">$line</span>, <span class="ruby-value">3</span>);
                <span class="ruby-identifier">$file</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>}<span class="ruby-operator">:</span><span class="ruby-regexp">//</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$file</span> <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$lastfile</span>) {
                <span class="ruby-identifier">$lastfile</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
                } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
                }
                <span class="ruby-identifier">$file_href</span> = <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>},
                                  <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;list\&quot;&gt;&quot;</span>.
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$file_href</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$file</span>));
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;&lt;td&gt;\n&quot;</span>;
                <span class="ruby-identifier">$lastfile</span> = <span class="ruby-identifier">$file</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$binary</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;binary\&quot;&gt;Binary file&lt;/div&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$ltext</span> = <span class="ruby-identifier">untabify</span>(<span class="ruby-identifier">$ltext</span>);
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$ltext</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>(.<span class="ruby-operator">*</span>)(<span class="ruby-identifier">$search_regexp</span>)(.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$/</span><span class="ruby-identifier">i</span>) {
                        <span class="ruby-identifier">$ltext</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-node">$1</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
                        <span class="ruby-identifier">$ltext</span> .= <span class="ruby-string">&#39;&lt;span class=&quot;match&quot;&gt;&#39;</span>;
                        <span class="ruby-identifier">$ltext</span> .= <span class="ruby-identifier">esc_html</span>(<span class="ruby-node">$2</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
                        <span class="ruby-identifier">$ltext</span> .= <span class="ruby-string">&#39;&lt;/span&gt;&#39;</span>;
                        <span class="ruby-identifier">$ltext</span> .= <span class="ruby-identifier">esc_html</span>(<span class="ruby-node">$3</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
                } <span class="ruby-keyword">else</span> {
                        <span class="ruby-identifier">$ltext</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$ltext</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
                }
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;pre\&quot;&gt;&quot;</span> .
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$file_href</span>.<span class="ruby-string">&#39;#l&#39;</span>.<span class="ruby-identifier">$lno</span>,
                                <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;linenr&quot;</span>}, <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&#39;%4i&#39;</span>, <span class="ruby-identifier">$lno</span>)) .
                        <span class="ruby-string">&#39; &#39;</span> .  <span class="ruby-identifier">$ltext</span> . <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
        }
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$lastfile</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$matches</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1000</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;diff nodifferences\&quot;&gt;Too many matches, listing trimmed&lt;/div&gt;\n&quot;</span>;
        }
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;diff nodifferences\&quot;&gt;No matches found&lt;/div&gt;\n&quot;</span>;
}
<span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>;

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;

<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_search_grep_body {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$commitlist</span>, <span class="ruby-identifier">$from</span>, <span class="ruby-identifier">$to</span>, <span class="ruby-identifier">$extra</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">$from</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$from</span>;
<span class="ruby-identifier">$to</span> = $<span class="ruby-comment">#{$commitlist} if (!defined $to || $#{$commitlist} &lt; $to);</span>

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;commit_search\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-identifier">$from</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$to</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-string">%Q{$commitlist-&gt;[$i]}</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-operator">%</span><span class="ruby-identifier">o</span>) {
                <span class="ruby-keyword">next</span>;
        }
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$commit</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>};
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$alternate</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">$alternate</span> <span class="ruby-operator">^=</span> <span class="ruby-value">1</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td title=\&quot;$co{&#39;age_string_age&#39;}\&quot;&gt;&lt;i&gt;$co{&#39;age_string_date&#39;}&lt;/i&gt;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-identifier">format_author_html</span>(<span class="ruby-string">&#39;td&#39;</span>, \<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>, <span class="ruby-value">15</span>, <span class="ruby-value">5</span>) .
              <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>}),
                       <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list subject&quot;</span>},
                      <span class="ruby-identifier">chop_and_escape_str</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}, <span class="ruby-value">50</span>) . <span class="ruby-string">&quot;&lt;br/&gt;&quot;</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$comment</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;comment&#39;</span>};
        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> (@<span class="ruby-identifier">$comment</span>) {
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>(.<span class="ruby-operator">*</span><span class="ruby-value">?)</span>(<span class="ruby-identifier">$search_regexp</span>)(.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$/</span><span class="ruby-identifier">i</span>) {
                        <span class="ruby-identifier">my</span> (<span class="ruby-identifier">$lead</span>, <span class="ruby-identifier">$match</span>, <span class="ruby-identifier">$trail</span>) = (<span class="ruby-node">$1</span>, <span class="ruby-node">$2</span>, <span class="ruby-node">$3</span>);
                        <span class="ruby-identifier">$match</span> = <span class="ruby-identifier">chop_str</span>(<span class="ruby-identifier">$match</span>, <span class="ruby-value">70</span>, <span class="ruby-value">5</span>, <span class="ruby-string">&#39;center&#39;</span>);
                        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$contextlen</span> = <span class="ruby-identifier">int</span>((<span class="ruby-value">80</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">length</span>(<span class="ruby-identifier">$match</span>))<span class="ruby-operator">/</span><span class="ruby-value">2</span>);
                        <span class="ruby-identifier">$contextlen</span> = <span class="ruby-value">30</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$contextlen</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">30</span>);
                        <span class="ruby-identifier">$lead</span>  = <span class="ruby-identifier">chop_str</span>(<span class="ruby-identifier">$lead</span>,  <span class="ruby-identifier">$contextlen</span>, <span class="ruby-value">10</span>, <span class="ruby-string">&#39;left&#39;</span>);
                        <span class="ruby-identifier">$trail</span> = <span class="ruby-identifier">chop_str</span>(<span class="ruby-identifier">$trail</span>, <span class="ruby-identifier">$contextlen</span>, <span class="ruby-value">10</span>, <span class="ruby-string">&#39;right&#39;</span>);

                        <span class="ruby-identifier">$lead</span>  = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$lead</span>);
                        <span class="ruby-identifier">$match</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$match</span>);
                        <span class="ruby-identifier">$trail</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$trail</span>);

                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$lead&lt;span class=\&quot;match\&quot;&gt;$match&lt;/span&gt;$trail&lt;br /&gt;&quot;</span>;
                }
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>})}, <span class="ruby-string">&quot;commit&quot;</span>) .
              <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commitdiff&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>})}, <span class="ruby-string">&quot;commitdiff&quot;</span>) .
              <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>}, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>})}, <span class="ruby-string">&quot;tree&quot;</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$extra</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;td colspan=\&quot;3\&quot;&gt;$extra&lt;/td&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;
</pre>

<p>}</p>

<p>## ======================================================================
## ======================================================================
## actions</p>

<p>sub git_project_list {</p>

<pre>my $order = $input_params{&#39;order&#39;};
if (defined $order &amp;&amp; $order !~ m/none|project|descr|owner|age/) {
        die_error(400, &quot;Unknown order parameter&quot;);
}

my @list = git_get_projects_list($project_filter, $strict_export);
if (!@list) {
        die_error(404, &quot;No projects found&quot;);
}

git_header_html();
if (defined $home_text &amp;&amp; -f $home_text) {
        print &quot;&lt;div class=\&quot;index_include\&quot;&gt;\n&quot;;
        insert_file($home_text);
        print &quot;&lt;/div&gt;\n&quot;;
}

git_project_search_form($searchtext, $search_use_regexp);
git_project_list_body(\@list, $order);
git_footer_html();</pre>

<p>}</p>

<p>sub git_forks {</p>

<pre>my $order = $input_params{&#39;order&#39;};
if (defined $order &amp;&amp; $order !~ m/none|project|descr|owner|age/) {
        die_error(400, &quot;Unknown order parameter&quot;);
}

my $filter = $project;
$filter =~ s/\.git$//;
my @list = git_get_projects_list($filter);
if (!@list) {
        die_error(404, &quot;No forks found&quot;);
}

git_header_html();
git_print_page_nav(&#39;&#39;,&#39;&#39;);
git_print_header_div(&#39;summary&#39;, &quot;$project forks&quot;);
git_project_list_body(\@list, $order);
git_footer_html();</pre>

<p>}</p>

<p>sub git_project_index {</p>

<pre>my @projects = git_get_projects_list($project_filter, $strict_export);
if (!@projects) {
        die_error(404, &quot;No projects found&quot;);
}

print $cgi-&gt;header(
        -type =&gt; &#39;text/plain&#39;,
        -charset =&gt; &#39;utf-8&#39;,
        -content_disposition =&gt; &#39;inline; filename=&quot;index.aux&quot;&#39;);

foreach my $pr (@projects) {
        if (!exists $pr-&gt;{&#39;owner&#39;}) {
                $pr-&gt;{&#39;owner&#39;} = git_get_project_owner(&quot;$pr-&gt;{&#39;path&#39;}&quot;);
        }

        my ($path, $owner) = ($pr-&gt;{&#39;path&#39;}, $pr-&gt;{&#39;owner&#39;});
        # quote as in CGI::Util::encode, but keep the slash, and use &#39;+&#39; for &#39; &#39;
        $path  =~ s/([^a-zA-Z0-9_.\-\/ ])/sprintf(&quot;%%%02X&quot;, ord($1))/eg;
        $owner =~ s/([^a-zA-Z0-9_.\-\/ ])/sprintf(&quot;%%%02X&quot;, ord($1))/eg;
        $path  =~ s/ /\+/g;
        $owner =~ s/ /\+/g;

        print &quot;$path $owner\n&quot;;
}
</pre>

<p>}</p>

<p>sub git_summary {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$descr</span> = <span class="ruby-identifier">git_get_project_description</span>(<span class="ruby-identifier">$project</span>) <span class="ruby-operator">||</span> <span class="ruby-string">&quot;none&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-string">&quot;HEAD&quot;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">d</span> = <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">parse_date</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;committer_epoch&#39;</span>}, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;committer_tz&#39;</span>}) <span class="ruby-operator">:</span> ();
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$head</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>};
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$remote_heads</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;remote_heads&#39;</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$owner</span> = <span class="ruby-identifier">git_get_project_owner</span>(<span class="ruby-identifier">$project</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$refs</span> = <span class="ruby-identifier">git_get_references</span>();
<span class="ruby-comment"># These get_*_list functions return one more to allow us to see if</span>
<span class="ruby-comment"># there are more ...</span>
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@taglist</span>  = <span class="ruby-identifier">git_get_tags_list</span>(<span class="ruby-value">16</span>);
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@headlist</span> = <span class="ruby-identifier">git_get_heads_list</span>(<span class="ruby-value">16</span>);
<span class="ruby-identifier">my</span> <span class="ruby-regexp">%rmote</span><span class="ruby-identifier">data</span> = <span class="ruby-identifier">$remote_heads</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">git_get_remotes_list</span>() <span class="ruby-operator">:</span> ();
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@forklist</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$check_forks</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;forks&#39;</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$check_forks</span>) {
        <span class="ruby-comment"># find forks of a project</span>
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filter</span> = <span class="ruby-identifier">$project</span>;
        <span class="ruby-identifier">$filter</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span>\.<span class="ruby-identifier">git</span><span class="ruby-identifier">$/</span><span class="ruby-operator">/</span>;
        <span class="ruby-ivar">@forklist</span> = <span class="ruby-identifier">git_get_projects_list</span>(<span class="ruby-identifier">$filter</span>);
        <span class="ruby-comment"># filter out forks of forks</span>
        <span class="ruby-ivar">@forklist</span> = <span class="ruby-identifier">filter_forks_from_projects_list</span>(\<span class="ruby-ivar">@forklist</span>)
                <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@forklist</span>);
}

<span class="ruby-identifier">git_header_html</span>();
<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;summary&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$head</span>);

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;title\&quot;&gt;&amp;nbsp;&lt;/div&gt;\n&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;projects_list\&quot;&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;tr id=\&quot;metadata_desc\&quot;&gt;&lt;td&gt;description&lt;/td&gt;&lt;td&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$descr</span>) . <span class="ruby-string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$owner</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">$omit_owner</span>) {
        <span class="ruby-identifier">print</span>  <span class="ruby-string">&quot;&lt;tr id=\&quot;metadata_owner\&quot;&gt;&lt;td&gt;owner&lt;/td&gt;&lt;td&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$owner</span>) . <span class="ruby-string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$cd</span>{<span class="ruby-string">&#39;rfc2822&#39;</span>}) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr id=\&quot;metadata_lchange\&quot;&gt;&lt;td&gt;last change&lt;/td&gt;&quot;</span> .
              <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>.<span class="ruby-identifier">format_timestamp_html</span>(\<span class="ruby-operator">%</span><span class="ruby-identifier">d</span>).<span class="ruby-string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
}

<span class="ruby-comment"># use per project git URL list in $projectroot/$project/cloneurl</span>
<span class="ruby-comment"># or make project git URL from git base URL and project name</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$url_tag</span> = <span class="ruby-string">&quot;URL&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@url_list</span> = <span class="ruby-identifier">git_get_project_url_list</span>(<span class="ruby-identifier">$project</span>);
<span class="ruby-ivar">@url_list</span> = <span class="ruby-identifier">map</span> { <span class="ruby-string">&quot;$_/$project&quot;</span> } <span class="ruby-ivar">@git_base_url_list</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@url_list</span>;
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$git_url</span> (<span class="ruby-ivar">@url_list</span>) {
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$git_url</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">format_repo_url</span>(<span class="ruby-identifier">$url_tag</span>, <span class="ruby-identifier">$git_url</span>);
        <span class="ruby-identifier">$url_tag</span> = <span class="ruby-string">&quot;&quot;</span>;
}

<span class="ruby-comment"># Tag cloud</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$show_ctags</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;ctags&#39;</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$show_ctags</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ctags</span> = <span class="ruby-identifier">git_get_project_ctags</span>(<span class="ruby-identifier">$project</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-node">%Qctags) {
                # without ability to add tags, don&#39;t show if there are none
                my $</span><span class="ruby-identifier">cloud</span> = <span class="ruby-identifier">git_populate_project_tagcloud</span>(<span class="ruby-identifier">$ctags</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr id=\&quot;metadata_ctags\&quot;&gt;&quot;</span> .
                      <span class="ruby-string">&quot;&lt;td&gt;content tags&lt;/td&gt;&quot;</span> .
                      <span class="ruby-string">&quot;&lt;td&gt;&quot;</span>.<span class="ruby-identifier">git_show_project_tagcloud</span>(<span class="ruby-identifier">$cloud</span>, <span class="ruby-value">48</span>).<span class="ruby-string">&quot;&lt;/td&gt;&quot;</span> .
                      <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
        }
}

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>;

<span class="ruby-comment"># If XSS prevention is on, we don&#39;t include README.html.</span>
<span class="ruby-comment"># TODO: Allow a readme in some safe format.</span>
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">$prevent_xss</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">-</span><span class="ruby-identifier">s</span> <span class="ruby-string">&quot;$projectroot/$project/README.html&quot;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;title\&quot;&gt;readme&lt;/div&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;div class=\&quot;readme\&quot;&gt;\n&quot;</span>;
        <span class="ruby-identifier">insert_file</span>(<span class="ruby-string">&quot;$projectroot/$project/README.html&quot;</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;\n&lt;/div&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;readme&quot;</span>
}

<span class="ruby-comment"># we need to request one more than 16 (0..15) to check if</span>
<span class="ruby-comment"># those 16 are all</span>
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@commitlist</span> = <span class="ruby-identifier">$head</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">parse_commits</span>(<span class="ruby-identifier">$head</span>, <span class="ruby-value">17</span>) <span class="ruby-operator">:</span> ();
<span class="ruby-keyword">if</span> (<span class="ruby-ivar">@commitlist</span>) {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;shortlog&#39;</span>);
        <span class="ruby-identifier">git_shortlog_body</span>(\<span class="ruby-ivar">@commitlist</span>, <span class="ruby-value">0</span>, <span class="ruby-value">15</span>, <span class="ruby-identifier">$refs</span>,
                          $<span class="ruby-comment">#commitlist &lt;=  15 ? undef :</span>
                          <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;shortlog&quot;</span>)}, <span class="ruby-string">&quot;...&quot;</span>));
}

<span class="ruby-keyword">if</span> (<span class="ruby-ivar">@taglist</span>) {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;tags&#39;</span>);
        <span class="ruby-identifier">git_tags_body</span>(\<span class="ruby-ivar">@taglist</span>, <span class="ruby-value">0</span>, <span class="ruby-value">15</span>,
                      $<span class="ruby-comment">#taglist &lt;=  15 ? undef :</span>
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tags&quot;</span>)}, <span class="ruby-string">&quot;...&quot;</span>));
}

<span class="ruby-keyword">if</span> (<span class="ruby-ivar">@headlist</span>) {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;heads&#39;</span>);
        <span class="ruby-identifier">git_heads_body</span>(\<span class="ruby-ivar">@headlist</span>, <span class="ruby-identifier">$head</span>, <span class="ruby-value">0</span>, <span class="ruby-value">15</span>,
                       $<span class="ruby-comment">#headlist &lt;= 15 ? undef :</span>
                       <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;heads&quot;</span>)}, <span class="ruby-string">&quot;...&quot;</span>));
}

<span class="ruby-keyword">if</span> (<span class="ruby-regexp">%rmote</span><span class="ruby-identifier">data</span>) {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;remotes&#39;</span>);
        <span class="ruby-identifier">git_remotes_body</span>(\<span class="ruby-regexp">%rmote</span><span class="ruby-identifier">data</span>, <span class="ruby-value">15</span>, <span class="ruby-identifier">$head</span>);
}

<span class="ruby-keyword">if</span> (<span class="ruby-ivar">@forklist</span>) {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;forks&#39;</span>);
        <span class="ruby-identifier">git_project_list_body</span>(\<span class="ruby-ivar">@forklist</span>, <span class="ruby-string">&#39;age&#39;</span>, <span class="ruby-value">0</span>, <span class="ruby-value">15</span>,
                              $<span class="ruby-comment">#forklist &lt;= 15 ? undef :</span>
                              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;forks&quot;</span>)}, <span class="ruby-string">&quot;...&quot;</span>),
                              <span class="ruby-string">&#39;no_header&#39;</span>);
}

<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_tag {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ag</span> = <span class="ruby-identifier">parse_tag</span>(<span class="ruby-identifier">$hash</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ag</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Unknown tag object&quot;</span>);
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$head</span> = <span class="ruby-identifier">git_get_head_hash</span>(<span class="ruby-identifier">$project</span>);
<span class="ruby-identifier">git_header_html</span>();
<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$head</span>,<span class="ruby-keyword">undef</span>,<span class="ruby-identifier">$head</span>);
<span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;name&#39;</span>}), <span class="ruby-identifier">$hash</span>);
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;title_text\&quot;&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;table class=\&quot;object_header\&quot;&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;tr&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;td&gt;object&lt;/td&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;td&gt;&quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;type&#39;</span>}, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;object&#39;</span>})},
                       <span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;object&#39;</span>}) . <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;type&#39;</span>}, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;object&#39;</span>})},
                                      <span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;type&#39;</span>}) . <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;author&#39;</span>})) {
        <span class="ruby-identifier">git_print_authorship_rows</span>(\<span class="ruby-operator">%</span><span class="ruby-identifier">ag</span>, <span class="ruby-string">&#39;author&#39;</span>);
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;\n\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_body\&quot;&gt;&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$comment</span> = <span class="ruby-identifier">$tag</span>{<span class="ruby-string">&#39;comment&#39;</span>};
<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> (@<span class="ruby-identifier">$comment</span>) {
        <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$line</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$line</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>) . <span class="ruby-string">&quot;&lt;br/&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_blame_common {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$format</span> = <span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;porcelain&#39;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;porcelain&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;javascript&#39;</span>}) {
        <span class="ruby-identifier">$format</span> = <span class="ruby-string">&#39;incremental&#39;</span>;
        <span class="ruby-identifier">$action</span> = <span class="ruby-string">&#39;blame_incremental&#39;</span>; <span class="ruby-comment"># for page title etc</span>
}

<span class="ruby-comment"># permissions</span>
<span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;blame&#39;</span>)
        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">403</span>, <span class="ruby-string">&quot;Blame view not allowed&quot;</span>);

<span class="ruby-comment"># error checking</span>
<span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;No file name given&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$file_name</span>;
<span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">git_get_head_hash</span>(<span class="ruby-identifier">$project</span>);
<span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Couldn&#39;t find base commit&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$hash_base</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$hash_base</span>)
        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Commit not found&quot;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$ftype</span> = <span class="ruby-string">&quot;blob&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span>) {
        <span class="ruby-identifier">$hash</span> = <span class="ruby-identifier">git_get_hash_by_path</span>(<span class="ruby-identifier">$hash_base</span>, <span class="ruby-identifier">$file_name</span>, <span class="ruby-string">&quot;blob&quot;</span>)
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Error looking up file&quot;</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$ftype</span> = <span class="ruby-identifier">git_get_type</span>(<span class="ruby-identifier">$hash</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$ftype</span> <span class="ruby-operator">!~</span> <span class="ruby-string">&quot;blob&quot;</span>) {
                <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Object is not a blob&quot;</span>);
        }
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;incremental&#39;</span>) {
        <span class="ruby-comment"># get file contents (as base)</span>
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&#39;cat-file&#39;</span>, <span class="ruby-string">&#39;blob&#39;</span>, <span class="ruby-identifier">$hash</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-cat-file failed&quot;</span>);
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;data&#39;</span>) {
        <span class="ruby-comment"># run git-blame --incremental</span>
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;blame&quot;</span>, <span class="ruby-string">&quot;--incremental&quot;</span>,
                <span class="ruby-identifier">$hash_base</span>, <span class="ruby-string">&quot;--&quot;</span>, <span class="ruby-identifier">$file_name</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-blame --incremental failed&quot;</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-comment"># run git-blame --porcelain</span>
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;blame&quot;</span>, <span class="ruby-string">&#39;-p&#39;</span>,
                <span class="ruby-identifier">$hash_base</span>, <span class="ruby-string">&#39;--&#39;</span>, <span class="ruby-identifier">$file_name</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-blame --porcelain failed&quot;</span>);
}
<span class="ruby-identifier">binmode</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&#39;:utf8&#39;</span>;

<span class="ruby-comment"># incremental blame data returns early</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;data&#39;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">header</span>(
                <span class="ruby-operator">-</span><span class="ruby-identifier">type</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;text/plain&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">charset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;utf-8&quot;</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">status</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;200 OK&quot;</span>);
        <span class="ruby-identifier">local</span> $<span class="ruby-operator">|</span> = <span class="ruby-value">1</span>; <span class="ruby-comment"># output autoflush</span>
        <span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$line</span>);
        }
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;ERROR $!\n&quot;</span>;

        <span class="ruby-identifier">print</span> <span class="ruby-string">&#39;END&#39;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$t0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;timed&#39;</span>)) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&#39; &#39;</span>.
                      <span class="ruby-identifier">tv_interval</span>(<span class="ruby-identifier">$t0</span>, [ <span class="ruby-identifier">gettimeofday</span>() ]).
                      <span class="ruby-string">&#39; &#39;</span>.<span class="ruby-identifier">$number_of_git_cmds</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;\n&quot;</span>;

        <span class="ruby-keyword">return</span>;
}

<span class="ruby-comment"># page header</span>
<span class="ruby-identifier">git_header_html</span>();
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$formats_nav</span> =
        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                <span class="ruby-string">&quot;blob&quot;</span>) .
        <span class="ruby-string">&quot; | &quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;incremental&#39;</span>) {
        <span class="ruby-identifier">$formats_nav</span> .=
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame&quot;</span>, <span class="ruby-identifier">javascript</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                        <span class="ruby-string">&quot;blame&quot;</span>) . <span class="ruby-string">&quot; (non-incremental)&quot;</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$formats_nav</span> .=
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame_incremental&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                        <span class="ruby-string">&quot;blame&quot;</span>) . <span class="ruby-string">&quot; (incremental)&quot;</span>;
}
<span class="ruby-identifier">$formats_nav</span> .=
        <span class="ruby-string">&quot; | &quot;</span> .
        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                <span class="ruby-string">&quot;history&quot;</span>) .
        <span class="ruby-string">&quot; | &quot;</span> .
        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$action</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>)},
                <span class="ruby-string">&quot;HEAD&quot;</span>);
<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash_base</span>,<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},<span class="ruby-identifier">$hash_base</span>, <span class="ruby-identifier">$formats_nav</span>);
<span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}), <span class="ruby-identifier">$hash_base</span>);
<span class="ruby-identifier">git_print_page_path</span>(<span class="ruby-identifier">$file_name</span>, <span class="ruby-identifier">$ftype</span>, <span class="ruby-identifier">$hash_base</span>);

<span class="ruby-comment"># page body</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;incremental&#39;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;noscript&gt;\n&lt;div class=\&quot;error\&quot;&gt;&lt;center&gt;&lt;b&gt;\n&quot;</span>.
              <span class="ruby-string">&quot;This page requires JavaScript to run.\n Use &quot;</span>.
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;blame&#39;</span>,<span class="ruby-identifier">javascript</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>,<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                      <span class="ruby-string">&#39;this page&#39;</span>).
              <span class="ruby-string">&quot; instead.\n&quot;</span>.
              <span class="ruby-string">&quot;&lt;/b&gt;&lt;/center&gt;&lt;/div&gt;\n&lt;/noscript&gt;\n&quot;</span>;

        <span class="ruby-identifier">print</span> <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">div</span> <span class="ruby-identifier">id</span>=<span class="ruby-string">&quot;progress_bar&quot;</span> <span class="ruby-identifier">style</span>=<span class="ruby-string">&quot;width: 100%; background-color: yellow&quot;</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/div&gt;\n!;
}

print qq!&lt;div class=&quot;page_body&quot;&gt;\n!;
print qq!&lt;div id=&quot;progress_info&quot;&gt;... /</span> <span class="ruby-operator">...</span><span class="ruby-operator">&lt;</span><span class="ruby-node">/div&gt;\n!
        if ($format eq &#39;incremental&#39;);
print qq!&lt;table id=&quot;blame_table&quot; class=&quot;blame&quot; width=&quot;100%&quot;&gt;\n!.
      #qq!&lt;col width=&quot;5.5em&quot; /</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">col</span> <span class="ruby-identifier">width</span>=<span class="ruby-string">&quot;2.5em&quot;</span> <span class="ruby-operator">/</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">col</span> <span class="ruby-identifier">width</span>=<span class="ruby-string">&quot;*&quot;</span> <span class="ruby-operator">/</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n!</span>.
      <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">thead</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n!</span>.
      <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">tr</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">th</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Commit</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/th&gt;&lt;th&gt;Line&lt;/</span><span class="ruby-identifier">th</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">th</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Data</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/th&gt;&lt;/</span><span class="ruby-identifier">tr</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n!</span>.
      <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-node">/thead&gt;\n!.
      qq!&lt;tbody&gt;\n!;

my @rev_color = qw(light dark);
my $num_colors = scalar(@rev_color);
my $current_color = 0;

if ($format eq &#39;incremental&#39;) {
        my $color_class = $rev_color[$current_color];

        #contents of a file
        my $linenr = 0;
LINE:
        while (my $line = &lt;$fd&gt;) {
                chomp $line;
                $linenr++;

                print qq!&lt;tr id=&quot;l$linenr&quot; class=&quot;$color_class&quot;&gt;!.
                      qq!&lt;td class=&quot;sha1&quot;&gt;&lt;a href=&quot;&quot;&gt; &lt;/</span><span class="ruby-identifier">a</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/td&gt;!.
                      qq!&lt;td class=&quot;linenr&quot;&gt;!.
                      qq!&lt;a class=&quot;linenr&quot; href=&quot;&quot;&gt;$linenr&lt;/</span><span class="ruby-identifier">a</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/td&gt;!;
                print qq!&lt;td class=&quot;pre&quot;&gt;! . esc_html($line) . &quot;&lt;/</span><span class="ruby-identifier">td</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n</span><span class="ruby-node">&quot;;
                print qq!&lt;/tr&gt;\n!;
        }

} else { # porcelain, i.e. ordinary blame
        my %metainfo = (); # saves information about commits

        # blame data
LINE:
        while (my $line = &lt;$fd&gt;) {
                chomp $line;
                # the header: &lt;SHA-1&gt; &lt;src lineno&gt; &lt;dst lineno&gt; [&lt;lines in group&gt;]
                # no &lt;lines in group&gt; for subsequent lines in group of lines
                my ($full_rev, $orig_lineno, $lineno, $group_size) =
                   ($line =~ /^([0-9a-f]{40}) (\d+) (\d+)(?: (\d+))?$/);
                if (!exists $metainfo{$full_rev}) {
                        $metainfo{$full_rev} = { &#39;nprevious&#39; =&gt; 0 };
                }
                my $meta = $metainfo{$full_rev};
                my $data;
                while ($data = &lt;$fd&gt;) {
                        chomp $data;
                        last if ($data =~ s/^\t//); # contents of line
                        if ($data =~ /^(\S+)(?: (.*))?$/) {
                                $meta-&gt;{$1} = $2 unless exists $meta-&gt;{$1};
                        }
                        if ($data =~ /^previous /) {
                                $meta-&gt;{&#39;nprevious&#39;}++;
                        }
                }
                my $short_rev = substr($full_rev, 0, 8);
                my $author = $meta-&gt;{&#39;author&#39;};
                my %date =
                        parse_date($meta-&gt;{&#39;author-time&#39;}, $meta-&gt;{&#39;author-tz&#39;});
                my $date = $date{&#39;iso-tz&#39;};
                if ($group_size) {
                        $current_color = ($current_color + 1) % $num_colors;
                }
                my $tr_class = $rev_color[$current_color];
                $tr_class .= &#39; boundary&#39; if (exists $meta-&gt;{&#39;boundary&#39;});
                $tr_class .= &#39; no-previous&#39; if ($meta-&gt;{&#39;nprevious&#39;} == 0);
                $tr_class .= &#39; multiple-previous&#39; if ($meta-&gt;{&#39;nprevious&#39;} &gt; 1);
                print &quot;</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">tr</span> <span class="ruby-identifier">id</span>=\<span class="ruby-string">&quot;l$lineno\&quot; class=\&quot;$tr_class\&quot;&gt;\n&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$group_size</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;sha1\&quot;&quot;</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; title=\&quot;&quot;</span>. <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$author</span>) . <span class="ruby-string">&quot;, $date\&quot;&quot;</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; rowspan=\&quot;$group_size\&quot;&quot;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$group_size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&gt;&quot;</span>;
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>,
                                                     <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$full_rev</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>)},
                                      <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$short_rev</span>));
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$group_size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span>) {
                                <span class="ruby-identifier">my</span> <span class="ruby-ivar">@author_initials</span> = (<span class="ruby-identifier">$author</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\b([[:upper:]])\B/</span><span class="ruby-identifier">g</span>);
                                <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@author_initials</span>) {
                                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;br /&gt;&quot;</span> .
                                              <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-ivar">@author_initials</span>));
                                        <span class="ruby-comment">#           or join(&#39;.&#39;, ...)</span>
                                }
                        }
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                }
                <span class="ruby-comment"># &#39;previous&#39; &lt;sha1 of parent commit&gt; &lt;filename at commit&gt;</span>
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">exists</span> <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;previous&#39;</span>} <span class="ruby-operator">&amp;&amp;</span>
                    <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;previous&#39;</span>} <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^([a-fA-F0-9]{40}) (.*)$/</span>) {
                        <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;parent&#39;</span>} = <span class="ruby-node">$1</span>;
                        <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file_parent&#39;</span>} = <span class="ruby-identifier">unquote</span>(<span class="ruby-node">$2</span>);
                }
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$linenr_commit</span> =
                        <span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;parent&#39;</span>}) <span class="ruby-operator">?</span>
                        <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;parent&#39;</span>} <span class="ruby-operator">:</span> <span class="ruby-identifier">$full_rev</span>;
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$linenr_filename</span> =
                        <span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file_parent&#39;</span>}) <span class="ruby-operator">?</span>
                        <span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;file_parent&#39;</span>} <span class="ruby-operator">:</span> <span class="ruby-identifier">unquote</span>(<span class="ruby-identifier">$meta</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-string">&#39;filename&#39;</span>});
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$blamed</span> = <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;blame&#39;</span>,
                                  <span class="ruby-identifier">file_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$linenr_filename</span>,
                                  <span class="ruby-identifier">hash_base</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$linenr_commit</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;linenr\&quot;&gt;&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({ <span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;$blamed#l$orig_lineno&quot;</span>,
                                <span class="ruby-operator">-</span><span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;linenr&quot;</span> },
                              <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$lineno</span>));
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;td class=\&quot;pre\&quot;&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$data</span>) . <span class="ruby-string">&quot;&lt;/td&gt;\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
        } <span class="ruby-comment"># end while</span>

}

<span class="ruby-comment"># footer</span>
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/tbody&gt;\n&quot;</span>.
      <span class="ruby-string">&quot;&lt;/table&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;blame&quot;</span>
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;   <span class="ruby-comment"># class=&quot;blame_body&quot;</span>
<span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
        <span class="ruby-keyword">or</span> <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Reading blob failed\n&quot;</span>;

<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_blame {</p>

<pre>git_blame_common();</pre>

<p>}</p>

<p>sub git_blame_incremental {</p>

<pre>git_blame_common(&#39;incremental&#39;);</pre>

<p>}</p>

<p>sub git_blame_data {</p>

<pre>git_blame_common(&#39;data&#39;);</pre>

<p>}</p>

<p>sub git_tags {</p>

<pre>my $head = git_get_head_hash($project);
git_header_html();
git_print_page_nav(&#39;&#39;,&#39;&#39;, $head,undef,$head,format_ref_views(&#39;tags&#39;));
git_print_header_div(&#39;summary&#39;, $project);

my @tagslist = git_get_tags_list();
if (@tagslist) {
        git_tags_body(\@tagslist);
}
git_footer_html();</pre>

<p>}</p>

<p>sub git_heads {</p>

<pre>my $head = git_get_head_hash($project);
git_header_html();
git_print_page_nav(&#39;&#39;,&#39;&#39;, $head,undef,$head,format_ref_views(&#39;heads&#39;));
git_print_header_div(&#39;summary&#39;, $project);

my @headslist = git_get_heads_list();
if (@headslist) {
        git_heads_body(\@headslist, $head);
}
git_footer_html();</pre>

<p>}</p>

<p># used both for single remote view and for list of all the remotes sub
git_remotes {</p>

<pre class="ruby"><span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;remote_heads&#39;</span>)
        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">403</span>, <span class="ruby-string">&quot;Remote heads view is disabled&quot;</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$head</span> = <span class="ruby-identifier">git_get_head_hash</span>(<span class="ruby-identifier">$project</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$remote</span> = <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;hash&#39;</span>};

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$remotedata</span> = <span class="ruby-identifier">git_get_remotes_list</span>(<span class="ruby-identifier">$remote</span>);
<span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Unable to get remote information&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$remotedata</span>;

<span class="ruby-keyword">unless</span> (<span class="ruby-string">%Qremotedata) {
        die_error(404, defined $</span><span class="ruby-identifier">remote</span> <span class="ruby-operator">?</span>
                <span class="ruby-string">&quot;Remote $remote not found&quot;</span> <span class="ruby-operator">:</span>
                <span class="ruby-string">&quot;No remotes found&quot;</span>);
}

<span class="ruby-identifier">git_header_html</span>(<span class="ruby-keyword">undef</span>, <span class="ruby-keyword">undef</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">action_extra</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$remote</span>);
<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-string">&#39;&#39;</span>,  <span class="ruby-identifier">$head</span>, <span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$head</span>,
        <span class="ruby-identifier">format_ref_views</span>(<span class="ruby-identifier">$remote</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;remotes&#39;</span>));

<span class="ruby-identifier">fill_remote_heads</span>(<span class="ruby-identifier">$remotedata</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$remote</span>) {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;remotes&#39;</span>, <span class="ruby-string">&quot;$remote remote for $project&quot;</span>);
        <span class="ruby-identifier">git_remote_block</span>(<span class="ruby-identifier">$remote</span>, <span class="ruby-identifier">$remotedata</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>{<span class="ruby-identifier">$remote</span>}, <span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$head</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;summary&#39;</span>, <span class="ruby-string">&quot;$project remotes&quot;</span>);
        <span class="ruby-identifier">git_remotes_body</span>(<span class="ruby-identifier">$remotedata</span>, <span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$head</span>);
}

<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_blob_plain {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$type</span> = <span class="ruby-identifier">shift</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$expires</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$base</span> = <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">git_get_head_hash</span>(<span class="ruby-identifier">$project</span>);
                <span class="ruby-identifier">$hash</span> = <span class="ruby-identifier">git_get_hash_by_path</span>(<span class="ruby-identifier">$base</span>, <span class="ruby-identifier">$file_name</span>, <span class="ruby-string">&quot;blob&quot;</span>)
                        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Cannot find file&quot;</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;No file name defined&quot;</span>);
        }
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$hash</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-identifier">$/</span>) {
        <span class="ruby-comment"># blobs defined by non-textual hash id&#39;s can be cached</span>
        <span class="ruby-identifier">$expires</span> = <span class="ruby-string">&quot;+1d&quot;</span>;
}

<span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;cat-file&quot;</span>, <span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">$hash</span>
        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-cat-file blob &#39;$hash&#39; failed&quot;</span>);

<span class="ruby-comment"># content-type (can include charset)</span>
<span class="ruby-identifier">$type</span> = <span class="ruby-identifier">blob_contenttype</span>(<span class="ruby-identifier">$fd</span>, <span class="ruby-identifier">$file_name</span>, <span class="ruby-identifier">$type</span>);

<span class="ruby-comment"># &quot;save as&quot; filename, even when no $file_name is given</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$save_as</span> = <span class="ruby-string">&quot;$hash&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-identifier">$save_as</span> = <span class="ruby-identifier">$file_name</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$type</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span><span class="ruby-identifier">text</span>\<span class="ruby-operator">/</span><span class="ruby-node">/) {
        $save_as .= &#39;.txt&#39;;
}

# With XSS prevention on, blobs of all types except a few known safe
# ones are served with &quot;Content-Disposition: attachment&quot; to make sure
# they don&#39;t run in our security domain.  For certain image types,
# blob view writes an &lt;img&gt; tag referring to blob_plain view, and we
# want to be sure not to break that by serving the image as an
# attachment (though Firefox 3 doesn&#39;t seem to care).
my $sandbox = $prevent_xss &amp;&amp;
        $type !~ m!^(?:text/</span>[<span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">z</span>]<span class="ruby-operator">+</span><span class="ruby-operator">|</span><span class="ruby-identifier">image</span><span class="ruby-operator">/</span>(<span class="ruby-value">?:</span><span class="ruby-identifier">gif</span><span class="ruby-operator">|</span><span class="ruby-identifier">png</span><span class="ruby-operator">|</span><span class="ruby-identifier">jpeg</span>))(<span class="ruby-value">?:</span>[ ;]<span class="ruby-operator">|</span>$)<span class="ruby-operator">!</span>;

<span class="ruby-comment"># serve text/* as text/plain</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$prevent_xss</span> <span class="ruby-operator">&amp;&amp;</span>
    (<span class="ruby-identifier">$type</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span><span class="ruby-identifier">text</span><span class="ruby-operator">/</span>[<span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">z</span>]<span class="ruby-operator">+</span>\<span class="ruby-identifier">b</span>(.<span class="ruby-operator">*</span>)<span class="ruby-identifier">$!</span> <span class="ruby-operator">||</span>
     (<span class="ruby-identifier">$type</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span>[<span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">z</span>]<span class="ruby-operator">+</span><span class="ruby-regexp">/[a-z]\+xml\b(.*)$! &amp;&amp; -T $fd))) {
        my $rest = $1;
        $rest = defined $rest ? $rest : &#39;&#39;;
        $type = &quot;text/</span><span class="ruby-identifier">plain</span><span class="ruby-identifier">$rest</span><span class="ruby-string">&quot;;
}

print $cgi-&gt;header(
        -type =&gt; $type,
        -expires =&gt; $expires,
        -content_disposition =&gt;
                ($sandbox ? &#39;attachment&#39; : &#39;inline&#39;)
                . &#39;; filename=&quot;</span><span class="ruby-string">&#39; . $save_as . &#39;</span><span class="ruby-node">&quot;&#39;);
local $/ = undef;
binmode STDOUT, &#39;:raw&#39;;
print &lt;$fd&gt;;
binmode STDOUT, &#39;:utf8&#39;; # as set at the beginning of gitweb.cgi
close $fd;
</span></pre>

<p>}</p>

<p>sub git_blob {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$expires</span>;

<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$base</span> = <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">git_get_head_hash</span>(<span class="ruby-identifier">$project</span>);
                <span class="ruby-identifier">$hash</span> = <span class="ruby-identifier">git_get_hash_by_path</span>(<span class="ruby-identifier">$base</span>, <span class="ruby-identifier">$file_name</span>, <span class="ruby-string">&quot;blob&quot;</span>)
                        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Cannot find file&quot;</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;No file name defined&quot;</span>);
        }
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$hash</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-identifier">$/</span>) {
        <span class="ruby-comment"># blobs defined by non-textual hash id&#39;s can be cached</span>
        <span class="ruby-identifier">$expires</span> = <span class="ruby-string">&quot;+1d&quot;</span>;
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$have_blame</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;blame&#39;</span>);
<span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;cat-file&quot;</span>, <span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">$hash</span>
        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Couldn&#39;t cat $file_name, $hash&quot;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$mimetype</span> = <span class="ruby-identifier">blob_mimetype</span>(<span class="ruby-identifier">$fd</span>, <span class="ruby-identifier">$file_name</span>);
<span class="ruby-comment"># use &#39;blob_plain&#39; (aka &#39;raw&#39;) view for files that cannot be displayed</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$mimetype</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span>(<span class="ruby-value">?:</span><span class="ruby-identifier">text</span><span class="ruby-operator">/</span><span class="ruby-operator">|</span><span class="ruby-identifier">image</span><span class="ruby-operator">/</span>(<span class="ruby-value">?:</span><span class="ruby-identifier">gif</span><span class="ruby-operator">|</span><span class="ruby-identifier">png</span><span class="ruby-operator">|</span><span class="ruby-identifier">jpeg</span>)$)<span class="ruby-operator">!</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">-</span><span class="ruby-constant">B</span> <span class="ruby-identifier">$fd</span>) {
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>;
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">git_blob_plain</span>(<span class="ruby-identifier">$mimetype</span>);
}
<span class="ruby-comment"># we can have blame only for text/* mimetype</span>
<span class="ruby-identifier">$have_blame</span> <span class="ruby-operator">&amp;&amp;=</span> (<span class="ruby-identifier">$mimetype</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span><span class="ruby-identifier">text</span><span class="ruby-operator">/</span><span class="ruby-operator">!</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$highlight</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;highlight&#39;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$syntax</span> = <span class="ruby-identifier">guess_file_syntax</span>(<span class="ruby-identifier">$highlight</span>, <span class="ruby-identifier">$mimetype</span>, <span class="ruby-identifier">$file_name</span>);
<span class="ruby-identifier">$fd</span> = <span class="ruby-identifier">run_highlighter</span>(<span class="ruby-identifier">$fd</span>, <span class="ruby-identifier">$highlight</span>, <span class="ruby-identifier">$syntax</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">$syntax</span>;

<span class="ruby-identifier">git_header_html</span>(<span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$expires</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$formats_nav</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$hash_base</span>))) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$have_blame</span>) {
                        <span class="ruby-identifier">$formats_nav</span> .=
                                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                                        <span class="ruby-string">&quot;blame&quot;</span>) .
                                <span class="ruby-string">&quot; | &quot;</span>;
                }
                <span class="ruby-identifier">$formats_nav</span> .=
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                                <span class="ruby-string">&quot;history&quot;</span>) .
                        <span class="ruby-string">&quot; | &quot;</span> .
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob_plain&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                                <span class="ruby-string">&quot;raw&quot;</span>) .
                        <span class="ruby-string">&quot; | &quot;</span> .
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob&quot;</span>,
                                               <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;HEAD&quot;</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>)},
                                <span class="ruby-string">&quot;HEAD&quot;</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$formats_nav</span> .=
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blob_plain&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                                <span class="ruby-string">&quot;raw&quot;</span>);
        }
        <span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash_base</span>,<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},<span class="ruby-identifier">$hash_base</span>, <span class="ruby-identifier">$formats_nav</span>);
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}), <span class="ruby-identifier">$hash_base</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_nav\&quot;&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;br/&gt;&lt;br/&gt;&lt;/div&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;div class=\&quot;title\&quot;&gt;&quot;</span>.<span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$hash</span>).<span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
}
<span class="ruby-identifier">git_print_page_path</span>(<span class="ruby-identifier">$file_name</span>, <span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">$hash_base</span>);
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_body\&quot;&gt;\n&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$mimetype</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span><span class="ruby-identifier">image</span><span class="ruby-operator">/</span><span class="ruby-operator">!</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">img</span> <span class="ruby-identifier">type</span>=<span class="ruby-string">&quot;!.esc_attr($mimetype).qq!&quot;</span><span class="ruby-operator">!</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">qq!</span> <span class="ruby-identifier">alt</span>=<span class="ruby-string">&quot;!.esc_attr($file_name).qq!&quot;</span> <span class="ruby-identifier">title</span>=<span class="ruby-string">&quot;!.esc_attr($file_name).qq!&quot;</span><span class="ruby-operator">!</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">qq!</span> <span class="ruby-identifier">src</span>=<span class="ruby-string">&quot;! .
              href(action=&gt;&quot;</span><span class="ruby-identifier">blob_plain</span><span class="ruby-string">&quot;, hash=&gt;$hash,
                   hash_base=&gt;$hash_base, file_name=&gt;$file_name) .
              qq!&quot;</span> <span class="ruby-operator">/</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n!</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$nr</span>;
        <span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
                <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$line</span>;
                <span class="ruby-identifier">$nr</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>;
                <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">untabify</span>(<span class="ruby-identifier">$line</span>);
                <span class="ruby-identifier">printf</span> <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">div</span> <span class="ruby-identifier">class</span>=<span class="ruby-string">&quot;pre&quot;</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">a</span> <span class="ruby-identifier">id</span>=<span class="ruby-string">&quot;l%i&quot;</span> <span class="ruby-identifier">href</span>=<span class="ruby-node">&quot;%s#l%i&quot;</span> <span class="ruby-identifier">class</span>=<span class="ruby-string">&quot;linenr&quot;</span><span class="ruby-operator">&gt;</span><span class="ruby-operator">%</span><span class="ruby-identifier">i</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/a&gt; %s&lt;/</span><span class="ruby-identifier">div</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n!</span>,
                       <span class="ruby-identifier">$nr</span>, <span class="ruby-identifier">esc_attr</span>(<span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)), <span class="ruby-identifier">$nr</span>, <span class="ruby-identifier">$nr</span>,
                       <span class="ruby-identifier">$syntax</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">sanitize</span>(<span class="ruby-identifier">$line</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$line</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">nbsp</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>);
        }
}
<span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
        <span class="ruby-keyword">or</span> <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Reading blob failed.\n&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;&quot;</span>;
<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_tree {</p>

<pre class="ruby"><span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span>) {
        <span class="ruby-identifier">$hash_base</span> = <span class="ruby-string">&quot;HEAD&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-identifier">$hash</span> = <span class="ruby-identifier">git_get_hash_by_path</span>(<span class="ruby-identifier">$hash_base</span>, <span class="ruby-identifier">$file_name</span>, <span class="ruby-string">&quot;tree&quot;</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">$hash</span> = <span class="ruby-identifier">$hash_base</span>;
        }
}
<span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;No such tree&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$hash</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$show_sizes</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;show-sizes&#39;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$have_blame</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;blame&#39;</span>);

<span class="ruby-identifier">my</span> <span class="ruby-ivar">@entries</span> = ();
{
        <span class="ruby-identifier">local</span> <span class="ruby-identifier">$/</span> = <span class="ruby-string">&quot;\0&quot;</span>;
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;ls-tree&quot;</span>, <span class="ruby-string">&#39;-z&#39;</span>,
                (<span class="ruby-identifier">$show_sizes</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;-l&#39;</span> <span class="ruby-operator">:</span> ()), <span class="ruby-ivar">@extra_options</span>, <span class="ruby-identifier">$hash</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-ls-tree failed&quot;</span>);
        <span class="ruby-ivar">@entries</span> = <span class="ruby-identifier">map</span> { <span class="ruby-identifier">chomp</span>; <span class="ruby-identifier">$_</span> } <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Reading tree failed&quot;</span>);
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$refs</span> = <span class="ruby-identifier">git_get_references</span>();
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$ref</span> = <span class="ruby-identifier">format_ref_marker</span>(<span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$hash_base</span>);
<span class="ruby-identifier">git_header_html</span>();
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$basedir</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$hash_base</span>))) {
        <span class="ruby-identifier">my</span> <span class="ruby-ivar">@views_nav</span> = ();
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@views_nav</span>,
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                                <span class="ruby-string">&quot;history&quot;</span>),
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>,
                                               <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;HEAD&quot;</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>)},
                                <span class="ruby-string">&quot;HEAD&quot;</span>),
        }
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$snapshot_links</span> = <span class="ruby-identifier">format_snapshot_links</span>(<span class="ruby-identifier">$hash</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$snapshot_links</span>) {
                <span class="ruby-comment"># FIXME: Should be available when we have no hash base as well.</span>
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@views_nav</span>, <span class="ruby-identifier">$snapshot_links</span>;
        }
        <span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;tree&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash_base</span>, <span class="ruby-keyword">undef</span>, <span class="ruby-keyword">undef</span>,
                           <span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; | &#39;</span>, <span class="ruby-ivar">@views_nav</span>));
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-identifier">$ref</span>, <span class="ruby-identifier">$hash_base</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-keyword">undef</span> <span class="ruby-identifier">$hash_base</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_nav\&quot;&gt;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;br/&gt;&lt;br/&gt;&lt;/div&gt;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;title\&quot;&gt;&quot;</span>.<span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$hash</span>).<span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-identifier">$basedir</span> = <span class="ruby-identifier">$file_name</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$basedir</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$basedir</span>, <span class="ruby-value">-1</span>) <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;/&#39;</span>) {
                <span class="ruby-identifier">$basedir</span> .= <span class="ruby-string">&#39;/&#39;</span>;
        }
        <span class="ruby-identifier">git_print_page_path</span>(<span class="ruby-identifier">$file_name</span>, <span class="ruby-string">&#39;tree&#39;</span>, <span class="ruby-identifier">$hash_base</span>);
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_body\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;table class=\&quot;tree\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alternate</span> = <span class="ruby-value">1</span>;
<span class="ruby-comment"># &#39;..&#39; (top directory) link if possible</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">&amp;&amp;</span>
    <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$file_name</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span>[<span class="ruby-operator">^</span><span class="ruby-regexp">/]+$!) {
        if ($alternate) {
                print &quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;;
        } else {
                print &quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;;
        }
        $alternate ^= 1;

        my $up = $file_name;
        $up =~ s!/</span><span class="ruby-operator">?</span>[<span class="ruby-operator">^</span><span class="ruby-node">/]+$!!;
        undef $up unless $up;
        # based on git_print_tree_entry
        print &#39;&lt;td class=&quot;mode&quot;&gt;&#39; . mode_str(&#39;040000&#39;) . &quot;&lt;/</span><span class="ruby-identifier">td</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n</span><span class="ruby-string">&quot;;
        print &#39;&lt;td class=&quot;</span><span class="ruby-identifier">size</span><span class="ruby-string">&quot;&gt;&amp;nbsp;&lt;/td&gt;&#39;.&quot;</span>\<span class="ruby-identifier">n</span><span class="ruby-string">&quot; if $show_sizes;
        print &#39;&lt;td class=&quot;</span><span class="ruby-identifier">list</span><span class="ruby-string">&quot;&gt;&#39;;
        print $cgi-&gt;a({-href =&gt; href(action=&gt;&quot;</span><span class="ruby-identifier">tree</span><span class="ruby-string">&quot;,
                                     hash_base=&gt;$hash_base,
                                     file_name=&gt;$up)},
                      &quot;</span><span class="ruby-operator">..</span><span class="ruby-string">&quot;);
        print &quot;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/td&gt;\n&quot;;
        print &quot;&lt;td class=\&quot;link\&quot;&gt;&lt;/</span><span class="ruby-identifier">td</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n</span><span class="ruby-string">&quot;;

        print &quot;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/tr&gt;\n&quot;;
}
foreach my $line (@entries) {
        my %t = parse_ls_tree_line($line, -z =&gt; 1, -l =&gt; $show_sizes);

        if ($alternate) {
                print &quot;&lt;tr class=\&quot;dark\&quot;&gt;\n&quot;;
        } else {
                print &quot;&lt;tr class=\&quot;light\&quot;&gt;\n&quot;;
        }
        $alternate ^= 1;

        git_print_tree_entry(\%t, $basedir, $hash_base, $have_blame);

        print &quot;&lt;/</span><span class="ruby-identifier">tr</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n</span><span class="ruby-string">&quot;;
}
print &quot;</span><span class="ruby-operator">&lt;</span><span class="ruby-regexp">/table&gt;\n&quot; .
      &quot;&lt;/</span><span class="ruby-identifier">div</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;;
git_footer_html();
</span></pre>

<p>}</p>

<p>sub snapshot_name {</p>

<pre>my ($project, $hash) = @_;

# path/to/project.git  -&gt; project
# path/to/project/.git -&gt; project
my $name = to_utf8($project);
$name =~ s,([^/])/*\.git$,$1,;
$name = basename($name);
# sanitize name
$name =~ s/[[:cntrl:]]/?/g;

my $ver = $hash;
if ($hash =~ /^[0-9a-fA-F]+$/) {
        # shorten SHA-1 hash
        my $full_hash = git_get_full_hash($project, $hash);
        if ($full_hash =~ /^$hash/ &amp;&amp; length($hash) &gt; 7) {
                $ver = git_get_short_hash($project, $hash);
        }
} elsif ($hash =~ m!^refs/tags/(.*)$!) {
        # tags don&#39;t need shortened SHA-1 hash
        $ver = $1;
} else {
        # branches and other need shortened SHA-1 hash
        if ($hash =~ m!^refs/(?:heads|remotes)/(.*)$!) {
                $ver = $1;
        }
        $ver .= &#39;-&#39; . git_get_short_hash($project, $hash);
}
# in case of hierarchical branch names
$ver =~ s!/!.!g;

# name = project-version_string
$name = &quot;$name-$ver&quot;;

return wantarray ? ($name, $name) : $name;</pre>

<p>}</p>

<p>sub exit_if_unmodified_since {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$latest_epoch</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">our</span> <span class="ruby-identifier">$cgi</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$if_modified</span> = <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">http</span>(<span class="ruby-string">&#39;IF_MODIFIED_SINCE&#39;</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$if_modified</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$since</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">eval</span> { <span class="ruby-identifier">require</span> <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Date</span>; <span class="ruby-value">1</span>; }) {
                <span class="ruby-identifier">$since</span> = <span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Date</span><span class="ruby-operator">::</span><span class="ruby-identifier">str2time</span>(<span class="ruby-identifier">$if_modified</span>);
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">eval</span> { <span class="ruby-identifier">require</span> <span class="ruby-constant">Time</span><span class="ruby-operator">::</span><span class="ruby-constant">ParseDate</span>; <span class="ruby-value">1</span>; }) {
                <span class="ruby-identifier">$since</span> = <span class="ruby-constant">Time</span><span class="ruby-operator">::</span><span class="ruby-constant">ParseDate</span><span class="ruby-operator">::</span><span class="ruby-identifier">parsedate</span>(<span class="ruby-identifier">$if_modified</span>, <span class="ruby-constant">GMT</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$since</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$latest_epoch</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$since</span>) {
                <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">atest_date</span> = <span class="ruby-identifier">parse_date</span>(<span class="ruby-identifier">$latest_epoch</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">header</span>(
                        <span class="ruby-operator">-</span><span class="ruby-identifier">last_modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$latest_date</span>{<span class="ruby-string">&#39;rfc2822&#39;</span>},
                        <span class="ruby-operator">-</span><span class="ruby-identifier">status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;304 Not Modified&#39;</span>);
                <span class="ruby-identifier">goto</span> <span class="ruby-constant">DONE_GITWEB</span>;
        }
}
</pre>

<p>}</p>

<p>sub git_snapshot {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$format</span> = <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;snapshot_format&#39;</span>};
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-ivar">@snapshot_fmts</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">403</span>, <span class="ruby-string">&quot;Snapshots not allowed&quot;</span>);
}
<span class="ruby-comment"># default to first supported snapshot format</span>
<span class="ruby-identifier">$format</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">$snapshot_fmts</span>[<span class="ruby-value">0</span>];
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">z0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">$/</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Invalid snapshot format parameter&quot;</span>);
} <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">exists</span>(<span class="ruby-identifier">$known_snapshot_formats</span>{<span class="ruby-identifier">$format</span>})) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Unknown snapshot format&quot;</span>);
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$known_snapshot_formats</span>{<span class="ruby-identifier">$format</span>}{<span class="ruby-string">&#39;disabled&#39;</span>}) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">403</span>, <span class="ruby-string">&quot;Snapshot format not allowed&quot;</span>);
} <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">grep</span>(<span class="ruby-identifier">$_</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$format</span>, <span class="ruby-ivar">@snapshot_fmts</span>)) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">403</span>, <span class="ruby-string">&quot;Unsupported snapshot format&quot;</span>);
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$type</span> = <span class="ruby-identifier">git_get_type</span>(<span class="ruby-string">&quot;$hash^{}&quot;</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">$type</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&#39;Object does not exist&#39;</span>);
}  <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$type</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;blob&#39;</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&#39;Object is not a tree-ish&#39;</span>);
}

<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$name</span>, <span class="ruby-identifier">$prefix</span>) = <span class="ruby-identifier">snapshot_name</span>(<span class="ruby-identifier">$project</span>, <span class="ruby-identifier">$hash</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$filename</span> = <span class="ruby-string">&quot;$name$known_snapshot_formats{$format}{&#39;suffix&#39;}&quot;</span>;

<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$hash</span>);
<span class="ruby-identifier">exit_if_unmodified_since</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;committer_epoch&#39;</span>}) <span class="ruby-keyword">if</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$cmd</span> = <span class="ruby-identifier">quote_command</span>(
        <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&#39;archive&#39;</span>,
        <span class="ruby-string">&quot;--format=$known_snapshot_formats{$format}{&#39;format&#39;}&quot;</span>,
        <span class="ruby-string">&quot;--prefix=$prefix/&quot;</span>, <span class="ruby-identifier">$hash</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">exists</span> <span class="ruby-identifier">$known_snapshot_formats</span>{<span class="ruby-identifier">$format</span>}{<span class="ruby-string">&#39;compressor&#39;</span>}) {
        <span class="ruby-identifier">$cmd</span> .= <span class="ruby-string">&#39; | &#39;</span> . <span class="ruby-identifier">quote_command</span>(@{<span class="ruby-identifier">$known_snapshot_formats</span>{<span class="ruby-identifier">$format</span>}{<span class="ruby-string">&#39;compressor&#39;</span>}});
}

<span class="ruby-identifier">$filename</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span><span class="ruby-operator">/</span>([<span class="ruby-string">&quot;\\])/\\$1/g;
my %latest_date;
if (%co) {
        %latest_date = parse_date($co{&#39;committer_epoch&#39;}, $co{&#39;committer_tz&#39;});
}

print $cgi-&gt;header(
        -type =&gt; $known_snapshot_formats{$format}{&#39;type&#39;},
        -content_disposition =&gt; &#39;inline; filename=&quot;</span><span class="ruby-string">&#39; . $filename . &#39;</span><span class="ruby-string">&quot;&#39;,
        %co ? (-last_modified =&gt; $latest_date{&#39;rfc2822&#39;}) : (),
        -status =&gt; &#39;200 OK&#39;);

open my $fd, &quot;</span><span class="ruby-operator">-</span><span class="ruby-operator">|</span><span class="ruby-string">&quot;, $cmd
        or die_error(500, &quot;</span><span class="ruby-constant">Execute</span> <span class="ruby-identifier">git</span><span class="ruby-operator">-</span><span class="ruby-identifier">archive</span> <span class="ruby-identifier">failed</span><span class="ruby-node">&quot;);
binmode STDOUT, &#39;:raw&#39;;
print &lt;$fd&gt;;
binmode STDOUT, &#39;:utf8&#39;; # as set at the beginning of gitweb.cgi
close $fd;
</span></pre>

<p>}</p>

<p>sub git_log_generic {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$fmt_name</span>, <span class="ruby-identifier">$body_subr</span>, <span class="ruby-identifier">$base</span>, <span class="ruby-identifier">$parent</span>, <span class="ruby-identifier">$file_name</span>, <span class="ruby-identifier">$file_hash</span>) = <span class="ruby-ivar">@_</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$head</span> = <span class="ruby-identifier">git_get_head_hash</span>(<span class="ruby-identifier">$project</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$base</span>) {
        <span class="ruby-identifier">$base</span> = <span class="ruby-identifier">$head</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$page</span>) {
        <span class="ruby-identifier">$page</span> = <span class="ruby-value">0</span>;
}
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$refs</span> = <span class="ruby-identifier">git_get_references</span>();

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$commit_hash</span> = <span class="ruby-identifier">$base</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$parent</span>) {
        <span class="ruby-identifier">$commit_hash</span> = <span class="ruby-string">&quot;$parent..$base&quot;</span>;
}
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@commitlist</span> =
        <span class="ruby-identifier">parse_commits</span>(<span class="ruby-identifier">$commit_hash</span>, <span class="ruby-value">101</span>, (<span class="ruby-value">100</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">$page</span>),
                      <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">$file_name</span>, <span class="ruby-string">&quot;--full-history&quot;</span>) <span class="ruby-operator">:</span> ());

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$ftype</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_hash</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-comment"># some commits could have deleted file in question,</span>
        <span class="ruby-comment"># and not have it in tree, but one of them has to have it</span>
        <span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@commitlist</span>; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
                <span class="ruby-identifier">$file_hash</span> = <span class="ruby-identifier">git_get_hash_by_path</span>(<span class="ruby-identifier">$commitlist</span>[<span class="ruby-identifier">$i</span>]{<span class="ruby-string">&#39;id&#39;</span>}, <span class="ruby-identifier">$file_name</span>);
                <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_hash</span>;
        }
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_hash</span>) {
        <span class="ruby-identifier">$ftype</span> = <span class="ruby-identifier">git_get_type</span>(<span class="ruby-identifier">$file_hash</span>);
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$ftype</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Unknown type of object&quot;</span>);
}
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$base</span>)
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Unknown commit object&quot;</span>);
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$paging_nav</span> = <span class="ruby-identifier">format_paging_nav</span>(<span class="ruby-identifier">$fmt_name</span>, <span class="ruby-identifier">$page</span>, $<span class="ruby-comment">#commitlist &gt;= 100);</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$next_link</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-keyword">if</span> ($<span class="ruby-comment">#commitlist &gt;= 100) {</span>
        <span class="ruby-identifier">$next_link</span> =
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">page</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$page</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>),
                         <span class="ruby-operator">-</span><span class="ruby-identifier">accesskey</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;n&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Alt-n&quot;</span>}, <span class="ruby-string">&quot;next&quot;</span>);
}
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$patch_max</span> = <span class="ruby-identifier">gitweb_get_feature</span>(<span class="ruby-string">&#39;patches&#39;</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$patch_max</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$patch_max</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@commitlist</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">$patch_max</span>) {
                <span class="ruby-identifier">$paging_nav</span> .= <span class="ruby-string">&quot; &amp;sdot; &quot;</span> .
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;patches&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                                <span class="ruby-string">&quot;patches&quot;</span>);
        }
}

<span class="ruby-identifier">git_header_html</span>();
<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-identifier">$fmt_name</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash</span>,<span class="ruby-identifier">$hash</span>,<span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$paging_nav</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}), <span class="ruby-identifier">$base</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;summary&#39;</span>, <span class="ruby-identifier">$project</span>)
}
<span class="ruby-identifier">git_print_page_path</span>(<span class="ruby-identifier">$file_name</span>, <span class="ruby-identifier">$ftype</span>, <span class="ruby-identifier">$hash_base</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>);

<span class="ruby-identifier">$body_subr</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>(\<span class="ruby-ivar">@commitlist</span>, <span class="ruby-value">0</span>, <span class="ruby-value">99</span>, <span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$next_link</span>,
             <span class="ruby-identifier">$file_name</span>, <span class="ruby-identifier">$file_hash</span>, <span class="ruby-identifier">$ftype</span>);

<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_log {</p>

<pre>git_log_generic(&#39;log&#39;, \&amp;git_log_body,
                $hash, $hash_parent);</pre>

<p>}</p>

<p>sub git_commit {</p>

<pre class="ruby"><span class="ruby-identifier">$hash</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;HEAD&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$hash</span>)
    <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Unknown commit object&quot;</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$parent</span>  = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parent&#39;</span>};
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$parents</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}; <span class="ruby-comment"># listref</span>

<span class="ruby-comment"># we need to prepare $formats_nav before any parameter munging</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$formats_nav</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$parent</span>) {
        <span class="ruby-comment"># --root commitdiff</span>
        <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-string">&#39;(initial)&#39;</span>;
} <span class="ruby-keyword">elsif</span> (@<span class="ruby-identifier">$parents</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>) {
        <span class="ruby-comment"># single parent commit</span>
        <span class="ruby-identifier">$formats_nav</span> .=
                <span class="ruby-string">&#39;(parent: &#39;</span> .
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>,
                                       <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$parent</span>)},
                        <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$parent</span>, <span class="ruby-value">0</span>, <span class="ruby-value">7</span>))) .
                <span class="ruby-string">&#39;)&#39;</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-comment"># merge commit</span>
        <span class="ruby-identifier">$formats_nav</span> .=
                <span class="ruby-string">&#39;(merge: &#39;</span> .
                <span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>, <span class="ruby-identifier">map</span> {
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>,
                                               <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$_</span>)},
                                <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$_</span>, <span class="ruby-value">0</span>, <span class="ruby-value">7</span>)));
                } @<span class="ruby-identifier">$parents</span> ) .
                <span class="ruby-string">&#39;)&#39;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;patches&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> @<span class="ruby-identifier">$parents</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">1</span>) {
        <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-string">&quot; | &quot;</span> .
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;patch&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                        <span class="ruby-string">&quot;patch&quot;</span>);
}

<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$parent</span>) {
        <span class="ruby-identifier">$parent</span> = <span class="ruby-string">&quot;--root&quot;</span>;
}
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@difftree</span>;
<span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;diff-tree&quot;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-string">&quot;--no-commit-id&quot;</span>,
        <span class="ruby-ivar">@diff_opts</span>,
        (@<span class="ruby-identifier">$parents</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$parent</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;-c&#39;</span>),
        <span class="ruby-identifier">$hash</span>, <span class="ruby-string">&quot;--&quot;</span>
        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-diff-tree failed&quot;</span>);
<span class="ruby-ivar">@difftree</span> = <span class="ruby-identifier">map</span> { <span class="ruby-identifier">chomp</span>; <span class="ruby-identifier">$_</span> } <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
<span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Reading git-diff-tree failed&quot;</span>);

<span class="ruby-comment"># non-textual hash id&#39;s can be cached</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$expires</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$hash</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-identifier">$/</span>) {
        <span class="ruby-identifier">$expires</span> = <span class="ruby-string">&quot;+1d&quot;</span>;
}
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$refs</span> = <span class="ruby-identifier">git_get_references</span>();
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$ref</span> = <span class="ruby-identifier">format_ref_marker</span>(<span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>});

<span class="ruby-identifier">git_header_html</span>(<span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$expires</span>);
<span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-string">&#39;&#39;</span>,
                   <span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>}, <span class="ruby-identifier">$hash</span>,
                   <span class="ruby-identifier">$formats_nav</span>);

<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parent&#39;</span>}) {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commitdiff&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-identifier">$ref</span>, <span class="ruby-identifier">$hash</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;tree&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-identifier">$ref</span>, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>}, <span class="ruby-identifier">$hash</span>);
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;title_text\&quot;&gt;\n&quot;</span> .
      <span class="ruby-string">&quot;&lt;table class=\&quot;object_header\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">git_print_authorship_rows</span>(\<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>);
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;&lt;td&gt;commit&lt;/td&gt;&lt;td class=\&quot;sha1\&quot;&gt;$co{&#39;id&#39;}&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;&quot;</span> .
      <span class="ruby-string">&quot;&lt;td&gt;tree&lt;/td&gt;&quot;</span> .
      <span class="ruby-string">&quot;&lt;td class=\&quot;sha1\&quot;&gt;&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>}, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>),
               <span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>}) .
      <span class="ruby-string">&quot;&lt;/td&gt;&quot;</span> .
      <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;tree&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>}, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>)},
              <span class="ruby-string">&quot;tree&quot;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$snapshot_links</span> = <span class="ruby-identifier">format_snapshot_links</span>(<span class="ruby-identifier">$hash</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$snapshot_links</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot; | &quot;</span> . <span class="ruby-identifier">$snapshot_links</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/td&gt;&quot;</span> .
      <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;

<span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$par</span> (@<span class="ruby-identifier">$parents</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;tr&gt;&quot;</span> .
              <span class="ruby-string">&quot;&lt;td&gt;parent&lt;/td&gt;&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;sha1\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$par</span>),
                       <span class="ruby-identifier">class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;list&quot;</span>}, <span class="ruby-identifier">$par</span>) .
              <span class="ruby-string">&quot;&lt;/td&gt;&quot;</span> .
              <span class="ruby-string">&quot;&lt;td class=\&quot;link\&quot;&gt;&quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commit&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$par</span>)}, <span class="ruby-string">&quot;commit&quot;</span>) .
              <span class="ruby-string">&quot; | &quot;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commitdiff&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$par</span>)}, <span class="ruby-string">&quot;diff&quot;</span>) .
              <span class="ruby-string">&quot;&lt;/td&gt;&quot;</span> .
              <span class="ruby-string">&quot;&lt;/tr&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;&quot;</span>.
      <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;

<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_body\&quot;&gt;\n&quot;</span>;
<span class="ruby-identifier">git_print_log</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;comment&#39;</span>});
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;

<span class="ruby-identifier">git_difftree_body</span>(\<span class="ruby-ivar">@difftree</span>, <span class="ruby-identifier">$hash</span>, @<span class="ruby-identifier">$parents</span>);

<span class="ruby-identifier">git_footer_html</span>();
</pre>

<p>}</p>

<p>sub git_object {</p>

<pre class="ruby"><span class="ruby-comment"># object is defined by:</span>
<span class="ruby-comment"># - hash or hash_base alone</span>
<span class="ruby-comment"># - hash_base and file_name</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$type</span>;

<span class="ruby-comment"># - hash or hash_base alone</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$hash</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>)) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$object_id</span> = <span class="ruby-identifier">$hash</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$hash_base</span>;

        <span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">quote_command</span>(
                <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&#39;cat-file&#39;</span>, <span class="ruby-string">&#39;-t&#39;</span>, <span class="ruby-identifier">$object_id</span>) . <span class="ruby-string">&#39; 2&gt; /dev/null&#39;</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Object does not exist&quot;</span>);
        <span class="ruby-identifier">$type</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
        <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$type</span>;
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Object does not exist&quot;</span>);

<span class="ruby-comment"># - hash_base and file_name</span>
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-identifier">$file_name</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s</span>,<span class="ruby-node">/+$,,;

        system(git_cmd(), &quot;cat-file&quot;, &#39;-e&#39;, $hash_base) == 0
                or die_error(404, &quot;Base object does not exist&quot;);

        # here errors should not happen
        open my $fd, &quot;-|&quot;, git_cmd(), &quot;ls-tree&quot;, $hash_base, &quot;--&quot;, $file_name
                or die_error(500, &quot;Open git-ls-tree failed&quot;);
        my $line = &lt;$fd&gt;;
        close $fd;

        #&#39;100644 blob 0fa3f3a66fb6a137f6ec2c19351ed4d807070ffa  panic.c&#39;
        unless ($line &amp;&amp; $line =~ m/</span><span class="ruby-operator">^</span>([<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span>]<span class="ruby-operator">+</span>) (.<span class="ruby-operator">+</span>) ([<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>})\<span class="ruby-identifier">t</span><span class="ruby-operator">/</span>) {
                <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;File or directory for given base does not exist&quot;</span>);
        }
        <span class="ruby-identifier">$type</span> = <span class="ruby-node">$2</span>;
        <span class="ruby-identifier">$hash</span> = <span class="ruby-node">$3</span>;
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Not enough information to find object&quot;</span>);
}

<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">redirect</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">uri</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$type</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>,
                                  <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_base</span>,
                                  <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>),
                     <span class="ruby-operator">-</span><span class="ruby-identifier">status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;302 Found&#39;</span>);
</pre>

<p>}</p>

<p>sub git_blobdiff {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$format</span> = <span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;html&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$diff_style</span> = <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;diff_style&#39;</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&#39;inline&#39;</span>;

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@difftree</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">iffinfo</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$expires</span>;

<span class="ruby-comment"># preparing $fd and %diffinfo for git_patchset_body</span>
<span class="ruby-comment"># new style URI</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_parent_base</span>) {
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-comment"># read raw output</span>
                <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;diff-tree&quot;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-ivar">@diff_opts</span>,
                        <span class="ruby-identifier">$hash_parent_base</span>, <span class="ruby-identifier">$hash_base</span>,
                        <span class="ruby-string">&quot;--&quot;</span>, (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_parent</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$file_parent</span> <span class="ruby-operator">:</span> ()), <span class="ruby-identifier">$file_name</span>
                        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-diff-tree failed&quot;</span>);
                <span class="ruby-ivar">@difftree</span> = <span class="ruby-identifier">map</span> { <span class="ruby-identifier">chomp</span>; <span class="ruby-identifier">$_</span> } <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
                <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
                        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Reading git-diff-tree failed&quot;</span>);
                <span class="ruby-ivar">@difftree</span>
                        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Blob diff not found&quot;</span>);

        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span> <span class="ruby-operator">&amp;&amp;</span>
                 <span class="ruby-identifier">$hash</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[0-9a-fA-F]{40}/</span>) {
                <span class="ruby-comment"># try to find filename from $hash</span>

                <span class="ruby-comment"># read filtered raw output</span>
                <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;diff-tree&quot;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-ivar">@diff_opts</span>,
                        <span class="ruby-identifier">$hash_parent_base</span>, <span class="ruby-identifier">$hash_base</span>, <span class="ruby-string">&quot;--&quot;</span>
                        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-diff-tree failed&quot;</span>);
                <span class="ruby-ivar">@difftree</span> =
                        <span class="ruby-comment"># &#39;:100644 100644 03b21826... 3b93d5e7... M     ls-files.c&#39;</span>
                        <span class="ruby-comment"># $hash == to_id</span>
                        <span class="ruby-identifier">grep</span> { <span class="ruby-regexp">/^:[0-7]{6} [0-7]{6} [0-9a-fA-F]{40} $hash/</span> }
                        <span class="ruby-identifier">map</span> { <span class="ruby-identifier">chomp</span>; <span class="ruby-identifier">$_</span> } <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
                <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
                        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Reading git-diff-tree failed&quot;</span>);
                <span class="ruby-ivar">@difftree</span>
                        <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Blob diff not found&quot;</span>);

        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Missing one of the blob diff parameters&quot;</span>);
        }

        <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@difftree</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) {
                <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Ambiguous blob diff specification&quot;</span>);
        }

        <span class="ruby-operator">%</span><span class="ruby-identifier">iffinfo</span> = <span class="ruby-identifier">parse_difftree_raw_line</span>(<span class="ruby-identifier">$difftree</span>[<span class="ruby-value">0</span>]);
        <span class="ruby-identifier">$file_parent</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">$diffinfo</span>{<span class="ruby-string">&#39;from_file&#39;</span>} <span class="ruby-operator">||</span> <span class="ruby-identifier">$file_name</span>;
        <span class="ruby-identifier">$file_name</span>   <span class="ruby-operator">||=</span> <span class="ruby-identifier">$diffinfo</span>{<span class="ruby-string">&#39;to_file&#39;</span>};

        <span class="ruby-identifier">$hash_parent</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">$diffinfo</span>{<span class="ruby-string">&#39;from_id&#39;</span>};
        <span class="ruby-identifier">$hash</span>        <span class="ruby-operator">||=</span> <span class="ruby-identifier">$diffinfo</span>{<span class="ruby-string">&#39;to_id&#39;</span>};

        <span class="ruby-comment"># non-textual hash id&#39;s can be cached</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-identifier">$/</span> <span class="ruby-operator">&amp;&amp;</span>
            <span class="ruby-identifier">$hash_parent_base</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-identifier">$/</span>) {
                <span class="ruby-identifier">$expires</span> = <span class="ruby-string">&#39;+1d&#39;</span>;
        }

        <span class="ruby-comment"># open patch output</span>
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;diff-tree&quot;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-ivar">@diff_opts</span>,
                <span class="ruby-string">&#39;-p&#39;</span>, (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;html&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;--full-index&quot;</span> <span class="ruby-operator">:</span> ()),
                <span class="ruby-identifier">$hash_parent_base</span>, <span class="ruby-identifier">$hash_base</span>,
                <span class="ruby-string">&quot;--&quot;</span>, (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_parent</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$file_parent</span> <span class="ruby-operator">:</span> ()), <span class="ruby-identifier">$file_name</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-diff-tree failed&quot;</span>);
}

<span class="ruby-comment"># old/legacy style URI -- not generated anymore since 1.4.3.</span>
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-operator">%</span><span class="ruby-identifier">iffinfo</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-string">&#39;404 Not Found&#39;</span>, <span class="ruby-string">&quot;Missing one of the blob diff parameters&quot;</span>)
}

<span class="ruby-comment"># header</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;html&#39;</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$formats_nav</span> =
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blobdiff_plain&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                        <span class="ruby-string">&quot;raw&quot;</span>);
        <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-identifier">diff_style_nav</span>(<span class="ruby-identifier">$diff_style</span>);
        <span class="ruby-identifier">git_header_html</span>(<span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$expires</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$hash_base</span>))) {
                <span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash_base</span>,<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},<span class="ruby-identifier">$hash_base</span>, <span class="ruby-identifier">$formats_nav</span>);
                <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}), <span class="ruby-identifier">$hash_base</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_nav\&quot;&gt;&lt;br/&gt;$formats_nav&lt;br/&gt;&lt;/div&gt;\n&quot;</span>;
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;title\&quot;&gt;&quot;</span>.<span class="ruby-identifier">esc_html</span>(<span class="ruby-string">&quot;$hash vs $hash_parent&quot;</span>).<span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-identifier">git_print_page_path</span>(<span class="ruby-identifier">$file_name</span>, <span class="ruby-string">&quot;blob&quot;</span>, <span class="ruby-identifier">$hash_base</span>);
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_path\&quot;&gt;&lt;/div&gt;\n&quot;</span>;
        }

} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;plain&#39;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">header</span>(
                <span class="ruby-operator">-</span><span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/plain&#39;</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">charset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;utf-8&#39;</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">expires</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$expires</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">content_disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;inline; filename=&quot;&#39;</span> . <span class="ruby-string">&quot;$file_name&quot;</span> . <span class="ruby-string">&#39;.patch&quot;&#39;</span>);

        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;X-Git-Url: &quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">self_url</span>() . <span class="ruby-string">&quot;\n\n&quot;</span>;

} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Unknown blobdiff format&quot;</span>);
}

<span class="ruby-comment"># patch</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;html&#39;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_body\&quot;&gt;\n&quot;</span>;

        <span class="ruby-identifier">git_patchset_body</span>(<span class="ruby-identifier">$fd</span>, <span class="ruby-identifier">$diff_style</span>,
                          [ \<span class="ruby-operator">%</span><span class="ruby-identifier">iffinfo</span> ], <span class="ruby-identifier">$hash_base</span>, <span class="ruby-identifier">$hash_parent_base</span>);
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>;

        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;page_body&quot;</span>
        <span class="ruby-identifier">git_footer_html</span>();

} <span class="ruby-keyword">else</span> {
        <span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
                <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-identifier">a</span><span class="ruby-operator">/</span>(<span class="ruby-identifier">$hash</span><span class="ruby-operator">|</span><span class="ruby-identifier">$hash_parent</span>)<span class="ruby-operator">!</span><span class="ruby-string">&#39;a/&#39;</span>.<span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diffinfo</span>{<span class="ruby-string">&#39;from_file&#39;</span>})<span class="ruby-operator">!</span><span class="ruby-identifier">eg</span>;
                <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">s!</span><span class="ruby-identifier">b</span><span class="ruby-operator">/</span>(<span class="ruby-identifier">$hash</span><span class="ruby-operator">|</span><span class="ruby-identifier">$hash_parent</span>)<span class="ruby-operator">!</span><span class="ruby-string">&#39;b/&#39;</span>.<span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$diffinfo</span>{<span class="ruby-string">&#39;to_file&#39;</span>})<span class="ruby-operator">!</span><span class="ruby-identifier">eg</span>;

                <span class="ruby-identifier">print</span> <span class="ruby-identifier">$line</span>;

                <span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m!</span><span class="ruby-operator">^</span>\<span class="ruby-operator">+</span>\<span class="ruby-operator">+</span>\<span class="ruby-operator">+</span><span class="ruby-operator">!</span>;
        }
        <span class="ruby-identifier">local</span> <span class="ruby-identifier">$/</span> = <span class="ruby-keyword">undef</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>;
}
</pre>

<p>}</p>

<p>sub git_blobdiff_plain {</p>

<pre>git_blobdiff(&#39;plain&#39;);</pre>

<p>}</p>

<p># assumes that it is added as later part of already existing navigation, #
so it returns | foo | bar rather than just foo | bar sub diff_style_nav
{</p>

<pre class="ruby"><span class="ruby-identifier">my</span> (<span class="ruby-identifier">$diff_style</span>, <span class="ruby-identifier">$is_combined</span>) = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">$diff_style</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;inline&#39;</span>;

<span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$is_combined</span>);

<span class="ruby-identifier">my</span> <span class="ruby-ivar">@styles</span> = (<span class="ruby-identifier">inline</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;inline&#39;</span>, <span class="ruby-string">&#39;sidebyside&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;side by side&#39;</span>);
<span class="ruby-identifier">my</span> <span class="ruby-value">%syles = @st</span><span class="ruby-identifier">yles</span>;
<span class="ruby-ivar">@styles</span> =
        <span class="ruby-ivar">@styles</span>[ <span class="ruby-identifier">map</span> { <span class="ruby-identifier">$_</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span> } <span class="ruby-value">0</span><span class="ruby-operator">..</span>$<span class="ruby-comment">#styles/2 ];</span>

<span class="ruby-keyword">return</span> <span class="ruby-identifier">join</span> <span class="ruby-string">&#39;&#39;</span>,
        <span class="ruby-identifier">map</span> { <span class="ruby-string">&quot; | &quot;</span>.<span class="ruby-identifier">$_</span> }
        <span class="ruby-identifier">map</span> {
                <span class="ruby-identifier">$_</span> <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$diff_style</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$styles</span>{<span class="ruby-identifier">$_</span>} <span class="ruby-operator">:</span>
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">diff_style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$_</span>)}, <span class="ruby-identifier">$styles</span>{<span class="ruby-identifier">$_</span>})
        } <span class="ruby-ivar">@styles</span>;
</pre>

<p>}</p>

<p>sub git_commitdiff {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">arams</span> = <span class="ruby-ivar">@_</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$format</span> = <span class="ruby-identifier">$params</span>{<span class="ruby-operator">-</span><span class="ruby-identifier">format</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&#39;html&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$diff_style</span> = <span class="ruby-identifier">$input_params</span>{<span class="ruby-string">&#39;diff_style&#39;</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&#39;inline&#39;</span>;

<span class="ruby-identifier">my</span> (<span class="ruby-identifier">$patch_max</span>) = <span class="ruby-identifier">gitweb_get_feature</span>(<span class="ruby-string">&#39;patches&#39;</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;patch&#39;</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">403</span>, <span class="ruby-string">&quot;Patch view not allowed&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$patch_max</span>;
}

<span class="ruby-identifier">$hash</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">$hash_base</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;HEAD&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$hash</span>)
    <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;Unknown commit object&quot;</span>);

<span class="ruby-comment"># choose format for commitdiff for merge</span>
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span> <span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_parent</span> <span class="ruby-operator">&amp;&amp;</span> @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}} <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) {
        <span class="ruby-identifier">$hash_parent</span> = <span class="ruby-string">&#39;--cc&#39;</span>;
}
<span class="ruby-comment"># we need to prepare $formats_nav before almost any parameter munging</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$formats_nav</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;html&#39;</span>) {
        <span class="ruby-identifier">$formats_nav</span> =
                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commitdiff_plain&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                        <span class="ruby-string">&quot;raw&quot;</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$patch_max</span> <span class="ruby-operator">&amp;&amp;</span> @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}} <span class="ruby-operator">&lt;=</span> <span class="ruby-value">1</span>) {
                <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-string">&quot; | &quot;</span> .
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;patch&quot;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)},
                                <span class="ruby-string">&quot;patch&quot;</span>);
        }
        <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-identifier">diff_style_nav</span>(<span class="ruby-identifier">$diff_style</span>, @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}} <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);

        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_parent</span> <span class="ruby-operator">&amp;&amp;</span>
            <span class="ruby-identifier">$hash_parent</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;-c&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$hash_parent</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;--cc&#39;</span>) {
                <span class="ruby-comment"># commitdiff with two commits given</span>
                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$hash_parent_short</span> = <span class="ruby-identifier">$hash_parent</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$hash_parent</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-identifier">$/</span>) {
                        <span class="ruby-identifier">$hash_parent_short</span> = <span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$hash_parent</span>, <span class="ruby-value">0</span>, <span class="ruby-value">7</span>);
                }
                <span class="ruby-identifier">$formats_nav</span> .=
                        <span class="ruby-string">&#39; (from&#39;</span>;
                <span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;</span> @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}}; <span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-operator">+</span>) {
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}[<span class="ruby-identifier">$i</span>] <span class="ruby-identifier">eq</span> <span class="ruby-identifier">$hash_parent</span>) {
                                <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-string">&#39; parent &#39;</span> . (<span class="ruby-identifier">$i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>);
                                <span class="ruby-identifier">last</span>;
                        }
                }
                <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-string">&#39;: &#39;</span> .
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>,
                                               <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash_parent</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>)},
                                <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$hash_parent_short</span>)) .
                        <span class="ruby-string">&#39;)&#39;</span>;
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parent&#39;</span>}) {
                <span class="ruby-comment"># --root commitdiff</span>
                <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-string">&#39; (initial)&#39;</span>;
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">scalar</span> @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}} <span class="ruby-operator">==</span> <span class="ruby-value">1</span>) {
                <span class="ruby-comment"># single parent commit</span>
                <span class="ruby-identifier">$formats_nav</span> .=
                        <span class="ruby-string">&#39; (parent: &#39;</span> .
                        <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>,
                                               <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parent&#39;</span>}, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>)},
                                <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parent&#39;</span>}, <span class="ruby-value">0</span>, <span class="ruby-value">7</span>))) .
                        <span class="ruby-string">&#39;)&#39;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-comment"># merge commit</span>
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$hash_parent</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;--cc&#39;</span>) {
                        <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-string">&#39; | &#39;</span> .
                                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>,
                                                       <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;-c&#39;</span>)},
                                        <span class="ruby-string">&#39;combined&#39;</span>);
                } <span class="ruby-keyword">else</span> { <span class="ruby-comment"># $hash_parent eq &#39;-c&#39;</span>
                        <span class="ruby-identifier">$formats_nav</span> .= <span class="ruby-string">&#39; | &#39;</span> .
                                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>,
                                                       <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;--cc&#39;</span>)},
                                        <span class="ruby-string">&#39;compact&#39;</span>);
                }
                <span class="ruby-identifier">$formats_nav</span> .=
                        <span class="ruby-string">&#39; (merge: &#39;</span> .
                        <span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>, <span class="ruby-identifier">map</span> {
                                <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">replay</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>,
                                                       <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$_</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">undef</span>)},
                                        <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">substr</span>(<span class="ruby-identifier">$_</span>, <span class="ruby-value">0</span>, <span class="ruby-value">7</span>)));
                        } @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}} ) .
                        <span class="ruby-string">&#39;)&#39;</span>;
        }
}

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$hash_parent_param</span> = <span class="ruby-identifier">$hash_parent</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_parent_param</span>) {
        <span class="ruby-comment"># --cc for multiple parents, --root for parentless</span>
        <span class="ruby-identifier">$hash_parent_param</span> =
                @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}} <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;--cc&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parent&#39;</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&#39;--root&#39;</span>;
}

<span class="ruby-comment"># read commitdiff</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@difftree</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;html&#39;</span>) {
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;diff-tree&quot;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-ivar">@diff_opts</span>,
                <span class="ruby-string">&quot;--no-commit-id&quot;</span>, <span class="ruby-string">&quot;--patch-with-raw&quot;</span>, <span class="ruby-string">&quot;--full-index&quot;</span>,
                <span class="ruby-identifier">$hash_parent_param</span>, <span class="ruby-identifier">$hash</span>, <span class="ruby-string">&quot;--&quot;</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-diff-tree failed&quot;</span>);

        <span class="ruby-keyword">while</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> = <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>) {
                <span class="ruby-identifier">chomp</span> <span class="ruby-identifier">$line</span>;
                <span class="ruby-comment"># empty line ends raw part of diff-tree output</span>
                <span class="ruby-identifier">last</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$line</span>;
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@difftree</span>, <span class="ruby-identifier">scalar</span> <span class="ruby-identifier">parse_difftree_raw_line</span>(<span class="ruby-identifier">$line</span>);
        }

} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;plain&#39;</span>) {
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;diff-tree&quot;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-ivar">@diff_opts</span>,
                <span class="ruby-string">&#39;-p&#39;</span>, <span class="ruby-identifier">$hash_parent_param</span>, <span class="ruby-identifier">$hash</span>, <span class="ruby-string">&quot;--&quot;</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-diff-tree failed&quot;</span>);
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;patch&#39;</span>) {
        <span class="ruby-comment"># For commit ranges, we limit the output to the number of</span>
        <span class="ruby-comment"># patches specified in the &#39;patches&#39; feature.</span>
        <span class="ruby-comment"># For single commits, we limit the output to a single patch,</span>
        <span class="ruby-comment"># diverging from the git-format-patch default.</span>
        <span class="ruby-identifier">my</span> <span class="ruby-ivar">@commit_spec</span> = ();
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$hash_parent</span>) {
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$patch_max</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
                        <span class="ruby-identifier">push</span> <span class="ruby-ivar">@commit_spec</span>, <span class="ruby-string">&quot;-$patch_max&quot;</span>;
                }
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@commit_spec</span>, <span class="ruby-string">&#39;-n&#39;</span>, <span class="ruby-string">&quot;$hash_parent..$hash&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$params</span>{<span class="ruby-operator">-</span><span class="ruby-identifier">single</span>}) {
                        <span class="ruby-identifier">push</span> <span class="ruby-ivar">@commit_spec</span>, <span class="ruby-string">&#39;-1&#39;</span>;
                } <span class="ruby-keyword">else</span> {
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$patch_max</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) {
                                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@commit_spec</span>, <span class="ruby-string">&quot;-$patch_max&quot;</span>;
                        }
                        <span class="ruby-identifier">push</span> <span class="ruby-ivar">@commit_spec</span>, <span class="ruby-string">&quot;-n&quot;</span>;
                }
                <span class="ruby-identifier">push</span> <span class="ruby-ivar">@commit_spec</span>, <span class="ruby-string">&#39;--root&#39;</span>, <span class="ruby-identifier">$hash</span>;
        }
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;format-patch&quot;</span>, <span class="ruby-ivar">@diff_opts</span>,
                <span class="ruby-string">&#39;--encoding=utf8&#39;</span>, <span class="ruby-string">&#39;--stdout&#39;</span>, <span class="ruby-ivar">@commit_spec</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">die_error</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&quot;Open git-format-patch failed&quot;</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Unknown commitdiff format&quot;</span>);
}

<span class="ruby-comment"># non-textual hash id&#39;s can be cached</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$expires</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$hash</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span><span class="ruby-operator">/</span><span class="ruby-operator">^</span>[<span class="ruby-value">0</span><span class="ruby-operator">-</span><span class="ruby-value">9</span><span class="ruby-identifier">a</span><span class="ruby-operator">-</span><span class="ruby-identifier">fA</span><span class="ruby-operator">-</span><span class="ruby-constant">F</span>]{<span class="ruby-value">40</span>}<span class="ruby-identifier">$/</span>) {
        <span class="ruby-identifier">$expires</span> = <span class="ruby-string">&quot;+1d&quot;</span>;
}

<span class="ruby-comment"># write commit message</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;html&#39;</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$refs</span> = <span class="ruby-identifier">git_get_references</span>();
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$ref</span> = <span class="ruby-identifier">format_ref_marker</span>(<span class="ruby-identifier">$refs</span>, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>});

        <span class="ruby-identifier">git_header_html</span>(<span class="ruby-keyword">undef</span>, <span class="ruby-identifier">$expires</span>);
        <span class="ruby-identifier">git_print_page_nav</span>(<span class="ruby-string">&#39;commitdiff&#39;</span>,<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">$hash</span>,<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;tree&#39;</span>},<span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">$formats_nav</span>);
        <span class="ruby-identifier">git_print_header_div</span>(<span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-identifier">$ref</span>, <span class="ruby-identifier">$hash</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;title_text\&quot;&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;table class=\&quot;object_header\&quot;&gt;\n&quot;</span>;
        <span class="ruby-identifier">git_print_authorship_rows</span>(\<span class="ruby-operator">%</span><span class="ruby-identifier">o</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/table&gt;&quot;</span>.
              <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;page_body\&quot;&gt;\n&quot;</span>;
        <span class="ruby-keyword">if</span> (@{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;comment&#39;</span>}} <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;div class=\&quot;log\&quot;&gt;\n&quot;</span>;
                <span class="ruby-identifier">git_print_log</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;comment&#39;</span>}, <span class="ruby-operator">-</span><span class="ruby-identifier">final_empty_line</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">remove_title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;log&quot;</span>
        }

} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;plain&#39;</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$refs</span> = <span class="ruby-identifier">git_get_references</span>(<span class="ruby-string">&quot;tags&quot;</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$tagname</span> = <span class="ruby-identifier">git_get_rev_name_tags</span>(<span class="ruby-identifier">$hash</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filename</span> = <span class="ruby-identifier">basename</span>(<span class="ruby-identifier">$project</span>) . <span class="ruby-string">&quot;-$hash.patch&quot;</span>;

        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">header</span>(
                <span class="ruby-operator">-</span><span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/plain&#39;</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">charset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;utf-8&#39;</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">expires</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$expires</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">content_disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;inline; filename=&quot;&#39;</span> . <span class="ruby-string">&quot;$filename&quot;</span> . <span class="ruby-string">&#39;&quot;&#39;</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">d</span> = <span class="ruby-identifier">parse_date</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_epoch&#39;</span>}, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_tz&#39;</span>});
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;From: &quot;</span> . <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author&#39;</span>}) . <span class="ruby-string">&quot;\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Date: $ad{&#39;rfc2822&#39;} ($ad{&#39;tz_local&#39;})\n&quot;</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Subject: &quot;</span> . <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-string">&quot;\n&quot;</span>;

        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;X-Git-Tag: $tagname\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$tagname</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;X-Git-Url: &quot;</span> . <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">self_url</span>() . <span class="ruby-string">&quot;\n\n&quot;</span>;

        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> (@{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;comment&#39;</span>}}) {
                <span class="ruby-identifier">print</span> <span class="ruby-identifier">to_utf8</span>(<span class="ruby-identifier">$line</span>) . <span class="ruby-string">&quot;\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;---\n\n&quot;</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;patch&#39;</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$filename</span> = <span class="ruby-identifier">basename</span>(<span class="ruby-identifier">$project</span>) . <span class="ruby-string">&quot;-$hash.patch&quot;</span>;

        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">header</span>(
                <span class="ruby-operator">-</span><span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/plain&#39;</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">charset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;utf-8&#39;</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">expires</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$expires</span>,
                <span class="ruby-operator">-</span><span class="ruby-identifier">content_disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;inline; filename=&quot;&#39;</span> . <span class="ruby-string">&quot;$filename&quot;</span> . <span class="ruby-string">&#39;&quot;&#39;</span>);
}

<span class="ruby-comment"># write patch</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;html&#39;</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$use_parents</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash_parent</span> <span class="ruby-operator">||</span>
                <span class="ruby-identifier">$hash_parent</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;-c&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$hash_parent</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;--cc&#39;</span>;
        <span class="ruby-identifier">git_difftree_body</span>(\<span class="ruby-ivar">@difftree</span>, <span class="ruby-identifier">$hash</span>,
                          <span class="ruby-identifier">$use_parents</span> <span class="ruby-operator">?</span> @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}} <span class="ruby-operator">:</span> <span class="ruby-identifier">$hash_parent</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;br/&gt;\n&quot;</span>;

        <span class="ruby-identifier">git_patchset_body</span>(<span class="ruby-identifier">$fd</span>, <span class="ruby-identifier">$diff_style</span>,
                          \<span class="ruby-ivar">@difftree</span>, <span class="ruby-identifier">$hash</span>,
                          <span class="ruby-identifier">$use_parents</span> <span class="ruby-operator">?</span> @{<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parents&#39;</span>}} <span class="ruby-operator">:</span> <span class="ruby-identifier">$hash_parent</span>);
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/div&gt;\n&quot;</span>; <span class="ruby-comment"># class=&quot;page_body&quot;</span>
        <span class="ruby-identifier">git_footer_html</span>();

} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;plain&#39;</span>) {
        <span class="ruby-identifier">local</span> <span class="ruby-identifier">$/</span> = <span class="ruby-keyword">undef</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Reading git-diff-tree failed\n&quot;</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;patch&#39;</span>) {
        <span class="ruby-identifier">local</span> <span class="ruby-identifier">$/</span> = <span class="ruby-keyword">undef</span>;
        <span class="ruby-identifier">print</span> <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
                <span class="ruby-keyword">or</span> <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;Reading git-format-patch failed\n&quot;</span>;
}
</pre>

<p>}</p>

<p>sub git_commitdiff_plain {</p>

<pre class="ruby"><span class="ruby-identifier">git_commitdiff</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;plain&#39;</span>);
</pre>

<p>}</p>

<p># format-patch-style patches sub git_patch {</p>

<pre class="ruby"><span class="ruby-identifier">git_commitdiff</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;patch&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">single</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
</pre>

<p>}</p>

<p>sub git_patches {</p>

<pre class="ruby"><span class="ruby-identifier">git_commitdiff</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;patch&#39;</span>);
</pre>

<p>}</p>

<p>sub git_history {</p>

<pre>git_log_generic(&#39;history&#39;, \&amp;git_history_body,
                $hash_base, $hash_parent_base,
                $file_name, $hash);</pre>

<p>}</p>

<p>sub git_search {</p>

<pre>$searchtype ||= &#39;commit&#39;;

# check if appropriate features are enabled
gitweb_check_feature(&#39;search&#39;)
        or die_error(403, &quot;Search is disabled&quot;);
if ($searchtype eq &#39;pickaxe&#39;) {
        # pickaxe may take all resources of your box and run for several minutes
        # with every query - so decide by yourself how public you make this feature
        gitweb_check_feature(&#39;pickaxe&#39;)
                or die_error(403, &quot;Pickaxe search is disabled&quot;);
}
if ($searchtype eq &#39;grep&#39;) {
        # grep search might be potentially CPU-intensive, too
        gitweb_check_feature(&#39;grep&#39;)
                or die_error(403, &quot;Grep search is disabled&quot;);
}

if (!defined $searchtext) {
        die_error(400, &quot;Text field is empty&quot;);
}
if (!defined $hash) {
        $hash = git_get_head_hash($project);
}
my %co = parse_commit($hash);
if (!%co) {
        die_error(404, &quot;Unknown commit object&quot;);
}
if (!defined $page) {
        $page = 0;
}

if ($searchtype eq &#39;commit&#39; ||
    $searchtype eq &#39;author&#39; ||
    $searchtype eq &#39;committer&#39;) {
        git_search_message(%co);
} elsif ($searchtype eq &#39;pickaxe&#39;) {
        git_search_changes(%co);
} elsif ($searchtype eq &#39;grep&#39;) {
        git_search_files(%co);
} else {
        die_error(400, &quot;Unknown search type&quot;);
}</pre>

<p>}</p>

<p>sub git_search_help {</p>

<pre>git_header_html();
git_print_page_nav(&#39;&#39;,&#39;&#39;, $hash,$hash,$hash);
print &lt;&lt;EOT;</pre>

<p>&lt;p&gt;&lt;strong&gt;Pattern&lt;/strong&gt; is by default a normal string
that is matched precisely (but without regard to case, except in the case
of pickaxe). However, when you check the <em>re</em> checkbox, the pattern
entered is recognized as the POSIX extended &lt;a href=<a
href="http://en.wikipedia.org/wiki/Regular_expression">regular>en.wikipedia.org/wiki/Regular_expression>regular</a>
expression&lt;/a&gt; (also case insensitive).&lt;/p&gt; &lt;dl&gt;
&lt;dt&gt;<strong>commit</strong>&lt;/dt&gt; &lt;dd&gt;The commit messages
and authorship information will be scanned for the given
pattern.&lt;/dd&gt; EOT</p>

<pre>my $have_grep = gitweb_check_feature(&#39;grep&#39;);
if ($have_grep) {
        print &lt;&lt;EOT;</pre>

<p>&lt;dt&gt;<strong>grep</strong>&lt;/dt&gt; &lt;dd&gt;All files in the
currently selected tree (HEAD unless you are explicitly browsing</p>

<pre>a different one) are searched for the given pattern. On large trees, this search can take</pre>

<p>a while and put some strain on the server, so please use it with some
consideration. Note that due to git-grep peculiarity, currently if regexp
mode is turned off, the matches are case-sensitive.&lt;/dd&gt; EOT</p>

<pre>}
print &lt;&lt;EOT;</pre>

<p>&lt;dt&gt;<strong>author</strong>&lt;/dt&gt; &lt;dd&gt;Name and e-mail of
the change author and date of birth of the patch will be scanned for the
given pattern.&lt;/dd&gt; &lt;dt&gt;<strong>committer</strong>&lt;/dt&gt;
&lt;dd&gt;Name and e-mail of the committer and date of commit will be
scanned for the given pattern.&lt;/dd&gt; EOT</p>

<pre>my $have_pickaxe = gitweb_check_feature(&#39;pickaxe&#39;);
if ($have_pickaxe) {
        print &lt;&lt;EOT;</pre>

<p>&lt;dt&gt;<strong>pickaxe</strong>&lt;/dt&gt; &lt;dd&gt;All commits that
caused the string to appear or disappear from any file (changes that added,
removed or modified the string) will be listed. This search can take a
while and takes a lot of strain on the server, so please use it wisely.
Note that since you may be interested even in changes just changing the
case as well, this search is case sensitive.&lt;/dd&gt; EOT</p>

<pre>}
print &quot;&lt;/dl&gt;\n&quot;;
git_footer_html();</pre>

<p>}</p>

<p>sub git_shortlog {</p>

<pre>git_log_generic(&#39;shortlog&#39;, \&amp;git_shortlog_body,
                $hash, $hash_parent);</pre>

<p>}</p>

<p>## ................... ## feeds (RSS, Atom; OPML)</p>

<p>sub git_feed {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-identifier">$format</span> = <span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;atom&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$have_blame</span> = <span class="ruby-identifier">gitweb_check_feature</span>(<span class="ruby-string">&#39;blame&#39;</span>);

<span class="ruby-comment"># Atom: http://www.atomenabled.org/developers/syndication/</span>
<span class="ruby-comment"># RSS:  http://www.notestips.com/80256B3A007F2692/1/NAMO5P9UPQ</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;rss&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$format</span> <span class="ruby-identifier">ne</span> <span class="ruby-string">&#39;atom&#39;</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">400</span>, <span class="ruby-string">&quot;Unknown web feed format&quot;</span>);
}

<span class="ruby-comment"># log/feed of current (HEAD) branch, log of given branch, history of file/directory</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$head</span> = <span class="ruby-identifier">$hash</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;HEAD&#39;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-ivar">@commitlist</span> = <span class="ruby-identifier">parse_commits</span>(<span class="ruby-identifier">$head</span>, <span class="ruby-value">150</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">$file_name</span>);

<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">atest_commit</span>;
<span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">atest_date</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$content_type</span> = <span class="ruby-string">&quot;application/$format+xml&quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">http</span>(<span class="ruby-string">&#39;HTTP_ACCEPT&#39;</span>) <span class="ruby-operator">&amp;&amp;</span>
         <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Accept</span>(<span class="ruby-string">&#39;text/xml&#39;</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Accept</span>(<span class="ruby-identifier">$content_type</span>)) {
        <span class="ruby-comment"># browser (feed reader) prefers text/xml</span>
        <span class="ruby-identifier">$content_type</span> = <span class="ruby-string">&#39;text/xml&#39;</span>;
}
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span>(<span class="ruby-identifier">$commitlist</span>[<span class="ruby-value">0</span>])) {
        <span class="ruby-operator">%</span><span class="ruby-identifier">atest_commit</span> = <span class="ruby-string">%Q{$commitlist[0]}</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$latest_epoch</span> = <span class="ruby-identifier">$latest_commit</span>{<span class="ruby-string">&#39;committer_epoch&#39;</span>};
        <span class="ruby-identifier">exit_if_unmodified_since</span>(<span class="ruby-identifier">$latest_epoch</span>);
        <span class="ruby-operator">%</span><span class="ruby-identifier">atest_date</span> = <span class="ruby-identifier">parse_date</span>(<span class="ruby-identifier">$latest_epoch</span>, <span class="ruby-identifier">$latest_commit</span>{<span class="ruby-string">&#39;committer_tz&#39;</span>});
}
<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">header</span>(
        <span class="ruby-operator">-</span><span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$content_type</span>,
        <span class="ruby-operator">-</span><span class="ruby-identifier">charset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;utf-8&#39;</span>,
        <span class="ruby-operator">%</span><span class="ruby-identifier">atest_date</span> <span class="ruby-operator">?</span> (<span class="ruby-operator">-</span><span class="ruby-identifier">last_modified</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$latest_date</span>{<span class="ruby-string">&#39;rfc2822&#39;</span>}) <span class="ruby-operator">:</span> (),
        <span class="ruby-operator">-</span><span class="ruby-identifier">status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;200 OK&#39;</span>);

<span class="ruby-comment"># Optimization: skip generating the body if client asks only</span>
<span class="ruby-comment"># for Last-Modified date.</span>
<span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">request_method</span>() <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;HEAD&#39;</span>);

<span class="ruby-comment"># header variables</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$title</span> = <span class="ruby-string">&quot;$site_name - $project/$action&quot;</span>;
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$feed_type</span> = <span class="ruby-string">&#39;log&#39;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span>) {
        <span class="ruby-identifier">$title</span> .= <span class="ruby-string">&quot; - &#39;$hash&#39;&quot;</span>;
        <span class="ruby-identifier">$feed_type</span> = <span class="ruby-string">&#39;branch log&#39;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
                <span class="ruby-identifier">$title</span> .= <span class="ruby-string">&quot; :: $file_name&quot;</span>;
                <span class="ruby-identifier">$feed_type</span> = <span class="ruby-string">&#39;history&#39;</span>;
        }
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-identifier">$title</span> .= <span class="ruby-string">&quot; - $file_name&quot;</span>;
        <span class="ruby-identifier">$feed_type</span> = <span class="ruby-string">&#39;history&#39;</span>;
}
<span class="ruby-identifier">$title</span> .= <span class="ruby-string">&quot; $feed_type&quot;</span>;
<span class="ruby-identifier">$title</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$title</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$descr</span> = <span class="ruby-identifier">git_get_project_description</span>(<span class="ruby-identifier">$project</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$descr</span>) {
        <span class="ruby-identifier">$descr</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$descr</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$descr</span> = <span class="ruby-string">&quot;$project &quot;</span> .
                 (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;rss&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;RSS&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;Atom&#39;</span>) .
                 <span class="ruby-string">&quot; feed&quot;</span>;
}
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$owner</span> = <span class="ruby-identifier">git_get_project_owner</span>(<span class="ruby-identifier">$project</span>);
<span class="ruby-identifier">$owner</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$owner</span>);

<span class="ruby-comment">#header</span>
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$alt_url</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span>) {
        <span class="ruby-identifier">$alt_url</span> = <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>, <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file_name</span>);
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$hash</span>) {
        <span class="ruby-identifier">$alt_url</span> = <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;log&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$hash</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$alt_url</span> = <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;summary&quot;</span>);
}
<span class="ruby-identifier">print</span> <span class="ruby-identifier">qq!</span><span class="ruby-operator">&lt;</span><span class="ruby-value">?x</span><span class="ruby-identifier">ml</span> <span class="ruby-identifier">version</span>=<span class="ruby-string">&quot;1.0&quot;</span> <span class="ruby-identifier">encoding</span>=<span class="ruby-string">&quot;utf-8&quot;</span><span class="ruby-operator">?</span><span class="ruby-operator">&gt;</span>\<span class="ruby-identifier">n!</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;rss&#39;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&quot;</span>;
</pre>

<p>&lt;rss version=2.0 xmlns:content=<a
href="http://purl.org/rss/1.0/modules/content">purl.org/rss/1.0/modules/content</a>/&gt;
&lt;channel&gt; XML</p>

<pre>        print &quot;&lt;title&gt;$title&lt;/title&gt;\n&quot; .
              &quot;&lt;link&gt;$alt_url&lt;/link&gt;\n&quot; .
              &quot;&lt;description&gt;$descr&lt;/description&gt;\n&quot; .
              &quot;&lt;language&gt;en&lt;/language&gt;\n&quot; .
              # project owner is responsible for &#39;editorial&#39; content
              &quot;&lt;managingEditor&gt;$owner&lt;/managingEditor&gt;\n&quot;;
        if (defined $logo || defined $favicon) {
                # prefer the logo to the favicon, since RSS
                # doesn&#39;t allow both
                my $img = esc_url($logo || $favicon);
                print &quot;&lt;image&gt;\n&quot; .
                      &quot;&lt;url&gt;$img&lt;/url&gt;\n&quot; .
                      &quot;&lt;title&gt;$title&lt;/title&gt;\n&quot; .
                      &quot;&lt;link&gt;$alt_url&lt;/link&gt;\n&quot; .
                      &quot;&lt;/image&gt;\n&quot;;
        }
        if (%latest_date) {
                print &quot;&lt;pubDate&gt;$latest_date{&#39;rfc2822&#39;}&lt;/pubDate&gt;\n&quot;;
                print &quot;&lt;lastBuildDate&gt;$latest_date{&#39;rfc2822&#39;}&lt;/lastBuildDate&gt;\n&quot;;
        }
        print &quot;&lt;generator&gt;gitweb v.$version/$git_version&lt;/generator&gt;\n&quot;;
} elsif ($format eq &#39;atom&#39;) {
        print &lt;&lt;XML;</pre>

<p>&lt;feed xmlns=<a
href="http://www.w3.org/2005/Atom">www.w3.org/2005/Atom</a>&gt; XML</p>

<pre class="ruby">        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;title&gt;$title&lt;/title&gt;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;subtitle&gt;$descr&lt;/subtitle&gt;\n&quot;</span> .
              <span class="ruby-string">&#39;&lt;link rel=&quot;alternate&quot; type=&quot;text/html&quot; href=&quot;&#39;</span> .
              <span class="ruby-identifier">$alt_url</span> . <span class="ruby-string">&#39;&quot; /&gt;&#39;</span> . <span class="ruby-string">&quot;\n&quot;</span> .
              <span class="ruby-string">&#39;&lt;link rel=&quot;self&quot; type=&quot;&#39;</span> . <span class="ruby-identifier">$content_type</span> . <span class="ruby-string">&#39;&quot; href=&quot;&#39;</span> .
              <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">self_url</span>() . <span class="ruby-string">&#39;&quot; /&gt;&#39;</span> . <span class="ruby-string">&quot;\n&quot;</span> .
              <span class="ruby-string">&quot;&lt;id&gt;&quot;</span> . <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>) . <span class="ruby-string">&quot;&lt;/id&gt;\n&quot;</span> .
              <span class="ruby-comment"># use project owner for feed author</span>
              <span class="ruby-string">&quot;&lt;author&gt;&lt;name&gt;$owner&lt;/name&gt;&lt;/author&gt;\n&quot;</span>;
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$favicon</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;icon&gt;&quot;</span> . <span class="ruby-identifier">esc_url</span>(<span class="ruby-identifier">$favicon</span>) . <span class="ruby-string">&quot;&lt;/icon&gt;\n&quot;</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$logo</span>) {
                <span class="ruby-comment"># not twice as wide as tall: 72 x 27 pixels</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;logo&gt;&quot;</span> . <span class="ruby-identifier">esc_url</span>(<span class="ruby-identifier">$logo</span>) . <span class="ruby-string">&quot;&lt;/logo&gt;\n&quot;</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span> <span class="ruby-operator">%</span><span class="ruby-identifier">atest_date</span>) {
                <span class="ruby-comment"># dummy date to keep the feed valid until commits trickle in:</span>
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;updated&gt;1970-01-01T00:00:00Z&lt;/updated&gt;\n&quot;</span>;
        } <span class="ruby-keyword">else</span> {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;updated&gt;$latest_date{&#39;iso-8601&#39;}&lt;/updated&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;generator version=&#39;$version/$git_version&#39;&gt;gitweb&lt;/generator&gt;\n&quot;</span>;
}

<span class="ruby-comment"># contents</span>
<span class="ruby-keyword">for</span> (<span class="ruby-identifier">my</span> <span class="ruby-identifier">$i</span> = <span class="ruby-value">0</span>; <span class="ruby-identifier">$i</span> <span class="ruby-operator">&lt;=</span> $<span class="ruby-comment">#commitlist; $i++) {</span>
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-string">%Q{$commitlist[$i]}</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$commit</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>};
        <span class="ruby-comment"># we read 150, we always show 30 and the ones more recent than 48 hours</span>
        <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">$i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">20</span>) <span class="ruby-operator">&amp;&amp;</span> ((<span class="ruby-identifier">time</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_epoch&#39;</span>}) <span class="ruby-operator">&gt;</span> <span class="ruby-value">48</span><span class="ruby-operator">*</span><span class="ruby-value">60</span><span class="ruby-operator">*</span><span class="ruby-value">60</span>)) {
                <span class="ruby-identifier">last</span>;
        }
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">d</span> = <span class="ruby-identifier">parse_date</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_epoch&#39;</span>}, <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_tz&#39;</span>});

        <span class="ruby-comment"># get list of changed files</span>
        <span class="ruby-identifier">open</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$fd</span>, <span class="ruby-string">&quot;-|&quot;</span>, <span class="ruby-identifier">git_cmd</span>(), <span class="ruby-string">&quot;diff-tree&quot;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-ivar">@diff_opts</span>,
                <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parent&#39;</span>} <span class="ruby-operator">||</span> <span class="ruby-string">&quot;--root&quot;</span>,
                <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>}, <span class="ruby-string">&quot;--&quot;</span>, (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$file_name</span> <span class="ruby-operator">:</span> ())
                <span class="ruby-keyword">or</span> <span class="ruby-keyword">next</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-ivar">@difftree</span> = <span class="ruby-identifier">map</span> { <span class="ruby-identifier">chomp</span>; <span class="ruby-identifier">$_</span> } <span class="ruby-operator">&lt;</span><span class="ruby-identifier">$fd</span><span class="ruby-operator">&gt;</span>;
        <span class="ruby-identifier">close</span> <span class="ruby-identifier">$fd</span>
                <span class="ruby-keyword">or</span> <span class="ruby-keyword">next</span>;

        <span class="ruby-comment"># print element (entry, item)</span>
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$co_url</span> = <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;commitdiff&quot;</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;rss&#39;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;item&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;title&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-string">&quot;&lt;/title&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;author&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author&#39;</span>}) . <span class="ruby-string">&quot;&lt;/author&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;pubDate&gt;$cd{&#39;rfc2822&#39;}&lt;/pubDate&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;guid isPermaLink=\&quot;true\&quot;&gt;$co_url&lt;/guid&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;link&gt;$co_url&lt;/link&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;description&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-string">&quot;&lt;/description&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;content:encoded&gt;&quot;</span> .
                      <span class="ruby-string">&quot;&lt;![CDATA[\n&quot;</span>;
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;atom&#39;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;entry&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;title type=\&quot;html\&quot;&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;title&#39;</span>}) . <span class="ruby-string">&quot;&lt;/title&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;updated&gt;$cd{&#39;iso-8601&#39;}&lt;/updated&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;author&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;  &lt;name&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_name&#39;</span>}) . <span class="ruby-string">&quot;&lt;/name&gt;\n&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_email&#39;</span>}) {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;  &lt;email&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;author_email&#39;</span>}) . <span class="ruby-string">&quot;&lt;/email&gt;\n&quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/author&gt;\n&quot;</span> .
                      <span class="ruby-comment"># use committer for contributor</span>
                      <span class="ruby-string">&quot;&lt;contributor&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;  &lt;name&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;committer_name&#39;</span>}) . <span class="ruby-string">&quot;&lt;/name&gt;\n&quot;</span>;
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;committer_email&#39;</span>}) {
                        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;  &lt;email&gt;&quot;</span> . <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;committer_email&#39;</span>}) . <span class="ruby-string">&quot;&lt;/email&gt;\n&quot;</span>;
                }
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/contributor&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;published&gt;$cd{&#39;iso-8601&#39;}&lt;/published&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;link rel=\&quot;alternate\&quot; type=\&quot;text/html\&quot; href=\&quot;$co_url\&quot; /&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;id&gt;$co_url&lt;/id&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;content type=\&quot;xhtml\&quot; xml:base=\&quot;&quot;</span> . <span class="ruby-identifier">esc_url</span>(<span class="ruby-identifier">$my_url</span>) . <span class="ruby-string">&quot;\&quot;&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;\n&quot;</span>;
        }
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$comment</span> = <span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;comment&#39;</span>};
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;pre&gt;\n&quot;</span>;
        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$line</span> (@<span class="ruby-identifier">$comment</span>) {
                <span class="ruby-identifier">$line</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$line</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;$line\n&quot;</span>;
        }
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/pre&gt;&lt;ul&gt;\n&quot;</span>;
        <span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$difftree_line</span> (<span class="ruby-ivar">@difftree</span>) {
                <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">ifftree</span> = <span class="ruby-identifier">parse_difftree_raw_line</span>(<span class="ruby-identifier">$difftree_line</span>);
                <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$difftree</span>{<span class="ruby-string">&#39;from_id&#39;</span>};

                <span class="ruby-identifier">my</span> <span class="ruby-identifier">$file</span> = <span class="ruby-identifier">$difftree</span>{<span class="ruby-string">&#39;file&#39;</span>} <span class="ruby-operator">||</span> <span class="ruby-identifier">$difftree</span>{<span class="ruby-string">&#39;to_file&#39;</span>};

                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;li&gt;&quot;</span> .
                      <span class="ruby-string">&quot;[&quot;</span> .
                      <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blobdiff&quot;</span>,
                                             <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$difftree</span>{<span class="ruby-string">&#39;to_id&#39;</span>}, <span class="ruby-identifier">hash_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$difftree</span>{<span class="ruby-string">&#39;from_id&#39;</span>},
                                             <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;id&#39;</span>}, <span class="ruby-identifier">hash_parent_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$co</span>{<span class="ruby-string">&#39;parent&#39;</span>},
                                             <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file</span>, <span class="ruby-identifier">file_parent</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$difftree</span>{<span class="ruby-string">&#39;from_file&#39;</span>}),
                              <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;diff&quot;</span>}, <span class="ruby-string">&#39;D&#39;</span>);
                <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$have_blame</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;blame&quot;</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file</span>, <span class="ruby-identifier">hash_base</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>),
                                      <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;blame&quot;</span>}, <span class="ruby-string">&#39;B&#39;</span>);
                }
                <span class="ruby-comment"># if this is not a feed of a file history</span>
                <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$file_name</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">$file_name</span> <span class="ruby-identifier">ne</span> <span class="ruby-identifier">$file</span>) {
                        <span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a</span>({<span class="ruby-operator">-</span><span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">href</span>(<span class="ruby-operator">-</span><span class="ruby-identifier">full</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>, <span class="ruby-identifier">action</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;history&quot;</span>,
                                                     <span class="ruby-identifier">file_name</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$file</span>, <span class="ruby-identifier">hash</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">$commit</span>),
                                      <span class="ruby-operator">-</span><span class="ruby-identifier">title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;history&quot;</span>}, <span class="ruby-string">&#39;H&#39;</span>);
                }
                <span class="ruby-identifier">$file</span> = <span class="ruby-identifier">esc_path</span>(<span class="ruby-identifier">$file</span>);
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;] &quot;</span>.
                      <span class="ruby-string">&quot;$file&lt;/li&gt;\n&quot;</span>;
        }
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;rss&#39;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/ul&gt;]]&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;/content:encoded&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;/item&gt;\n&quot;</span>;
        } <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;atom&#39;</span>) {
                <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/ul&gt;\n&lt;/div&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;/content&gt;\n&quot;</span> .
                      <span class="ruby-string">&quot;&lt;/entry&gt;\n&quot;</span>;
        }
}

<span class="ruby-comment"># end of feed</span>
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;rss&#39;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/channel&gt;\n&lt;/rss&gt;\n&quot;</span>;
} <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">$format</span> <span class="ruby-identifier">eq</span> <span class="ruby-string">&#39;atom&#39;</span>) {
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;/feed&gt;\n&quot;</span>;
}
</pre>

<p>}</p>

<p>sub git_rss {</p>

<pre>git_feed(&#39;rss&#39;);</pre>

<p>}</p>

<p>sub git_atom {</p>

<pre>git_feed(&#39;atom&#39;);</pre>

<p>}</p>

<p>sub git_opml {</p>

<pre class="ruby"><span class="ruby-identifier">my</span> <span class="ruby-ivar">@list</span> = <span class="ruby-identifier">git_get_projects_list</span>(<span class="ruby-identifier">$project_filter</span>, <span class="ruby-identifier">$strict_export</span>);
<span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-ivar">@list</span>) {
        <span class="ruby-identifier">die_error</span>(<span class="ruby-value">404</span>, <span class="ruby-string">&quot;No projects found&quot;</span>);
}

<span class="ruby-identifier">print</span> <span class="ruby-identifier">$cgi</span><span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">header</span>(
        <span class="ruby-operator">-</span><span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/xml&#39;</span>,
        <span class="ruby-operator">-</span><span class="ruby-identifier">charset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;utf-8&#39;</span>,
        <span class="ruby-operator">-</span><span class="ruby-identifier">content_disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;inline; filename=&quot;opml.xml&quot;&#39;</span>);

<span class="ruby-identifier">my</span> <span class="ruby-identifier">$title</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$site_name</span>);
<span class="ruby-identifier">my</span> <span class="ruby-identifier">$filter</span> = <span class="ruby-string">&quot; within subdirectory &quot;</span>;
<span class="ruby-keyword">if</span> (<span class="ruby-identifier">defined</span> <span class="ruby-identifier">$project_filter</span>) {
        <span class="ruby-identifier">$filter</span> .= <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">$project_filter</span>);
} <span class="ruby-keyword">else</span> {
        <span class="ruby-identifier">$filter</span> = <span class="ruby-string">&quot;&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&quot;</span>;
</pre>

<p>&lt;?xml version=1.0 encoding=utf-8?&gt; &lt;opml version=1.0&gt;
&lt;head&gt;</p>

<pre>&lt;title&gt;$title OPML Export$filter&lt;/title&gt;</pre>

<p>&lt;/head&gt; &lt;body&gt; &lt;outline text=git RSS feeds&gt; XML</p>

<pre class="ruby"><span class="ruby-identifier">foreach</span> <span class="ruby-identifier">my</span> <span class="ruby-identifier">$pr</span> (<span class="ruby-ivar">@list</span>) {
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">roj</span> = <span class="ruby-string">%Qpr;
        my $</span><span class="ruby-identifier">head</span> = <span class="ruby-identifier">git_get_head_hash</span>(<span class="ruby-identifier">$proj</span>{<span class="ruby-string">&#39;path&#39;</span>});
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">defined</span> <span class="ruby-identifier">$head</span>) {
                <span class="ruby-keyword">next</span>;
        }
        <span class="ruby-identifier">$git_dir</span> = <span class="ruby-string">&quot;$projectroot/$proj{&#39;path&#39;}&quot;</span>;
        <span class="ruby-identifier">my</span> <span class="ruby-operator">%</span><span class="ruby-identifier">o</span> = <span class="ruby-identifier">parse_commit</span>(<span class="ruby-identifier">$head</span>);
        <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-operator">%</span><span class="ruby-identifier">o</span>) {
                <span class="ruby-keyword">next</span>;
        }

        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$path</span> = <span class="ruby-identifier">esc_html</span>(<span class="ruby-identifier">chop_str</span>(<span class="ruby-identifier">$proj</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-value">25</span>, <span class="ruby-value">5</span>));
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$rss</span>  = <span class="ruby-identifier">href</span>(<span class="ruby-string">&#39;project&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$proj</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-string">&#39;action&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;rss&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">full</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
        <span class="ruby-identifier">my</span> <span class="ruby-identifier">$html</span> = <span class="ruby-identifier">href</span>(<span class="ruby-string">&#39;project&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$proj</span>{<span class="ruby-string">&#39;path&#39;</span>}, <span class="ruby-string">&#39;action&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;summary&#39;</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">full</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>);
        <span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&lt;outline type=\&quot;rss\&quot; text=\&quot;$path\&quot; title=\&quot;$path\&quot; xmlUrl=\&quot;$rss\&quot; htmlUrl=\&quot;$html\&quot;/&gt;\n&quot;</span>;
}
<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;&quot;</span>;
</pre>

<p>&lt;/outline&gt; &lt;/body&gt; &lt;/opml&gt; XML }</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

